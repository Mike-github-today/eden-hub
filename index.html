<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Eden Hub - Associates Portal</title>
    <style>
        /* ============================================
           EDEN CALM DESIGN SYSTEM
           ============================================ */

        :root {
            /* Core Palette - NO GREY */
            --pure-white: #FFFFFF;
            --eden-mint: #F4F7F6;
            --eden-green: #2D5F4D;
            --eden-green-hover: #245040;
            --eden-green-light: #E8F0ED;
            --eden-text: #1A3329;
            --eden-text-primary: #111827;
            --eden-text-secondary: #4A6259;
            --eden-text-muted: #9ca3af;
            --eden-border: #D4E5DE;
            --eden-surface: #f4f7f6;

            /* Alert Colours (Friction Feed) */
            --alert-amber: #F59E0B;
            --alert-rose: #EF4444;
            --alert-blue: #3B82F6;

            /* Referral System Colours */
            --referral-new: #9b59b6;
            --referral-broadcasting: #3498db;
            --referral-pending: #f39c12;
            --referral-accepted: #27ae60;
            --referral-declined: #95a5a6;

            /* Component Tokens */
            --radius-standard: 8px;
            --radius-card: 12px;
            --transition-smooth: 300ms ease-out;

            /* Layout */
            --sidebar-width: 260px;
            --side-panel-width: 450px;
            --bottom-sheet-height: 85vh;

            /* iOS Safe Area Support */
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
        }

        /* Typography - System Fonts */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--eden-text);
            background-color: var(--pure-white);
        }

        /* Body scroll lock when panel is open */
        body.panel-open {
            overflow: hidden;
        }

        /* ============================================
           LAYOUT STRUCTURE
           ============================================ */

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--eden-mint);
            border-right: 1px solid var(--eden-border);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            /* HEIGHT FIX - Use dvh with fallback for iOS Safari */
            height: 100vh;
            height: 100dvh;
            z-index: 100;
            transition: transform var(--transition-smooth);
            overflow: hidden;
        }

        .sidebar-header {
            flex-shrink: 0;
            padding: 24px 16px 16px;
        }

        .sidebar-nav-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px;
            padding-bottom: calc(80px + env(safe-area-inset-bottom));
        }

        .sidebar-footer {
            flex-shrink: 0;
            padding: 16px;
            border-top: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            color: var(--eden-green);
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-green);
            letter-spacing: -0.5px;
        }

        /* Navigation */
        .nav-section {
            margin-bottom: 24px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-standard);
            cursor: pointer;
            transition: all var(--transition-smooth);
            color: var(--eden-text-secondary);
            text-decoration: none;
        }

        .nav-item:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-text);
        }

        .nav-item.active {
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            stroke-width: 1.5;
        }

        .nav-item span {
            font-size: 14px;
            font-weight: 500;
        }

        /* Alert dot for Action Centre */
        .nav-item .alert-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--alert-amber);
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* User Profile Section */
        .user-profile-section {
            /* Now inside sidebar-footer, no need for margin-top: auto */
        }

        .user-profile-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--eden-green);
            color: var(--pure-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 11px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 4px;
        }

        .role-badge-admin {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .role-badge-associate {
            background-color: #E8F0ED;
            color: var(--eden-text-secondary);
        }

        .role-toggle-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background-color: var(--eden-green-light, #E8F0ED);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-smooth);
            z-index: 9999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .role-toggle-btn:hover {
            background-color: var(--eden-green, #2d5f4d);
            transform: scale(1.1);
        }

        .role-toggle-btn:hover svg {
            color: white;
        }

        .role-toggle-btn svg {
            width: 18px;
            height: 18px;
            color: var(--eden-green, #2d5f4d);
        }

        /* Access Denied Notification */
        .access-denied-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background-color: var(--eden-text);
            color: var(--pure-white);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease-out;
        }

        .access-denied-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 32px;
            transition: margin-right var(--transition-smooth);
        }

        .main-content.panel-open {
            margin-right: var(--side-panel-width);
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* ============================================
           ID CARD GRID
           ============================================ */

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .id-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .id-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
            transform: translateY(-2px);
        }

        .id-card-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-green);
            flex-shrink: 0;
        }

        .id-card-info {
            flex: 1;
            min-width: 0;
        }

        .id-card-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 2px;
        }

        .id-card-ucid {
            font-size: 12px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .support-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .support-badge.independent {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .support-badge.supported {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .id-card-stats {
            display: flex;
            gap: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--eden-border);
        }

        .stat {
            flex: 1;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .stat-label {
            font-size: 11px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Capacity bar */
        .capacity-bar {
            height: 4px;
            background-color: var(--eden-border);
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background-color: var(--eden-green);
            border-radius: 2px;
            transition: width var(--transition-smooth);
        }

        /* ============================================
           SIDE PANEL (Desktop)
           ============================================ */

        .side-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--side-panel-width);
            height: 100vh;
            background-color: var(--pure-white);
            border-left: 1px solid var(--eden-border);
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            z-index: 200;
            display: flex;
            flex-direction: column;
        }

        .side-panel.open {
            transform: translateX(0);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            padding-top: calc(var(--safe-area-top) + 20px);
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .panel-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-green);
        }

        .panel-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .panel-ucid {
            font-size: 12px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text-secondary);
            transition: all var(--transition-smooth);
        }

        .close-btn:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-text);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--eden-border);
            padding: 0 24px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 14px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text-secondary);
            background: none;
            border: none;
            cursor: pointer;
            white-space: nowrap;
            position: relative;
            transition: color var(--transition-smooth);
        }

        .tab-btn:hover {
            color: var(--eden-text);
        }

        .tab-btn.active {
            color: var(--eden-green);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--eden-green);
        }

        /* Tab Content */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .tab-panel {
            display: none;
            animation: fadeIn 300ms ease-out;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Panel Content Styles */
        .section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .info-group {
            margin-bottom: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--eden-border);
        }

        .info-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .info-value {
            font-size: 14px;
            color: var(--eden-text);
            font-weight: 500;
            text-align: right;
        }

        /* Overview Tab Styles */
        .overview-stats-row {
            display: flex;
            gap: 12px;
        }

        .overview-stat-card {
            flex: 1;
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .overview-stat-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 2px 8px rgba(45, 95, 77, 0.1);
        }

        .overview-stat-card.tappable-earnings {
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
        }

        .overview-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .overview-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .stat-arrow {
            color: var(--eden-green);
        }

        .view-clients-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: var(--eden-text);
            transition: all var(--transition-fast);
        }

        .view-clients-btn:hover {
            border-color: var(--eden-green);
            box-shadow: 0 2px 8px rgba(45, 95, 77, 0.1);
        }

        .view-clients-btn svg:first-child {
            color: var(--eden-green);
        }

        .view-clients-btn span {
            flex: 1;
            text-align: left;
        }

        .view-clients-btn .btn-arrow {
            color: var(--eden-text-secondary);
        }

        .overview-divider {
            height: 1px;
            background: var(--eden-border);
            margin: 24px 0;
        }

        .info-row.tappable-row {
            cursor: pointer;
            transition: background-color var(--transition-fast);
            margin: 0 -16px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
        }

        .info-row.tappable-row:hover {
            background-color: var(--eden-mint);
        }

        .info-row.tappable-row .info-value {
            flex: 1;
        }

        .info-link {
            color: var(--eden-green) !important;
        }

        .row-arrow {
            margin-left: 8px;
            flex-shrink: 0;
        }

        .status-badge-inline {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge-inline.active {
            background: #f0fdf4;
            color: #166534;
        }

        .status-badge-inline.onboarding {
            background: #fef3c7;
            color: #b45309;
        }

        /* Navigation Header (for back button views) */
        .navigation-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            background: var(--eden-mint);
            border-bottom: 1px solid var(--eden-border);
            position: relative;
            z-index: 10;
        }

        .nav-back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text-secondary);
            transition: all var(--transition-fast);
        }

        .nav-back-btn:hover {
            background: var(--eden-mint);
            color: var(--eden-green);
        }

        .nav-header-title {
            flex: 1;
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .nav-header-subtitle {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* Panel Views (pushed views like Inbox, Capacity) */
        .panel-view {
            padding: 24px;
            animation: fadeIn 200ms ease-out;
        }

        /* Inbox View Styles */
        .inbox-messages-list {
            display: flex;
            flex-direction: column;
        }

        .inbox-message-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--eden-border);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .inbox-message-item:hover {
            background: var(--eden-mint);
        }

        .inbox-message-unread-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--eden-green);
            margin-top: 6px;
            flex-shrink: 0;
        }

        .inbox-message-content {
            flex: 1;
            min-width: 0;
        }

        .inbox-message-subject {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
            margin-bottom: 2px;
        }

        .inbox-message-item.unread .inbox-message-subject {
            font-weight: 600;
        }

        .inbox-message-from {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .inbox-message-date {
            font-size: 12px;
            color: var(--eden-text-muted);
            flex-shrink: 0;
        }

        /* Capacity View Styles */
        .capacity-gauge-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 32px;
            text-align: center;
            margin-bottom: 16px;
        }

        .capacity-gauge-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--eden-green);
            margin-bottom: 4px;
        }

        .capacity-gauge-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin-bottom: 16px;
        }

        .capacity-progress-bar {
            height: 12px;
            background: var(--eden-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .capacity-progress-fill {
            height: 100%;
            background: var(--eden-green);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .capacity-info-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 20px;
            margin-bottom: 16px;
        }

        .capacity-stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 12px;
        }

        .capacity-stat {
            text-align: center;
        }

        .capacity-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .capacity-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .capacity-next-slot {
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .capacity-next-slot-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .capacity-next-slot-value {
            font-size: 15px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .capacity-todo-note {
            font-size: 11px;
            color: var(--eden-text-muted);
            text-align: center;
            margin-top: 24px;
        }

        /* Email Detail View Styles */
        .email-detail-header {
            margin-bottom: 20px;
        }

        .email-detail-subject {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0 0 12px 0;
        }

        .email-detail-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .email-detail-body {
            padding-top: 20px;
            border-top: 1px solid var(--eden-border);
            font-size: 14px;
            line-height: 1.6;
            color: var(--eden-text);
            white-space: pre-line;
        }

        /* Payout Cockpit View Styles */
        .payout-stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .payout-stat-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 20px;
            text-align: center;
        }

        .payout-stat-card.pending {
            background: #fffbeb;
            border-color: #fcd34d;
        }

        .payout-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-green);
        }

        .payout-stat-card.pending .payout-stat-value {
            color: #b45309;
        }

        .payout-stat-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .payout-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .payout-history-item {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .payout-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .payout-month {
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-status {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .payout-status.pending {
            background: #fef3c7;
            color: #b45309;
        }

        .payout-status.completed {
            background: #f0fdf4;
            color: #166534;
        }

        .payout-history-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payout-amount {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-date {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        /* Enhanced Associate Payout Cockpit Styles */
        .earnings-hero {
            background: linear-gradient(135deg, var(--eden-green) 0%, #3d7a66 100%);
            border-radius: var(--radius-standard);
            padding: 24px;
            color: white;
            margin-bottom: 20px;
        }

        .earnings-hero-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .earnings-hero-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .earnings-hero-subtitle {
            font-size: 13px;
            opacity: 0.8;
        }

        .earnings-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 16px;
            overflow: hidden;
        }

        .earnings-progress-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .earnings-progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            opacity: 0.8;
        }

        .earnings-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .earnings-breakdown-card {
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
            text-align: center;
        }

        .earnings-breakdown-card.awaiting {
            background: #fffbeb;
            border: 1px solid #fcd34d;
        }

        .earnings-breakdown-card.ready {
            background: #f0fdf4;
            border: 1px solid #86efac;
        }

        .earnings-breakdown-card.paid {
            background: #f0f9ff;
            border: 1px solid #93c5fd;
        }

        .earnings-breakdown-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--eden-text);
        }

        .earnings-breakdown-card.awaiting .earnings-breakdown-value {
            color: #b45309;
        }

        .earnings-breakdown-card.ready .earnings-breakdown-value {
            color: #166534;
        }

        .earnings-breakdown-card.paid .earnings-breakdown-value {
            color: #1d4ed8;
        }

        .earnings-breakdown-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .earnings-breakdown-count {
            font-size: 11px;
            color: var(--eden-text-secondary);
            margin-top: 2px;
        }

        /* Session List in Payout Cockpit */
        .session-group {
            margin-bottom: 20px;
        }

        .session-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .session-group-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-group-count {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            margin-bottom: 8px;
        }

        .session-item:last-child {
            margin-bottom: 0;
        }

        .session-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .session-status-dot.awaiting { background: #f59e0b; }
        .session-status-dot.paid { background: #10b981; }
        .session-status-dot.ready { background: #3b82f6; }
        .session-status-dot.paid-out { background: #6366f1; }

        .session-item-info {
            flex: 1;
            min-width: 0;
        }

        .session-item-date {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .session-item-client {
            font-size: 12px;
            color: var(--eden-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .session-item-amounts {
            text-align: right;
        }

        .session-item-rate {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-item-share {
            font-size: 12px;
            color: var(--eden-green);
        }

        /* Payout History Enhanced */
        .payout-history-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 12px;
        }

        .payout-history-card:last-child {
            margin-bottom: 0;
        }

        .payout-history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .payout-history-period {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-history-status {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .payout-history-status.paid {
            background: #f0fdf4;
            color: #166534;
        }

        .payout-history-status.pending {
            background: #fffbeb;
            color: #b45309;
        }

        .payout-history-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .payout-history-sessions {
            color: var(--eden-text-secondary);
        }

        .payout-history-amount {
            font-weight: 600;
            color: var(--eden-green);
        }

        .payout-history-paid-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        /* Collapsible Section */
        .collapsible-section {
            margin-bottom: 16px;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
            border-bottom: 1px solid var(--eden-border);
        }

        .collapsible-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .collapsible-toggle {
            color: var(--eden-text-secondary);
            transition: transform 0.2s ease;
        }

        .collapsible-section.open .collapsible-toggle {
            transform: rotate(180deg);
        }

        .collapsible-content {
            padding-top: 12px;
            display: none;
        }

        .collapsible-section.open .collapsible-content {
            display: block;
        }

        /* Admin Payment Tracker Styles */
        .payment-overview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .payment-overview-grid {
                grid-template-columns: 1fr;
            }
        }

        .payment-overview-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 20px;
            text-align: center;
            transition: box-shadow var(--transition-fast);
        }

        .payment-overview-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .payment-overview-card.awaiting {
            border-left: 4px solid #f59e0b;
        }

        .payment-overview-card.paid {
            border-left: 4px solid #10b981;
        }

        .payment-overview-card.overdue {
            border-left: 4px solid #ef4444;
        }

        .payment-overview-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .payment-overview-card.awaiting .payment-overview-value {
            color: #b45309;
        }

        .payment-overview-card.paid .payment-overview-value {
            color: #166534;
        }

        .payment-overview-card.overdue .payment-overview-value {
            color: #dc2626;
        }

        .payment-overview-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .payment-overview-count {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Unmatched Payments Alert */
        .unmatched-alert {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: var(--radius-standard);
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .unmatched-alert-icon {
            width: 40px;
            height: 40px;
            background: #fee2e2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc2626;
            flex-shrink: 0;
        }

        .unmatched-alert-content {
            flex: 1;
        }

        .unmatched-alert-title {
            font-size: 14px;
            font-weight: 600;
            color: #991b1b;
            margin-bottom: 4px;
        }

        .unmatched-alert-desc {
            font-size: 13px;
            color: #b91c1c;
        }

        .unmatched-alert-action {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .unmatched-alert-action:hover {
            background: #b91c1c;
        }

        /* Payment Table */
        .payment-table-container {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            overflow: hidden;
        }

        .payment-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-mint);
        }

        .payment-table-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payment-table-filters {
            display: flex;
            gap: 8px;
        }

        .payment-filter-btn {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .payment-filter-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .payment-filter-btn.active {
            background: var(--eden-green);
            border-color: var(--eden-green);
            color: white;
        }

        .payment-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payment-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-whisper);
        }

        .payment-table td {
            padding: 14px 16px;
            font-size: 14px;
            color: var(--eden-text);
            border-bottom: 1px solid var(--eden-border);
        }

        .payment-table tr:last-child td {
            border-bottom: none;
        }

        .payment-table tr:hover {
            background: var(--eden-whisper);
        }

        .payment-table-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .payment-table-status.awaiting {
            background: #fef3c7;
            color: #b45309;
        }

        .payment-table-status.paid {
            background: #f0fdf4;
            color: #166534;
        }

        .payment-table-status.overdue {
            background: #fef2f2;
            color: #dc2626;
        }

        .payment-table-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .payment-table-amount {
            font-weight: 600;
        }

        .payment-table-associate {
            color: var(--eden-green);
            cursor: pointer;
        }

        .payment-table-associate:hover {
            text-decoration: underline;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--eden-text-secondary);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            opacity: 0.4;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* Payout Pipeline Cards */
        .payout-pipeline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .payout-pipeline-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 20px;
            transition: box-shadow var(--transition-fast);
        }

        .payout-pipeline-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .payout-pipeline-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .payout-pipeline-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--eden-green-light);
            color: var(--eden-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .payout-pipeline-info {
            flex: 1;
        }

        .payout-pipeline-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-pipeline-sessions {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .payout-pipeline-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 16px 0;
            border-top: 1px solid var(--eden-border);
            border-bottom: 1px solid var(--eden-border);
        }

        .payout-pipeline-amount {
            text-align: center;
        }

        .payout-pipeline-amount-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-pipeline-amount-label {
            font-size: 11px;
            color: var(--eden-text-secondary);
            margin-top: 2px;
        }

        .payout-pipeline-action {
            margin-top: 16px;
        }

        .payout-pipeline-btn {
            width: 100%;
            background: var(--eden-green);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background var(--transition-fast);
        }

        .payout-pipeline-btn:hover {
            background: var(--eden-green-dark);
        }

        .payout-pipeline-btn.secondary {
            background: transparent;
            color: var(--eden-green);
            border: 1px solid var(--eden-green);
        }

        .payout-pipeline-btn.secondary:hover {
            background: var(--eden-green-light);
        }

        /* Needs Attention Section */
        .needs-attention-section {
            background: #fef2f2;
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 20px;
        }

        .needs-attention-section .section-title {
            color: #dc2626;
        }

        .attention-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--pure-white);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .attention-item:last-child {
            margin-bottom: 0;
        }

        .attention-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .attention-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .attention-icon.warning {
            background: #fef3c7;
            color: #b45309;
        }

        .attention-icon.urgent {
            background: #fef2f2;
            color: #dc2626;
        }

        .attention-text {
            flex: 1;
            font-size: 14px;
            color: var(--eden-text);
        }

        .attention-arrow {
            color: var(--eden-text-secondary);
        }

        /* Therapist link in client cards */
        .therapist-link {
            color: var(--eden-green) !important;
            cursor: pointer;
            transition: opacity var(--transition-fast);
        }

        .therapist-link:hover {
            opacity: 0.8;
        }

        /* Payout name link */
        .payout-name.tappable,
        .payout-detail-name.tappable {
            color: var(--eden-green);
            cursor: pointer;
            transition: opacity var(--transition-fast);
        }

        .payout-name.tappable:hover,
        .payout-detail-name.tappable:hover {
            opacity: 0.8;
        }

        /* Session Timeline */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--eden-border);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-dot {
            position: absolute;
            left: -24px;
            top: 4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: var(--eden-green);
            border: 3px solid var(--pure-white);
        }

        .timeline-dot.upcoming {
            background-color: var(--alert-blue);
        }

        .timeline-dot.past {
            background-color: var(--eden-border);
        }

        .timeline-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .timeline-content {
            font-size: 14px;
            color: var(--eden-text);
        }

        /* Contract Cards */
        .contract-card {
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 12px;
        }

        .contract-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .contract-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .contract-status {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .contract-status.signed {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .contract-status.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .contract-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Finance Summary */
        .finance-stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .finance-stat {
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
            text-align: center;
        }

        .finance-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-green);
        }

        .finance-stat-label {
            font-size: 11px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Split breakdown */
        .split-bar {
            display: flex;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .split-associate {
            background-color: var(--eden-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--pure-white);
            font-size: 11px;
            font-weight: 600;
        }

        .split-eden {
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
            font-size: 11px;
            font-weight: 600;
        }

        /* Message List */
        .message-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--eden-border);
        }

        .message-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-subject {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
            margin-bottom: 2px;
        }

        .message-preview {
            font-size: 13px;
            color: var(--eden-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .message-date {
            font-size: 11px;
            color: var(--eden-text-secondary);
            white-space: nowrap;
        }

        /* Enhanced Inbox Styles */
        .message-item {
            cursor: pointer;
            transition: all var(--transition-smooth);
            border-radius: var(--radius-standard);
            margin: 0 -8px;
            padding: 12px 8px;
        }

        .message-item:hover {
            background-color: var(--eden-green-light);
        }

        .message-item.unread .message-subject {
            font-weight: 600;
        }

        .message-item.unread::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--eden-green);
        }

        .inbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .compose-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: var(--eden-green);
            color: var(--pure-white);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .compose-btn:hover {
            background-color: var(--eden-green-hover);
        }

        .compose-btn svg {
            width: 14px;
            height: 14px;
        }

        /* Message Viewer Panel */
        .message-viewer {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 500px;
            max-width: 100%;
            background-color: var(--pure-white);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 270;
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            display: flex;
            flex-direction: column;
        }

        .message-viewer.open {
            transform: translateX(0);
        }

        .message-viewer-header {
            padding: 20px;
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .message-viewer-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 16px;
            border-radius: var(--radius-standard);
            transition: all var(--transition-smooth);
        }

        .message-viewer-back:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .message-viewer-subject {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 8px;
        }

        .message-viewer-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .message-viewer-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px 20px;
        }

        .message-viewer-body {
            font-size: 14px;
            line-height: 1.7;
            color: var(--eden-text-primary);
        }

        .message-viewer-body p {
            margin-bottom: 16px;
        }

        .message-viewer-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--eden-border);
            background-color: var(--eden-surface);
        }

        .message-actions {
            display: flex;
            gap: 12px;
        }

        .message-action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius-standard);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .message-action-btn.reply {
            border: none;
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .message-action-btn.reply:hover {
            background-color: var(--eden-green-hover);
        }

        .message-action-btn.archive {
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            color: var(--eden-text-secondary);
        }

        .message-action-btn.archive:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        @media (max-width: 768px) {
            .message-viewer {
                width: 100%;
            }
        }

        /* ============================================
           BOTTOM SHEET (Mobile)
           ============================================ */

        .bottom-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(26, 51, 41, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-smooth);
            z-index: 299;
        }

        .bottom-sheet-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .bottom-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: var(--bottom-sheet-height);
            background-color: var(--pure-white);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            transform: translateY(100%);
            transition: transform var(--transition-smooth);
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .bottom-sheet.open {
            transform: translateY(0);
        }

        .bottom-sheet-handle-area {
            padding: 12px 0;
            padding-top: calc(var(--safe-area-top) + 12px);
            cursor: grab;
            touch-action: none;
        }

        .bottom-sheet-handle-area:active {
            cursor: grabbing;
        }

        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background-color: var(--eden-border);
            border-radius: 2px;
            margin: 0 auto;
            transition: background-color var(--transition-smooth);
        }

        .bottom-sheet-handle-area:hover .bottom-sheet-handle {
            background-color: var(--eden-text-secondary);
        }

        /* ============================================
           MOBILE NAVIGATION
           ============================================ */

        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: calc(var(--safe-area-top) + 56px);
            background-color: var(--eden-mint);
            border-bottom: 1px solid var(--eden-border);
            padding: 0 16px;
            padding-top: var(--safe-area-top);
            align-items: center;
            justify-content: space-between;
            z-index: 99;
        }

        .mobile-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mobile-logo svg {
            width: 28px;
            height: 28px;
            color: var(--eden-green);
        }

        .mobile-logo span {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-green);
        }

        .menu-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text);
        }

        /* ============================================
           RESPONSIVE STYLES
           ============================================ */

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .mobile-header {
                display: flex;
            }

            .main-content {
                margin-left: 0;
                padding: calc(var(--safe-area-top) + 72px) 16px 16px;
            }

            .main-content.panel-open {
                margin-right: 0;
            }

            .side-panel {
                display: none;
            }

            .bottom-sheet {
                display: flex;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 24px;
            }
        }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(26, 51, 41, 0.4);
            z-index: 99;
        }

        @media (max-width: 768px) {
            .sidebar-overlay.open {
                display: block;
            }
        }

        /* ============================================
           DASHBOARD SUMMARY CARDS
           ============================================ */

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .summary-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 24px;
            transition: all var(--transition-smooth);
        }

        .summary-card.clickable {
            cursor: pointer;
        }

        .summary-card.clickable:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
            transform: translateY(-2px);
        }

        .summary-card-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: var(--eden-green);
        }

        .summary-card-icon svg {
            width: 20px;
            height: 20px;
            stroke-width: 1.5;
        }

        .summary-card-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .summary-card-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .summary-card-action {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 12px;
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-green);
        }

        .summary-card-action svg {
            width: 16px;
            height: 16px;
        }

        /* Analytics Card Enhancements */
        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .summary-card-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
        }

        .summary-card-trend.up {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .summary-card-trend.down {
            background-color: #FCE7E7;
            color: #B91C1C;
        }

        .summary-card-trend.neutral {
            background-color: var(--eden-surface);
            color: var(--eden-text-secondary);
        }

        .summary-card-trend svg {
            width: 12px;
            height: 12px;
        }

        .summary-card-sparkline {
            height: 40px;
            margin: 12px 0;
            display: flex;
            align-items: flex-end;
            gap: 3px;
        }

        .sparkline-bar {
            flex: 1;
            background-color: var(--eden-green-light);
            border-radius: 2px 2px 0 0;
            transition: all var(--transition-smooth);
            min-height: 4px;
        }

        .sparkline-bar:hover {
            background-color: var(--eden-green);
        }

        .sparkline-bar.highlight {
            background-color: var(--eden-green);
        }

        .summary-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--eden-border);
        }

        .summary-card-detail {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .summary-card-detail strong {
            color: var(--eden-text-primary);
        }

        /* Analytics Section */
        .analytics-section {
            margin-top: 32px;
        }

        .analytics-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .analytics-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text-primary);
        }

        .analytics-period-toggle {
            display: flex;
            gap: 4px;
            padding: 4px;
            background-color: var(--eden-surface);
            border-radius: var(--radius-standard);
        }

        .analytics-period-btn {
            padding: 6px 12px;
            border: none;
            background: none;
            font-size: 12px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all var(--transition-smooth);
        }

        .analytics-period-btn.active {
            background-color: var(--pure-white);
            color: var(--eden-text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .analytics-metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .analytics-metric-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 16px;
            text-align: center;
        }

        .analytics-metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-text-primary);
            margin-bottom: 4px;
        }

        .analytics-metric-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-bottom: 8px;
        }

        .analytics-metric-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .analytics-metric-change.up {
            color: var(--eden-green);
        }

        .analytics-metric-change.down {
            color: #B91C1C;
        }

        @media (max-width: 768px) {
            .analytics-metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* View containers */
        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
            animation: fadeIn 300ms ease-out;
        }

        /* Action items list */
        .action-list {
            margin-top: 8px;
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            font-size: 13px;
            color: var(--eden-text);
            border-bottom: 1px solid var(--eden-border);
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .action-dot.amber {
            background-color: var(--alert-amber);
        }

        .action-dot.rose {
            background-color: var(--alert-rose);
        }

        /* ============================================
           PIPELINE STRIP (Horizontal)
           ============================================ */

        .pipeline-strip {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .pipeline-stage {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
            white-space: nowrap;
            background-color: var(--eden-mint);
            color: var(--eden-text-secondary);
            border: 1px solid transparent;
        }

        .pipeline-stage:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-text);
        }

        .pipeline-stage.active {
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .pipeline-stage .count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .pipeline-stage:not(.active) .count {
            background-color: var(--eden-border);
            color: var(--eden-text-secondary);
        }

        /* ============================================
           CLIENT MINI-CARDS
           ============================================ */

        .client-mini-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .client-mini-card {
            background-color: var(--eden-mint);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 14px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .client-mini-card:hover {
            border-color: var(--eden-green);
            background-color: var(--pure-white);
        }

        .client-mini-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .client-mini-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-green);
            flex-shrink: 0;
        }

        .client-mini-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .client-mini-id {
            font-size: 11px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .client-mini-stage {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .client-mini-stage.awaiting {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .client-mini-stage.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .client-mini-stage.active {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .client-mini-stage.ending {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        /* ============================================
           CLIENT DETAIL PANEL (Stacked)
           ============================================ */

        .client-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--side-panel-width);
            height: 100vh;
            background-color: var(--pure-white);
            border-left: 1px solid var(--eden-border);
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            z-index: 250; /* Higher than associate panel (200) */
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 20px rgba(26, 51, 41, 0.15);
        }

        .client-panel.open {
            transform: translateX(0);
        }

        .client-panel .panel-header {
            background-color: var(--eden-green-light);
        }

        /* Vertical Pipeline (Editable) */
        .vertical-pipeline {
            padding: 16px 24px;
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .vertical-pipeline-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 10px;
        }

        .vertical-pipeline-stages {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .vertical-stage {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-standard);
            cursor: pointer;
            transition: all var(--transition-smooth);
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
        }

        .vertical-stage:hover {
            border-color: var(--eden-green);
        }

        .vertical-stage.current {
            background-color: var(--eden-green);
            border-color: var(--eden-green);
            color: var(--pure-white);
        }

        .vertical-stage-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid currentColor;
            flex-shrink: 0;
        }

        .vertical-stage.current .vertical-stage-dot {
            background-color: var(--pure-white);
            border-color: var(--pure-white);
        }

        .vertical-stage-name {
            font-size: 13px;
            font-weight: 500;
        }

        .vertical-stage.awaiting .vertical-stage-dot { border-color: #3B82F6; }
        .vertical-stage.pending .vertical-stage-dot { border-color: #F59E0B; }
        .vertical-stage.active .vertical-stage-dot { border-color: var(--eden-green); }
        .vertical-stage.ending .vertical-stage-dot { border-color: #EF4444; }

        /* Back button in client panel */
        .panel-back-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            margin-right: auto;
            background: none;
            border: none;
            font-size: 13px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: color var(--transition-smooth);
        }

        .panel-back-btn:hover {
            color: var(--eden-text);
        }

        .panel-back-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Mobile Client Bottom Sheet */
        .client-bottom-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: var(--bottom-sheet-height);
            background-color: var(--pure-white);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            transform: translateY(100%);
            transition: transform var(--transition-smooth);
            z-index: 350; /* Higher than associate bottom sheet (300) */
            display: none;
            flex-direction: column;
            box-shadow: 0 -4px 20px rgba(26, 51, 41, 0.15);
        }

        .client-bottom-sheet.open {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .client-panel {
                display: none;
            }

            .client-bottom-sheet {
                display: flex;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--eden-text-secondary);
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* ============================================
           ACTION CENTRE (FRICTION FEED)
           ============================================ */

        .friction-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .friction-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .friction-item:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
        }

        .friction-item.amber {
            border-left: 4px solid var(--alert-amber);
        }

        .friction-item.rose {
            border-left: 4px solid var(--alert-rose);
        }

        .friction-item.blue {
            border-left: 4px solid var(--alert-blue);
        }

        .friction-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .friction-icon.amber {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .friction-icon.rose {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .friction-icon.blue {
            background-color: #DBEAFE;
            color: #1E40AF;
        }

        .friction-icon svg {
            width: 20px;
            height: 20px;
            stroke-width: 1.5;
        }

        .friction-content {
            flex: 1;
        }

        .friction-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .friction-description {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-bottom: 8px;
        }

        .friction-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .friction-action {
            margin-left: auto;
            padding: 8px 16px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-green);
            cursor: pointer;
            transition: all var(--transition-smooth);
            white-space: nowrap;
        }

        .friction-action:hover {
            background-color: var(--eden-green);
            border-color: var(--eden-green);
            color: var(--pure-white);
        }

        .all-clear-state {
            text-align: center;
            padding: 80px 24px;
        }

        .all-clear-icon {
            margin-bottom: 24px;
        }

        .all-clear-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-green);
            margin-bottom: 8px;
        }

        .all-clear-text {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* Action Centre Summary Cards */
        .action-summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .action-summary-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            position: relative;
            cursor: pointer;
            transition: all var(--transition-smooth);
            text-align: center;
        }

        .action-summary-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
        }

        .action-summary-card.active {
            border-color: var(--eden-green);
            box-shadow: 0 0 0 3px rgba(45, 95, 77, 0.15);
        }

        .action-summary-pulse {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .action-summary-pulse.orange { background-color: #f97316; }
        .action-summary-pulse.blue { background-color: #3b82f6; }
        .action-summary-pulse.purple { background-color: #8b5cf6; }
        .action-summary-pulse.green { background-color: #10b981; }

        .action-summary-count {
            font-size: 32px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 4px;
        }

        .action-summary-count.zero {
            color: var(--eden-text-muted);
        }

        .action-summary-icon {
            display: flex;
            justify-content: center;
            margin-bottom: 4px;
        }

        .action-summary-icon svg {
            width: 18px;
            height: 18px;
            color: var(--eden-text-secondary);
            stroke-width: 1.5;
        }

        .action-summary-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
        }

        .action-filter-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin-bottom: 16px;
            background-color: var(--eden-green-light);
            border-radius: var(--radius-standard);
        }

        .action-filter-indicator span {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .action-filter-indicator span strong {
            color: var(--eden-text);
        }

        .action-filter-clear {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-green);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color var(--transition-smooth);
        }

        .action-filter-clear:hover {
            background-color: rgba(45, 95, 77, 0.1);
        }

        /* ============================================
           EARNINGS / FINANCE GATEWAY
           ============================================ */

        .gateway-card {
            background: linear-gradient(135deg, var(--eden-green) 0%, var(--eden-green-hover) 100%);
            border-radius: var(--radius-card);
            padding: 32px;
            color: var(--pure-white);
            margin-bottom: 32px;
        }

        .gateway-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .gateway-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-standard);
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gateway-label {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
        }

        .gateway-value {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .gateway-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 24px;
        }

        .gateway-breakdown {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .breakdown-row:last-child {
            border-bottom: none;
        }

        .breakdown-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .breakdown-value {
            font-size: 13px;
            font-weight: 600;
        }

        .breakdown-value.negative {
            opacity: 0.8;
        }

        /* True Cash Pulse Indicator */
        .true-cash-pulse {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .pulse-dot.healthy {
            background: #86efac;
            box-shadow: 0 0 8px rgba(134, 239, 172, 0.6);
        }

        .pulse-dot.caution {
            background: #fcd34d;
            box-shadow: 0 0 8px rgba(252, 211, 77, 0.6);
        }

        .pulse-dot.critical {
            background: #fca5a5;
            box-shadow: 0 0 8px rgba(252, 165, 165, 0.6);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .pulse-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .pulse-runway {
            font-size: 12px;
            opacity: 0.7;
            margin-left: auto;
        }

        .wealth-hub-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .wealth-module {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 24px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .wealth-module:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
            transform: translateY(-2px);
        }

        .wealth-module-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
            margin-bottom: 16px;
        }

        .wealth-module-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .wealth-module-desc {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .wealth-module-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .wealth-module-alert {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            background-color: #FEF3C7;
            color: #92400E;
        }

        /* ============================================
           WEALTH PANEL (Full-screen Module Views)
           ============================================ */

        .wealth-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--pure-white);
            z-index: 300;
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .wealth-panel.open {
            transform: translateX(0);
        }

        .wealth-panel-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 24px;
            padding-top: calc(var(--safe-area-top) + 20px);
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .wealth-back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: transparent;
            cursor: pointer;
            color: var(--eden-text-secondary);
            font-size: 14px;
            font-weight: 500;
            transition: all var(--transition-smooth);
        }

        .wealth-back-btn:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .wealth-back-btn svg {
            width: 20px;
            height: 20px;
        }

        .wealth-panel-title {
            flex: 1;
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .wealth-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .wealth-view {
            display: none;
            animation: fadeIn 300ms ease-out;
        }

        .wealth-view.active {
            display: block;
        }

        /* Wealth Panel Cards */
        .wealth-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 24px;
            margin-bottom: 24px;
        }

        .wealth-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .wealth-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wealth-hero-value {
            font-size: 36px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .wealth-hero-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* Wealth Stats Grid */
        .wealth-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .wealth-stat-card {
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .wealth-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .wealth-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .toggle-label.active {
            color: var(--eden-green);
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background-color: var(--eden-border);
            border-radius: 13px;
            cursor: pointer;
            transition: background-color var(--transition-smooth);
        }

        .toggle-switch.active {
            background-color: var(--eden-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: var(--pure-white);
            border-radius: 50%;
            transition: transform var(--transition-smooth);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle-switch.active::after {
            transform: translateX(22px);
        }

        /* Bar Chart */
        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 16px;
            height: 200px;
            padding: 20px 0;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }

        .bar-fill {
            width: 100%;
            max-width: 60px;
            background-color: var(--eden-green);
            border-radius: 4px 4px 0 0;
            transition: height var(--transition-smooth);
            position: relative;
        }

        .bar-fill.projected {
            background-color: var(--eden-green-light);
            border: 2px dashed var(--eden-green);
        }

        .bar-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 8px;
        }

        .bar-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 8px;
            text-align: center;
        }

        .threshold-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--alert-amber);
        }

        .threshold-label {
            position: absolute;
            right: calc(100% + 8px);
            top: -8px;
            font-size: 10px;
            color: var(--alert-amber);
            white-space: nowrap;
        }

        /* Cash Density Specific Styles */
        .cash-chart-container {
            position: relative;
            padding-left: 100px;
        }

        .cash-threshold-marker {
            position: absolute;
            left: 0;
            right: 0;
            border-top: 2px dashed var(--alert-amber);
        }

        .cash-threshold-marker .threshold-text {
            position: absolute;
            left: 0;
            top: -20px;
            font-size: 11px;
            color: var(--alert-amber);
            font-weight: 500;
        }

        .chart-legend {
            display: flex;
            gap: 24px;
            justify-content: center;
            padding-top: 16px;
            border-top: 1px solid var(--eden-border);
            margin-top: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.projected {
            background-color: var(--eden-green-light);
            border: 2px dashed var(--eden-green);
        }

        .legend-text {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Month Breakdown */
        .month-breakdown {
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .month-breakdown:last-child {
            margin-bottom: 0;
        }

        .month-breakdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background-color: var(--eden-mint);
            border-bottom: 1px solid var(--eden-border);
        }

        .month-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .month-status {
            font-size: 11px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .month-status.current {
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .month-status.projected {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .breakdown-details {
            padding: 8px 16px;
        }

        .info-value.positive {
            color: var(--eden-green);
        }

        .info-value.negative {
            color: var(--alert-rose);
        }

        .info-row.total {
            border-top: 2px solid var(--eden-border);
            border-bottom: none;
            margin-top: 8px;
            padding-top: 12px;
            font-weight: 600;
        }

        .info-row.total .info-label,
        .info-row.total .info-value {
            font-weight: 600;
            color: var(--eden-text);
        }

        /* Tax Intelligence Styles */
        .tax-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 8px 0;
        }

        .tax-mode-description {
            text-align: center;
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-top: 8px;
        }

        .health-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .health-badge.healthy {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .health-badge.warning {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .health-badge.danger {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .tax-reserve-meter {
            margin-top: 20px;
        }

        .reserve-progress {
            height: 12px;
            background-color: var(--eden-border);
            border-radius: 6px;
            position: relative;
            overflow: visible;
        }

        .reserve-fill {
            height: 100%;
            background-color: var(--eden-green);
            border-radius: 6px;
            transition: width var(--transition-smooth);
        }

        .reserve-target {
            position: absolute;
            top: -4px;
            width: 4px;
            height: 20px;
            background-color: var(--eden-text);
            border-radius: 2px;
            transform: translateX(-50%);
        }

        .reserve-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .reserve-target-label {
            font-weight: 500;
            color: var(--eden-text);
        }

        .tax-income-summary .income-hero {
            text-align: center;
            padding: 16px 0;
        }

        .income-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .income-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .tax-calculation {
            padding: 16px 0;
        }

        .tax-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .tax-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .tax-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .tax-value.deduction {
            color: var(--alert-rose);
        }

        .tax-divider {
            height: 1px;
            background-color: var(--eden-border);
            margin: 8px 0;
        }

        .tax-row.total {
            padding-top: 12px;
        }

        .tax-row.total .tax-label,
        .tax-row.total .tax-value {
            font-weight: 600;
            font-size: 16px;
            color: var(--eden-text);
        }

        .tax-note {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 12px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
            margin-top: 16px;
        }

        .tax-note svg {
            flex-shrink: 0;
            color: var(--eden-text-secondary);
        }

        .tax-note span {
            font-size: 12px;
            color: var(--eden-text-secondary);
            line-height: 1.4;
        }

        .health-card {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
        }

        .health-card.healthy {
            background-color: var(--eden-green-light);
            border-color: var(--eden-green);
        }

        .health-card.warning {
            background-color: #FEF3C7;
            border-color: #F59E0B;
        }

        .health-card.danger {
            background-color: #FEE2E2;
            border-color: #EF4444;
        }

        .health-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--pure-white);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .health-card.healthy .health-icon {
            color: var(--eden-green);
        }

        .health-card.warning .health-icon {
            color: #F59E0B;
        }

        .health-card.danger .health-icon {
            color: #EF4444;
        }

        .health-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .health-text {
            font-size: 13px;
            color: var(--eden-text-secondary);
            line-height: 1.5;
        }

        /* Post-VAT Mode Styles */
        .combined-tax-hero {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 24px 0;
            flex-wrap: wrap;
        }

        .tax-hero-item {
            text-align: center;
            padding: 16px 24px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
        }

        .tax-hero-item.total {
            background-color: var(--eden-green);
        }

        .tax-hero-item.total .tax-hero-value,
        .tax-hero-item.total .tax-hero-label {
            color: var(--pure-white);
        }

        .tax-hero-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .tax-hero-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .tax-hero-plus,
        .tax-hero-equals {
            font-size: 24px;
            font-weight: 300;
            color: var(--eden-text-secondary);
        }

        .vat-rate-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .vat-summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .vat-stat {
            text-align: center;
            padding: 16px;
            border-radius: var(--radius-standard);
        }

        .vat-stat.collected {
            background-color: var(--eden-green-light);
        }

        .vat-stat.reclaimable {
            background-color: #DBEAFE;
        }

        .vat-stat.owed {
            background-color: #FEF3C7;
        }

        .vat-stat-icon {
            margin-bottom: 8px;
        }

        .vat-stat.collected .vat-stat-icon {
            color: var(--eden-green);
        }

        .vat-stat.reclaimable .vat-stat-icon {
            color: #3B82F6;
        }

        .vat-stat.owed .vat-stat-icon {
            color: #F59E0B;
        }

        .vat-stat-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .vat-stat-label {
            font-size: 11px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Quarterly Schedule */
        .quarterly-schedule {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quarter-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            transition: all var(--transition-smooth);
        }

        .quarter-item.completed {
            background-color: var(--eden-green-light);
            border-color: var(--eden-green);
        }

        .quarter-item.current {
            background-color: #FEF3C7;
            border-color: #F59E0B;
        }

        .quarter-item.future {
            opacity: 0.6;
        }

        .quarter-marker {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quarter-item.completed .quarter-marker {
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .quarter-item.current .quarter-marker {
            background-color: #F59E0B;
        }

        .quarter-item.future .quarter-marker {
            background-color: var(--eden-border);
        }

        .quarter-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--pure-white);
        }

        .quarter-details {
            flex: 1;
        }

        .quarter-period {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .quarter-due {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 2px;
        }

        .quarter-amount {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            text-align: right;
            min-width: 80px;
        }

        .quarter-status {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            min-width: 90px;
            text-align: center;
        }

        .quarter-status.paid {
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .quarter-status.upcoming {
            background-color: #F59E0B;
            color: var(--pure-white);
        }

        .quarter-status.future {
            background-color: var(--eden-border);
            color: var(--eden-text-secondary);
        }

        @media (max-width: 768px) {
            .vat-summary-grid {
                grid-template-columns: 1fr;
            }

            .combined-tax-hero {
                flex-direction: column;
            }

            .tax-hero-plus,
            .tax-hero-equals {
                transform: rotate(90deg);
            }

            .quarter-item {
                flex-wrap: wrap;
            }

            .quarter-amount {
                order: 3;
                width: 100%;
                text-align: left;
                margin-top: 8px;
            }

            .quarter-status {
                order: 4;
            }
        }

        /* ============================================
           PAYOUT COCKPIT
           ============================================ */

        .payout-count-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background-color: #FEF3C7;
            color: #92400E;
        }

        .payout-summary-row {
            display: flex;
            gap: 24px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--eden-border);
        }

        .payout-summary-item {
            flex: 1;
            text-align: center;
        }

        .payout-summary-value {
            display: block;
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-summary-label {
            display: block;
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 4px;
        }

        .payout-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .payout-filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .payout-filter-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .payout-filter-btn.active {
            background-color: var(--eden-green);
            border-color: var(--eden-green);
            color: var(--pure-white);
        }

        .filter-count {
            margin-left: 4px;
            opacity: 0.8;
        }

        .payout-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .payout-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 16px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .payout-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
            transform: translateY(-2px);
        }

        .payout-card.overdue {
            border-left: 4px solid var(--alert-rose);
        }

        .payout-card.pending {
            border-left: 4px solid var(--alert-amber);
        }

        .payout-card.paid {
            border-left: 4px solid var(--eden-green);
            opacity: 0.8;
        }

        .payout-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .payout-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-green);
            flex-shrink: 0;
        }

        .payout-info {
            flex: 1;
            min-width: 0;
        }

        .payout-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-id {
            font-size: 11px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .payout-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .payout-status.overdue {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .payout-status.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .payout-status.paid {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .payout-card-body {
            padding: 8px 0;
        }

        .payout-amount {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .payout-details {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .payout-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--eden-text-secondary);
        }

        .payout-card-footer {
            padding-top: 12px;
            border-top: 1px solid var(--eden-border);
            margin-top: 8px;
            font-size: 12px;
        }

        .overdue-warning {
            color: var(--alert-rose);
            font-weight: 500;
        }

        .due-soon {
            color: var(--alert-amber);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .payout-summary-row {
                flex-direction: column;
                gap: 16px;
            }

            .payout-cards-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Payout Detail View */
        .payout-back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: transparent;
            color: var(--eden-text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all var(--transition-smooth);
        }

        .payout-back-btn:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .payout-detail-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-card);
            margin-bottom: 24px;
        }

        .payout-detail-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-green);
        }

        .payout-detail-info {
            flex: 1;
        }

        .payout-detail-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0;
        }

        .payout-detail-id {
            font-size: 12px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .payout-period {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .session-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .session-stat {
            text-align: center;
            padding: 16px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
        }

        .session-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-stat-label {
            font-size: 11px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .payment-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .payment-history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
        }

        .payment-history-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .payment-history-marker.paid {
            background-color: var(--eden-green);
        }

        .payment-history-marker.pending {
            background-color: var(--alert-amber);
        }

        .payment-history-details {
            flex: 1;
        }

        .payment-history-month {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .payment-history-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .payment-history-amount {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .payout-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .payout-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border-radius: var(--radius-standard);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-smooth);
            flex: 1;
        }

        .payout-action-btn.primary {
            background-color: var(--eden-green);
            border: none;
            color: var(--pure-white);
        }

        .payout-action-btn.primary:hover {
            background-color: var(--eden-green-hover);
        }

        .payout-action-btn.secondary {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            color: var(--eden-text);
        }

        .payout-action-btn.secondary:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        @media (max-width: 768px) {
            .session-stats-grid {
                grid-template-columns: 1fr;
            }

            .payout-actions {
                flex-direction: column;
            }
        }

        /* ============================================
           WEALTH LAB SIMULATOR
           ============================================ */

        .simulator-intro {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .simulator-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
            flex-shrink: 0;
        }

        .simulator-intro-text h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0 0 4px 0;
        }

        .simulator-intro-text p {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin: 0;
        }

        .simulator-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .simulator-inputs,
        .simulator-results {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .simulator-input-group {
            margin-bottom: 20px;
        }

        .simulator-input-group:last-child {
            margin-bottom: 0;
        }

        .simulator-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--eden-text);
        }

        .simulator-value {
            font-weight: 600;
            color: var(--eden-green);
        }

        .simulator-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--eden-border);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .simulator-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--eden-green);
            cursor: pointer;
            border: 3px solid var(--pure-white);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            transition: transform var(--transition-smooth);
        }

        .simulator-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .simulator-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--eden-green);
            cursor: pointer;
            border: 3px solid var(--pure-white);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 11px;
            color: var(--eden-text-secondary);
        }

        .simulator-reset-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            color: var(--eden-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .simulator-reset-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .results-hero {
            text-align: center;
            background-color: var(--eden-green);
            border-color: var(--eden-green);
        }

        .results-hero .wealth-card-title {
            color: rgba(255,255,255,0.8);
        }

        .results-hero-value {
            font-size: 42px;
            font-weight: 600;
            color: var(--pure-white);
            margin: 8px 0;
        }

        .results-hero-label {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
        }

        .results-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--eden-border);
        }

        .results-row:last-child {
            border-bottom: none;
        }

        .results-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .results-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .results-value.negative {
            color: var(--alert-rose);
        }

        .results-divider {
            height: 1px;
            background-color: var(--eden-border);
            margin: 8px 0;
        }

        .results-row.total {
            padding-top: 12px;
            border-bottom: none;
        }

        .results-row.total .results-label,
        .results-row.total .results-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .projection-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .projection-card {
            text-align: center;
            padding: 16px 12px;
        }

        .projection-period {
            font-size: 11px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .projection-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        @media (max-width: 768px) {
            .simulator-layout {
                grid-template-columns: 1fr;
            }

            .projection-cards {
                grid-template-columns: 1fr;
            }

            .results-hero-value {
                font-size: 32px;
            }
        }

        /* ============================================
           SCHEDULE / CALENDAR
           ============================================ */

        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            margin-bottom: 24px;
        }

        .calendar-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text-secondary);
            transition: all var(--transition-smooth);
        }

        .calendar-nav-btn:hover {
            background-color: var(--eden-green-light);
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .calendar-month {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
            min-width: 180px;
            text-align: center;
        }

        .calendar-container {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            margin-bottom: 32px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-day-name {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            padding: 8px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-standard);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .calendar-day:hover {
            background-color: var(--eden-green-light);
        }

        .calendar-day.other-month {
            color: var(--eden-border);
        }

        .calendar-day.today {
            background-color: var(--eden-green);
            color: var(--pure-white);
            font-weight: 600;
        }

        .calendar-day.has-sessions::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--eden-green);
        }

        .calendar-day.today.has-sessions::after {
            background-color: var(--pure-white);
        }

        .today-sessions {
            margin-top: 24px;
        }

        .session-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .session-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
        }

        .session-time {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-green);
            min-width: 60px;
        }

        .session-info {
            flex: 1;
        }

        .session-client {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-associate {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .session-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        /* Session Detail Panel */
        .session-detail-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 420px;
            max-width: 100%;
            background-color: var(--pure-white);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 250;
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            display: flex;
            flex-direction: column;
        }

        .session-detail-panel.open {
            transform: translateX(0);
        }

        .session-detail-header {
            padding: 20px;
            padding-top: calc(var(--safe-area-top) + 20px);
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .session-detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 12px;
            border-radius: var(--radius-standard);
            transition: all var(--transition-smooth);
        }

        .session-detail-back:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .session-detail-date {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0;
        }

        .session-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .session-detail-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--eden-text-secondary);
        }

        .session-detail-empty svg {
            margin-bottom: 16px;
            color: var(--eden-border);
        }

        .session-detail-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 12px;
            transition: all var(--transition-smooth);
        }

        .session-detail-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 2px 8px rgba(45, 95, 77, 0.1);
        }

        .session-detail-card.confirmed {
            border-left: 4px solid var(--eden-green);
        }

        .session-detail-card.pending {
            border-left: 4px solid var(--alert-amber);
        }

        .session-detail-card.cancelled {
            border-left: 4px solid var(--alert-rose);
            opacity: 0.7;
        }

        .session-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .session-card-time {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-card-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .session-card-status.confirmed {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .session-card-status.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .session-card-status.cancelled {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .session-card-client {
            font-size: 16px;
            font-weight: 500;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .session-card-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .session-card-meta-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--eden-text-secondary);
        }

        .session-card-actions {
            display: flex;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid var(--eden-border);
        }

        .session-action-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: var(--radius-standard);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .session-action-btn.primary {
            background-color: var(--eden-green);
            border: none;
            color: var(--pure-white);
        }

        .session-action-btn.primary:hover {
            background-color: var(--eden-green-hover);
        }

        .session-action-btn.secondary {
            background-color: transparent;
            border: 1px solid var(--eden-border);
            color: var(--eden-text-secondary);
        }

        .session-action-btn.secondary:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .calendar-day.clickable {
            cursor: pointer;
        }

        .calendar-day.clickable:hover {
            background-color: var(--eden-green-light);
            border-color: var(--eden-green);
        }

        @media (max-width: 768px) {
            .session-detail-panel {
                width: 100%;
            }
        }

        /* Resolution Drawer */
        .resolution-drawer {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 440px;
            max-width: 100%;
            background-color: var(--pure-white);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 260;
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            display: flex;
            flex-direction: column;
        }

        .resolution-drawer.open {
            transform: translateX(0);
        }

        .resolution-drawer-header {
            padding: 20px;
            padding-top: calc(var(--safe-area-top) + 20px);
            border-bottom: 1px solid var(--eden-border);
        }

        .resolution-drawer-header.amber {
            background: linear-gradient(135deg, #FEF3C7 0%, var(--pure-white) 100%);
        }

        .resolution-drawer-header.rose {
            background: linear-gradient(135deg, #FCE7E7 0%, var(--pure-white) 100%);
        }

        .resolution-drawer-header.blue {
            background: linear-gradient(135deg, #E0F2FE 0%, var(--pure-white) 100%);
        }

        .resolution-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 16px;
            border-radius: var(--radius-standard);
            transition: all var(--transition-smooth);
        }

        .resolution-back:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .resolution-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .resolution-type-badge.amber {
            background-color: var(--alert-amber);
            color: #92400E;
        }

        .resolution-type-badge.rose {
            background-color: var(--alert-rose);
            color: #B91C1C;
        }

        .resolution-type-badge.blue {
            background-color: var(--alert-blue);
            color: #1E40AF;
        }

        .resolution-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 8px;
        }

        .resolution-description {
            font-size: 14px;
            color: var(--eden-text-secondary);
            line-height: 1.5;
        }

        .resolution-drawer-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px 20px;
        }

        .resolution-section {
            margin-bottom: 28px;
        }

        .resolution-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .resolution-info-card {
            background-color: var(--eden-surface);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .resolution-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--eden-border);
        }

        .resolution-info-row:last-child {
            border-bottom: none;
        }

        .resolution-info-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .resolution-info-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        .resolution-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .resolution-action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            cursor: pointer;
            transition: all var(--transition-smooth);
            text-align: left;
        }

        .resolution-action-btn:hover {
            border-color: var(--eden-green);
            background-color: var(--eden-green-light);
        }

        .resolution-action-btn.primary {
            border-color: var(--eden-green);
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .resolution-action-btn.primary:hover {
            background-color: var(--eden-green-hover);
        }

        .resolution-action-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .resolution-action-btn.primary .resolution-action-icon {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .resolution-action-icon svg {
            width: 20px;
            height: 20px;
        }

        .resolution-action-text {
            flex: 1;
        }

        .resolution-action-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 2px;
        }

        .resolution-action-btn.primary .resolution-action-title {
            color: var(--pure-white);
        }

        .resolution-action-desc {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .resolution-action-btn.primary .resolution-action-desc {
            color: rgba(255, 255, 255, 0.8);
        }

        .resolution-drawer-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--eden-border);
            background-color: var(--eden-surface);
        }

        .resolution-footer-actions {
            display: flex;
            gap: 12px;
        }

        .resolution-snooze-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            font-size: 14px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .resolution-snooze-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .resolution-resolve-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: var(--eden-green);
            font-size: 14px;
            font-weight: 500;
            color: var(--pure-white);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .resolution-resolve-btn:hover {
            background-color: var(--eden-green-hover);
        }

        @media (max-width: 768px) {
            .resolution-drawer {
                width: 100%;
            }
        }

        /* Contracts View */
        .contracts-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .contract-stat-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            text-align: center;
        }

        .contract-stat-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 4px;
        }

        .contract-stat-value.active {
            color: var(--eden-green);
        }

        .contract-stat-value.pending {
            color: var(--alert-amber);
        }

        .contract-stat-value.expired {
            color: var(--alert-rose);
        }

        .contract-stat-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .contracts-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .contracts-filter-btn {
            padding: 8px 16px;
            border-radius: 100px;
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            font-size: 13px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .contracts-filter-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .contracts-filter-btn.active {
            background-color: var(--eden-green);
            border-color: var(--eden-green);
            color: var(--pure-white);
        }

        .contracts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 20px;
        }

        .contract-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .contract-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
        }

        .contract-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .contract-associate-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contract-avatar {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--eden-green);
            font-size: 16px;
        }

        .contract-associate-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 2px;
        }

        .contract-associate-role {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .contract-status-badge {
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contract-status-badge.active {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .contract-status-badge.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .contract-status-badge.expired {
            background-color: #FCE7E7;
            color: #B91C1C;
        }

        .contract-card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .contract-detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .contract-detail-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
        }

        .contract-detail-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        .contract-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--eden-border);
        }

        .contract-renewal-info {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .contract-renewal-info.warning {
            color: var(--alert-amber);
        }

        .contract-renewal-info.urgent {
            color: var(--alert-rose);
        }

        .contract-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: var(--eden-surface);
            font-size: 12px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .contract-action-btn:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        @media (max-width: 768px) {
            .contracts-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .contracts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ============================================
           UNIFIED PAGE COMPONENTS
           Used across Associates, Clients, Contracts
           ============================================ */

        /* Summary Stats Grid - 2x2 on mobile, 4 on desktop */
        .summary-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .summary-stat-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 16px;
            text-align: center;
        }

        .summary-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 2px;
        }

        .summary-stat-value.warning {
            color: var(--alert-amber);
        }

        .summary-stat-value.danger {
            color: var(--alert-rose);
        }

        .summary-stat-value.success {
            color: var(--eden-green);
        }

        .summary-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Filter Pills */
        .filter-pills {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-pill {
            padding: 8px 16px;
            border-radius: 100px;
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            font-size: 13px;
            color: var(--eden-text-secondary);
            cursor: pointer;
            transition: all var(--transition-smooth);
            white-space: nowrap;
        }

        .filter-pill:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .filter-pill.active {
            background-color: var(--eden-green);
            border-color: var(--eden-green);
            color: var(--pure-white);
        }

        /* Entity Card (Associates, Clients unified layout) */
        .entity-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .entity-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
        }

        .entity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .entity-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .entity-avatar {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--pure-white);
            font-size: 14px;
            flex-shrink: 0;
        }

        .entity-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 2px;
        }

        .entity-subtitle {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .entity-badge {
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            flex-shrink: 0;
        }

        .entity-badge.active {
            background-color: rgba(34, 197, 94, 0.1);
            color: #15803d;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .entity-badge.supported,
        .entity-badge.onboarding,
        .entity-badge.awaiting,
        .entity-badge.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: #b45309;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .entity-badge.ending,
        .entity-badge.attention {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .entity-badge.independent {
            background-color: rgba(45, 95, 77, 0.1);
            color: var(--eden-green);
            border: 1px solid rgba(45, 95, 77, 0.2);
        }

        .entity-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px 16px;
        }

        .entity-detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .entity-detail-label {
            font-size: 10px;
            color: var(--eden-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .entity-detail-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        /* Entity Cards Grid */
        .entity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        @media (max-width: 768px) {
            .entity-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Contract Detail Panel */
        .contract-detail-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 480px;
            max-width: 100%;
            background-color: var(--pure-white);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 260;
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            display: flex;
            flex-direction: column;
        }

        .contract-detail-panel.open {
            transform: translateX(0);
        }

        .contract-detail-header {
            padding: 20px;
            padding-top: calc(var(--safe-area-top) + 20px);
            border-bottom: 1px solid var(--eden-border);
            background-color: var(--eden-mint);
        }

        .contract-detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 16px;
            border-radius: var(--radius-standard);
            transition: all var(--transition-smooth);
        }

        .contract-detail-back:hover {
            background-color: var(--eden-green-light);
            color: var(--eden-green);
        }

        .contract-detail-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .contract-detail-associate {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contract-detail-avatar {
            width: 52px;
            height: 52px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--eden-green);
            font-size: 18px;
        }

        .contract-detail-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin-bottom: 2px;
        }

        .contract-detail-role {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .contract-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px 20px;
        }

        .contract-detail-section {
            margin-bottom: 28px;
        }

        .contract-detail-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contract-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .contract-info-item {
            background-color: var(--eden-surface);
            border-radius: var(--radius-standard);
            padding: 14px;
        }

        .contract-info-item.full-width {
            grid-column: 1 / -1;
        }

        .contract-info-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .contract-info-value {
            font-size: 15px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        .contract-timeline {
            position: relative;
            padding-left: 24px;
        }

        .contract-timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background-color: var(--eden-border);
        }

        .contract-timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .contract-timeline-item:last-child {
            padding-bottom: 0;
        }

        .contract-timeline-item::before {
            content: '';
            position: absolute;
            left: -17px;
            top: 6px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--eden-green);
            border: 2px solid var(--pure-white);
        }

        .contract-timeline-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-bottom: 2px;
        }

        .contract-timeline-event {
            font-size: 14px;
            color: var(--eden-text-primary);
        }

        .contract-documents {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .contract-document-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--eden-surface);
            border-radius: var(--radius-standard);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .contract-document-item:hover {
            background-color: var(--eden-green-light);
        }

        .contract-document-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-standard);
            background-color: var(--pure-white);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
        }

        .contract-document-info {
            flex: 1;
        }

        .contract-document-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        .contract-document-meta {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .contract-detail-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--eden-border);
            background-color: var(--eden-surface);
        }

        .contract-footer-actions {
            display: flex;
            gap: 12px;
        }

        .contract-footer-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius-standard);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .contract-footer-btn.secondary {
            border: 1px solid var(--eden-border);
            background-color: var(--pure-white);
            color: var(--eden-text-secondary);
        }

        .contract-footer-btn.secondary:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .contract-footer-btn.primary {
            border: none;
            background-color: var(--eden-green);
            color: var(--pure-white);
        }

        .contract-footer-btn.primary:hover {
            background-color: var(--eden-green-hover);
        }

        @media (max-width: 768px) {
            .contract-detail-panel {
                width: 100%;
            }

            .contract-info-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Add Session Button & Modal */
        .schedule-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .add-session-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--radius-standard);
            border: none;
            background-color: var(--eden-green);
            color: var(--pure-white);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .add-session-btn:hover {
            background-color: var(--eden-green-hover);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 400;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal-container {
            background-color: var(--pure-white);
            border-radius: var(--radius-card);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalSlideIn 200ms ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--eden-border);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: transparent;
            color: var(--eden-text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-smooth);
        }

        .modal-close:hover {
            background-color: var(--eden-mint);
            color: var(--eden-text);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid var(--eden-border);
            justify-content: flex-end;
        }

        .modal-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: var(--radius-standard);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .modal-btn.primary {
            background-color: var(--eden-green);
            border: none;
            color: var(--pure-white);
        }

        .modal-btn.primary:hover {
            background-color: var(--eden-green-hover);
        }

        .modal-btn.secondary {
            background-color: transparent;
            border: 1px solid var(--eden-border);
            color: var(--eden-text-secondary);
        }

        .modal-btn.secondary:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text);
            margin-bottom: 6px;
        }

        .form-select,
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            font-size: 14px;
            color: var(--eden-text);
            background-color: var(--pure-white);
            transition: all var(--transition-smooth);
        }

        .form-select:focus,
        .form-input:focus {
            outline: none;
            border-color: var(--eden-green);
            box-shadow: 0 0 0 3px var(--eden-green-light);
        }

        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            font-size: 14px;
            color: var(--eden-text);
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--eden-green);
            box-shadow: 0 0 0 3px var(--eden-green-light);
        }

        .session-type-options {
            display: flex;
            gap: 12px;
        }

        .session-type-option {
            flex: 1;
            cursor: pointer;
        }

        .session-type-option input {
            display: none;
        }

        .session-type-label {
            display: block;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            font-size: 13px;
            color: var(--eden-text-secondary);
            transition: all var(--transition-smooth);
        }

        .session-type-option input:checked + .session-type-label {
            border-color: var(--eden-green);
            background-color: var(--eden-green-light);
            color: var(--eden-green);
            font-weight: 500;
        }

        .session-conflict-warning {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background-color: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: var(--radius-standard);
            margin-bottom: 16px;
            color: #92400E;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .schedule-header {
                flex-direction: column;
                gap: 16px;
            }

            .add-session-btn {
                width: 100%;
                justify-content: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .session-type-options {
                flex-direction: column;
            }
        }

        /* ============================================
           CPD VIEW
           ============================================ */

        .cpd-summary {
            margin-bottom: 32px;
        }

        .cpd-progress-card {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 32px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
        }

        .cpd-progress-ring {
            position: relative;
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }

        .cpd-progress-ring svg {
            width: 100%;
            height: 100%;
        }

        .cpd-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .cpd-hours {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-green);
            display: block;
        }

        .cpd-total {
            font-size: 11px;
            color: var(--eden-text-secondary);
        }

        .cpd-progress-info {
            flex: 1;
        }

        .cpd-progress-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .cpd-progress-subtitle {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .cpd-categories {
            margin-bottom: 32px;
        }

        .cpd-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .cpd-category-card {
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 20px;
            text-align: center;
        }

        .cpd-category-hours {
            font-size: 28px;
            font-weight: 700;
            color: var(--eden-green);
            margin-bottom: 4px;
        }

        .cpd-category-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .cpd-activities {
            margin-bottom: 24px;
        }

        .cpd-activity-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cpd-activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
        }

        .cpd-activity-date {
            font-size: 12px;
            color: var(--eden-text-secondary);
            min-width: 80px;
        }

        .cpd-activity-info {
            flex: 1;
        }

        .cpd-activity-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .cpd-activity-category {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .cpd-activity-hours {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-green);
        }

        /* ============================================
           SUPPORT VIEW
           ============================================ */

        .support-section {
            margin-bottom: 32px;
        }

        .support-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .support-link-card {
            display: block;
            padding: 24px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            text-decoration: none;
            transition: all var(--transition-smooth);
        }

        .support-link-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
            transform: translateY(-2px);
        }

        .support-link-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-standard);
            background-color: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
            margin-bottom: 16px;
        }

        .support-link-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .support-link-desc {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .emergency-contacts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .emergency-contact-card {
            padding: 20px;
            background-color: var(--eden-mint);
            border-radius: var(--radius-standard);
        }

        .emergency-contact-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .emergency-contact-detail {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin-bottom: 8px;
        }

        .emergency-contact-phone {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-green);
        }

        /* Pipeline count styling */
        .pipeline-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            border-radius: 9px;
            font-size: 11px;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.2);
            margin-left: 4px;
        }

        .pipeline-stage:not(.active) .pipeline-count {
            background-color: var(--eden-border);
            color: var(--eden-text-secondary);
        }

        /* Collapsible Overview Section */
        .overview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            cursor: pointer;
            min-height: 44px;
            user-select: none;
            transition: background-color var(--transition-fast);
            margin: 0 -16px;
            padding-left: 16px;
            padding-right: 16px;
        }

        .overview-header:hover {
            background-color: var(--eden-whisper);
        }

        .overview-header:active {
            background-color: #e9efec;
        }

        .overview-header-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .overview-chevron {
            color: var(--eden-green);
            transition: transform 250ms ease-out;
            flex-shrink: 0;
        }

        .overview-header.collapsed .overview-chevron {
            transform: rotate(180deg);
        }

        .overview-collapsible {
            overflow: hidden;
            transition: max-height 250ms ease-out, opacity 200ms ease-out;
            max-height: 500px;
            opacity: 1;
        }

        .overview-collapsible.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .overview-header.collapsed + .overview-collapsible + .overview-divider {
            display: none;
        }

        /* ============================================
           IVY WALLET-INSPIRED UX COMPONENTS
           ============================================ */

        /* Progress Ring Component */
        .progress-ring-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--eden-border);
        }

        .progress-ring-progress {
            fill: none;
            stroke: var(--eden-green);
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-out;
        }

        .progress-ring-content {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .progress-ring-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--eden-text);
            line-height: 1.1;
        }

        .progress-ring-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 2px;
        }

        /* Cash Density Ring (Admin) */
        .cash-density-ring .progress-ring-value {
            font-size: 32px;
            color: var(--pure-white);
        }

        .cash-density-ring .progress-ring-label {
            color: rgba(255, 255, 255, 0.7);
        }

        .cash-density-ring .progress-ring-progress {
            stroke: #4ADE80;
        }

        .cash-density-ring .progress-ring-bg {
            stroke: rgba(255, 255, 255, 0.2);
        }

        /* QuickStat Card */
        .quick-stat {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 16px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            text-align: center;
            position: relative;
            min-width: 100px;
            flex: 1;
        }

        .quick-stat:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.12);
            transform: translateY(-2px);
        }

        .quick-stat:active {
            transform: translateY(0);
        }

        .quick-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--eden-text);
            line-height: 1.2;
            margin-bottom: 4px;
        }

        .quick-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .quick-stat-subtext {
            font-size: 11px;
            color: var(--eden-text-muted);
            margin-top: 4px;
        }

        .quick-stat.warning {
            border-color: var(--alert-amber);
            background: linear-gradient(135deg, #FFFBEB 0%, var(--pure-white) 100%);
        }

        .quick-stat.warning .quick-stat-value {
            color: #B45309;
        }

        .quick-stat-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        /* PulseDot */
        .pulse-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--alert-amber);
            animation: pulse-animation 2s ease-in-out infinite;
            position: absolute;
            top: 8px;
            right: 8px;
        }

        .pulse-dot.alert {
            background-color: var(--alert-rose);
        }

        .pulse-dot.success {
            background-color: var(--eden-green);
        }

        @keyframes pulse-animation {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.7;
            }
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-default {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge-success {
            background: #F0FDF4;
            color: #166534;
        }

        .badge-alert {
            background: #FEF2F2;
            color: #991B1B;
        }

        .badge-info {
            background: #EFF6FF;
            color: #1E40AF;
        }

        .badge.pulse .pulse-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: pulse-animation 2s ease-in-out infinite;
        }

        /* ============================================
           REFERRAL SYSTEM
           ============================================ */

        /* Referral Stats Row */
        .referral-stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .referral-stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .referral-stat-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .referral-stat-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 2px 8px rgba(45, 95, 77, 0.1);
        }

        .referral-stat-card.active {
            border-color: var(--eden-green);
            background: var(--eden-green-light);
        }

        .referral-stat-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .referral-stat-indicator.new {
            background: var(--referral-new);
            animation: pulse 2s infinite;
        }

        .referral-stat-indicator.broadcasting {
            background: var(--referral-broadcasting);
        }

        .referral-stat-indicator.pending {
            background: var(--referral-pending);
            animation: pulse 2s infinite;
        }

        .referral-stat-indicator.accepted {
            background: var(--referral-accepted);
        }

        .referral-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .referral-stat-label {
            font-size: 12px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Referral List */
        .referral-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .referral-section {
            margin-bottom: 32px;
        }

        .referral-section .section-title {
            margin-bottom: 16px;
        }

        /* Referral Card */
        .referral-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .referral-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.1);
        }

        .referral-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .referral-card-id {
            font-family: monospace;
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .referral-card-time {
            font-size: 11px;
            color: var(--eden-text-muted);
        }

        .referral-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .referral-status-badge.new {
            background: #F3E8FF;
            color: #7C3AED;
        }

        .referral-status-badge.broadcasting {
            background: #DBEAFE;
            color: #1D4ED8;
        }

        .referral-status-badge.pending {
            background: #FEF3C7;
            color: #B45309;
        }

        .referral-status-badge.accepted {
            background: #D1FAE5;
            color: #047857;
        }

        .referral-status-badge.declined {
            background: #F3F4F6;
            color: #6B7280;
        }

        .referral-card-pseudonym {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .referral-card-enquiry {
            font-size: 14px;
            color: var(--eden-text);
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .referral-card-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .referral-card-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .referral-card-meta-item svg {
            width: 14px;
            height: 14px;
        }

        .referral-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--eden-border);
        }

        .referral-time-remaining {
            font-size: 12px;
            color: var(--referral-broadcasting);
            font-weight: 500;
        }

        .referral-interest-count {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Associate Referral Card Actions */
        .referral-card-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .referral-action-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius-standard);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .referral-action-btn.primary {
            background: var(--eden-green);
            border: none;
            color: var(--pure-white);
        }

        .referral-action-btn.primary:hover {
            background: var(--eden-green-hover);
        }

        .referral-action-btn.secondary {
            background: var(--eden-mint);
            border: none;
            color: var(--eden-text);
        }

        .referral-action-btn.secondary:hover {
            background: var(--eden-green-light);
        }

        /* Specialisation Tags */
        .specialisation-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .specialisation-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            background: var(--eden-mint);
            color: var(--eden-text);
        }

        /* Inbox Header Row */
        .inbox-header-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 16px;
        }

        .available-badge {
            background: var(--eden-green);
            color: var(--pure-white);
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
        }

        /* Capacity Quick Card */
        .capacity-quick-card {
            background: var(--eden-mint);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 24px;
        }

        .capacity-quick-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .capacity-quick-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--eden-text);
        }

        .capacity-quick-item svg {
            color: var(--eden-green);
        }

        /* Toggle Switch */
        .toggle-switch {
            width: 44px;
            height: 24px;
            background: var(--eden-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .toggle-switch.active {
            background: var(--eden-green);
        }

        .toggle-knob {
            width: 20px;
            height: 20px;
            background: var(--pure-white);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all var(--transition-smooth);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-knob {
            left: 22px;
        }

        /* Referral Panel */
        .referral-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--side-panel-width);
            height: 100vh;
            background: var(--pure-white);
            border-left: 1px solid var(--eden-border);
            transform: translateX(100%);
            transition: transform var(--transition-smooth);
            z-index: 300;
            display: flex;
            flex-direction: column;
        }

        .referral-panel.open {
            transform: translateX(0);
        }

        .referral-panel-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            z-index: 299;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-smooth);
        }

        .referral-panel-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .referral-panel-header {
            padding: 20px 24px;
            padding-top: calc(var(--safe-area-top) + 20px);
            background: var(--eden-mint);
            border-bottom: 1px solid var(--eden-border);
        }

        .referral-panel-header .close-btn {
            position: absolute;
            top: calc(var(--safe-area-top) + 16px);
            right: 16px;
        }

        .referral-panel-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .referral-panel-id {
            font-family: monospace;
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .referral-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin: 0;
        }

        .referral-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        /* Panel Content Styles */
        .panel-section {
            margin-bottom: 24px;
        }

        .panel-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .enquiry-preview {
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
        }

        .enquiry-text {
            font-size: 14px;
            color: var(--eden-text);
            line-height: 1.6;
            margin-bottom: 12px;
            font-style: italic;
        }

        .enquiry-meta {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text);
            margin-bottom: 6px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            font-size: 14px;
            color: var(--eden-text);
            background: var(--pure-white);
            transition: all var(--transition-smooth);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--eden-green);
            box-shadow: 0 0 0 3px var(--eden-green-light);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Urgency Selector */
        .urgency-selector {
            display: flex;
            gap: 8px;
        }

        .urgency-btn {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            background: var(--pure-white);
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .urgency-btn:hover {
            border-color: var(--eden-green);
        }

        .urgency-btn.active {
            background: var(--eden-green-light);
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        /* Eligible Associates List */
        .associate-checkbox-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .associate-checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-standard);
            background: var(--eden-green-light);
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .associate-checkbox-item.disabled {
            background: var(--eden-surface);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .associate-checkbox-item:not(.disabled):hover {
            background: var(--eden-mint);
        }

        .associate-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid var(--eden-border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all var(--transition-smooth);
        }

        .associate-checkbox-item.selected .associate-checkbox {
            background: var(--eden-green);
            border-color: var(--eden-green);
        }

        .associate-checkbox svg {
            width: 12px;
            height: 12px;
            color: var(--pure-white);
            opacity: 0;
        }

        .associate-checkbox-item.selected .associate-checkbox svg {
            opacity: 1;
        }

        .associate-checkbox-info {
            flex: 1;
        }

        .associate-checkbox-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .associate-checkbox-slots {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        /* Broadcast Button */
        .broadcast-btn {
            width: 100%;
            padding: 16px;
            background: var(--eden-green);
            border: none;
            border-radius: var(--radius-standard);
            color: var(--pure-white);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .broadcast-btn:hover {
            background: var(--eden-green-hover);
        }

        .broadcast-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .broadcast-note {
            text-align: center;
            font-size: 12px;
            color: var(--eden-text-secondary);
            margin-top: 8px;
        }

        /* Allocation Panel */
        .expression-group {
            margin-bottom: 24px;
        }

        .expression-group-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .expression-group-title.interested {
            color: var(--eden-green);
        }

        .expression-group-title.declined {
            color: var(--eden-text-muted);
        }

        .expression-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 12px;
        }

        .expression-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .expression-associate-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .expression-note {
            font-size: 13px;
            color: var(--eden-text-secondary);
            font-style: italic;
            margin-bottom: 12px;
        }

        .allocate-btn {
            width: 100%;
            padding: 12px;
            background: var(--eden-green);
            border: none;
            border-radius: var(--radius-standard);
            color: var(--pure-white);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .allocate-btn:hover {
            background: var(--eden-green-hover);
        }

        /* Interest Panel */
        .interest-info-box {
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 16px;
        }

        .interest-info-box p {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin: 0;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .interest-info-box svg {
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Mobile Referral Panel (Bottom Sheet) */
        @media (max-width: 768px) {
            .referral-panel {
                width: 100%;
                height: 85vh;
                max-height: 85vh;
                top: auto;
                bottom: 0;
                border-radius: 24px 24px 0 0;
                border-left: none;
                border-top: 1px solid var(--eden-border);
                transform: translateY(100%);
            }

            .referral-panel.open {
                transform: translateY(0);
            }

            .referral-panel-header {
                border-radius: 24px 24px 0 0;
            }

            .referral-panel-header::before {
                content: '';
                display: block;
                width: 40px;
                height: 4px;
                background: var(--eden-border);
                border-radius: 2px;
                margin: 0 auto 12px;
            }
        }

        /* Empty State */
        .referral-empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .referral-empty-state svg {
            color: var(--eden-border);
            margin-bottom: 16px;
        }

        .referral-empty-state h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 8px;
        }

        .referral-empty-state p {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* ============================================
           ROLE-SPECIFIC HOME SCREENS
           ============================================ */

        /* Associate Home Screen */
        .associate-home {
            display: none;
        }

        .associate-home.active {
            display: block;
        }

        .home-greeting {
            margin-bottom: 24px;
        }

        .greeting-text {
            font-size: 24px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .greeting-subtext {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .home-actions-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .home-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-standard);
            border: 1px solid var(--eden-border);
            background: var(--pure-white);
            color: var(--eden-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
        }

        .home-action-btn:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .home-action-btn svg {
            width: 18px;
            height: 18px;
        }

        .home-action-btn .badge-count {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--eden-green);
            color: var(--pure-white);
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Period Selector */
        .period-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 4px;
            background: var(--eden-mint);
            border-radius: 20px;
            width: fit-content;
        }

        .period-btn {
            padding: 8px 16px;
            border-radius: 16px;
            border: none;
            background: transparent;
            color: var(--eden-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .period-btn:hover {
            color: var(--eden-text);
        }

        .period-btn.active {
            background: var(--pure-white);
            color: var(--eden-green);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* My Clients Card */
        .clients-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .clients-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.12);
        }

        .clients-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .clients-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .clients-card-count {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* Pipeline Visualization (Horizontal) */
        .pipeline-visual {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 0;
        }

        .pipeline-stage-dot {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .stage-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-bottom: 6px;
        }

        .stage-dot.enquiry { background: #9b59b6; }
        .stage-dot.consultation { background: #3498db; }
        .stage-dot.onboarding { background: #f39c12; }
        .stage-dot.active { background: var(--eden-green); }
        .stage-dot.paused { background: #7f8c8d; }
        .stage-dot.completed { background: #95a5a6; }

        .stage-count {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .stage-label {
            font-size: 10px;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .pipeline-connector {
            flex: 0.5;
            height: 2px;
            background: var(--eden-border);
            margin-bottom: 20px;
        }

        /* ============================================
           ADMIN HOME SCREEN
           ============================================ */

        .admin-home {
            display: none;
        }

        .admin-home.active {
            display: block;
        }

        /* Admin Dark Header */
        .admin-header {
            background: linear-gradient(135deg, #1e4035 0%, #2d5f4d 100%);
            border-radius: var(--radius-card);
            padding: 24px;
            margin-bottom: 24px;
            color: var(--pure-white);
        }

        .admin-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .admin-header-title {
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .admin-header-practice {
            font-size: 22px;
            font-weight: 600;
            color: var(--pure-white);
        }

        .admin-header-center {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .admin-header-stats {
            display: flex;
            gap: 24px;
            justify-content: center;
        }

        .admin-stat {
            text-align: center;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: var(--radius-standard);
            transition: background-color var(--transition-smooth);
        }

        .admin-stat:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .admin-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--pure-white);
            line-height: 1.2;
        }

        .admin-stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .admin-stat .pulse-dot {
            position: absolute;
            top: 0;
            right: 0;
        }

        /* Admin Cards Row */
        .admin-cards-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .admin-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .admin-card:hover {
            border-color: var(--eden-green);
            box-shadow: 0 4px 12px rgba(45, 95, 77, 0.12);
        }

        .admin-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .admin-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .admin-card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-green);
        }

        .admin-card-icon svg {
            width: 18px;
            height: 18px;
        }

        .admin-card-content {
            font-size: 13px;
            color: var(--eden-text-secondary);
            line-height: 1.5;
        }

        .admin-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-green);
            margin-bottom: 4px;
        }

        /* Responsive adjustments for home screens */
        @media (max-width: 768px) {
            .quick-stat-row {
                flex-wrap: wrap;
            }

            .quick-stat {
                min-width: calc(50% - 8px);
            }

            .admin-header-stats {
                flex-wrap: wrap;
                gap: 12px;
            }

            .admin-stat {
                min-width: 80px;
            }

            .admin-cards-row {
                grid-template-columns: 1fr;
            }

            .pipeline-visual {
                flex-wrap: wrap;
                gap: 4px;
            }

            .pipeline-connector {
                display: none;
            }
        }

        /* ============================================
           NAVIGATION VIEWS (Sessions, Pending, etc.)
           ============================================ */

        .nav-view {
            display: none;
            animation: fadeIn 300ms ease-out;
        }

        .nav-view.active {
            display: block;
        }

        .nav-view-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .nav-back-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--eden-mint);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text-secondary);
            transition: all var(--transition-smooth);
        }

        .nav-back-btn:hover {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .nav-view-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        /* Session Item */
        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-standard);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all var(--transition-smooth);
        }

        .session-item:hover {
            border-color: var(--eden-green);
            box-shadow: 0 2px 8px rgba(45, 95, 77, 0.1);
        }

        .session-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--eden-green);
            font-size: 14px;
        }

        .session-info {
            flex: 1;
        }

        .session-client {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 2px;
        }

        .session-time {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .session-amount {
            text-align: right;
        }

        .session-fee {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .session-status {
            font-size: 11px;
            margin-top: 2px;
        }

        .session-status.paid {
            color: var(--eden-green);
        }

        .session-status.pending {
            color: #B45309;
        }

        /* Day Group */
        .day-group {
            margin-bottom: 24px;
        }

        .day-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
            padding-left: 4px;
        }

        /* Pending Payment Card */
        .pending-summary-card {
            background: linear-gradient(135deg, #FFFBEB 0%, var(--pure-white) 100%);
            border: 1px solid #FCD34D;
            border-radius: var(--radius-card);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .pending-summary-value {
            font-size: 32px;
            font-weight: 700;
            color: #B45309;
            margin-bottom: 4px;
        }

        .pending-summary-label {
            font-size: 14px;
            color: #92400E;
        }

        /* Payout Card */
        .payout-preview-card {
            background: linear-gradient(135deg, #F0FDF4 0%, var(--pure-white) 100%);
            border: 1px solid var(--eden-green-light);
            border-radius: var(--radius-card);
            padding: 20px;
            margin-bottom: 20px;
        }

        .payout-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .payout-preview-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
        }

        .payout-preview-date {
            font-size: 13px;
            color: var(--eden-green);
            font-weight: 500;
        }

        .payout-preview-amount {
            font-size: 36px;
            font-weight: 700;
            color: var(--eden-green);
            margin-bottom: 4px;
        }

        .payout-preview-sessions {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        /* Session Detail View */
        .session-detail-card {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 24px;
            margin-bottom: 20px;
        }

        .session-detail-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--eden-border);
        }

        .session-detail-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--eden-green);
            font-size: 18px;
        }

        .session-detail-info h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 4px;
        }

        .session-detail-info p {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .session-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--eden-border);
        }

        .session-detail-row:last-child {
            border-bottom: none;
        }

        .session-detail-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .session-detail-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        /* Stripe Status Section */
        .stripe-status-section {
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
            padding: 16px;
            margin-bottom: 20px;
        }

        .stripe-status-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stripe-logo {
            color: #635BFF;
            font-weight: 700;
            font-size: 14px;
        }

        .stripe-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
        }

        .stripe-status-badge.paid {
            background: #F0FDF4;
            color: #166534;
        }

        .stripe-status-badge.pending {
            background: #FEF3C7;
            color: #92400E;
        }

        /* Action Buttons */
        .action-btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            border-radius: var(--radius-standard);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-smooth);
            border: none;
        }

        .action-btn-primary {
            background: var(--eden-green);
            color: var(--pure-white);
        }

        .action-btn-primary:hover {
            background: var(--eden-green-hover);
        }

        .action-btn-secondary {
            background: var(--pure-white);
            color: var(--eden-text);
            border: 1px solid var(--eden-border);
        }

        .action-btn-secondary:hover {
            border-color: var(--eden-green);
            color: var(--eden-green);
        }

        .action-btn-warning {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #FCD34D;
        }

        .action-btn-warning:hover {
            background: #FDE68A;
        }

        /* Email Preview Modal */
        .email-preview {
            background: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            padding: 20px;
            margin-bottom: 20px;
        }

        .email-preview-header {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .email-preview-to {
            font-size: 14px;
            color: var(--eden-text);
            margin-bottom: 8px;
        }

        .email-preview-subject {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 12px;
        }

        .email-preview-body {
            font-size: 14px;
            color: var(--eden-text-secondary);
            line-height: 1.6;
            padding: 16px;
            background: var(--eden-mint);
            border-radius: var(--radius-standard);
        }

        /* ============================================
           PROGRESS STEPPER COMPONENT
           ============================================ */

        .progress-stepper {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .progress-stepper::-webkit-scrollbar {
            display: none;
        }

        .stepper-container {
            display: flex;
            align-items: flex-start;
            min-width: max-content;
        }

        .stepper-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            min-width: 80px;
        }

        .stepper-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 300ms ease;
            position: relative;
            z-index: 2;
        }

        /* Inactive step */
        .stepper-step.inactive .stepper-circle {
            background-color: var(--pure-white);
            border: 1px solid #e5e5e5;
            color: #9ca3af;
        }

        /* Active step */
        .stepper-step.active .stepper-circle {
            background-color: var(--pure-white);
            border: 2px solid var(--eden-green);
            color: var(--eden-green);
            box-shadow: 0 0 0 4px rgba(45, 95, 77, 0.1);
        }

        /* Complete step */
        .stepper-step.complete .stepper-circle {
            background-color: var(--eden-green);
            border: 2px solid var(--eden-green);
            color: var(--pure-white);
        }

        .stepper-checkmark {
            display: none;
        }

        .stepper-step.complete .stepper-checkmark {
            display: block;
        }

        .stepper-step.complete .stepper-number {
            display: none;
        }

        .stepper-label {
            font-size: 12px;
            font-weight: 500;
            color: #9ca3af;
            margin-top: 8px;
            text-align: center;
            white-space: nowrap;
            transition: color 300ms ease;
        }

        .stepper-step.active .stepper-label {
            color: var(--eden-green);
            font-weight: 600;
        }

        .stepper-step.complete .stepper-label {
            color: var(--eden-text);
        }

        /* Connector lines */
        .stepper-connector {
            height: 2px;
            flex: 1;
            min-width: 24px;
            background-color: #e5e5e5;
            margin-top: 15px;
            transition: background-color 300ms ease;
        }

        .stepper-connector.complete {
            background-color: var(--eden-green);
        }

        /* Clickable states */
        .stepper-step.complete {
            cursor: pointer;
        }

        .stepper-step.complete:hover .stepper-circle {
            transform: scale(1.1);
        }

        .stepper-step.inactive {
            cursor: not-allowed;
        }

        /* ============================================
           STATUS CARD COMPONENT (Referral Style)
           ============================================ */

        .status-card {
            background-color: var(--pure-white);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 200ms ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--eden-border);
            position: relative;
        }

        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--eden-green);
        }

        .status-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .status-card-ref {
            font-size: 12px;
            font-family: monospace;
            color: var(--eden-text-secondary);
        }

        .status-card-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Status badge colours */
        .status-card-badge.new {
            background-color: #f3e8ff;
            color: #7c3aed;
        }

        .status-card-badge.broadcasting {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .status-card-badge.pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        .status-card-badge.accepted,
        .status-card-badge.ready {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .status-card-badge.active {
            background-color: #d1fae5;
            color: #059669;
        }

        .status-card-badge.awaiting {
            background-color: #fef3c7;
            color: #d97706;
        }

        .status-card-badge.ending {
            background-color: #fee2e2;
            color: #dc2626;
        }

        .status-card-badge.independent {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .status-card-badge.supported {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 8px;
        }

        .status-card-preview {
            font-size: 13px;
            color: var(--eden-text-secondary);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .status-card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .status-card-chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            background-color: var(--eden-mint);
            border-radius: 4px;
            font-size: 11px;
            color: var(--eden-text-secondary);
        }

        .status-card-timestamp {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 11px;
            color: #9ca3af;
        }

        /* Pulse indicator */
        .status-card-pulse {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: statusPulse 2s infinite;
        }

        .status-card-pulse.purple { background-color: #a855f7; }
        .status-card-pulse.blue { background-color: #3b82f6; }
        .status-card-pulse.amber { background-color: #f59e0b; }
        .status-card-pulse.green { background-color: #22c55e; }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Associate Card Kebab Menu */
        .kebab-menu-container {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 10;
        }

        .kebab-menu-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-smooth);
        }

        .kebab-menu-btn:hover {
            background-color: var(--eden-green-light);
        }

        .kebab-menu-btn svg {
            width: 18px;
            height: 18px;
            color: var(--eden-text-secondary);
        }

        .kebab-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            width: 220px;
            background-color: var(--pure-white);
            border: 1px solid var(--eden-border);
            border-radius: var(--radius-card);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 200ms ease;
            z-index: 100;
        }

        .kebab-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .kebab-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .kebab-dropdown-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-muted);
        }

        .kebab-dropdown-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--eden-text);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .kebab-dropdown-options {
            padding: 8px 0;
        }

        .kebab-option {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: background-color var(--transition-smooth);
        }

        .kebab-option:hover {
            background-color: var(--eden-green-light);
        }

        .kebab-option-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background-color: var(--eden-mint);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .kebab-option-icon svg {
            width: 16px;
            height: 16px;
            color: var(--eden-green);
            stroke-width: 1.5;
        }

        .kebab-option-text {
            flex: 1;
            min-width: 0;
        }

        .kebab-option-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .kebab-option-desc {
            font-size: 11px;
            color: var(--eden-text-secondary);
        }

        /* ============================================
           ANIMATED CARD LIST
           ============================================ */

        .animated-card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .animated-card-list > * {
            opacity: 0;
            transform: translateY(20px);
            animation: cardSlideIn 300ms ease-out forwards;
        }

        @keyframes cardSlideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ============================================
           DETAIL PANEL (Side Panel + Bottom Sheet)
           ============================================ */

        .detail-panel-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: all 300ms ease;
            z-index: 300;
        }

        .detail-panel-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* Side Panel (Desktop) */
        .detail-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 480px;
            height: 100vh;
            background: var(--pure-white);
            box-shadow: -4px 0 24px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 300ms ease-out;
            z-index: 301;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-panel.open {
            transform: translateX(0);
        }

        .detail-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            padding-top: calc(var(--safe-area-top) + 16px);
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-mint);
            flex-shrink: 0;
        }

        .detail-panel-back {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
            border-radius: 6px;
            transition: all 200ms ease;
        }

        .detail-panel-back:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--eden-text);
        }

        .detail-panel-back svg {
            width: 18px;
            height: 18px;
        }

        .detail-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .detail-panel-actions {
            position: relative;
        }

        .detail-panel-actions-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--eden-text-secondary);
            transition: all 200ms ease;
        }

        .detail-panel-actions-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--eden-text);
        }

        /* Three-dots dropdown menu */
        .detail-panel-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 4px;
            width: 224px;
            background: var(--pure-white);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--eden-border);
            z-index: 400;
            display: none;
            overflow: hidden;
        }

        .detail-panel-dropdown.open {
            display: block;
            animation: fadeIn 150ms ease;
        }

        .detail-panel-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-mint);
        }

        .detail-panel-dropdown-header-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 2px;
        }

        .detail-panel-dropdown-header-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .detail-panel-dropdown-menu {
            padding: 8px 0;
        }

        .detail-panel-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: background-color 150ms ease;
        }

        .detail-panel-dropdown-item:hover {
            background-color: var(--eden-mint);
        }

        .detail-panel-dropdown-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--eden-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .detail-panel-dropdown-icon svg {
            width: 16px;
            height: 16px;
            color: var(--eden-green);
        }

        .detail-panel-dropdown-text {
            flex: 1;
        }

        .detail-panel-dropdown-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .detail-panel-dropdown-subtitle {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .detail-panel-stepper {
            padding: 0;
            border-bottom: 1px solid var(--eden-border);
            background: var(--pure-white);
            flex-shrink: 0;
        }

        .detail-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }

        /* Drag handle - hidden on desktop, shown on mobile */
        .detail-panel-drag-handle {
            display: none;
        }

        /* Stage content sections */
        .stage-section {
            display: none;
        }

        .stage-section.active {
            display: block;
            animation: fadeIn 300ms ease;
        }

        .stage-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--eden-border);
        }

        .stage-field-group {
            margin-bottom: 16px;
        }

        .stage-field-label {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 6px;
        }

        .stage-field-value {
            font-size: 14px;
            color: var(--eden-text);
            padding: 10px 12px;
            background: var(--eden-mint);
            border-radius: 6px;
        }

        .stage-field-input {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            border: 1px solid var(--eden-border);
            border-radius: 6px;
            background: var(--pure-white);
            color: var(--eden-text);
            transition: border-color 200ms ease;
        }

        .stage-field-input:focus {
            outline: none;
            border-color: var(--eden-green);
        }

        .stage-field-input::placeholder {
            color: #9ca3af;
        }

        /* Activity Timeline */
        .activity-timeline {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--eden-border);
        }

        .activity-timeline-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
            margin-bottom: 16px;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding-bottom: 16px;
            position: relative;
        }

        .activity-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 16px;
            bottom: 0;
            width: 2px;
            background: var(--eden-border);
        }

        .activity-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--eden-green);
            flex-shrink: 0;
            margin-top: 4px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 13px;
            color: var(--eden-text);
        }

        .activity-time {
            font-size: 11px;
            color: var(--eden-text-secondary);
            margin-top: 2px;
        }

        /* Mobile Bottom Sheet */
        @media (max-width: 768px) {
            .detail-panel {
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: 90vh;
                border-radius: 16px 16px 0 0;
                transform: translateY(100%);
            }

            .detail-panel.open {
                transform: translateY(0);
            }

            .detail-panel-drag-handle {
                display: block;
                width: 40px;
                height: 4px;
                background: #d1d5db;
                border-radius: 2px;
                margin: 8px auto 4px auto;
                flex-shrink: 0;
            }

            .detail-panel-header {
                padding-top: 4px;
                padding-bottom: 12px;
                flex-shrink: 0;
            }

            .progress-stepper {
                padding: 12px 16px;
            }

            .stepper-step {
                min-width: 70px;
            }
        }

        /* ============================================
           ASSOCIATE DETAIL VIEW (Full Page Navigation)
           ============================================ */

        .associate-detail-page {
            min-height: 100vh;
            background: var(--eden-surface);
            display: flex;
            flex-direction: column;
        }

        .associate-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            padding-top: calc(var(--safe-area-top) + 16px);
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .associate-detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
            border-radius: 6px;
            transition: all 200ms ease;
        }

        .associate-detail-back:hover {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .associate-detail-header-info {
            text-align: center;
            flex: 1;
        }

        .associate-detail-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .associate-detail-ucid {
            font-size: 12px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .associate-detail-menu {
            position: relative;
        }

        .associate-detail-menu-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 200ms ease;
        }

        .associate-detail-menu-btn:hover {
            background: var(--eden-green-light);
        }

        .associate-detail-menu-btn svg {
            color: var(--eden-text-secondary);
        }

        .associate-detail-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 240px;
            background: var(--pure-white);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--eden-border);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 200ms ease;
            z-index: 100;
            overflow: hidden;
        }

        .associate-detail-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(4px);
        }

        .associate-detail-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-mint);
        }

        .associate-detail-dropdown-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .associate-detail-dropdown-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .associate-detail-dropdown-menu {
            padding: 8px;
        }

        .associate-detail-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 10px 12px;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 200ms ease;
            text-align: left;
        }

        .associate-detail-dropdown-item:hover {
            background: var(--eden-green-light);
        }

        .associate-detail-dropdown-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--eden-mint);
            border-radius: 8px;
        }

        .associate-detail-dropdown-icon svg {
            width: 18px;
            height: 18px;
            color: var(--eden-green);
        }

        .associate-detail-dropdown-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .associate-detail-dropdown-subtitle {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .associate-detail-stepper {
            padding: 16px 20px;
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
        }

        .associate-detail-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* Mobile adjustments for Associate Detail View */
        @media (max-width: 768px) {
            .associate-detail-header {
                padding: 12px 16px;
                padding-top: calc(var(--safe-area-top) + 12px);
            }

            .associate-detail-name {
                font-size: 16px;
            }

            .associate-detail-stepper {
                padding: 12px 16px;
            }

            .associate-detail-content {
                padding: 16px;
            }

            .associate-detail-dropdown {
                width: 220px;
            }
        }

        /* ============================================
           ASSOCIATE SUB-PAGES STYLES
           (Profile, Sessions, Contracts, Finance, Inbox)
           ============================================ */

        .associate-subpage {
            min-height: 100vh;
            background: var(--pure-white);
            display: flex;
            flex-direction: column;
        }

        .associate-subpage-mint {
            background: var(--eden-surface);
        }

        .associate-subpage-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            padding-top: calc(var(--safe-area-top) + 16px);
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .associate-subpage-back {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--eden-text-secondary);
            cursor: pointer;
            padding: 8px;
            margin: -8px;
            border-radius: 6px;
            transition: all 200ms ease;
        }

        .associate-subpage-back:hover {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .associate-subpage-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text-primary);
        }

        .associate-subpage-initials {
            font-size: 14px;
            color: var(--eden-text-secondary);
            font-weight: 500;
        }

        .associate-subpage-content {
            flex: 1;
            padding: 24px 20px;
            overflow-y: auto;
        }

        /* ============================================
           PROFILE PAGE STYLES
           ============================================ */

        .profile-page {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .profile-section {
            margin-bottom: 32px;
        }

        .profile-section-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .profile-stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .profile-stat-card {
            background: var(--eden-surface);
            border-radius: 16px;
            padding: 16px 12px;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .profile-stat-card:hover {
            background: var(--eden-green-light);
        }

        .profile-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .profile-stat-value-green {
            color: var(--eden-green);
        }

        .profile-stat-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-top: 4px;
            color: var(--eden-text-secondary);
            font-size: 14px;
        }

        .profile-stat-label-text {
            margin-top: 4px;
            color: var(--eden-text-secondary);
            font-size: 14px;
        }

        .profile-info-card {
            background: var(--pure-white);
            border-radius: 16px;
            border: 1px solid var(--eden-border);
            overflow: hidden;
        }

        .profile-info-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .profile-info-row:last-child {
            border-bottom: none;
        }

        .profile-info-row-link {
            text-decoration: none;
            transition: background 200ms ease;
        }

        .profile-info-row-link:hover {
            background: var(--eden-surface);
        }

        .profile-info-label {
            font-size: 15px;
            color: var(--eden-text-secondary);
        }

        .profile-info-value-wrap {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-info-value {
            font-size: 15px;
            font-weight: 500;
            color: var(--eden-text-primary);
        }

        /* ============================================
           SESSIONS PAGE STYLES
           ============================================ */

        .sessions-page {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .sessions-section {
            margin-bottom: 32px;
        }

        .sessions-section-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .sessions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .session-card {
            background: var(--pure-white);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .session-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .session-card-date {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .session-status {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .session-status-scheduled {
            background: #dbeafe;
            color: #1e40af;
        }

        .session-status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .session-status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .session-card-client {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .session-card-type {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin: 4px 0 0;
        }

        /* ============================================
           CONTRACTS PAGE STYLES
           ============================================ */

        .contracts-page {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .contracts-section {
            margin-bottom: 32px;
        }

        .contracts-section-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .contracts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .contract-card {
            background: var(--pure-white);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .contract-card-content {
            flex: 1;
        }

        .contract-card-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .contract-card-date {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin: 4px 0 0;
        }

        .contract-status {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            padding: 4px 8px;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .contract-status-signed {
            background: #dcfce7;
            color: #166534;
        }

        .contract-status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .contract-status-expired {
            background: #fee2e2;
            color: #991b1b;
        }

        /* ============================================
           FINANCE PAGE (PAYOUT COCKPIT) STYLES
           ============================================ */

        .finance-page {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .finance-hero-card {
            background: var(--eden-green);
            border-radius: 20px;
            padding: 24px;
            color: var(--pure-white);
            margin-bottom: 16px;
        }

        .finance-hero-label {
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
        }

        .finance-hero-amount {
            font-size: 40px;
            font-weight: 700;
            margin: 4px 0;
        }

        .finance-hero-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
        }

        .finance-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .finance-progress-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 4px;
            transition: width 500ms ease;
        }

        .finance-progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 13px;
            opacity: 0.8;
        }

        .finance-status-row {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .finance-status-card {
            flex: 1;
            min-width: 100px;
            background: var(--pure-white);
            border-radius: 16px;
            padding: 16px 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .finance-status-amount {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .finance-status-amber {
            color: var(--alert-amber);
        }

        .finance-status-green {
            color: var(--eden-green);
        }

        .finance-status-blue {
            color: var(--alert-blue);
        }

        .finance-status-label {
            font-size: 13px;
            color: var(--eden-text-secondary);
            margin: 0;
            line-height: 1.3;
        }

        .finance-status-count {
            font-size: 12px;
            color: var(--eden-text-muted);
            margin: 4px 0 0;
        }

        .finance-expandable-section {
            background: var(--pure-white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .finance-expandable-header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: var(--eden-text-primary);
            transition: background 200ms ease;
        }

        .finance-expandable-header:hover {
            background: var(--eden-surface);
        }

        .finance-expandable-content {
            border-top: 1px solid var(--eden-border);
        }

        .finance-session-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .finance-session-row:last-child {
            border-bottom: none;
        }

        .finance-session-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--alert-blue);
            flex-shrink: 0;
        }

        .finance-session-info {
            flex: 1;
            min-width: 0;
        }

        .finance-session-date {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .finance-session-client {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin: 2px 0;
        }

        .finance-session-type {
            font-size: 12px;
            color: var(--eden-text-muted);
            margin: 0;
        }

        .finance-session-amounts {
            text-align: right;
            flex-shrink: 0;
        }

        .finance-session-total {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text-primary);
            margin: 0;
        }

        .finance-session-share {
            font-size: 12px;
            color: var(--eden-green);
            margin: 2px 0 0;
        }

        .finance-empty-message {
            padding: 24px;
            text-align: center;
            color: var(--eden-text-secondary);
        }

        /* ============================================
           INBOX PAGE STYLES
           ============================================ */

        .inbox-page {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .inbox-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .inbox-header-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .inbox-compose-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--eden-green);
            color: var(--pure-white);
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .inbox-compose-btn:hover {
            background: var(--eden-green-hover);
        }

        .inbox-messages-list {
            background: var(--pure-white);
            border-radius: 16px;
            border: 1px solid var(--eden-border);
            overflow: hidden;
        }

        .inbox-message-row {
            width: 100%;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: none;
            border: none;
            border-bottom: 1px solid var(--eden-border);
            cursor: pointer;
            text-align: left;
            transition: background 200ms ease;
        }

        .inbox-message-row:last-child {
            border-bottom: none;
        }

        .inbox-message-row:hover {
            background: var(--eden-surface);
        }

        .inbox-message-indicator {
            padding-top: 6px;
            width: 12px;
            flex-shrink: 0;
        }

        .inbox-unread-dot {
            display: block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--alert-blue);
        }

        .inbox-message-content {
            flex: 1;
            min-width: 0;
        }

        .inbox-message-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 8px;
        }

        .inbox-message-subject {
            font-size: 15px;
            font-weight: 500;
            color: var(--eden-text-secondary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .inbox-message-unread {
            font-weight: 600;
            color: var(--eden-text-primary);
        }

        .inbox-message-time {
            font-size: 12px;
            color: var(--eden-text-muted);
            flex-shrink: 0;
        }

        .inbox-message-sender {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin: 4px 0 0;
        }

        /* Empty State */
        .empty-state {
            padding: 48px 24px;
            text-align: center;
            color: var(--eden-text-muted);
        }

        .empty-state svg {
            color: var(--eden-border);
            margin-bottom: 12px;
        }

        .empty-state p {
            margin: 0;
            font-size: 15px;
        }

        /* Mobile adjustments for Associate Sub-pages */
        @media (max-width: 768px) {
            .associate-subpage-header {
                padding: 12px 16px;
                padding-top: calc(var(--safe-area-top) + 12px);
            }

            .associate-subpage-title {
                font-size: 16px;
            }

            .associate-subpage-content {
                padding: 20px 16px;
            }

            .profile-stats-row {
                gap: 8px;
            }

            .profile-stat-card {
                padding: 12px 8px;
            }

            .profile-stat-value {
                font-size: 20px;
            }

            .finance-hero-amount {
                font-size: 32px;
            }

            .finance-status-row {
                gap: 8px;
            }

            .finance-status-card {
                padding: 12px 8px;
            }

            .finance-status-amount {
                font-size: 16px;
            }
        }

        /* ============================================
           CLIENT DETAIL VIEW STYLES
           ============================================ */

        .client-detail-page {
            min-height: 100vh;
            background: var(--eden-surface);
            display: flex;
            flex-direction: column;
        }

        .client-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            padding-top: calc(var(--safe-area-top) + 16px);
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .client-detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
            border-radius: 6px;
            transition: all 200ms ease;
        }

        .client-detail-back:hover {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .client-detail-header-info {
            text-align: center;
            flex: 1;
        }

        .client-detail-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .client-detail-ucid {
            font-size: 12px;
            color: var(--eden-text-secondary);
            font-family: monospace;
        }

        .client-detail-menu {
            position: relative;
        }

        .client-detail-menu-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 200ms ease;
        }

        .client-detail-menu-btn:hover {
            background: var(--eden-green-light);
        }

        .client-detail-menu-btn svg {
            color: var(--eden-text-secondary);
        }

        .client-detail-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 240px;
            background: var(--pure-white);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--eden-border);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 200ms ease;
            z-index: 100;
            overflow: hidden;
        }

        .client-detail-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(4px);
        }

        .client-detail-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--eden-border);
            background: var(--eden-mint);
        }

        .client-detail-dropdown-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 4px;
        }

        .client-detail-dropdown-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .client-detail-dropdown-menu {
            padding: 8px;
        }

        .client-detail-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 10px 12px;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 200ms ease;
            text-align: left;
        }

        .client-detail-dropdown-item:hover {
            background: var(--eden-green-light);
        }

        .client-detail-dropdown-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--eden-mint);
            border-radius: 8px;
        }

        .client-detail-dropdown-icon svg {
            width: 18px;
            height: 18px;
            color: var(--eden-green);
        }

        .client-detail-dropdown-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .client-detail-dropdown-subtitle {
            font-size: 12px;
            color: var(--eden-text-secondary);
        }

        .client-detail-pipeline {
            padding: 16px 20px;
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
        }

        .client-pipeline-horizontal {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .client-pipeline-stage {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 200ms ease;
            flex: 1;
            justify-content: center;
        }

        .client-pipeline-stage:hover {
            background: var(--eden-mint);
        }

        .client-pipeline-stage.current {
            background: var(--eden-green-light);
        }

        .client-pipeline-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--eden-border);
            transition: all 200ms ease;
        }

        .client-pipeline-stage.awaiting .client-pipeline-dot { background: var(--alert-amber); }
        .client-pipeline-stage.pending .client-pipeline-dot { background: var(--alert-blue); }
        .client-pipeline-stage.active .client-pipeline-dot { background: var(--eden-green); }
        .client-pipeline-stage.ending .client-pipeline-dot { background: #8b5cf6; }

        .client-pipeline-stage.current .client-pipeline-dot {
            box-shadow: 0 0 0 3px rgba(45, 95, 77, 0.2);
        }

        .client-pipeline-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-text-secondary);
        }

        .client-pipeline-stage.current .client-pipeline-label {
            color: var(--eden-green);
            font-weight: 600;
        }

        .client-detail-tabs {
            display: flex;
            gap: 4px;
            padding: 8px 20px;
            background: var(--pure-white);
            border-bottom: 1px solid var(--eden-border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .client-detail-tab {
            padding: 8px 16px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text-secondary);
            cursor: pointer;
            border-radius: 6px;
            white-space: nowrap;
            transition: all 200ms ease;
        }

        .client-detail-tab:hover {
            background: var(--eden-mint);
        }

        .client-detail-tab.active {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .client-detail-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .client-detail-section {
            background: var(--pure-white);
            border-radius: 12px;
            border: 1px solid var(--eden-border);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .client-detail-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            padding: 16px 16px 8px;
        }

        .client-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .client-detail-row:last-child {
            border-bottom: none;
        }

        .client-detail-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .client-detail-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        /* Mobile adjustments for Client Detail View */
        @media (max-width: 768px) {
            .client-detail-header {
                padding: 12px 16px;
                padding-top: calc(var(--safe-area-top) + 12px);
            }

            .client-detail-name {
                font-size: 16px;
            }

            .client-detail-pipeline {
                padding: 12px 16px;
            }

            .client-pipeline-stage {
                padding: 6px 8px;
            }

            .client-pipeline-label {
                font-size: 11px;
            }

            .client-detail-tabs {
                padding: 8px 16px;
            }

            .client-detail-content {
                padding: 16px;
            }

            .client-detail-dropdown {
                width: 220px;
            }
        }

        /* ============================================
           REFERRAL DETAIL VIEW STYLES
           ============================================ */

        .referral-detail-page {
            min-height: 100vh;
            background: var(--pure-white);
            display: flex;
            flex-direction: column;
        }

        .referral-detail-header {
            padding: 16px 20px;
            padding-top: calc(var(--safe-area-top) + 16px);
        }

        .referral-detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--eden-text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
            border-radius: 6px;
            transition: all 200ms ease;
        }

        .referral-detail-back:hover {
            background: var(--eden-green-light);
            color: var(--eden-green);
        }

        .referral-detail-banner {
            margin: 0 16px;
            padding: 20px;
            border-radius: 12px;
            background: var(--alert-amber-bg, #FEF3C7);
        }

        .referral-detail-banner.new {
            background: #F3E8FF;
        }

        .referral-detail-banner.broadcasting {
            background: #DBEAFE;
        }

        .referral-detail-banner.pending {
            background: #FEF3C7;
        }

        .referral-detail-banner.accepted {
            background: var(--eden-green-light);
        }

        .referral-detail-badge {
            display: inline-block;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 20px;
            background: rgba(0,0,0,0.1);
            color: var(--eden-text);
        }

        .referral-detail-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--eden-text);
            margin-top: 12px;
            font-family: monospace;
        }

        .referral-detail-subtitle {
            font-size: 14px;
            color: var(--eden-text-secondary);
            margin-top: 8px;
            line-height: 1.5;
        }

        .referral-detail-content {
            flex: 1;
            padding: 20px;
        }

        .referral-detail-section {
            margin-bottom: 24px;
        }

        .referral-detail-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--eden-text-secondary);
            margin-bottom: 12px;
        }

        .referral-detail-card {
            background: var(--eden-mint);
            border-radius: 12px;
            border: 1px solid var(--eden-border);
            overflow: hidden;
        }

        .referral-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 14px 16px;
            border-bottom: 1px solid var(--eden-border);
        }

        .referral-detail-row:last-child {
            border-bottom: none;
        }

        .referral-detail-label {
            font-size: 14px;
            color: var(--eden-text-secondary);
        }

        .referral-detail-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--eden-text);
        }

        .referral-detail-action-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--eden-green);
            color: var(--pure-white);
            border-radius: 12px;
            cursor: pointer;
            transition: all 200ms ease;
            border: none;
            width: 100%;
            text-align: left;
            margin-bottom: 8px;
        }

        .referral-detail-action-card:hover {
            background: var(--eden-green-hover);
        }

        .referral-detail-action-card.secondary {
            background: var(--eden-mint);
            color: var(--eden-text);
            border: 1px solid var(--eden-border);
        }

        .referral-detail-action-card.secondary:hover {
            background: var(--eden-green-light);
        }

        .referral-detail-action-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }

        .referral-detail-action-card.secondary .referral-detail-action-icon {
            background: var(--pure-white);
        }

        .referral-detail-action-text {
            flex: 1;
        }

        .referral-detail-action-title {
            font-size: 15px;
            font-weight: 600;
        }

        .referral-detail-action-subtitle {
            font-size: 13px;
            opacity: 0.8;
        }

        .referral-detail-actions {
            position: sticky;
            bottom: 0;
            padding: 16px 20px;
            padding-bottom: calc(var(--safe-area-bottom) + 16px);
            background: var(--pure-white);
            border-top: 1px solid var(--eden-border);
            display: flex;
            gap: 12px;
        }

        .referral-action-btn {
            flex: 1;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 200ms ease;
            border: none;
        }

        .referral-action-btn.primary {
            background: var(--eden-green);
            color: var(--pure-white);
        }

        .referral-action-btn.primary:hover {
            background: var(--eden-green-hover);
        }

        .referral-action-btn.secondary {
            background: var(--eden-mint);
            color: var(--eden-text);
            border: 1px solid var(--eden-border);
        }

        .referral-action-btn.secondary:hover {
            background: var(--eden-green-light);
        }

        /* Mobile adjustments for Referral Detail View */
        @media (max-width: 768px) {
            .referral-detail-header {
                padding: 12px 16px;
                padding-top: calc(var(--safe-area-top) + 12px);
            }

            .referral-detail-banner {
                margin: 0 12px;
                padding: 16px;
            }

            .referral-detail-title {
                font-size: 18px;
            }

            .referral-detail-content {
                padding: 16px;
            }

            .referral-detail-actions {
                padding: 12px 16px;
                padding-bottom: calc(var(--safe-area-bottom) + 12px);
            }
        }

        /* ============================================
           ONBOARDING FORM STYLES
           ============================================ */

        .onboarding-form {
            padding: 0;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .form-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .form-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--eden-text);
        }

        .form-section-status {
            font-size: 11px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .form-section-status.complete {
            background: #dcfce7;
            color: #16a34a;
        }

        .form-section-status.incomplete {
            background: #fef3c7;
            color: #d97706;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--eden-text-secondary);
            margin-bottom: 6px;
        }

        .form-input {
            padding: 10px 12px;
            font-size: 14px;
            border: 1px solid var(--eden-border);
            border-radius: 6px;
            background: var(--pure-white);
            color: var(--eden-text);
            transition: all 200ms ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--eden-green);
            box-shadow: 0 0 0 3px rgba(45, 95, 77, 0.1);
        }

        .form-input.valid {
            border-color: #22c55e;
        }

        .form-input.invalid {
            border-color: #ef4444;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%239ca3af' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* Document upload styling */
        .doc-upload-area {
            border: 2px dashed var(--eden-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .doc-upload-area:hover {
            border-color: var(--eden-green);
            background: var(--eden-mint);
        }

        .doc-upload-area.has-file {
            border-style: solid;
            border-color: #22c55e;
            background: #f0fdf4;
        }

        .doc-upload-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
            color: var(--eden-text-secondary);
        }

        .doc-upload-text {
            font-size: 13px;
            color: var(--eden-text-secondary);
        }

        .doc-upload-filename {
            font-size: 13px;
            font-weight: 500;
            color: var(--eden-green);
            margin-top: 8px;
        }

        /* ===== MOBILE BOTTOM NAV ===== */

        .mobile-bottom-nav {
            display: none; /* Hidden by default, shown via media query */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: #FFFFFF;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.06);
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom); /* iOS safe area */
        }

        /* Show on mobile only */
        @media (max-width: 768px) {
            .mobile-bottom-nav {
                display: flex;
                justify-content: space-around;
                align-items: center;
            }

            /* Add padding to main content so it doesn't hide behind nav */
            body {
                padding-bottom: calc(64px + env(safe-area-inset-bottom));
            }
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            height: 100%;
            padding: 8px 4px;
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280; /* Inactive grey */
            transition: color 0.2s ease;
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }

        .bottom-nav-item:hover,
        .bottom-nav-item:focus {
            color: #4b5563;
            outline: none;
        }

        .bottom-nav-item.active {
            color: var(--eden-green); /* Eden Green */
        }

        .bottom-nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        .bottom-nav-label {
            font-size: 11px;
            font-weight: 500;
            line-height: 1;
        }

        .bottom-nav-badge {
            position: absolute;
            top: 6px;
            right: 50%;
            transform: translateX(12px);
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: #f43f5e; /* Rose for alerts */
            color: #FFFFFF;
            font-size: 11px;
            font-weight: 600;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== UNIFIED DETAIL VIEW ===== */

        .unified-detail-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: calc(64px + env(safe-area-inset-bottom, 0px)); /* Exclude bottom nav */
            z-index: 900;
            pointer-events: none; /* Container NEVER captures clicks */
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .unified-detail-view.open {
            opacity: 1;
            /* NO pointer-events: auto here - keep it none on container */
        }

        /* Backdrop - Desktop only */
        .unified-detail-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .unified-detail-view.open .unified-detail-backdrop {
            opacity: 1;
            pointer-events: auto; /* Only backdrop captures clicks when open */
        }

        /* Detail Panel - Desktop (Side Panel) */
        .unified-detail-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 450px;
            max-width: 100%;
            height: 100%;
            background: #FFFFFF;
            box-shadow: -4px 0 24px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            pointer-events: none;
        }

        .unified-detail-view.open .unified-detail-panel {
            transform: translateX(0);
            pointer-events: auto; /* Only panel captures clicks when open */
        }

        /* Mobile: Full Page (but above bottom nav) */
        @media (max-width: 768px) {
            .unified-detail-view {
                bottom: calc(64px + env(safe-area-inset-bottom, 0px)); /* Keep excluding bottom nav */
            }

            .unified-detail-backdrop {
                display: none;
            }

            .unified-detail-panel {
                width: 100%;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0; /* Relative to parent which now excludes bottom nav */
                transform: translateX(100%);
            }

            .unified-detail-view.open .unified-detail-panel {
                transform: translateX(0);
            }
        }

        /* ===== UNIFIED DETAIL HEADER ===== */

        .unified-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            min-height: 64px;
            background: #FFFFFF;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .unified-detail-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .unified-detail-header-center {
            flex: 1;
            text-align: center;
            min-width: 0;
        }

        .unified-detail-header-right {
            position: relative;
        }

        /* Steward Anchor (Admin only) */
        .unified-steward-anchor {
            display: flex;
            align-items: center;
        }

        .unified-steward-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--eden-deep, #2d5f4d);
        }

        /* Back Button */
        .unified-detail-back-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px;
            background: none;
            border: none;
            color: var(--eden-deep, #2d5f4d);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.15s ease;
        }

        .unified-detail-back-btn:hover {
            background: var(--eden-whisper, #f4f7f6);
        }

        .unified-detail-back-text {
            display: none;
        }

        @media (min-width: 400px) {
            .unified-detail-back-text {
                display: inline;
            }
        }

        /* Title */
        .unified-detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .unified-detail-subtitle {
            font-size: 12px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            color: #6b7280;
            display: block;
        }

        /* Menu Button */
        .unified-detail-menu-btn {
            padding: 8px;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .unified-detail-menu-btn:hover {
            background: var(--eden-whisper, #f4f7f6);
            color: var(--eden-deep, #2d5f4d);
        }

        /* Dropdown Menu */
        .unified-detail-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            min-width: 200px;
            background: #FFFFFF;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            padding: 4px 0;
            z-index: 20;
            display: none;
        }

        .unified-detail-dropdown.open {
            display: block;
        }

        .unified-detail-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .unified-detail-dropdown-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #9ca3af;
            margin-bottom: 4px;
        }

        .unified-detail-dropdown-name {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
        }

        .unified-detail-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 10px 16px;
            text-align: left;
            background: none;
            border: none;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .unified-detail-dropdown-item:hover {
            background: var(--eden-whisper, #f4f7f6);
        }

        .unified-detail-dropdown-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--eden-whisper, #f4f7f6);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .unified-detail-dropdown-icon svg {
            width: 16px;
            height: 16px;
            color: var(--eden-deep, #2d5f4d);
        }

        .unified-detail-dropdown-text {
            flex: 1;
            min-width: 0;
        }

        .unified-detail-dropdown-title {
            font-size: 14px;
            font-weight: 500;
            color: #111827;
        }

        .unified-detail-dropdown-subtitle {
            font-size: 12px;
            color: #6b7280;
        }

        /* ===== UNIFIED DETAIL TABS ===== */

        .unified-detail-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            background: #FFFFFF;
        }

        .unified-detail-tabs::-webkit-scrollbar {
            display: none;
        }

        .unified-detail-tab {
            padding: 12px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            white-space: nowrap;
            transition: color 0.15s ease, border-color 0.15s ease;
        }

        .unified-detail-tab:hover {
            color: #374151;
        }

        .unified-detail-tab.active {
            color: var(--eden-deep, #2d5f4d);
            border-bottom-color: var(--eden-deep, #2d5f4d);
        }

        /* ===== UNIFIED DETAIL CONTENT ===== */

        .unified-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--eden-whisper, #f4f7f6);
        }

        /* Content sections */
        .unified-detail-section {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .unified-detail-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .unified-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .unified-detail-row:last-child {
            border-bottom: none;
        }

        .unified-detail-label {
            font-size: 14px;
            color: #6b7280;
        }

        .unified-detail-value {
            font-size: 14px;
            color: #111827;
            font-weight: 500;
            text-align: right;
        }

        /* Pipeline stepper in unified detail */
        .unified-detail-pipeline {
            display: flex;
            justify-content: space-between;
            padding: 16px;
            background: #FFFFFF;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .unified-pipeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
            min-width: 60px;
        }

        .unified-pipeline-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
        }

        .unified-pipeline-dot.active {
            background: var(--eden-deep, #2d5f4d);
        }

        .unified-pipeline-dot.completed {
            background: var(--eden-deep, #2d5f4d);
            opacity: 0.5;
        }

        .unified-pipeline-label {
            font-size: 10px;
            color: #6b7280;
            text-align: center;
        }

        .unified-pipeline-label.active {
            color: var(--eden-deep, #2d5f4d);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="mobile-logo">
                <!-- Eden Leaf Logo (Outlined) -->
                <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M16 28 L16 12" stroke-linecap="round"/>
                    <path d="M16 12 C16 12, 8 14, 6 20 C4 26, 10 28, 16 24 C22 28, 28 26, 26 20 C24 14, 16 12, 16 12" stroke-linejoin="round"/>
                    <path d="M16 12 C16 16, 12 20, 10 22" stroke-linecap="round"/>
                    <path d="M16 14 C17 16, 20 19, 22 20" stroke-linecap="round"/>
                </svg>
                <span>Eden Hub</span>
            </div>
            <button class="menu-btn" onclick="toggleSidebar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
        </header>

        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header (fixed, doesn't scroll) -->
            <div class="sidebar-header">
                <div class="logo-container">
                    <!-- Eden Leaf Logo (Outlined) -->
                    <svg class="logo-icon" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M16 28 L16 12" stroke-linecap="round"/>
                        <path d="M16 12 C16 12, 8 14, 6 20 C4 26, 10 28, 16 24 C22 28, 28 26, 26 20 C24 14, 16 12, 16 12" stroke-linejoin="round"/>
                        <path d="M16 12 C16 16, 12 20, 10 22" stroke-linecap="round"/>
                        <path d="M16 14 C17 16, 20 19, 22 20" stroke-linecap="round"/>
                    </svg>
                    <span class="logo-text">Eden Hub</span>
                </div>
            </div>

            <!-- Sidebar Nav Content (scrollable) -->
            <div class="sidebar-nav-content">
                <!-- Daily Pulse Section -->
            <nav class="nav-section">
                <div class="nav-label">Daily Pulse</div>
                <a href="#" class="nav-item active" data-view="dashboard" onclick="showView('dashboard')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-view="action-centre" onclick="showView('action-centre')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span>Action Centre</span>
                    <div class="alert-dot"></div>
                </a>
                <a href="#" class="nav-item" data-view="referrals" onclick="showView('referrals')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        <line x1="19" y1="8" x2="19" y2="14"/>
                        <line x1="22" y1="11" x2="16" y2="11"/>
                    </svg>
                    <span>Referrals</span>
                    <div class="alert-dot" id="referralsAlertDot"></div>
                </a>
                <a href="#" class="nav-item" data-view="schedule" onclick="showView('schedule')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span>Schedule</span>
                </a>
            </nav>

            <!-- Practice Foundations Section -->
            <nav class="nav-section">
                <div class="nav-label">Practice Foundations</div>
                <a href="#" class="nav-item" data-view="associates" id="nav-associates" onclick="showView('associates')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span>Associates</span>
                </a>
                <a href="#" class="nav-item" data-view="clients" onclick="showView('clients')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span>Clients</span>
                </a>
                <a href="#" class="nav-item" data-view="contracts" onclick="showView('contracts')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    <span>Contracts</span>
                </a>
                <a href="#" class="nav-item" data-view="earnings" onclick="showView('earnings')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    <span>Earnings</span>
                </a>
                <a href="#" class="nav-item" data-view="cpd" onclick="showView('cpd')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                        <path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/>
                    </svg>
                    <span>CPD</span>
                </a>
            </nav>

                <!-- Support Section -->
                <nav class="nav-section">
                    <div class="nav-label">Support</div>
                    <a href="#" class="nav-item" data-view="support" onclick="showView('support')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <span>Resources</span>
                    </a>
                </nav>
            </div>

            <!-- Sidebar Footer (fixed, doesn't scroll) -->
            <div class="sidebar-footer">
                <div class="user-profile-section" id="userProfileSection">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard View -->
            <div class="view-container active" id="dashboardView">
                <!-- ============================================
                     ASSOCIATE HOME SCREEN
                     ============================================ -->
                <div class="associate-home" id="associateHome">
                    <!-- Greeting -->
                    <div class="home-greeting">
                        <h1 class="greeting-text" id="associateGreeting">Good morning, Sarah</h1>
                        <p class="greeting-subtext">Here's your practice overview</p>
                    </div>

                    <!-- Action Buttons Row -->
                    <div class="home-actions-row">
                        <button class="home-action-btn" onclick="navigateToAssociateView('inbox')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                            Inbox
                            <span class="badge-count" id="inboxBadge">3</span>
                        </button>
                        <button class="home-action-btn" onclick="navigateToAssociateView('pipeline')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Pipeline
                        </button>
                    </div>

                    <!-- My Clients Card -->
                    <div class="clients-card" onclick="navigateToAssociateView('clients')">
                        <div class="clients-card-header">
                            <span class="clients-card-title">My Clients</span>
                            <span class="clients-card-count" id="totalClientsCount">12 active</span>
                        </div>
                        <div class="pipeline-visual" id="pipelineVisual">
                            <div class="pipeline-stage-dot">
                                <div class="stage-dot enquiry"></div>
                                <span class="stage-count" id="stageEnquiry">2</span>
                                <span class="stage-label">Enquiry</span>
                            </div>
                            <div class="pipeline-connector"></div>
                            <div class="pipeline-stage-dot">
                                <div class="stage-dot consultation"></div>
                                <span class="stage-count" id="stageConsultation">1</span>
                                <span class="stage-label">Consult</span>
                            </div>
                            <div class="pipeline-connector"></div>
                            <div class="pipeline-stage-dot">
                                <div class="stage-dot onboarding"></div>
                                <span class="stage-count" id="stageOnboarding">2</span>
                                <span class="stage-label">Onboard</span>
                            </div>
                            <div class="pipeline-connector"></div>
                            <div class="pipeline-stage-dot">
                                <div class="stage-dot active"></div>
                                <span class="stage-count" id="stageActive">7</span>
                                <span class="stage-label">Active</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ============================================
                     ADMIN HOME SCREEN
                     ============================================ -->
                <div class="admin-home" id="adminHome">
                    <!-- Dark Header with Cash Ring -->
                    <div class="admin-header">
                        <div class="admin-header-top">
                            <div>
                                <div class="admin-header-title">Practice Overview</div>
                                <div class="admin-header-practice">Eden Relationships</div>
                            </div>
                        </div>

                        <!-- Cash Density Ring -->
                        <div class="admin-header-center">
                            <div class="progress-ring-container cash-density-ring" id="cashDensityRing">
                                <svg class="progress-ring" width="140" height="140">
                                    <circle class="progress-ring-bg" cx="70" cy="70" r="60" stroke-width="10"/>
                                    <circle class="progress-ring-progress" id="cashRingProgress" cx="70" cy="70" r="60" stroke-width="10"
                                        stroke-dasharray="377" stroke-dashoffset="377"/>
                                </svg>
                                <div class="progress-ring-content">
                                    <div class="progress-ring-value" id="trueCashValue">18,450</div>
                                    <div class="progress-ring-label" id="projectedLabel">of 24,680 projected</div>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Stats Row -->
                        <div class="admin-header-stats">
                            <div class="admin-stat" onclick="showView('associates')" style="position: relative;">
                                <div class="admin-stat-value" id="adminAssociatesCount">7</div>
                                <div class="admin-stat-label">Associates</div>
                            </div>
                            <div class="admin-stat" onclick="showView('clients')" style="position: relative;">
                                <div class="admin-stat-value" id="adminClientsCount">74</div>
                                <div class="admin-stat-label">Clients</div>
                            </div>
                            <div class="admin-stat" onclick="navigateToAdminView('pending-payments')" style="position: relative;">
                                <div class="admin-stat-value" id="adminPendingCount">4,820</div>
                                <div class="admin-stat-label">Pending</div>
                                <div class="pulse-dot" id="adminPendingPulse"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Cards -->
                    <div class="admin-cards-row">
                        <div class="admin-card" onclick="navigateToAdminView('finance')">
                            <div class="admin-card-header">
                                <span class="admin-card-title">Financial Summary</span>
                                <div class="admin-card-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <line x1="12" y1="1" x2="12" y2="23"/>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="admin-card-content">
                                <div class="admin-card-value" id="adminRevenueValue">24,680</div>
                                <span>Revenue this month</span>
                            </div>
                        </div>

                        <div class="admin-card" onclick="navigateToAdminView('health')">
                            <div class="admin-card-header">
                                <span class="admin-card-title">Practice Health</span>
                                <div class="admin-card-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="admin-card-content">
                                <div class="admin-card-value" style="color: var(--eden-green);">82%</div>
                                <span>Average capacity utilisation</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ============================================
                     NAVIGATION VIEWS (pushed views for both roles)
                     ============================================ -->

                <!-- Sessions View (Associate) -->
                <div class="nav-view" id="sessionsNavView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Sessions This Week</h2>
                    </div>
                    <div id="sessionsContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Pending Payments View (Associate) -->
                <div class="nav-view" id="pendingNavView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Pending Payments</h2>
                    </div>
                    <div id="pendingContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Earnings View (Associate) -->
                <div class="nav-view" id="earningsNavView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Earnings</h2>
                    </div>
                    <div id="earningsContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- My Clients View (Associate) -->
                <div class="nav-view" id="clientsNavView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">My Clients</h2>
                    </div>
                    <div id="clientsNavContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Inbox View (Associate) -->
                <div class="nav-view" id="inboxNavView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Inbox</h2>
                    </div>
                    <div id="inboxNavContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Session Detail View (Associate) -->
                <div class="nav-view" id="sessionDetailView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Session Details</h2>
                    </div>
                    <div id="sessionDetailContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Admin: Pending Payments View -->
                <div class="nav-view" id="adminPendingView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Pending Payments</h2>
                    </div>
                    <div id="adminPendingContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Admin: Finance View -->
                <div class="nav-view" id="adminFinanceView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Financial Summary</h2>
                    </div>
                    <div id="adminFinanceContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Admin: Practice Health View -->
                <div class="nav-view" id="adminHealthView">
                    <div class="nav-view-header">
                        <button class="nav-back-btn" onclick="navigateHomeBack()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <h2 class="nav-view-title">Practice Health</h2>
                    </div>
                    <div id="adminHealthContent">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- Associates View -->
            <div class="view-container" id="associatesView">
                <header class="page-header">
                    <button class="back-btn" onclick="showView('dashboard')" style="display: inline-flex; align-items: center; gap: 8px; background: none; border: none; color: var(--eden-text-secondary); font-size: 14px; cursor: pointer; margin-bottom: 12px; padding: 0;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                        Back to Dashboard
                    </button>
                    <h1 class="page-title">Associates</h1>
                    <p class="page-subtitle" id="associatesSubtitle">Your therapy team</p>
                </header>

                <!-- Summary Stats -->
                <div class="summary-stats-grid" id="associatesStats">
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="totalAssociatesCount">7</div>
                        <div class="summary-stat-label">Total Associates</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="activeAssociatesCount">5</div>
                        <div class="summary-stat-label">Independent</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="supportedAssociatesCount">2</div>
                        <div class="summary-stat-label">Supported</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="highCapacityCount">3</div>
                        <div class="summary-stat-label">High Capacity</div>
                    </div>
                </div>

                <!-- Filter Pills -->
                <div class="filter-pills" id="associatesFilter">
                    <button class="filter-pill active" data-filter="all" onclick="filterAssociates('all')">All</button>
                    <button class="filter-pill" data-filter="independent" onclick="filterAssociates('independent')">Independent</button>
                    <button class="filter-pill" data-filter="supported" onclick="filterAssociates('supported')">Supported</button>
                    <button class="filter-pill" data-filter="highCapacity" onclick="filterAssociates('highCapacity')">High Capacity</button>
                </div>

                <!-- Entity Card Grid -->
                <div class="entity-grid" id="cardGrid">
                    <!-- Cards will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Associate Detail View (Full Page Navigation) -->
            <div class="view-container" id="associateDetailView">
                <div class="associate-detail-page">
                    <header class="associate-detail-header">
                        <button class="associate-detail-back" onclick="closeAssociateDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back
                        </button>
                        <div class="associate-detail-header-info">
                            <div class="associate-detail-name" id="associateDetailName">Associate Name</div>
                            <div class="associate-detail-ucid" id="associateDetailUcid">ASSOC-0000</div>
                        </div>
                        <div class="associate-detail-menu">
                            <button class="associate-detail-menu-btn" onclick="toggleAssociateDetailMenu(event)">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="12" cy="5" r="1"/>
                                    <circle cx="12" cy="19" r="1"/>
                                </svg>
                            </button>
                            <div class="associate-detail-dropdown" id="associateDetailDropdown">
                                <div class="associate-detail-dropdown-header">
                                    <div class="associate-detail-dropdown-label">Quick Access</div>
                                    <div class="associate-detail-dropdown-name" id="associateDetailDropdownName">Associate Name</div>
                                </div>
                                <div class="associate-detail-dropdown-menu">
                                    <button class="associate-detail-dropdown-item" onclick="navigateFromAssociateDetail('profile')">
                                        <div class="associate-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                <circle cx="12" cy="7" r="4"/>
                                            </svg>
                                        </div>
                                        <div class="associate-detail-dropdown-text">
                                            <div class="associate-detail-dropdown-title">Profile</div>
                                            <div class="associate-detail-dropdown-subtitle">View details</div>
                                        </div>
                                    </button>
                                    <button class="associate-detail-dropdown-item" onclick="navigateFromAssociateDetail('sessions')">
                                        <div class="associate-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                            </svg>
                                        </div>
                                        <div class="associate-detail-dropdown-text">
                                            <div class="associate-detail-dropdown-title">Sessions</div>
                                            <div class="associate-detail-dropdown-subtitle">View sessions</div>
                                        </div>
                                    </button>
                                    <button class="associate-detail-dropdown-item" onclick="navigateFromAssociateDetail('contracts')">
                                        <div class="associate-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                <polyline points="14 2 14 8 20 8"/>
                                                <line x1="16" y1="13" x2="8" y2="13"/>
                                                <line x1="16" y1="17" x2="8" y2="17"/>
                                            </svg>
                                        </div>
                                        <div class="associate-detail-dropdown-text">
                                            <div class="associate-detail-dropdown-title">Contracts</div>
                                            <div class="associate-detail-dropdown-subtitle">Active agreements</div>
                                        </div>
                                    </button>
                                    <button class="associate-detail-dropdown-item" onclick="navigateFromAssociateDetail('finance')">
                                        <div class="associate-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <line x1="12" y1="1" x2="12" y2="23"/>
                                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                            </svg>
                                        </div>
                                        <div class="associate-detail-dropdown-text">
                                            <div class="associate-detail-dropdown-title">Finance</div>
                                            <div class="associate-detail-dropdown-subtitle">Payout Cockpit</div>
                                        </div>
                                    </button>
                                    <button class="associate-detail-dropdown-item" onclick="navigateFromAssociateDetail('inbox')">
                                        <div class="associate-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                                <polyline points="22,6 12,13 2,6"/>
                                            </svg>
                                        </div>
                                        <div class="associate-detail-dropdown-text">
                                            <div class="associate-detail-dropdown-title">Inbox</div>
                                            <div class="associate-detail-dropdown-subtitle">Messages</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>
                    <div class="associate-detail-stepper" id="associateDetailStepper">
                        <!-- Progress stepper rendered by JavaScript -->
                    </div>
                    <div class="associate-detail-content" id="associateDetailContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Client Detail View (Full Page Navigation) -->
            <div class="view-container" id="clientDetailView">
                <div class="client-detail-page">
                    <header class="client-detail-header">
                        <button class="client-detail-back" onclick="closeClientDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            <span id="clientDetailBackText">Back</span>
                        </button>
                        <div class="client-detail-header-info">
                            <div class="client-detail-name" id="clientDetailName">Client Name</div>
                            <div class="client-detail-ucid" id="clientDetailUcid">CLIENT-0000</div>
                        </div>
                        <div class="client-detail-menu">
                            <button class="client-detail-menu-btn" onclick="toggleClientDetailMenu(event)">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="12" cy="5" r="1"/>
                                    <circle cx="12" cy="19" r="1"/>
                                </svg>
                            </button>
                            <div class="client-detail-dropdown" id="clientDetailDropdown">
                                <div class="client-detail-dropdown-header">
                                    <div class="client-detail-dropdown-label">Quick Access</div>
                                    <div class="client-detail-dropdown-name" id="clientDetailDropdownName">Client Name</div>
                                </div>
                                <div class="client-detail-dropdown-menu">
                                    <button class="client-detail-dropdown-item" onclick="navigateFromClientDetail('associate')">
                                        <div class="client-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                <circle cx="12" cy="7" r="4"/>
                                            </svg>
                                        </div>
                                        <div class="client-detail-dropdown-text">
                                            <div class="client-detail-dropdown-title">View Associate</div>
                                            <div class="client-detail-dropdown-subtitle" id="clientAssociateLink">Their therapist</div>
                                        </div>
                                    </button>
                                    <button class="client-detail-dropdown-item" onclick="navigateFromClientDetail('sessions')">
                                        <div class="client-detail-dropdown-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                            </svg>
                                        </div>
                                        <div class="client-detail-dropdown-text">
                                            <div class="client-detail-dropdown-title">Sessions</div>
                                            <div class="client-detail-dropdown-subtitle">Session history</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Pipeline Stage Indicator -->
                    <div class="client-detail-pipeline" id="clientDetailPipeline">
                        <!-- Pipeline stages rendered by JavaScript -->
                    </div>

                    <!-- Section Navigation -->
                    <div class="client-detail-tabs" id="clientDetailTabs">
                        <button class="client-detail-tab active" data-section="overview" onclick="switchClientSection('overview')">Overview</button>
                        <button class="client-detail-tab" data-section="sessions" onclick="switchClientSection('sessions')">Sessions</button>
                        <button class="client-detail-tab" data-section="finance" onclick="switchClientSection('finance')">Finance</button>
                        <button class="client-detail-tab" data-section="notes" onclick="switchClientSection('notes')">Notes</button>
                    </div>

                    <div class="client-detail-content" id="clientDetailContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Referral Detail View (Full Page Navigation) -->
            <div class="view-container" id="referralDetailView">
                <div class="referral-detail-page">
                    <header class="referral-detail-header">
                        <button class="referral-detail-back" onclick="closeReferralDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back to Referrals
                        </button>
                    </header>

                    <!-- Status Banner -->
                    <div class="referral-detail-banner" id="referralDetailBanner">
                        <span class="referral-detail-badge" id="referralDetailBadge">New</span>
                        <h1 class="referral-detail-title" id="referralDetailTitle">REF-00000</h1>
                        <p class="referral-detail-subtitle" id="referralDetailSubtitle">Client enquiry preview...</p>
                    </div>

                    <div class="referral-detail-content" id="referralDetailContent">
                        <!-- Content rendered by JavaScript -->
                    </div>

                    <!-- Bottom Actions -->
                    <div class="referral-detail-actions" id="referralDetailActions">
                        <!-- Actions rendered by JavaScript based on referral status -->
                    </div>
                </div>
            </div>

            <!-- Associate Profile View (Full Page) -->
            <div class="view-container" id="associateProfileView">
                <div class="associate-subpage">
                    <header class="associate-subpage-header">
                        <button class="associate-subpage-back" onclick="closeAssociateSubpage()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <h1 class="associate-subpage-title">Profile</h1>
                        <span class="associate-subpage-initials" id="profileInitials">SJ</span>
                    </header>
                    <div class="associate-subpage-content" id="associateProfileContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Associate Sessions View (Full Page) -->
            <div class="view-container" id="associateSessionsView">
                <div class="associate-subpage associate-subpage-mint">
                    <header class="associate-subpage-header">
                        <button class="associate-subpage-back" onclick="closeAssociateSubpage()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <h1 class="associate-subpage-title">Sessions</h1>
                        <span class="associate-subpage-initials" id="sessionsInitials">SJ</span>
                    </header>
                    <div class="associate-subpage-content" id="associateSessionsContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Associate Contracts View (Full Page) -->
            <div class="view-container" id="associateContractsView">
                <div class="associate-subpage associate-subpage-mint">
                    <header class="associate-subpage-header">
                        <button class="associate-subpage-back" onclick="closeAssociateSubpage()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <h1 class="associate-subpage-title">Contracts</h1>
                        <span class="associate-subpage-initials" id="contractsInitials">SJ</span>
                    </header>
                    <div class="associate-subpage-content" id="associateContractsContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Associate Finance View (Payout Cockpit - Full Page) -->
            <div class="view-container" id="associateFinanceView">
                <div class="associate-subpage associate-subpage-mint">
                    <header class="associate-subpage-header">
                        <button class="associate-subpage-back" onclick="closeAssociateSubpage()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <h1 class="associate-subpage-title">Payout Cockpit</h1>
                        <span class="associate-subpage-initials" id="financeInitials">SJ</span>
                    </header>
                    <div class="associate-subpage-content" id="associateFinanceContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Associate Inbox View (Full Page) -->
            <div class="view-container" id="associateInboxView">
                <div class="associate-subpage">
                    <header class="associate-subpage-header">
                        <button class="associate-subpage-back" onclick="closeAssociateSubpage()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </button>
                        <h1 class="associate-subpage-title">Inbox</h1>
                        <span class="associate-subpage-initials" id="inboxInitials">SJ</span>
                    </header>
                    <div class="associate-subpage-content" id="associateInboxContent">
                        <!-- Content rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Action Centre View (Friction Feed) -->
            <div class="view-container" id="action-centreView">
                <header class="page-header">
                    <h1 class="page-title">Action Centre</h1>
                    <p class="page-subtitle">Items requiring your attention</p>
                </header>

                <!-- Summary Cards Grid -->
                <div class="action-summary-grid" id="actionSummaryGrid">
                    <div class="action-summary-card" data-category="associates" onclick="filterActionsByCategory('associates')">
                        <div class="action-summary-pulse orange" id="associatesPulse" style="display: none;"></div>
                        <div class="action-summary-count" id="associatesCount">0</div>
                        <div class="action-summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <div class="action-summary-label">Associates</div>
                    </div>
                    <div class="action-summary-card" data-category="clients" onclick="filterActionsByCategory('clients')">
                        <div class="action-summary-pulse blue" id="clientsPulse" style="display: none;"></div>
                        <div class="action-summary-count" id="clientsActionCount">0</div>
                        <div class="action-summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <div class="action-summary-label">Clients</div>
                    </div>
                    <div class="action-summary-card" data-category="contracts" onclick="filterActionsByCategory('contracts')">
                        <div class="action-summary-pulse purple" id="contractsPulse" style="display: none;"></div>
                        <div class="action-summary-count" id="contractsCount">0</div>
                        <div class="action-summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                        </div>
                        <div class="action-summary-label">Contracts</div>
                    </div>
                    <div class="action-summary-card" data-category="finance" onclick="filterActionsByCategory('finance')">
                        <div class="action-summary-pulse green" id="financePulse" style="display: none;"></div>
                        <div class="action-summary-count" id="financeCount">0</div>
                        <div class="action-summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="action-summary-label">Finance</div>
                    </div>
                </div>

                <!-- Filter Indicator (shown when filtered) -->
                <div class="action-filter-indicator" id="actionFilterIndicator" style="display: none;">
                    <span>Showing: <strong id="activeFilterLabel">All</strong></span>
                    <button class="action-filter-clear" onclick="clearActionFilter()">Clear filter</button>
                </div>

                <div class="friction-feed" id="frictionFeed">
                    <!-- Friction items will be rendered here -->
                </div>

                <div class="all-clear-state" id="allClearState" style="display: none;">
                    <div class="all-clear-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--eden-green)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <h2 class="all-clear-title">All Clear!</h2>
                    <p class="all-clear-text">No pending actions. Everything is running smoothly.</p>
                </div>

                <!-- Resolution Drawer -->
                <div class="resolution-drawer" id="resolutionDrawer">
                    <div class="resolution-drawer-header" id="resolutionHeader">
                        <button class="resolution-back" onclick="closeResolutionDrawer()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back to Action Centre
                        </button>
                        <div class="resolution-type-badge" id="resolutionBadge">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                            <span id="resolutionBadgeText">Action Required</span>
                        </div>
                        <h3 class="resolution-title" id="resolutionTitle">Item Title</h3>
                        <p class="resolution-description" id="resolutionDescription">Item description goes here</p>
                    </div>
                    <div class="resolution-drawer-content">
                        <div class="resolution-section">
                            <div class="resolution-section-title">Details</div>
                            <div class="resolution-info-card" id="resolutionDetails">
                                <!-- Details will be populated dynamically -->
                            </div>
                        </div>

                        <div class="resolution-section">
                            <div class="resolution-section-title">Available Actions</div>
                            <div class="resolution-actions" id="resolutionActions">
                                <!-- Actions will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="resolution-drawer-footer">
                        <div class="resolution-footer-actions">
                            <button class="resolution-snooze-btn" onclick="snoozeItem()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                Snooze 7 Days
                            </button>
                            <button class="resolution-resolve-btn" onclick="markAsResolved()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Mark Resolved
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referrals View -->
            <div class="view-container" id="referralsView">
                <!-- Admin: Referral Command Centre -->
                <div class="referrals-admin-view" id="referralsAdminView">
                    <header class="page-header">
                        <h1 class="page-title">Referral Command Centre</h1>
                        <p class="page-subtitle">Manage incoming client enquiries</p>
                    </header>

                    <!-- Referral Stats Row -->
                    <div class="referral-stats-row">
                        <div class="referral-stat-card" data-status="new" onclick="filterReferrals('New')">
                            <div class="referral-stat-indicator new"></div>
                            <div class="referral-stat-value" id="refStatNew">0</div>
                            <div class="referral-stat-label">New</div>
                        </div>
                        <div class="referral-stat-card" data-status="broadcasting" onclick="filterReferrals('Broadcasting')">
                            <div class="referral-stat-indicator broadcasting"></div>
                            <div class="referral-stat-value" id="refStatBroadcasting">0</div>
                            <div class="referral-stat-label">Broadcasting</div>
                        </div>
                        <div class="referral-stat-card" data-status="pending" onclick="filterReferrals('Pending Allocation')">
                            <div class="referral-stat-indicator pending"></div>
                            <div class="referral-stat-value" id="refStatPending">0</div>
                            <div class="referral-stat-label">Pending</div>
                        </div>
                        <div class="referral-stat-card" data-status="accepted" onclick="filterReferrals('all')">
                            <div class="referral-stat-indicator accepted"></div>
                            <div class="referral-stat-value" id="refStatAccepted">0</div>
                            <div class="referral-stat-label">Accepted</div>
                        </div>
                    </div>

                    <!-- Referral List -->
                    <div class="referral-list" id="referralListAdmin">
                        <!-- Referrals will be rendered here -->
                    </div>
                </div>

                <!-- Associate: Referral Inbox -->
                <div class="referrals-associate-view" id="referralsAssociateView" style="display: none;">
                    <header class="page-header">
                        <div class="inbox-header-row">
                            <div>
                                <h1 class="page-title">Referral Inbox</h1>
                                <p class="page-subtitle">Available opportunities matching your profile</p>
                            </div>
                            <span class="available-badge" id="availableReferralsBadge">0 available</span>
                        </div>
                    </header>

                    <!-- Capacity Settings Quick View -->
                    <div class="capacity-quick-card" id="capacityQuickCard">
                        <div class="capacity-quick-row">
                            <div class="capacity-quick-item">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                <span>Accepting Referrals</span>
                                <div class="toggle-switch active" id="acceptingToggle" onclick="toggleAcceptingReferrals()">
                                    <div class="toggle-knob"></div>
                                </div>
                            </div>
                            <div class="capacity-quick-item">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                <span id="capacitySlotsText">2 slots available</span>
                            </div>
                        </div>
                    </div>

                    <!-- Available Referrals Section -->
                    <div class="referral-section">
                        <div class="section-title">Available Referrals</div>
                        <div class="referral-list" id="referralListAssociate">
                            <!-- Available referrals will be rendered here -->
                        </div>
                    </div>

                    <!-- My Expressions Section -->
                    <div class="referral-section">
                        <div class="section-title">Awaiting Allocation</div>
                        <div class="referral-list" id="myExpressionsLis">
                            <!-- My expressions will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referral and Detail Panels removed - now using full-page referralDetailView and clientDetailView -->

            <!-- Clients View -->
            <div class="view-container" id="clientsView">
                <header class="page-header">
                    <h1 class="page-title">Clients</h1>
                    <p class="page-subtitle" id="clientsSubtitle">All clients across the practice</p>
                </header>

                <!-- Summary Stats -->
                <div class="summary-stats-grid" id="clientsStats">
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="totalClientsStatCount">0</div>
                        <div class="summary-stat-label">Total Clients</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="activeClientsStatCount">0</div>
                        <div class="summary-stat-label">Active</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="awaitingClientsStatCount">0</div>
                        <div class="summary-stat-label">Awaiting</div>
                    </div>
                    <div class="summary-stat-card">
                        <div class="summary-stat-value" id="endingClientsStatCount">0</div>
                        <div class="summary-stat-label">Ending Soon</div>
                    </div>
                </div>

                <!-- Filter Pills -->
                <div class="filter-pills" id="clientsFilter">
                    <button class="filter-pill active" data-stage="all" onclick="filterAllClients('all')">All</button>
                    <button class="filter-pill" data-stage="awaiting" onclick="filterAllClients('awaiting')">Awaiting</button>
                    <button class="filter-pill" data-stage="pending" onclick="filterAllClients('pending')">Pending</button>
                    <button class="filter-pill" data-stage="active" onclick="filterAllClients('active')">Active</button>
                    <button class="filter-pill" data-stage="ending" onclick="filterAllClients('ending')">Ending</button>
                </div>

                <!-- Entity Cards Grid -->
                <div class="entity-grid" id="allClientsGrid">
                    <!-- Client cards will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Contracts View -->
            <div class="view-container" id="contractsView">
                <header class="page-header">
                    <h1 class="page-title">Contracts</h1>
                    <p class="page-subtitle">Associate agreements and documentation</p>
                </header>

                <!-- Stats Cards -->
                <div class="contracts-stats" id="contractsStats">
                    <div class="contract-stat-card">
                        <div class="contract-stat-value" id="totalContractsCount">6</div>
                        <div class="contract-stat-label">Total Contracts</div>
                    </div>
                    <div class="contract-stat-card">
                        <div class="contract-stat-value active" id="activeContractsCount">4</div>
                        <div class="contract-stat-label">Active</div>
                    </div>
                    <div class="contract-stat-card">
                        <div class="contract-stat-value pending" id="pendingContractsCount">1</div>
                        <div class="contract-stat-label">Pending Signature</div>
                    </div>
                    <div class="contract-stat-card">
                        <div class="contract-stat-value expired" id="expiredContractsCount">1</div>
                        <div class="contract-stat-label">Expiring Soon</div>
                    </div>
                </div>

                <!-- Filter Tabs -->
                <div class="contracts-filter" id="contractsFilter">
                    <button class="contracts-filter-btn active" data-filter="all" onclick="filterContracts('all')">All</button>
                    <button class="contracts-filter-btn" data-filter="active" onclick="filterContracts('active')">Active</button>
                    <button class="contracts-filter-btn" data-filter="pending" onclick="filterContracts('pending')">Pending</button>
                    <button class="contracts-filter-btn" data-filter="expired" onclick="filterContracts('expired')">Expiring</button>
                </div>

                <!-- Contracts Grid -->
                <div class="contracts-grid" id="contractsGrid">
                    <!-- Contract cards will be rendered by JavaScript -->
                </div>

                <!-- Contract Detail Panel -->
                <div class="contract-detail-panel" id="contractDetailPanel">
                    <div class="contract-detail-header">
                        <button class="contract-detail-back" onclick="closeContractDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back to Contracts
                        </button>
                        <div class="contract-detail-title-row">
                            <div class="contract-detail-associate">
                                <div class="contract-detail-avatar" id="contractDetailAvatar">SJ</div>
                                <div>
                                    <div class="contract-detail-name" id="contractDetailName">Sarah Johnson</div>
                                    <div class="contract-detail-role" id="contractDetailRole">Counsellor</div>
                                </div>
                            </div>
                            <span class="contract-status-badge active" id="contractDetailStatus">Active</span>
                        </div>
                    </div>
                    <div class="contract-detail-content">
                        <div class="contract-detail-section">
                            <div class="contract-detail-section-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                                Contract Details
                            </div>
                            <div class="contract-info-grid" id="contractInfoGrid">
                                <!-- Details will be populated dynamically -->
                            </div>
                        </div>

                        <div class="contract-detail-section">
                            <div class="contract-detail-section-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                Contract History
                            </div>
                            <div class="contract-timeline" id="contractTimeline">
                                <!-- Timeline will be populated dynamically -->
                            </div>
                        </div>

                        <div class="contract-detail-section">
                            <div class="contract-detail-section-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                                Documents
                            </div>
                            <div class="contract-documents" id="contractDocuments">
                                <!-- Documents will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                    <div class="contract-detail-footer">
                        <div class="contract-footer-actions">
                            <button class="contract-footer-btn secondary" onclick="downloadContract()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download
                            </button>
                            <button class="contract-footer-btn primary" onclick="renewContract()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                                </svg>
                                Renew Contract
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings View (Finance Gateway) -->
            <div class="view-container" id="earningsView">
                <header class="page-header">
                    <h1 class="page-title">Earnings</h1>
                    <p class="page-subtitle">Financial Vitality Hub</p>
                </header>

                <!-- True Cash Gateway Card -->
                <div class="gateway-card" id="trueCashCard">
                    <div class="gateway-header">
                        <div class="gateway-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="gateway-label">True Cash</div>
                    </div>
                    <div class="gateway-value" id="trueCashValue">0</div>
                    <div class="gateway-subtitle">Available after all obligations</div>

                    <div class="gateway-breakdown">
                        <div class="breakdown-row">
                            <span class="breakdown-label">Bank Balance</span>
                            <span class="breakdown-value" id="bankBalanceValue">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label"> Outstanding Payouts</span>
                            <span class="breakdown-value negative" id="outstandingPayoutsValue">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label"> Tax Reserve (25%)</span>
                            <span class="breakdown-value negative" id="taxReserveValue">0</span>
                        </div>
                    </div>

                    <div class="true-cash-pulse">
                        <div class="pulse-dot healthy" id="trueCashPulse"></div>
                        <span class="pulse-label" id="trueCashStatus">Healthy</span>
                        <span class="pulse-runway" id="trueCashRunway">~X months runway</span>
                    </div>
                </div>

                <!-- Wealth Hub Modules Grid -->
                <div class="wealth-hub-grid">
                    <div class="wealth-module" onclick="openWealthModule('payment-tracker')">
                        <div class="wealth-module-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                        </div>
                        <div class="wealth-module-title">Payment Tracker</div>
                        <div class="wealth-module-desc">Client payments</div>
                        <div class="wealth-module-alert" id="paymentTrackerAlert">0 awaiting</div>
                    </div>

                    <div class="wealth-module" onclick="openWealthModule('payouts')">
                        <div class="wealth-module-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <div class="wealth-module-title">Payout Pipeline</div>
                        <div class="wealth-module-desc">Associate payments</div>
                        <div class="wealth-module-alert" id="payoutPipelineAlert">0 ready</div>
                    </div>

                    <div class="wealth-module" onclick="openWealthModule('cash-density')">
                        <div class="wealth-module-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        </div>
                        <div class="wealth-module-title">Cash Density</div>
                        <div class="wealth-module-desc">3-month projection</div>
                    </div>

                    <div class="wealth-module" onclick="openWealthModule('tax-intel')">
                        <div class="wealth-module-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="wealth-module-title">Tax Intelligence</div>
                        <div class="wealth-module-desc">VAT tracking</div>
                        <div class="wealth-module-badge">Pre-VAT</div>
                    </div>

                    <div class="wealth-module" onclick="openWealthModule('simulator')">
                        <div class="wealth-module-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                <polyline points="2 17 12 22 22 17"/>
                                <polyline points="2 12 12 17 22 12"/>
                            </svg>
                        </div>
                        <div class="wealth-module-title">Wealth Lab</div>
                        <div class="wealth-module-desc">Planning simulator</div>
                    </div>
                </div>
            </div>

            <!-- Schedule View -->
            <div class="view-container" id="scheduleView">
                <header class="page-header schedule-header">
                    <div>
                        <h1 class="page-title">Schedule</h1>
                        <p class="page-subtitle">Session calendar</p>
                    </div>
                    <button class="add-session-btn" onclick="openAddSessionModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Session
                    </button>
                </header>

                <!-- Calendar Navigation -->
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>
                    <h2 class="calendar-month" id="calendarMonth">January 2026</h2>
                    <button class="calendar-nav-btn" onclick="changeMonth(1)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </button>
                </div>

                <!-- Calendar Grid -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-day-name">Mon</div>
                        <div class="calendar-day-name">Tue</div>
                        <div class="calendar-day-name">Wed</div>
                        <div class="calendar-day-name">Thu</div>
                        <div class="calendar-day-name">Fri</div>
                        <div class="calendar-day-name">Sat</div>
                        <div class="calendar-day-name">Sun</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days will be rendered by JavaScript -->
                    </div>
                </div>

                <!-- Today's Sessions -->
                <div class="today-sessions">
                    <h3 class="section-title">Today's Sessions</h3>
                    <div class="session-list" id="todaySessionsList">
                        <!-- Sessions will be rendered by JavaScript -->
                    </div>
                </div>

                <!-- Session Detail Panel (slides in from right) -->
                <div class="session-detail-panel" id="sessionDetailPanel">
                    <div class="session-detail-header">
                        <button class="session-detail-back" onclick="closeSessionDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back
                        </button>
                        <h3 class="session-detail-date" id="sessionDetailDate">Wednesday, 8 January</h3>
                    </div>
                    <div class="session-detail-content" id="sessionDetailContent">
                        <!-- Session cards will be rendered here -->
                    </div>
                </div>

                <!-- Add Session Modal -->
                <div class="modal-overlay" id="addSessionModal">
                    <div class="modal-container">
                        <div class="modal-header">
                            <h3 class="modal-title">Add New Session</h3>
                            <button class="modal-close" onclick="closeAddSessionModal()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Conflict Warning (hidden by default) -->
                            <div class="session-conflict-warning" id="sessionConflictWarning" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                    <line x1="12" y1="9" x2="12" y2="13"/>
                                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                                </svg>
                                <span id="conflictMessage">Scheduling conflict detected</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Client</label>
                                <select class="form-select" id="sessionClient" onchange="checkSessionConflict()">
                                    <option value="">Select client...</option>
                                    <option value="James Wilson">James Wilson</option>
                                    <option value="Sophie Taylor">Sophie Taylor</option>
                                    <option value="Michael Chen">Michael Chen</option>
                                    <option value="Mark & Lisa Harris">Mark & Lisa Harris</option>
                                    <option value="Rachel Green">Rachel Green</option>
                                    <option value="Emma Stone">Emma Stone</option>
                                    <option value="Robert Lee">Robert Lee</option>
                                    <option value="Julia Roberts">Julia Roberts</option>
                                    <option value="Diana Prince">Diana Prince</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Associate</label>
                                <select class="form-select" id="sessionAssociate" onchange="checkSessionConflict()">
                                    <option value="">Select associate...</option>
                                    <option value="Sarah Johnson">Sarah Johnson</option>
                                    <option value="David Okonkwo">David Okonkwo</option>
                                    <option value="Fatima Okafor">Fatima Okafor</option>
                                    <option value="Amara Mensah">Amara Mensah</option>
                                    <option value="Kwame Asante">Kwame Asante</option>
                                    <option value="Chioma Eze">Chioma Eze</option>
                                    <option value="Yemi Adebayo">Yemi Adebayo</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-input" id="sessionDate" onchange="checkSessionConflict()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Time</label>
                                    <select class="form-select" id="sessionTime" onchange="checkSessionConflict()">
                                        <option value="">Select time...</option>
                                        <option value="09:00">09:00</option>
                                        <option value="09:30">09:30</option>
                                        <option value="10:00">10:00</option>
                                        <option value="10:30">10:30</option>
                                        <option value="11:00">11:00</option>
                                        <option value="11:30">11:30</option>
                                        <option value="12:00">12:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="14:30">14:30</option>
                                        <option value="15:00">15:00</option>
                                        <option value="15:30">15:30</option>
                                        <option value="16:00">16:00</option>
                                        <option value="16:30">16:30</option>
                                        <option value="17:00">17:00</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Session Type</label>
                                <div class="session-type-options">
                                    <label class="session-type-option">
                                        <input type="radio" name="sessionType" value="Individual" checked>
                                        <span class="session-type-label">Individual</span>
                                    </label>
                                    <label class="session-type-option">
                                        <input type="radio" name="sessionType" value="Couples">
                                        <span class="session-type-label">Couples</span>
                                    </label>
                                    <label class="session-type-option">
                                        <input type="radio" name="sessionType" value="Family">
                                        <span class="session-type-label">Family</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Notes (optional)</label>
                                <textarea class="form-textarea" id="sessionNotes" rows="3" placeholder="Add any notes about this session..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn secondary" onclick="closeAddSessionModal()">Cancel</button>
                            <button class="modal-btn primary" onclick="saveNewSession()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Save Session
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CPD View -->
            <div class="view-container" id="cpdView">
                <header class="page-header">
                    <h1 class="page-title">CPD</h1>
                    <p class="page-subtitle">Continuing Professional Development</p>
                </header>

                <!-- CPD Summary -->
                <div class="cpd-summary">
                    <div class="cpd-progress-card">
                        <div class="cpd-progress-ring">
                            <svg viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--eden-border)" stroke-width="8"/>
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--eden-green)" stroke-width="8"
                                    stroke-dasharray="283" stroke-dashoffset="70" stroke-linecap="round"
                                    transform="rotate(-90 50 50)"/>
                            </svg>
                            <div class="cpd-progress-text">
                                <span class="cpd-hours">24</span>
                                <span class="cpd-total">/ 30 hrs</span>
                            </div>
                        </div>
                        <div class="cpd-progress-info">
                            <div class="cpd-progress-title">Annual CPD Progress</div>
                            <div class="cpd-progress-subtitle">6 hours remaining for 2026</div>
                        </div>
                    </div>
                </div>

                <!-- CPD Categories -->
                <div class="cpd-categories">
                    <h3 class="section-title">By Category</h3>
                    <div class="cpd-category-grid">
                        <div class="cpd-category-card">
                            <div class="cpd-category-hours">8</div>
                            <div class="cpd-category-label">Clinical Skills</div>
                        </div>
                        <div class="cpd-category-card">
                            <div class="cpd-category-hours">6</div>
                            <div class="cpd-category-label">Ethics & Law</div>
                        </div>
                        <div class="cpd-category-card">
                            <div class="cpd-category-hours">5</div>
                            <div class="cpd-category-label">Supervision</div>
                        </div>
                        <div class="cpd-category-card">
                            <div class="cpd-category-hours">5</div>
                            <div class="cpd-category-label">Self-Care</div>
                        </div>
                    </div>
                </div>

                <!-- Recent CPD Activities -->
                <div class="cpd-activities">
                    <h3 class="section-title">Recent Activities</h3>
                    <div class="cpd-activity-list" id="cpdActivityList">
                        <!-- Activities will be rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Support View -->
            <div class="view-container" id="supportView">
                <header class="page-header">
                    <h1 class="page-title">Support</h1>
                    <p class="page-subtitle">Help and resources</p>
                </header>

                <!-- Quick Links -->
                <div class="support-section">
                    <h3 class="section-title">Quick Links</h3>
                    <div class="support-links-grid">
                        <a href="#" class="support-link-card">
                            <div class="support-link-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                            </div>
                            <div class="support-link-title">Associate Handbook</div>
                            <div class="support-link-desc">Policies and procedures</div>
                        </a>

                        <a href="#" class="support-link-card">
                            <div class="support-link-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="3" y1="9" x2="21" y2="9"/>
                                    <line x1="9" y1="21" x2="9" y2="9"/>
                                </svg>
                            </div>
                            <div class="support-link-title">Booking System</div>
                            <div class="support-link-desc">Manage your schedule</div>
                        </a>

                        <a href="#" class="support-link-card">
                            <div class="support-link-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                    <polyline points="22,6 12,13 2,6"/>
                                </svg>
                            </div>
                            <div class="support-link-title">Contact Eden</div>
                            <div class="support-link-desc">Get in touch with us</div>
                        </a>

                        <a href="#" class="support-link-card">
                            <div class="support-link-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                                </svg>
                            </div>
                            <div class="support-link-title">FAQs</div>
                            <div class="support-link-desc">Common questions</div>
                        </a>
                    </div>
                </div>

                <!-- Emergency Contacts -->
                <div class="support-section">
                    <h3 class="section-title">Emergency Contacts</h3>
                    <div class="emergency-contacts">
                        <div class="emergency-contact-card">
                            <div class="emergency-contact-name">Clinical Supervisor</div>
                            <div class="emergency-contact-detail">Available 9am-5pm weekdays</div>
                            <div class="emergency-contact-phone">020 7946 0958</div>
                        </div>
                        <div class="emergency-contact-card">
                            <div class="emergency-contact-name">IT Support</div>
                            <div class="emergency-contact-detail">Technical issues</div>
                            <div class="emergency-contact-phone">support@edenrelationships.co.uk</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Unified Detail View (replaces all individual panel patterns) -->
        <div class="unified-detail-view" id="unifiedDetailView" aria-hidden="true">
            <!-- Backdrop (desktop only) -->
            <div class="unified-detail-backdrop" id="unifiedDetailBackdrop"></div>

            <!-- Detail Panel -->
            <div class="unified-detail-panel" id="unifiedDetailPanel">

                <!-- Header -->
                <header class="unified-detail-header">
                    <div class="unified-detail-header-left">
                        <!-- Steward Anchor (Admin only, when viewing associate's client) -->
                        <div class="unified-steward-anchor" id="unifiedStewardAnchor" style="display: none;">
                            <img src="" alt="" class="unified-steward-avatar" id="unifiedStewardAvatar">
                        </div>
                        <button class="unified-detail-back-btn" id="unifiedDetailBackBtn" aria-label="Go back">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m12 19-7-7 7-7"></path>
                                <path d="M19 12H5"></path>
                            </svg>
                            <span class="unified-detail-back-text" id="unifiedDetailBackText">Back</span>
                        </button>
                    </div>

                    <div class="unified-detail-header-center">
                        <h2 class="unified-detail-title" id="unifiedDetailTitle">Title</h2>
                        <span class="unified-detail-subtitle" id="unifiedDetailSubtitle"></span>
                    </div>

                    <div class="unified-detail-header-right">
                        <button class="unified-detail-menu-btn" id="unifiedDetailMenuBtn" aria-label="More options" aria-haspopup="true">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>

                        <!-- Three-dots dropdown menu -->
                        <div class="unified-detail-dropdown" id="unifiedDetailDropdown">
                            <div class="unified-detail-dropdown-header">
                                <div class="unified-detail-dropdown-label">Quick Access</div>
                                <div class="unified-detail-dropdown-name" id="unifiedDropdownName">Name</div>
                            </div>
                            <!-- Menu items populated by JavaScript -->
                        </div>
                    </div>
                </header>

                <!-- Pipeline stepper (for clients) -->
                <div class="unified-detail-pipeline" id="unifiedDetailPipeline" style="display: none;">
                    <!-- Pipeline steps populated by JavaScript -->
                </div>

                <!-- Tab Bar -->
                <nav class="unified-detail-tabs" id="unifiedDetailTabs" role="tablist">
                    <!-- Tabs populated by JavaScript based on entity type -->
                </nav>

                <!-- Tab Content -->
                <main class="unified-detail-content" id="unifiedDetailContent" role="tabpanel">
                    <!-- Content populated by JavaScript -->
                </main>

            </div>
        </div>

        <!-- Side Panel (Desktop) -->
        <aside class="side-panel" id="sidePanel">
            <!-- Standard Header (shown in overview) -->
            <header class="panel-header" id="desktopStandardHeader">
                <div class="panel-header-info">
                    <div class="panel-avatar" id="panelAvatar">SJ</div>
                    <div>
                        <div class="panel-name" id="panelName">Sarah Johnson</div>
                        <div class="panel-ucid" id="panelUcid">ASSOC-2401</div>
                    </div>
                </div>
                <button class="close-btn" onclick="closePanel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </header>

            <!-- Navigation Header (shown when in sub-views like Inbox/Capacity) -->
            <header class="panel-header navigation-header" id="desktopNavHeader" style="display: none;">
                <button class="nav-back-btn" onclick="navigatePanelBack()" aria-label="Go back">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <div class="nav-header-title" id="desktopNavTitle">Inbox</div>
                <div class="nav-header-subtitle" id="desktopNavSubtitle">Sarah J.</div>
            </header>

            <!-- Tab Navigation -->
            <nav class="tab-nav" id="desktopTabNav">
                <button class="tab-btn active" data-tab="profile">Profile</button>
                <button class="tab-btn" data-tab="sessions">Sessions</button>
                <button class="tab-btn" data-tab="contracts">Contracts</button>
                <button class="tab-btn" data-tab="finance">Finance</button>
            </nav>

            <!-- Tab Content -->
            <div class="tab-content" id="tabContent">
                <!-- Overview Tab (formerly Contact) -->
                <div class="tab-panel active" data-panel="overview" id="overviewPanel">
                    <!-- Overview Header (Collapsible Toggle) -->
                    <div class="overview-header" id="overviewHeader" onclick="toggleOverviewSection()" role="button" aria-expanded="true" aria-controls="overviewCollapsible">
                        <span class="overview-header-label">Overview</span>
                        <svg class="overview-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="18 15 12 9 6 15"/>
                        </svg>
                    </div>

                    <!-- Collapsible Content (Needs Attention + This Month) -->
                    <div class="overview-collapsible" id="overviewCollapsible">
                        <!-- Needs Attention Section (conditional - only shows if alerts exist) -->
                        <div class="info-group needs-attention-section" id="needsAttentionSection" style="display: none;">
                            <div class="section-title">Needs Attention</div>
                            <div id="needsAttentionItems">
                                <!-- Alert items rendered by JavaScript -->
                            </div>
                        </div>

                        <!-- This Month Stats -->
                        <div class="info-group">
                            <div class="section-title">This Month</div>
                            <div class="overview-stats-row">
                                <div class="overview-stat-card" onclick="navigatePanelTo('inbox')">
                                    <div class="overview-stat-value" id="overviewInbox">2</div>
                                    <div class="overview-stat-label">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <rect width="20" height="16" x="2" y="4" rx="2"/>
                                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                                        </svg>
                                        Inbox
                                    </div>
                                </div>
                                <div class="overview-stat-card" onclick="navigatePanelTo('capacity')">
                                    <div class="overview-stat-value" id="overviewCapacity">75%</div>
                                    <div class="overview-stat-label">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                                            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                                        </svg>
                                        Capacity
                                    </div>
                                </div>
                                <div class="overview-stat-card tappable-earnings" onclick="navigatePanelTo('payout-cockpit')">
                                    <div class="overview-stat-value" id="overviewEarnings">2,450</div>
                                    <div class="overview-stat-label">
                                        Earnings
                                        <svg class="stat-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m9 18 6-6-6-6"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div class="tab-panel active" data-panel="profile" id="profilePanel">
                    <!-- Profile Section -->
                    <div class="info-group">
                        <div class="section-title">Profile</div>
                        <div class="info-row tappable-row" onclick="window.location.href='mailto:' + document.getElementById('contactEmail').textContent">
                            <span class="info-label">Email</span>
                            <span class="info-value info-link" id="contactEmail">sarah.j@email.com</span>
                            <svg class="row-arrow" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--eden-green)" stroke-width="1.5">
                                <path d="m9 18 6-6-6-6"/>
                            </svg>
                        </div>
                        <div class="info-row tappable-row" onclick="window.location.href='tel:' + document.getElementById('contactPhone').textContent">
                            <span class="info-label">Phone</span>
                            <span class="info-value info-link" id="contactPhone">07700 900123</span>
                            <svg class="row-arrow" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--eden-green)" stroke-width="1.5">
                                <path d="m9 18 6-6-6-6"/>
                            </svg>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Specialisms</span>
                            <span class="info-value" id="specialisation">Couples Therapy</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Support Mode</span>
                            <span class="info-value" id="supportModeValue">Independent</span>
                        </div>
                    </div>

                    <!-- Practice Info Section -->
                    <div class="info-group">
                        <div class="section-title">Practice Info</div>
                        <div class="info-row">
                            <span class="info-label">Joined</span>
                            <span class="info-value" id="joinDate">January 2024</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Fee Split</span>
                            <span class="info-value" id="feeSplitValue">70/30</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status</span>
                            <span class="info-value">
                                <span class="status-badge-inline active" id="associateStatusBadge">Active</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Sessions Tab -->
                <div class="tab-panel" data-panel="sessions" id="sessionsPanel">
                    <div class="section-title">Upcoming Sessions</div>
                    <div class="timeline" id="upcomingSessions">
                        <div class="timeline-item">
                            <div class="timeline-dot upcoming"></div>
                            <div class="timeline-date">Tomorrow, 10:00 AM</div>
                            <div class="timeline-content">Client: James & Emma W.</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot upcoming"></div>
                            <div class="timeline-date">Thursday, 2:00 PM</div>
                            <div class="timeline-content">Client: David M.</div>
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 24px;">Recent Sessions</div>
                    <div class="timeline" id="recentSessions">
                        <div class="timeline-item">
                            <div class="timeline-dot past"></div>
                            <div class="timeline-date">Yesterday, 3:00 PM</div>
                            <div class="timeline-content">Client: Sophie T. - Completed</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-dot past"></div>
                            <div class="timeline-date">Monday, 11:00 AM</div>
                            <div class="timeline-content">Client: Mark & Lisa H. - Completed</div>
                        </div>
                    </div>
                </div>

                <!-- Contracts Tab -->
                <div class="tab-panel" data-panel="contracts" id="contractsPanel">
                    <div class="section-title">Active Agreements</div>
                    <div class="contract-card">
                        <div class="contract-header">
                            <span class="contract-title">Associate Agreement 2024</span>
                            <span class="contract-status signed">Signed</span>
                        </div>
                        <div class="contract-date">Signed 15 January 2024</div>
                    </div>
                    <div class="contract-card">
                        <div class="contract-header">
                            <span class="contract-title">Data Processing Agreement</span>
                            <span class="contract-status signed">Signed</span>
                        </div>
                        <div class="contract-date">Signed 15 January 2024</div>
                    </div>
                    <div class="contract-card">
                        <div class="contract-header">
                            <span class="contract-title">Insurance Certificate 2025</span>
                            <span class="contract-status pending">Pending</span>
                        </div>
                        <div class="contract-date">Due 31 January 2025</div>
                    </div>
                </div>

                <!-- Finance Tab -->
                <div class="tab-panel" data-panel="finance" id="financePanel">
                    <div class="finance-stat-grid">
                        <div class="finance-stat">
                            <div class="finance-stat-value" id="totalEarnings">8,420</div>
                            <div class="finance-stat-label">Total Earnings (MTD)</div>
                        </div>
                        <div class="finance-stat">
                            <div class="finance-stat-value" id="pendingPayout">1,240</div>
                            <div class="finance-stat-label">Pending Payout</div>
                        </div>
                    </div>

                    <div class="section-title">69/31 Split Breakdown</div>
                    <div class="split-bar">
                        <div class="split-associate" style="width: 69%;">69% Associate</div>
                        <div class="split-eden" style="width: 31%;">31% Eden</div>
                    </div>

                    <div class="info-group" style="margin-top: 16px;">
                        <div class="info-row">
                            <span class="info-label">Session Revenue</span>
                            <span class="info-value">12,200</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Your Share (69%)</span>
                            <span class="info-value" style="color: var(--eden-green);">8,418</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Eden Contribution (31%)</span>
                            <span class="info-value">3,782</span>
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 24px;">Outstanding Credits</div>
                    <div class="info-row">
                        <span class="info-label">Prepaid Session Credits</span>
                        <span class="info-value">4 sessions</span>
                    </div>
                </div>

                <!-- Inbox View (pushed via navigation, not a tab) -->
                <div class="panel-view" data-view="inbox" id="inboxView" style="display: none;">
                    <div class="inbox-header">
                        <div class="section-title" style="margin: 0;">Messages</div>
                        <button class="compose-btn" onclick="composeMessage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Compose
                        </button>
                    </div>
                    <div class="inbox-messages-list" id="inboxMessagesList">
                        <!-- Mock emails - rendered dynamically -->
                    </div>
                </div>

                <!-- Capacity View (pushed via navigation, not a tab) -->
                <div class="panel-view" data-view="capacity" id="capacityView" style="display: none;">
                    <!-- Capacity Gauge -->
                    <div class="capacity-gauge-card">
                        <div class="capacity-gauge-value" id="capacityGaugeValue">75%</div>
                        <div class="capacity-gauge-label">Current Capacity</div>
                        <div class="capacity-progress-bar">
                            <div class="capacity-progress-fill" id="capacityProgressFill" style="width: 75%;"></div>
                        </div>
                    </div>

                    <!-- Weekly Breakdown -->
                    <div class="capacity-info-card">
                        <div class="section-title">This Week</div>
                        <div class="capacity-stats-row">
                            <div class="capacity-stat">
                                <div class="capacity-stat-value" id="hoursBooked">30</div>
                                <div class="capacity-stat-label">Hours Booked</div>
                            </div>
                            <div class="capacity-stat">
                                <div class="capacity-stat-value" id="hoursAvailable">40</div>
                                <div class="capacity-stat-label">Hours Available</div>
                            </div>
                        </div>
                    </div>

                    <!-- Next Available Slot -->
                    <div class="capacity-next-slot">
                        <div class="capacity-next-slot-label">Next Available Slot</div>
                        <div class="capacity-next-slot-value" id="nextAvailableSlot">Tomorrow 2:00 PM</div>
                    </div>

                    <!-- TODO marker -->
                    <div class="capacity-todo-note">
                        <!-- TODO: Connect to Airtable Capacity % field -->
                    </div>
                </div>

                <!-- Email Detail View (pushed from Inbox) -->
                <div class="panel-view" data-view="email-detail" id="emailDetailView" style="display: none;">
                    <div class="email-detail-header">
                        <h3 class="email-detail-subject" id="emailDetailSubject">Session confirmation for Friday</h3>
                        <div class="email-detail-meta">
                            <span id="emailDetailFrom">From: sarah.j@email.com</span>
                            <span id="emailDetailDate">January 11, 2026 at 10:30 AM</span>
                        </div>
                    </div>
                    <div class="email-detail-body" id="emailDetailBody">
                        Hi Marcus,

Just confirming our session this Friday at 3pm.

Looking forward to it.

Best regards,
Sarah
                    </div>
                </div>

                <!-- Payout Cockpit View (pushed via Earnings stat card) -->
                <div class="panel-view" data-view="payout-cockpit" id="payoutCockpitView" style="display: none;">
                    <!-- Earnings Hero Card -->
                    <div class="earnings-hero" id="earningsHero">
                        <div class="earnings-hero-label">Your Earnings This Month</div>
                        <div class="earnings-hero-value" id="earningsHeroValue">0</div>
                        <div class="earnings-hero-subtitle" id="earningsHeroSubtitle">Your 69% share from sessions</div>
                        <div class="earnings-progress-bar">
                            <div class="earnings-progress-fill" id="earningsProgressFill" style="width: 0%;"></div>
                        </div>
                        <div class="earnings-progress-labels">
                            <span id="earningsProgressPaid">0 paid out</span>
                            <span id="earningsProgressPending">0 pending</span>
                        </div>
                    </div>

                    <!-- Earnings Breakdown Cards -->
                    <div class="earnings-breakdown" id="earningsBreakdown">
                        <div class="earnings-breakdown-card awaiting">
                            <div class="earnings-breakdown-value" id="awaitingPaymentValue">0</div>
                            <div class="earnings-breakdown-label">Awaiting Payment</div>
                            <div class="earnings-breakdown-count" id="awaitingPaymentCount">0 sessions</div>
                        </div>
                        <div class="earnings-breakdown-card ready">
                            <div class="earnings-breakdown-value" id="readyForPayoutValue">0</div>
                            <div class="earnings-breakdown-label">Ready for Payout</div>
                            <div class="earnings-breakdown-count" id="readyForPayoutCount">0 sessions</div>
                        </div>
                        <div class="earnings-breakdown-card paid">
                            <div class="earnings-breakdown-value" id="paidOutValue">0</div>
                            <div class="earnings-breakdown-label">Paid to You</div>
                            <div class="earnings-breakdown-count" id="paidOutCount">0 sessions</div>
                        </div>
                    </div>

                    <!-- Sessions List - Ready for Payout (collapsible) -->
                    <div class="collapsible-section open" id="readySessionsSection">
                        <div class="collapsible-header" onclick="toggleCollapsible('readySessionsSection')">
                            <span class="collapsible-title">Sessions Ready for Payout</span>
                            <svg class="collapsible-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </div>
                        <div class="collapsible-content" id="readySessionsList">
                            <!-- Rendered dynamically -->
                        </div>
                    </div>

                    <!-- Sessions List - Awaiting Payment (collapsible) -->
                    <div class="collapsible-section" id="awaitingSessionsSection">
                        <div class="collapsible-header" onclick="toggleCollapsible('awaitingSessionsSection')">
                            <span class="collapsible-title">Sessions Awaiting Client Payment</span>
                            <svg class="collapsible-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </div>
                        <div class="collapsible-content" id="awaitingSessionsList">
                            <!-- Rendered dynamically -->
                        </div>
                    </div>

                    <!-- Payout History -->
                    <div class="section-title" style="margin-top: 24px;">Payout History</div>
                    <div class="payout-history-list" id="payoutHistoryList">
                        <!-- Rendered dynamically by populatePayoutCockpitView() -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Message Viewer Panel -->
        <div class="message-viewer" id="messageViewer">
            <div class="message-viewer-header">
                <button class="message-viewer-back" onclick="closeMessageViewer()">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    Back to Inbox
                </button>
                <h3 class="message-viewer-subject" id="messageViewerSubject">Message Subject</h3>
                <div class="message-viewer-meta">
                    <span id="messageViewerFrom">From: Eden Practice</span>
                    <span id="messageViewerDate">2 days ago</span>
                </div>
            </div>
            <div class="message-viewer-content">
                <div class="message-viewer-body" id="messageViewerBody">
                    <!-- Message content will be populated dynamically -->
                </div>
            </div>
            <div class="message-viewer-footer">
                <div class="message-actions">
                    <button class="message-action-btn archive" onclick="archiveMessage()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="21 8 21 21 3 21 3 8"/>
                            <rect x="1" y="3" width="22" height="5"/>
                            <line x1="10" y1="12" x2="14" y2="12"/>
                        </svg>
                        Archive
                    </button>
                    <button class="message-action-btn reply" onclick="replyToMessage()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 17 4 12 9 7"/>
                            <path d="M20 18v-2a4 4 0 0 0-4-4H4"/>
                        </svg>
                        Reply
                    </button>
                </div>
            </div>
        </div>

        <!-- Bottom Sheet (Mobile) -->
        <div class="bottom-sheet-overlay" id="bottomSheetOverlay" onclick="closePanel()"></div>
        <div class="bottom-sheet" id="bottomSheet">
            <div class="bottom-sheet-handle-area" id="bottomSheetHandleArea">
                <div class="bottom-sheet-handle"></div>
            </div>

            <!-- Standard Header (shown in overview) -->
            <header class="panel-header" id="mobileStandardHeader">
                <div class="panel-header-info">
                    <div class="panel-avatar" id="mobileAvatar">SJ</div>
                    <div>
                        <div class="panel-name" id="mobilePanelName">Sarah Johnson</div>
                        <div class="panel-ucid" id="mobilePanelUcid">ASSOC-2401</div>
                    </div>
                </div>
                <button class="close-btn" onclick="closePanel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </header>

            <!-- Navigation Header (shown when in sub-views like Inbox/Capacity) -->
            <header class="panel-header navigation-header" id="mobileNavHeader" style="display: none;">
                <button class="nav-back-btn" onclick="navigatePanelBack()" aria-label="Go back">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <div class="nav-header-title" id="mobileNavTitle">Inbox</div>
                <div class="nav-header-subtitle" id="mobileNavSubtitle">Sarah J.</div>
            </header>

            <!-- Tab Navigation (Mobile) -->
            <nav class="tab-nav" id="mobileTabNav">
                <button class="tab-btn active" data-tab="profile">Profile</button>
                <button class="tab-btn" data-tab="sessions">Sessions</button>
                <button class="tab-btn" data-tab="contracts">Contracts</button>
                <button class="tab-btn" data-tab="finance">Finance</button>
            </nav>

            <!-- Tab Content (Mobile) -->
            <div class="tab-content" id="mobileTabContent">
                <!-- Content cloned from desktop -->
            </div>
        </div>

        <!-- Client panels removed - now using full-page clientDetailView -->

        <!-- Wealth Module Panel -->
        <div class="wealth-panel" id="wealthPanel">
            <header class="wealth-panel-header">
                <button class="wealth-back-btn" onclick="closeWealthModule()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    Back to Earnings
                </button>
                <h2 class="wealth-panel-title" id="wealthPanelTitle">Module</h2>
            </header>
            <div class="wealth-panel-content">
                <!-- Cash Density View -->
                <div class="wealth-view" id="cashDensityView">
                    <!-- Hero Summary -->
                    <div class="wealth-card">
                        <div class="wealth-card-header">
                            <span class="wealth-card-title">3-Month Cash Projection</span>
                        </div>
                        <div class="wealth-hero-value">24,680</div>
                        <div class="wealth-hero-label">Projected available cash by end of March</div>
                    </div>

                    <!-- Month Stats Grid -->
                    <div class="wealth-stats-grid">
                        <div class="wealth-stat-card">
                            <div class="wealth-stat-value">18,420</div>
                            <div class="wealth-stat-label">January (Current)</div>
                        </div>
                        <div class="wealth-stat-card">
                            <div class="wealth-stat-value">21,350</div>
                            <div class="wealth-stat-label">February (Projected)</div>
                        </div>
                        <div class="wealth-stat-card">
                            <div class="wealth-stat-value">24,680</div>
                            <div class="wealth-stat-label">March (Projected)</div>
                        </div>
                    </div>

                    <!-- Cash Flow Bar Chart -->
                    <div class="wealth-card">
                        <div class="wealth-card-header">
                            <span class="wealth-card-title">Cash Flow Visualization</span>
                        </div>
                        <div class="cash-chart-container">
                            <div class="cash-threshold-marker" style="bottom: 40%;">
                                <span class="threshold-text">10k Safe Threshold</span>
                            </div>
                            <div class="bar-chart" id="cashDensityChart">
                                <div class="bar-item">
                                    <div class="bar-value">18.4k</div>
                                    <div class="bar-fill" style="height: 73%;">
                                        <div class="threshold-line" style="bottom: 54%;"></div>
                                    </div>
                                    <div class="bar-label">Jan</div>
                                </div>
                                <div class="bar-item">
                                    <div class="bar-value">21.4k</div>
                                    <div class="bar-fill projected" style="height: 85%;"></div>
                                    <div class="bar-label">Feb</div>
                                </div>
                                <div class="bar-item">
                                    <div class="bar-value">24.7k</div>
                                    <div class="bar-fill projected" style="height: 98%;"></div>
                                    <div class="bar-label">Mar</div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-color" style="background-color: var(--eden-green);"></span>
                                <span class="legend-text">Actual</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color projected"></span>
                                <span class="legend-text">Projected</span>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Breakdown Cards -->
                    <div class="wealth-card">
                        <div class="wealth-card-header">
                            <span class="wealth-card-title">Monthly Breakdown</span>
                        </div>

                        <div class="month-breakdown">
                            <div class="month-breakdown-header">
                                <span class="month-name">January 2026</span>
                                <span class="month-status current">Current Month</span>
                            </div>
                            <div class="breakdown-details">
                                <div class="info-row">
                                    <span class="info-label">Opening Balance</span>
                                    <span class="info-value">32,680</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Expected Income</span>
                                    <span class="info-value positive">+8,400</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Payouts Due</span>
                                    <span class="info-value negative">2,890</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Tax Reserve</span>
                                    <span class="info-value negative">7,170</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Operating Costs</span>
                                    <span class="info-value negative">1,200</span>
                                </div>
                                <div class="info-row total">
                                    <span class="info-label">Projected Close</span>
                                    <span class="info-value">18,420</span>
                                </div>
                            </div>
                        </div>

                        <div class="month-breakdown">
                            <div class="month-breakdown-header">
                                <span class="month-name">February 2026</span>
                                <span class="month-status projected">Projected</span>
                            </div>
                            <div class="breakdown-details">
                                <div class="info-row">
                                    <span class="info-label">Opening Balance</span>
                                    <span class="info-value">18,420</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Expected Income</span>
                                    <span class="info-value positive">+9,200</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Payouts Due</span>
                                    <span class="info-value negative">3,120</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Tax Reserve</span>
                                    <span class="info-value negative">2,300</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Operating Costs</span>
                                    <span class="info-value negative">850</span>
                                </div>
                                <div class="info-row total">
                                    <span class="info-label">Projected Close</span>
                                    <span class="info-value">21,350</span>
                                </div>
                            </div>
                        </div>

                        <div class="month-breakdown">
                            <div class="month-breakdown-header">
                                <span class="month-name">March 2026</span>
                                <span class="month-status projected">Projected</span>
                            </div>
                            <div class="breakdown-details">
                                <div class="info-row">
                                    <span class="info-label">Opening Balance</span>
                                    <span class="info-value">21,350</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Expected Income</span>
                                    <span class="info-value positive">+9,800</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Payouts Due</span>
                                    <span class="info-value negative">3,450</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Tax Reserve</span>
                                    <span class="info-value negative">2,450</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Operating Costs</span>
                                    <span class="info-value negative">570</span>
                                </div>
                                <div class="info-row total">
                                    <span class="info-label">Projected Close</span>
                                    <span class="info-value">24,680</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tax Intelligence View -->
                <div class="wealth-view" id="taxIntelView">
                    <!-- VAT Mode Toggle (Pre-VAT default) -->
                    <div class="wealth-card">
                        <div class="tax-mode-toggle">
                            <span class="toggle-label active" id="preVatLabel">Pre-VAT</span>
                            <div class="toggle-switch" id="vatToggle" onclick="toggleVatMode()"></div>
                            <span class="toggle-label" id="postVatLabel">Post-VAT</span>
                        </div>
                        <p class="tax-mode-description" id="taxModeDescription">
                            Showing tax obligations before VAT registration threshold
                        </p>
                    </div>

                    <!-- Pre-VAT Content -->
                    <div id="preVatContent">
                        <!-- Tax Reserve Hero Card -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Tax Reserve</span>
                                <span class="health-badge healthy" id="reserveHealthBadge">On Track</span>
                            </div>
                            <div class="wealth-hero-value">7,170</div>
                            <div class="wealth-hero-label">Set aside for income tax</div>

                            <div class="tax-reserve-meter">
                                <div class="reserve-progress">
                                    <div class="reserve-fill" style="width: 85%;"></div>
                                    <div class="reserve-target" style="left: 100%;"></div>
                                </div>
                                <div class="reserve-labels">
                                    <span>0</span>
                                    <span class="reserve-target-label">Target: 8,440</span>
                                </div>
                            </div>
                        </div>

                        <!-- Income Summary -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Income This Tax Year</span>
                            </div>

                            <div class="tax-income-summary">
                                <div class="income-hero">
                                    <div class="income-value">33,760</div>
                                    <div class="income-label">Total taxable income (Apr 2025 - present)</div>
                                </div>
                            </div>

                            <div class="income-breakdown">
                                <div class="section-title" style="margin-top: 20px;">Income Sources</div>
                                <div class="info-row">
                                    <span class="info-label">Session Fees</span>
                                    <span class="info-value">31,200</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Room Rentals</span>
                                    <span class="info-value">1,800</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Training Income</span>
                                    <span class="info-value">760</span>
                                </div>
                                <div class="info-row total">
                                    <span class="info-label">Total Income</span>
                                    <span class="info-value">33,760</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tax Liability Estimate -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Estimated Tax Liability</span>
                            </div>

                            <div class="tax-calculation">
                                <div class="tax-row">
                                    <span class="tax-label">Gross Income</span>
                                    <span class="tax-value">33,760</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">Personal Allowance</span>
                                    <span class="tax-value deduction">12,570</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">Taxable Income</span>
                                    <span class="tax-value">21,190</span>
                                </div>
                                <div class="tax-divider"></div>
                                <div class="tax-row">
                                    <span class="tax-label">Basic Rate (20%)</span>
                                    <span class="tax-value">4,238</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">Class 2 NI</span>
                                    <span class="tax-value">179</span>
                                </div>
                                <div class="tax-row">
                                    <span class="tax-label">Class 4 NI (9%)</span>
                                    <span class="tax-value">1,907</span>
                                </div>
                                <div class="tax-divider"></div>
                                <div class="tax-row total">
                                    <span class="tax-label">Total Estimated Tax</span>
                                    <span class="tax-value">6,324</span>
                                </div>
                            </div>

                            <div class="tax-note">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                </svg>
                                <span>Estimate based on current income. Final liability may vary.</span>
                            </div>
                        </div>

                        <!-- Reserve Health Card -->
                        <div class="wealth-card health-card healthy">
                            <div class="health-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                            <div class="health-content">
                                <div class="health-title">Reserve Health: Good</div>
                                <div class="health-text">
                                    Your tax reserve of 7,170 covers 113% of your estimated liability (6,324).
                                    You have a buffer of 846.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Post-VAT Content (Hidden by default) -->
                    <div id="postVatContent" style="display: none;">
                        <!-- Combined Tax Overview -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Combined Tax Overview</span>
                            </div>
                            <div class="combined-tax-hero">
                                <div class="tax-hero-item">
                                    <div class="tax-hero-value">6,324</div>
                                    <div class="tax-hero-label">Income Tax + NI</div>
                                </div>
                                <div class="tax-hero-plus">+</div>
                                <div class="tax-hero-item">
                                    <div class="tax-hero-value">4,752</div>
                                    <div class="tax-hero-label">VAT Owed</div>
                                </div>
                                <div class="tax-hero-equals">=</div>
                                <div class="tax-hero-item total">
                                    <div class="tax-hero-value">11,076</div>
                                    <div class="tax-hero-label">Total Tax Liability</div>
                                </div>
                            </div>
                        </div>

                        <!-- VAT Summary Card -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">VAT Summary</span>
                                <span class="vat-rate-badge">20% Standard Rate</span>
                            </div>

                            <div class="vat-summary-grid">
                                <div class="vat-stat collected">
                                    <div class="vat-stat-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                            <polyline points="17 6 23 6 23 12"/>
                                        </svg>
                                    </div>
                                    <div class="vat-stat-value">6,752</div>
                                    <div class="vat-stat-label">VAT Collected</div>
                                </div>
                                <div class="vat-stat reclaimable">
                                    <div class="vat-stat-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
                                            <polyline points="17 18 23 18 23 12"/>
                                        </svg>
                                    </div>
                                    <div class="vat-stat-value">2,000</div>
                                    <div class="vat-stat-label">VAT Reclaimable</div>
                                </div>
                                <div class="vat-stat owed">
                                    <div class="vat-stat-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="12" y1="1" x2="12" y2="23"/>
                                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                        </svg>
                                    </div>
                                    <div class="vat-stat-value">4,752</div>
                                    <div class="vat-stat-label">VAT to Pay</div>
                                </div>
                            </div>

                            <div class="vat-breakdown">
                                <div class="section-title" style="margin-top: 20px;">VAT Breakdown</div>
                                <div class="info-row">
                                    <span class="info-label">Output VAT (on sales)</span>
                                    <span class="info-value">6,752</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Input VAT (on purchases)</span>
                                    <span class="info-value negative">2,000</span>
                                </div>
                                <div class="info-row total">
                                    <span class="info-label">Net VAT Payable</span>
                                    <span class="info-value">4,752</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quarterly Payment Schedule -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Quarterly Payment Schedule</span>
                            </div>

                            <div class="quarterly-schedule">
                                <div class="quarter-item completed">
                                    <div class="quarter-marker">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"/>
                                        </svg>
                                    </div>
                                    <div class="quarter-details">
                                        <div class="quarter-period">Q1: Apr - Jun 2025</div>
                                        <div class="quarter-due">Due: 7 Aug 2025</div>
                                    </div>
                                    <div class="quarter-amount">1,420</div>
                                    <div class="quarter-status paid">Paid</div>
                                </div>

                                <div class="quarter-item completed">
                                    <div class="quarter-marker">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"/>
                                        </svg>
                                    </div>
                                    <div class="quarter-details">
                                        <div class="quarter-period">Q2: Jul - Sep 2025</div>
                                        <div class="quarter-due">Due: 7 Nov 2025</div>
                                    </div>
                                    <div class="quarter-amount">1,580</div>
                                    <div class="quarter-status paid">Paid</div>
                                </div>

                                <div class="quarter-item current">
                                    <div class="quarter-marker">
                                        <div class="quarter-dot"></div>
                                    </div>
                                    <div class="quarter-details">
                                        <div class="quarter-period">Q3: Oct - Dec 2025</div>
                                        <div class="quarter-due">Due: 7 Feb 2026</div>
                                    </div>
                                    <div class="quarter-amount">1,752</div>
                                    <div class="quarter-status upcoming">Due in 30 days</div>
                                </div>

                                <div class="quarter-item future">
                                    <div class="quarter-marker">
                                        <div class="quarter-dot"></div>
                                    </div>
                                    <div class="quarter-details">
                                        <div class="quarter-period">Q4: Jan - Mar 2026</div>
                                        <div class="quarter-due">Due: 7 May 2026</div>
                                    </div>
                                    <div class="quarter-amount">Est. 1,800</div>
                                    <div class="quarter-status future">Future</div>
                                </div>
                            </div>
                        </div>

                        <!-- VAT Registration Info -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">VAT Registration Status</span>
                            </div>

                            <div class="vat-reg-info">
                                <div class="info-row">
                                    <span class="info-label">VAT Number</span>
                                    <span class="info-value">GB 123 4567 89</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Registration Date</span>
                                    <span class="info-value">1 April 2025</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">VAT Scheme</span>
                                    <span class="info-value">Standard Accounting</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Filing Frequency</span>
                                    <span class="info-value">Quarterly</span>
                                </div>
                            </div>

                            <div class="tax-note" style="margin-top: 16px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                </svg>
                                <span>VAT threshold is 90,000. Your current turnover: 40,512</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Tracker View -->
                <div class="wealth-view" id="paymentTrackerView">
                    <!-- Unmatched Payments Alert (shown conditionally) -->
                    <div class="unmatched-alert" id="unmatchedAlert" style="display: none;">
                        <div class="unmatched-alert-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                        </div>
                        <div class="unmatched-alert-content">
                            <div class="unmatched-alert-title" id="unmatchedAlertTitle">1 Unmatched Payment Needs Review</div>
                            <div class="unmatched-alert-desc" id="unmatchedAlertDesc">A Stripe payment couldn't be matched to a session</div>
                        </div>
                        <button class="unmatched-alert-action" onclick="showUnmatchedPayments()">Review</button>
                    </div>

                    <!-- Payment Overview Cards -->
                    <div class="payment-overview-grid" id="paymentOverviewGrid">
                        <div class="payment-overview-card awaiting">
                            <div class="payment-overview-value" id="awaitingPaymentOverviewValue">0</div>
                            <div class="payment-overview-label">Awaiting Payment</div>
                            <div class="payment-overview-count" id="awaitingPaymentOverviewCount">0 sessions</div>
                        </div>
                        <div class="payment-overview-card paid">
                            <div class="payment-overview-value" id="paidOverviewValue">0</div>
                            <div class="payment-overview-label">Paid This Month</div>
                            <div class="payment-overview-count" id="paidOverviewCount">0 sessions</div>
                        </div>
                        <div class="payment-overview-card overdue">
                            <div class="payment-overview-value" id="overdueOverviewValue">0</div>
                            <div class="payment-overview-label">Overdue (7+ days)</div>
                            <div class="payment-overview-count" id="overdueOverviewCount">0 sessions</div>
                        </div>
                    </div>

                    <!-- Session Payment Table -->
                    <div class="payment-table-container">
                        <div class="payment-table-header">
                            <div class="payment-table-title">Session Payments</div>
                            <div class="payment-table-filters">
                                <button class="payment-filter-btn active" data-filter="all" onclick="filterPaymentTable('all')">All</button>
                                <button class="payment-filter-btn" data-filter="awaiting" onclick="filterPaymentTable('awaiting')">Awaiting</button>
                                <button class="payment-filter-btn" data-filter="paid" onclick="filterPaymentTable('paid')">Paid</button>
                                <button class="payment-filter-btn" data-filter="overdue" onclick="filterPaymentTable('overdue')">Overdue</button>
                            </div>
                        </div>
                        <table class="payment-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Client</th>
                                    <th>Associate</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="paymentTableBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payout Pipeline View -->
                <div class="wealth-view" id="payoutsView">
                    <!-- Payout Overview Content -->
                    <div id="payoutOverviewContent">
                        <!-- Pipeline Summary Hero -->
                        <div class="wealth-card payout-hero">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Ready for Payout</span>
                                <span class="payout-count-badge" id="pipelineReadyCount">0 associates</span>
                            </div>
                            <div class="wealth-hero-value" id="pipelineTotalAmount">0</div>
                            <div class="wealth-hero-label">Total owed to associates</div>

                            <div class="payout-summary-row">
                                <div class="payout-summary-item">
                                    <span class="payout-summary-value" id="pipelineSessionCount">0</span>
                                    <span class="payout-summary-label">Sessions ready</span>
                                </div>
                                <div class="payout-summary-item">
                                    <span class="payout-summary-value" id="pipelineEdenShare">0</span>
                                    <span class="payout-summary-label">Eden share (31%)</span>
                                </div>
                                <div class="payout-summary-item">
                                    <span class="payout-summary-value" id="pipelinePaidThisMonth">0</span>
                                    <span class="payout-summary-label">Paid this month</span>
                                </div>
                            </div>
                        </div>

                        <!-- Payout Pipeline Grid -->
                        <div class="section-title" style="margin-top: 24px;">Associates Ready for Payout</div>
                        <div class="payout-pipeline-grid" id="payoutPipelineGrid">
                            <!-- Populated by JavaScript -->
                        </div>

                        <!-- Recent Payouts Section -->
                        <div class="section-title" style="margin-top: 32px;">Recent Payouts</div>
                        <div id="recentPayoutsList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Payout Detail Content (Hidden by default) -->
                    <div id="payoutDetailContent" style="display: none;">
                        <!-- Back Button -->
                        <button class="payout-back-btn" onclick="closePayoutDetail()">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                            Back to Pipeline
                        </button>

                        <!-- Associate Header -->
                        <div class="payout-detail-header" id="payoutDetailHeader">
                            <div class="payout-detail-avatar" id="detailAvatar">SJ</div>
                            <div class="payout-detail-info">
                                <h3 class="payout-detail-name tappable" id="detailName" onclick="navigateToAssociateFromPayoutDetail()">Sarah Johnson</h3>
                                <span class="payout-detail-id" id="detailId">ASSOC-2401</span>
                            </div>
                            <span class="payout-status pending" id="detailStatus">Ready</span>
                        </div>

                        <!-- Payout Amount Card -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Payout Summary</span>
                                <span class="payout-period" id="detailPeriod">January 2026</span>
                            </div>
                            <div class="wealth-hero-value" id="detailAmount">0</div>
                            <div class="wealth-hero-label">Associate's 69% share</div>

                            <div class="payout-breakdown" id="detailBreakdown">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Sessions List -->
                        <div class="wealth-card">
                            <div class="wealth-card-header">
                                <span class="wealth-card-title">Sessions Included</span>
                            </div>
                            <div id="detailSessionsList">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="payout-actions">
                            <button class="payout-action-btn primary" id="createPayoutBtn" onclick="createPayoutBatch()">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Create Payout Batch
                            </button>
                            <button class="payout-action-btn secondary" onclick="closePayoutDetail()">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Wealth Lab View -->
                <div class="wealth-view" id="simulatorView">
                    <!-- Simulator Header -->
                    <div class="wealth-card simulator-intro">
                        <div class="simulator-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                <polyline points="2 17 12 22 22 17"/>
                                <polyline points="2 12 12 17 22 12"/>
                            </svg>
                        </div>
                        <div class="simulator-intro-text">
                            <h3>Financial Scenario Planner</h3>
                            <p>Adjust the inputs below to see how changes affect your projected earnings</p>
                        </div>
                    </div>

                    <div class="simulator-layout">
                        <!-- Input Panel -->
                        <div class="simulator-inputs">
                            <div class="wealth-card">
                                <div class="wealth-card-header">
                                    <span class="wealth-card-title">Revenue Assumptions</span>
                                </div>

                                <div class="simulator-input-group">
                                    <label class="simulator-label">
                                        <span>Sessions per Week</span>
                                        <span class="simulator-value" id="sessionsValue">25</span>
                                    </label>
                                    <input type="range" class="simulator-slider" id="sessionsSlider"
                                           min="10" max="50" value="25" oninput="updateSimulator()">
                                    <div class="slider-labels">
                                        <span>10</span>
                                        <span>50</span>
                                    </div>
                                </div>

                                <div class="simulator-input-group">
                                    <label class="simulator-label">
                                        <span>Average Session Rate</span>
                                        <span class="simulator-value" id="rateValue">75</span>
                                    </label>
                                    <input type="range" class="simulator-slider" id="rateSlider"
                                           min="50" max="150" value="75" step="5" oninput="updateSimulator()">
                                    <div class="slider-labels">
                                        <span>50</span>
                                        <span>150</span>
                                    </div>
                                </div>

                                <div class="simulator-input-group">
                                    <label class="simulator-label">
                                        <span>Practice Split (%)</span>
                                        <span class="simulator-value" id="splitValue">40%</span>
                                    </label>
                                    <input type="range" class="simulator-slider" id="splitSlider"
                                           min="20" max="60" value="40" step="5" oninput="updateSimulator()">
                                    <div class="slider-labels">
                                        <span>20%</span>
                                        <span>60%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="wealth-card">
                                <div class="wealth-card-header">
                                    <span class="wealth-card-title">Expense Adjustments</span>
                                </div>

                                <div class="simulator-input-group">
                                    <label class="simulator-label">
                                        <span>Monthly Overheads</span>
                                        <span class="simulator-value" id="overheadsValue">800</span>
                                    </label>
                                    <input type="range" class="simulator-slider" id="overheadsSlider"
                                           min="200" max="2000" value="800" step="100" oninput="updateSimulator()">
                                    <div class="slider-labels">
                                        <span>200</span>
                                        <span>2,000</span>
                                    </div>
                                </div>

                                <div class="simulator-input-group">
                                    <label class="simulator-label">
                                        <span>Tax Reserve Rate</span>
                                        <span class="simulator-value" id="taxRateValue">25%</span>
                                    </label>
                                    <input type="range" class="simulator-slider" id="taxRateSlider"
                                           min="15" max="40" value="25" oninput="updateSimulator()">
                                    <div class="slider-labels">
                                        <span>15%</span>
                                        <span>40%</span>
                                    </div>
                                </div>
                            </div>

                            <button class="simulator-reset-btn" onclick="resetSimulator()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="1 4 1 10 7 10"/>
                                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                </svg>
                                Reset to Defaults
                            </button>
                        </div>

                        <!-- Results Panel -->
                        <div class="simulator-results">
                            <div class="wealth-card results-hero">
                                <div class="wealth-card-header">
                                    <span class="wealth-card-title">Projected Monthly Income</span>
                                </div>
                                <div class="results-hero-value" id="projectedIncome">4,500</div>
                                <div class="results-hero-label">After tax reserve & expenses</div>
                            </div>

                            <div class="results-breakdown">
                                <div class="wealth-card">
                                    <div class="wealth-card-header">
                                        <span class="wealth-card-title">Monthly Breakdown</span>
                                    </div>
                                    <div class="results-row">
                                        <span class="results-label">Gross Revenue</span>
                                        <span class="results-value" id="grossRevenue">8,125</span>
                                    </div>
                                    <div class="results-row">
                                        <span class="results-label">Practice Share (40%)</span>
                                        <span class="results-value negative" id="practiceShare">3,250</span>
                                    </div>
                                    <div class="results-row">
                                        <span class="results-label">Net to Practice</span>
                                        <span class="results-value" id="netToPractice">4,875</span>
                                    </div>
                                    <div class="results-divider"></div>
                                    <div class="results-row">
                                        <span class="results-label">Overheads</span>
                                        <span class="results-value negative" id="overheadsResult">800</span>
                                    </div>
                                    <div class="results-row">
                                        <span class="results-label">Tax Reserve (25%)</span>
                                        <span class="results-value negative" id="taxReserveResult">1,019</span>
                                    </div>
                                    <div class="results-divider"></div>
                                    <div class="results-row total">
                                        <span class="results-label">True Cash</span>
                                        <span class="results-value" id="trueCashResult">3,056</span>
                                    </div>
                                </div>
                            </div>

                            <div class="projection-cards">
                                <div class="wealth-card projection-card">
                                    <div class="projection-period">3 Months</div>
                                    <div class="projection-value" id="projection3m">9,168</div>
                                </div>
                                <div class="wealth-card projection-card">
                                    <div class="projection-period">6 Months</div>
                                    <div class="projection-value" id="projection6m">18,336</div>
                                </div>
                                <div class="wealth-card projection-card">
                                    <div class="projection-period">12 Months</div>
                                    <div class="projection-value" id="projection12m">36,672</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ============================================
        // MOCK DATA
        // ============================================

        const associates = [
            {
                id: 'ASSOC-2401',
                name: 'Sarah Johnson',
                initials: 'SJ',
                supportMode: 'independent',
                clients: 12,
                maxCapacity: 15,
                email: 'sarah.j@email.com',
                phone: '07700 900123',
                address: 'London, SE1',
                emergencyName: 'Michael Johnson',
                emergencyRelation: 'Partner',
                emergencyPhone: '07700 900456',
                joinDate: 'January 2024',
                specialisation: 'Couples Therapy',
                totalEarnings: '8,420',
                pendingPayout: '1,240'
            },
            {
                id: 'ASSOC-2402',
                name: 'David Okonkwo',
                initials: 'DO',
                supportMode: 'independent',
                clients: 14,
                maxCapacity: 16,
                email: 'david.o@email.com',
                phone: '07700 900234',
                address: 'London, E2',
                emergencyName: 'Grace Okonkwo',
                emergencyRelation: 'Spouse',
                emergencyPhone: '07700 900567',
                joinDate: 'February 2024',
                specialisation: 'Individual Therapy',
                totalEarnings: '9,180',
                pendingPayout: '980'
            },
            {
                id: 'ASSOC-2403',
                name: 'Amara Williams',
                initials: 'AW',
                supportMode: 'supported',
                clients: 8,
                maxCapacity: 12,
                email: 'amara.w@email.com',
                phone: '07700 900345',
                address: 'London, N1',
                emergencyName: 'James Williams',
                emergencyRelation: 'Brother',
                emergencyPhone: '07700 900678',
                joinDate: 'March 2024',
                specialisation: 'Family Therapy',
                totalEarnings: '5,640',
                pendingPayout: '720'
            },
            {
                id: 'ASSOC-2404',
                name: 'Marcus Thompson',
                initials: 'MT',
                supportMode: 'independent',
                clients: 10,
                maxCapacity: 12,
                email: 'marcus.t@email.com',
                phone: '07700 900456',
                address: 'London, SW4',
                emergencyName: 'Linda Thompson',
                emergencyRelation: 'Mother',
                emergencyPhone: '07700 900789',
                joinDate: 'January 2024',
                specialisation: 'Trauma Therapy',
                totalEarnings: '7,320',
                pendingPayout: '1,560'
            },
            {
                id: 'ASSOC-2501',
                name: 'Fatima Ahmed',
                initials: 'FA',
                supportMode: 'supported',
                clients: 6,
                maxCapacity: 10,
                email: 'fatima.a@email.com',
                phone: '07700 900567',
                address: 'London, W12',
                emergencyName: 'Hassan Ahmed',
                emergencyRelation: 'Spouse',
                emergencyPhone: '07700 900890',
                joinDate: 'January 2025',
                specialisation: 'Anxiety & Depression',
                totalEarnings: '3,480',
                pendingPayout: '480'
            },
            {
                id: 'ASSOC-2405',
                name: 'Kofi Mensah',
                initials: 'KM',
                supportMode: 'independent',
                clients: 11,
                maxCapacity: 14,
                email: 'kofi.m@email.com',
                phone: '07700 900678',
                address: 'London, SE15',
                emergencyName: 'Ama Mensah',
                emergencyRelation: 'Sister',
                emergencyPhone: '07700 900901',
                joinDate: 'April 2024',
                specialisation: 'Relationship Issues',
                totalEarnings: '7,890',
                pendingPayout: '1,100'
            },
            {
                id: 'ASSOC-2406',
                name: 'Zara Patel',
                initials: 'ZP',
                supportMode: 'independent',
                clients: 13,
                maxCapacity: 15,
                email: 'zara.p@email.com',
                phone: '07700 900789',
                address: 'London, NW3',
                emergencyName: 'Raj Patel',
                emergencyRelation: 'Father',
                emergencyPhone: '07700 901012',
                joinDate: 'May 2024',
                specialisation: 'Couples Therapy',
                totalEarnings: '8,950',
                pendingPayout: '1,320'
            }
        ];

        // Mock client data (assigned to associates)
        const clients = [
            // Sarah Johnson's clients (ASSOC-2401)
            { id: 'CLIENT-2501', name: 'James & Emma Wilson', initials: 'JW', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2502', name: 'David Miller', initials: 'DM', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2503', name: 'Sophie Taylor', initials: 'ST', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2504', name: 'Mark & Lisa Harris', initials: 'MH', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2505', name: 'Rachel Green', initials: 'RG', stage: 'pending', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2506', name: 'Tom Bennett', initials: 'TB', stage: 'awaiting', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2507', name: 'Nina Patel', initials: 'NP', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2508', name: 'Chris & Amy Brown', initials: 'CB', stage: 'ending', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2509', name: 'Laura Martinez', initials: 'LM', stage: 'active', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2510', name: 'Daniel Kim', initials: 'DK', stage: 'pending', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2511', name: 'Fiona Wright', initials: 'FW', stage: 'pending', associateId: 'ASSOC-2401' },
            { id: 'CLIENT-2512', name: 'Gary & Helen Price', initials: 'GP', stage: 'awaiting', associateId: 'ASSOC-2401' },
            // David Okonkwo's clients (ASSOC-2402)
            { id: 'CLIENT-2513', name: 'Michael Chen', initials: 'MC', stage: 'active', associateId: 'ASSOC-2402' },
            { id: 'CLIENT-2514', name: 'Sarah Adams', initials: 'SA', stage: 'active', associateId: 'ASSOC-2402' },
            { id: 'CLIENT-2515', name: 'Kevin & Jane Moore', initials: 'KM', stage: 'pending', associateId: 'ASSOC-2402' },
            // Add more for other associates as needed...
            { id: 'CLIENT-2516', name: 'Emma Stone', initials: 'ES', stage: 'active', associateId: 'ASSOC-2403' },
            { id: 'CLIENT-2517', name: 'Robert Lee', initials: 'RL', stage: 'awaiting', associateId: 'ASSOC-2403' },
            { id: 'CLIENT-2518', name: 'Julia Roberts', initials: 'JR', stage: 'active', associateId: 'ASSOC-2404' },
            { id: 'CLIENT-2519', name: 'Peter Parker', initials: 'PP', stage: 'pending', associateId: 'ASSOC-2405' },
            { id: 'CLIENT-2520', name: 'Diana Prince', initials: 'DP', stage: 'active', associateId: 'ASSOC-2406' },
        ];

        // Specialisations list for matching
        const SPECIALISATIONS = [
            'Anxiety & Stress', 'Depression', 'Trauma & PTSD', 'Grief & Loss',
            'Relationships & Intimacy', 'Couples & Marriage', 'Pre-Marital Preparation',
            'Family Dynamics', 'Workplace & Career', 'Burnout & Work Stress',
            'Leadership & Executive Performance', 'Identity & Self-Worth',
            'Cultural & Minority Identity', 'Men\'s Issues', 'Women\'s Issues',
            'Impostor Syndrome', 'Neurodiversity', 'Eating Disorders',
            'Addictions', 'Loneliness & Isolation', 'Life Transitions',
            'Parenting', 'Chronic Illness & Health', 'Faith & Spirituality'
        ];

        // Mock referrals data
        const referrals = [
            {
                id: 'REF-25003',
                clientPseudonym: null,
                contactEmail: 'emma.r@email.com',
                contactPhone: '07700 900111',
                enquiryText: "I've been struggling with anxiety since starting a new role. Looking for someone who understands work pressure and can help me develop coping strategies.",
                preferredTimes: ['Weekdays', 'Evenings'],
                presentingIssue: null,
                urgency: null,
                specialisationsNeeded: [],
                status: 'New',
                createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                broadcastDate: null,
                broadcastExpiresAt: null,
                allocatedTo: null,
                allocatedDate: null,
                adminNotes: ''
            },
            {
                id: 'REF-25002',
                clientPseudonym: 'Sarah M',
                contactEmail: 'sarah.m@email.com',
                contactPhone: '07700 900222',
                enquiryText: "My partner and I have been having communication issues. We want to work on our relationship before things get worse.",
                preferredTimes: ['Evenings', 'Weekends'],
                presentingIssue: 'Couples & Marriage',
                urgency: 'Standard',
                specialisationsNeeded: ['Couples & Marriage', 'Relationships & Intimacy'],
                status: 'Broadcasting',
                createdAt: new Date(Date.now() - 26 * 60 * 60 * 1000),
                broadcastDate: new Date(Date.now() - 2 * 60 * 60 * 1000),
                broadcastExpiresAt: new Date(Date.now() + 22 * 60 * 60 * 1000),
                allocatedTo: null,
                allocatedDate: null,
                adminNotes: 'Couple in early 30s, together 5 years'
            },
            {
                id: 'REF-25001',
                clientPseudonym: 'James K',
                contactEmail: 'james.k@email.com',
                contactPhone: '07700 900333',
                enquiryText: "I've been feeling really low since losing my mother last year. Finding it hard to function at work.",
                preferredTimes: ['Weekdays'],
                presentingIssue: 'Grief & Loss',
                urgency: 'Priority',
                specialisationsNeeded: ['Grief & Loss', 'Depression'],
                status: 'Pending Allocation',
                createdAt: new Date(Date.now() - 48 * 60 * 60 * 1000),
                broadcastDate: new Date(Date.now() - 24 * 60 * 60 * 1000),
                broadcastExpiresAt: new Date(Date.now() - 1 * 60 * 60 * 1000),
                allocatedTo: null,
                allocatedDate: null,
                adminNotes: 'Male client, recently bereaved'
            },
            {
                id: 'REF-25000',
                clientPseudonym: 'Lisa T',
                contactEmail: 'lisa.t@email.com',
                contactPhone: '07700 900444',
                enquiryText: "I've been promoted to a senior role and feel like a fraud. Constant self-doubt affecting my performance.",
                preferredTimes: ['Evenings'],
                presentingIssue: 'Impostor Syndrome',
                urgency: 'Standard',
                specialisationsNeeded: ['Impostor Syndrome', 'Workplace & Career'],
                status: 'Accepted',
                createdAt: new Date(Date.now() - 72 * 60 * 60 * 1000),
                broadcastDate: new Date(Date.now() - 50 * 60 * 60 * 1000),
                broadcastExpiresAt: new Date(Date.now() - 26 * 60 * 60 * 1000),
                allocatedTo: 'ASSOC-2401',
                allocatedDate: new Date(Date.now() - 24 * 60 * 60 * 1000),
                adminNotes: 'Allocated to Sarah'
            }
        ];

        // Mock referral expressions (interest from associates)
        const referralExpressions = [
            // Expressions for REF-25002 (Broadcasting)
            { id: 'EXP-001', referralId: 'REF-25002', associateId: 'ASSOC-2401', status: 'Interested', note: 'Good fit for my couples work.', expressedAt: new Date(Date.now() - 1 * 60 * 60 * 1000) },
            { id: 'EXP-002', referralId: 'REF-25002', associateId: 'ASSOC-2406', status: 'Pending', note: '', expressedAt: null },
            { id: 'EXP-003', referralId: 'REF-25002', associateId: 'ASSOC-2402', status: 'Pending', note: '', expressedAt: null },
            // Expressions for REF-25001 (Pending Allocation)
            { id: 'EXP-004', referralId: 'REF-25001', associateId: 'ASSOC-2403', status: 'Interested', note: 'I have experience with grief work.', expressedAt: new Date(Date.now() - 20 * 60 * 60 * 1000) },
            { id: 'EXP-005', referralId: 'REF-25001', associateId: 'ASSOC-2404', status: 'Interested', note: 'Good fit for psychodynamic work.', expressedAt: new Date(Date.now() - 18 * 60 * 60 * 1000) },
            { id: 'EXP-006', referralId: 'REF-25001', associateId: 'ASSOC-2402', status: 'Declined', note: 'At capacity this month.', expressedAt: new Date(Date.now() - 22 * 60 * 60 * 1000) },
            // Expressions for REF-25000 (Accepted)
            { id: 'EXP-007', referralId: 'REF-25000', associateId: 'ASSOC-2401', status: 'Allocated', note: 'Perfect match for executive coaching.', expressedAt: new Date(Date.now() - 30 * 60 * 60 * 1000) },
            { id: 'EXP-008', referralId: 'REF-25000', associateId: 'ASSOC-2405', status: 'Not Selected', note: 'Interested in this case.', expressedAt: new Date(Date.now() - 28 * 60 * 60 * 1000) }
        ];

        // Associate capacity and availability settings (extends associates data)
        const associateReferralSettings = {
            'ASSOC-2401': { acceptingReferrals: true, capacitySlots: 2, availableTimes: ['Weekdays', 'Evenings'], specialisations: ['Couples & Marriage', 'Impostor Syndrome', 'Workplace & Career'] },
            'ASSOC-2402': { acceptingReferrals: true, capacitySlots: 1, availableTimes: ['Weekdays', 'Evenings'], specialisations: ['Anxiety & Stress', 'Depression', 'Trauma & PTSD'] },
            'ASSOC-2403': { acceptingReferrals: true, capacitySlots: 3, availableTimes: ['Weekdays'], specialisations: ['Grief & Loss', 'Family Dynamics', 'Life Transitions'] },
            'ASSOC-2404': { acceptingReferrals: true, capacitySlots: 2, availableTimes: ['Weekdays', 'Weekends'], specialisations: ['Trauma & PTSD', 'Depression', 'Grief & Loss'] },
            'ASSOC-2501': { acceptingReferrals: false, capacitySlots: 0, availableTimes: ['Evenings'], specialisations: ['Anxiety & Stress', 'Depression'] },
            'ASSOC-2405': { acceptingReferrals: true, capacitySlots: 2, availableTimes: ['Evenings', 'Weekends'], specialisations: ['Relationships & Intimacy', 'Men\'s Issues'] },
            'ASSOC-2406': { acceptingReferrals: true, capacitySlots: 1, availableTimes: ['Weekdays', 'Evenings'], specialisations: ['Couples & Marriage', 'Pre-Marital Preparation'] }
        };

        // ============================================
        // SESSIONS MOCK DATA (Finance Integration)
        // ============================================

        const sessionRecords = [
            // Sarah Johnson's sessions (ASSOC-2401) - January 2026
            { id: 'SES-26001', sessionDate: '2026-01-02', sessionTime: '10:00', clientId: 'CLIENT-2501', clientName: 'James & Emma Wilson', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-01', stripeChargeId: 'ch_3abc001', payoutStatus: 'Paid Out', payoutId: 'PAY-26001' },
            { id: 'SES-26002', sessionDate: '2026-01-03', sessionTime: '14:00', clientId: 'CLIENT-2502', clientName: 'David Miller', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-02', stripeChargeId: 'ch_3abc002', payoutStatus: 'Paid Out', payoutId: 'PAY-26001' },
            { id: 'SES-26003', sessionDate: '2026-01-06', sessionTime: '11:00', clientId: 'CLIENT-2503', clientName: 'Sophie Taylor', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-05', stripeChargeId: 'ch_3abc003', payoutStatus: 'Paid Out', payoutId: 'PAY-26001' },
            { id: 'SES-26004', sessionDate: '2026-01-07', sessionTime: '15:00', clientId: 'CLIENT-2504', clientName: 'Mark & Lisa Harris', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-06', stripeChargeId: 'ch_3abc004', payoutStatus: 'Paid Out', payoutId: 'PAY-26001' },
            { id: 'SES-26005', sessionDate: '2026-01-08', sessionTime: '10:00', clientId: 'CLIENT-2501', clientName: 'James & Emma Wilson', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-07', stripeChargeId: 'ch_3abc005', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26006', sessionDate: '2026-01-09', sessionTime: '14:00', clientId: 'CLIENT-2507', clientName: 'Nina Patel', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-08', stripeChargeId: 'ch_3abc006', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26007', sessionDate: '2026-01-10', sessionTime: '11:00', clientId: 'CLIENT-2509', clientName: 'Laura Martinez', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-09', stripeChargeId: 'ch_3abc007', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26008', sessionDate: '2026-01-13', sessionTime: '10:00', clientId: 'CLIENT-2502', clientName: 'David Miller', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },
            { id: 'SES-26009', sessionDate: '2026-01-14', sessionTime: '15:00', clientId: 'CLIENT-2504', clientName: 'Mark & Lisa Harris', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },
            { id: 'SES-26010', sessionDate: '2026-01-15', sessionTime: '10:00', clientId: 'CLIENT-2501', clientName: 'James & Emma Wilson', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Couples', rate: 95, sessionStatus: 'Scheduled', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },
            { id: 'SES-26011', sessionDate: '2026-01-16', sessionTime: '14:00', clientId: 'CLIENT-2503', clientName: 'Sophie Taylor', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', sessionType: 'Individual', rate: 85, sessionStatus: 'Scheduled', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },

            // David Okonkwo's sessions (ASSOC-2402) - January 2026
            { id: 'SES-26012', sessionDate: '2026-01-02', sessionTime: '09:00', clientId: 'CLIENT-2513', clientName: 'Michael Chen', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-01', stripeChargeId: 'ch_3abc012', payoutStatus: 'Paid Out', payoutId: 'PAY-26002' },
            { id: 'SES-26013', sessionDate: '2026-01-03', sessionTime: '11:00', clientId: 'CLIENT-2514', clientName: 'Sarah Adams', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-02', stripeChargeId: 'ch_3abc013', payoutStatus: 'Paid Out', payoutId: 'PAY-26002' },
            { id: 'SES-26014', sessionDate: '2026-01-06', sessionTime: '14:00', clientId: 'CLIENT-2515', clientName: 'Kevin & Jane Moore', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-05', stripeChargeId: 'ch_3abc014', payoutStatus: 'Paid Out', payoutId: 'PAY-26002' },
            { id: 'SES-26015', sessionDate: '2026-01-07', sessionTime: '10:00', clientId: 'CLIENT-2513', clientName: 'Michael Chen', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-06', stripeChargeId: 'ch_3abc015', payoutStatus: 'Paid Out', payoutId: 'PAY-26002' },
            { id: 'SES-26016', sessionDate: '2026-01-08', sessionTime: '15:00', clientId: 'CLIENT-2514', clientName: 'Sarah Adams', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-07', stripeChargeId: 'ch_3abc016', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26017', sessionDate: '2026-01-09', sessionTime: '09:00', clientId: 'CLIENT-2513', clientName: 'Michael Chen', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-08', stripeChargeId: 'ch_3abc017', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26018', sessionDate: '2026-01-10', sessionTime: '11:00', clientId: 'CLIENT-2515', clientName: 'Kevin & Jane Moore', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },
            { id: 'SES-26019', sessionDate: '2026-01-13', sessionTime: '14:00', clientId: 'CLIENT-2514', clientName: 'Sarah Adams', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },

            // Amara Williams's sessions (ASSOC-2403) - January 2026
            { id: 'SES-26020', sessionDate: '2026-01-03', sessionTime: '10:00', clientId: 'CLIENT-2516', clientName: 'Emma Stone', associateId: 'ASSOC-2403', associateName: 'Amara Williams', sessionType: 'Family', rate: 110, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-02', stripeChargeId: 'ch_3abc020', payoutStatus: 'Paid Out', payoutId: 'PAY-26003' },
            { id: 'SES-26021', sessionDate: '2026-01-06', sessionTime: '14:00', clientId: 'CLIENT-2517', clientName: 'Robert Lee', associateId: 'ASSOC-2403', associateName: 'Amara Williams', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-05', stripeChargeId: 'ch_3abc021', payoutStatus: 'Paid Out', payoutId: 'PAY-26003' },
            { id: 'SES-26022', sessionDate: '2026-01-08', sessionTime: '11:00', clientId: 'CLIENT-2516', clientName: 'Emma Stone', associateId: 'ASSOC-2403', associateName: 'Amara Williams', sessionType: 'Family', rate: 110, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-07', stripeChargeId: 'ch_3abc022', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26023', sessionDate: '2026-01-10', sessionTime: '10:00', clientId: 'CLIENT-2517', clientName: 'Robert Lee', associateId: 'ASSOC-2403', associateName: 'Amara Williams', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },
            { id: 'SES-26024', sessionDate: '2026-01-13', sessionTime: '14:00', clientId: 'CLIENT-2516', clientName: 'Emma Stone', associateId: 'ASSOC-2403', associateName: 'Amara Williams', sessionType: 'Family', rate: 110, sessionStatus: 'Scheduled', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },

            // Marcus Thompson's sessions (ASSOC-2404) - January 2026
            { id: 'SES-26025', sessionDate: '2026-01-02', sessionTime: '14:00', clientId: 'CLIENT-2518', clientName: 'Julia Roberts', associateId: 'ASSOC-2404', associateName: 'Marcus Thompson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-01', stripeChargeId: 'ch_3abc025', payoutStatus: 'Paid Out', payoutId: 'PAY-26004' },
            { id: 'SES-26026', sessionDate: '2026-01-06', sessionTime: '10:00', clientId: 'CLIENT-2518', clientName: 'Julia Roberts', associateId: 'ASSOC-2404', associateName: 'Marcus Thompson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-05', stripeChargeId: 'ch_3abc026', payoutStatus: 'Paid Out', payoutId: 'PAY-26004' },
            { id: 'SES-26027', sessionDate: '2026-01-08', sessionTime: '15:00', clientId: 'CLIENT-2518', clientName: 'Julia Roberts', associateId: 'ASSOC-2404', associateName: 'Marcus Thompson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-07', stripeChargeId: 'ch_3abc027', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26028', sessionDate: '2026-01-10', sessionTime: '14:00', clientId: 'CLIENT-2518', clientName: 'Julia Roberts', associateId: 'ASSOC-2404', associateName: 'Marcus Thompson', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },

            // Kofi Mensah's sessions (ASSOC-2405) - January 2026
            { id: 'SES-26029', sessionDate: '2026-01-03', sessionTime: '16:00', clientId: 'CLIENT-2519', clientName: 'Peter Parker', associateId: 'ASSOC-2405', associateName: 'Kofi Mensah', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-02', stripeChargeId: 'ch_3abc029', payoutStatus: 'Paid Out', payoutId: 'PAY-26005' },
            { id: 'SES-26030', sessionDate: '2026-01-07', sessionTime: '17:00', clientId: 'CLIENT-2519', clientName: 'Peter Parker', associateId: 'ASSOC-2405', associateName: 'Kofi Mensah', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-06', stripeChargeId: 'ch_3abc030', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26031', sessionDate: '2026-01-10', sessionTime: '16:00', clientId: 'CLIENT-2519', clientName: 'Peter Parker', associateId: 'ASSOC-2405', associateName: 'Kofi Mensah', sessionType: 'Individual', rate: 85, sessionStatus: 'Completed', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null },

            // Zara Patel's sessions (ASSOC-2406) - January 2026
            { id: 'SES-26032', sessionDate: '2026-01-02', sessionTime: '11:00', clientId: 'CLIENT-2520', clientName: 'Diana Prince', associateId: 'ASSOC-2406', associateName: 'Zara Patel', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-01', stripeChargeId: 'ch_3abc032', payoutStatus: 'Paid Out', payoutId: 'PAY-26006' },
            { id: 'SES-26033', sessionDate: '2026-01-06', sessionTime: '14:00', clientId: 'CLIENT-2520', clientName: 'Diana Prince', associateId: 'ASSOC-2406', associateName: 'Zara Patel', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-05', stripeChargeId: 'ch_3abc033', payoutStatus: 'Paid Out', payoutId: 'PAY-26006' },
            { id: 'SES-26034', sessionDate: '2026-01-09', sessionTime: '11:00', clientId: 'CLIENT-2520', clientName: 'Diana Prince', associateId: 'ASSOC-2406', associateName: 'Zara Patel', sessionType: 'Couples', rate: 95, sessionStatus: 'Completed', paymentStatus: 'Paid', paymentDate: '2026-01-08', stripeChargeId: 'ch_3abc034', payoutStatus: 'Ready for Payout', payoutId: null },
            { id: 'SES-26035', sessionDate: '2026-01-13', sessionTime: '14:00', clientId: 'CLIENT-2520', clientName: 'Diana Prince', associateId: 'ASSOC-2406', associateName: 'Zara Patel', sessionType: 'Couples', rate: 95, sessionStatus: 'Scheduled', paymentStatus: 'Awaiting Payment', paymentDate: null, stripeChargeId: null, payoutStatus: 'Pending', payoutId: null }
        ];

        // ============================================
        // PAYOUTS MOCK DATA (Finance Integration)
        // ============================================

        const payouts = [
            // Week 1 payouts (1-7 Jan) - Already paid
            { id: 'PAY-26001', associateId: 'ASSOC-2401', associateName: 'Sarah Johnson', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26001', 'SES-26002', 'SES-26003', 'SES-26004'], sessionCount: 4, grossAmount: 360, associateAmount: 248.40, edenAmount: 111.60, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-SJ' },
            { id: 'PAY-26002', associateId: 'ASSOC-2402', associateName: 'David Okonkwo', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26012', 'SES-26013', 'SES-26014', 'SES-26015'], sessionCount: 4, grossAmount: 350, associateAmount: 241.50, edenAmount: 108.50, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-DO' },
            { id: 'PAY-26003', associateId: 'ASSOC-2403', associateName: 'Amara Williams', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26020', 'SES-26021'], sessionCount: 2, grossAmount: 195, associateAmount: 134.55, edenAmount: 60.45, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-AW' },
            { id: 'PAY-26004', associateId: 'ASSOC-2404', associateName: 'Marcus Thompson', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26025', 'SES-26026'], sessionCount: 2, grossAmount: 170, associateAmount: 117.30, edenAmount: 52.70, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-MT' },
            { id: 'PAY-26005', associateId: 'ASSOC-2405', associateName: 'Kofi Mensah', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26029'], sessionCount: 1, grossAmount: 85, associateAmount: 58.65, edenAmount: 26.35, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-KM' },
            { id: 'PAY-26006', associateId: 'ASSOC-2406', associateName: 'Zara Patel', periodStart: '2026-01-01', periodEnd: '2026-01-07', sessionIds: ['SES-26032', 'SES-26033'], sessionCount: 2, grossAmount: 190, associateAmount: 131.10, edenAmount: 58.90, status: 'Paid', approvedDate: '2026-01-08', approvedBy: 'Mike', paidDate: '2026-01-08', paymentMethod: 'Bank Transfer', paymentReference: 'EDEN-JAN26-ZP' }
        ];

        // ============================================
        // UNMATCHED PAYMENTS MOCK DATA
        // ============================================

        const unmatchedPayments = [
            { id: 'UNM-26001', stripeChargeId: 'ch_3xyz999', customerEmail: 'unknown.client@email.com', amount: 85, paymentDate: '2026-01-12', status: 'Pending Review', matchedSessionId: null, resolvedDate: null, resolvedBy: null, notes: 'No matching session found - client email not in system' }
        ];

        // ============================================
        // FINANCIAL SNAPSHOT MOCK DATA
        // ============================================

        const financialSnapshot = {
            snapshotDate: '2026-01-15',
            bankBalance: 32680,
            outstandingPayouts: 1245.60, // Sum of sessions ready for payout (associate share)
            taxReserve: 8170, // 25% of bank balance
            trueCash: 23264.40, // Bank - Outstanding Payouts - Tax Reserve
            unpaidSessions: 1110, // Sessions with PaymentStatus = "Awaiting Payment"
            revenueThisMonth: 3150, // Sum of paid session rates this month
            payoutsThisMonth: 931.50, // Sum of paid out associate amounts this month
            source: 'Mock Data'
        };

        // ============================================
        // FINANCE HELPER FUNCTIONS
        // ============================================

        // Get sessions for a specific associate
        function getSessionsForAssociate(associateId) {
            return sessionRecords.filter(s => s.associateId === associateId);
        }

        // Get sessions by payment status
        function getSessionsByPaymentStatus(status, associateId = null) {
            let filtered = sessionRecords.filter(s => s.paymentStatus === status);
            if (associateId) {
                filtered = filtered.filter(s => s.associateId === associateId);
            }
            return filtered;
        }

        // Get sessions by payout status
        function getSessionsByPayoutStatus(status, associateId = null) {
            let filtered = sessionRecords.filter(s => s.payoutStatus === status);
            if (associateId) {
                filtered = filtered.filter(s => s.associateId === associateId);
            }
            return filtered;
        }

        // Calculate earnings for an associate
        function calculateAssociateEarnings(associateId) {
            const associateSessions = getSessionsForAssociate(associateId);
            const paidSessions = associateSessions.filter(s => s.paymentStatus === 'Paid');
            const awaitingPayment = associateSessions.filter(s => s.paymentStatus === 'Awaiting Payment');
            const readyForPayout = associateSessions.filter(s => s.payoutStatus === 'Ready for Payout');
            const paidOut = associateSessions.filter(s => s.payoutStatus === 'Paid Out');

            const grossEarnings = paidSessions.reduce((sum, s) => sum + s.rate, 0);
            const associateShare = grossEarnings * 0.69;
            const awaitingTotal = awaitingPayment.reduce((sum, s) => sum + s.rate, 0);
            const readyForPayoutTotal = readyForPayout.reduce((sum, s) => sum + (s.rate * 0.69), 0);
            const paidOutTotal = paidOut.reduce((sum, s) => sum + (s.rate * 0.69), 0);

            return {
                grossEarnings,
                associateShare,
                awaitingPaymentCount: awaitingPayment.length,
                awaitingPaymentTotal: awaitingTotal,
                readyForPayoutCount: readyForPayout.length,
                readyForPayoutTotal,
                paidOutCount: paidOut.length,
                paidOutTotal,
                totalSessions: associateSessions.length,
                completedSessions: associateSessions.filter(s => s.sessionStatus === 'Completed').length
            };
        }

        // Get payouts for an associate
        function getPayoutsForAssociate(associateId) {
            return payouts.filter(p => p.associateId === associateId);
        }

        // Calculate True Cash
        function calculateTrueCash() {
            const bankBalance = financialSnapshot.bankBalance;

            // Calculate outstanding payouts (sessions ready for payout)
            const readyForPayout = sessionRecords.filter(s => s.payoutStatus === 'Ready for Payout');
            const outstandingPayouts = readyForPayout.reduce((sum, s) => sum + (s.rate * 0.69), 0);

            // Tax reserve (25% of bank balance)
            const taxReserve = bankBalance * 0.25;

            // True Cash
            const trueCash = bankBalance - outstandingPayouts - taxReserve;

            return {
                bankBalance,
                outstandingPayouts,
                taxReserve,
                trueCash,
                runway: trueCash / 2000 // Approximate months of runway at 2k/month operating costs
            };
        }

        // Get payment overview for admin
        function getPaymentOverview() {
            const allSessions = sessionRecords.filter(s => s.sessionStatus === 'Completed');
            const awaitingPayment = allSessions.filter(s => s.paymentStatus === 'Awaiting Payment');
            const paid = allSessions.filter(s => s.paymentStatus === 'Paid');

            // Overdue = Awaiting Payment for more than 7 days
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const overdue = awaitingPayment.filter(s => new Date(s.sessionDate) < sevenDaysAgo);

            return {
                awaitingPaymentCount: awaitingPayment.length,
                awaitingPaymentTotal: awaitingPayment.reduce((sum, s) => sum + s.rate, 0),
                paidCount: paid.length,
                paidTotal: paid.reduce((sum, s) => sum + s.rate, 0),
                overdueCount: overdue.length,
                overdueTotal: overdue.reduce((sum, s) => sum + s.rate, 0),
                overdueSessions: overdue
            };
        }

        // Get payout pipeline (sessions ready for payout grouped by associate)
        function getPayoutPipeline() {
            const readyForPayout = sessionRecords.filter(s => s.payoutStatus === 'Ready for Payout');
            const grouped = {};

            readyForPayout.forEach(session => {
                if (!grouped[session.associateId]) {
                    grouped[session.associateId] = {
                        associateId: session.associateId,
                        associateName: session.associateName,
                        sessions: [],
                        totalGross: 0,
                        totalAssociateShare: 0
                    };
                }
                grouped[session.associateId].sessions.push(session);
                grouped[session.associateId].totalGross += session.rate;
                grouped[session.associateId].totalAssociateShare += session.rate * 0.69;
            });

            return Object.values(grouped);
        }

        // ============================================
        // STATE
        // ============================================

        let selectedAssociate = null;
        let selectedClient = null;
        let isMobile = window.innerWidth <= 768;
        let currentView = 'dashboard';
        let currentPipelineFilter = 'all';

        // Navigation Stack State for Associate Panel
        let panelNavigationStack = ['overview'];
        let activePanelTab = 'profile'; // Default tab when viewing overview

        // Referral system state
        let selectedReferral = null;
        let referralPanelMode = null; // 'triage', 'allocate', 'interest', 'view'

        // ============================================
        // ROLE-BASED ACCESS CONTROL
        // ============================================

        // Current user state - change these to test different roles
        let currentUserRole = 'admin'; // 'admin' or 'associate'
        let currentUserId = null;       // null for admin, 'ASSOC-XXXX' for associates
        let currentUserName = 'Mike';   // Display name

        // Navigation permissions by role
        const roleNavPermissions = {
            admin: {
                allowedViews: ['dashboard', 'action-centre', 'referrals', 'associates', 'clients', 'contracts', 'earnings', 'schedule', 'cpd', 'support'],
                navLabels: {
                    'clients': 'Clients',
                    'earnings': 'Earnings',
                    'schedule': 'Schedule',
                    'referrals': 'Referrals'
                }
            },
            associate: {
                allowedViews: ['dashboard', 'referrals', 'clients', 'earnings', 'schedule', 'cpd', 'support'],
                navLabels: {
                    'clients': 'My Clients',
                    'earnings': 'My Earnings',
                    'schedule': 'My Schedule',
                    'referrals': 'Referral Inbox'
                }
            }
        };

        // ============================================
        // UNIFIED DETAIL VIEW CONTROLLER
        // ============================================

        const DetailView = (function() {
            // Navigation stack for back button
            let navigationStack = [];

            // Current entity being viewed
            let currentEntity = null;
            let currentEntityType = null;
            let currentTab = null;

            // DOM references
            const container = document.getElementById('unifiedDetailView');
            const backdrop = document.getElementById('unifiedDetailBackdrop');
            const panel = document.getElementById('unifiedDetailPanel');
            const backBtn = document.getElementById('unifiedDetailBackBtn');
            const backText = document.getElementById('unifiedDetailBackText');
            const title = document.getElementById('unifiedDetailTitle');
            const subtitle = document.getElementById('unifiedDetailSubtitle');
            const menuBtn = document.getElementById('unifiedDetailMenuBtn');
            const dropdown = document.getElementById('unifiedDetailDropdown');
            const dropdownName = document.getElementById('unifiedDropdownName');
            const tabsContainer = document.getElementById('unifiedDetailTabs');
            const content = document.getElementById('unifiedDetailContent');
            const pipelineContainer = document.getElementById('unifiedDetailPipeline');
            const stewardAnchor = document.getElementById('unifiedStewardAnchor');
            const stewardAvatar = document.getElementById('unifiedStewardAvatar');

            // Tab configurations by entity type
            const tabConfigs = {
                associate: [
                    { id: 'profile', label: 'Profile' },
                    { id: 'sessions', label: 'Sessions' },
                    { id: 'finance', label: 'Finance' },
                    { id: 'inbox', label: 'Inbox' }
                ],
                client: [
                    { id: 'overview', label: 'Overview' },
                    { id: 'sessions', label: 'Sessions' },
                    { id: 'finance', label: 'Finance' },
                    { id: 'notes', label: 'Notes' }
                ],
                referral: [
                    { id: 'details', label: 'Details' },
                    { id: 'history', label: 'History' }
                ]
            };

            // Menu configurations by entity type and role
            const menuConfigs = {
                associate: {
                    admin: [
                        { id: 'view-profile', label: 'Profile', subtitle: 'View details', icon: 'user' },
                        { id: 'view-sessions', label: 'Sessions', subtitle: 'View sessions', icon: 'calendar' },
                        { id: 'view-contracts', label: 'Contracts', subtitle: 'Active agreements', icon: 'file' },
                        { id: 'view-finance', label: 'Finance', subtitle: 'Payout Cockpit', icon: 'dollar' },
                        { id: 'send-message', label: 'Inbox', subtitle: 'Messages', icon: 'mail' }
                    ]
                },
                client: {
                    admin: [
                        { id: 'view-associate', label: 'View Associate', subtitle: 'Their therapist', icon: 'user' },
                        { id: 'view-sessions', label: 'Sessions', subtitle: 'Session history', icon: 'calendar' },
                        { id: 'update-stage', label: 'Update Stage', subtitle: 'Change pipeline', icon: 'edit' },
                        { id: 'reassign', label: 'Reassign', subtitle: 'Change associate', icon: 'switch' }
                    ],
                    associate: [
                        { id: 'view-sessions', label: 'Sessions', subtitle: 'Session history', icon: 'calendar' },
                        { id: 'send-message', label: 'Send Message', subtitle: 'Contact client', icon: 'mail' },
                        { id: 'update-stage', label: 'Update Stage', subtitle: 'Change pipeline', icon: 'edit' }
                    ]
                },
                referral: {
                    admin: [
                        { id: 'assign-associate', label: 'Assign', subtitle: 'Select associate', icon: 'user-plus' },
                        { id: 'archive', label: 'Archive', subtitle: 'Remove from list', icon: 'archive' }
                    ],
                    associate: [
                        { id: 'accept', label: 'Accept', subtitle: 'Take this referral', icon: 'check' },
                        { id: 'decline', label: 'Decline', subtitle: 'Pass on this one', icon: 'x' }
                    ]
                }
            };

            // Client pipeline stages
            const clientPipelineStages = [
                { id: 'inquiry', label: 'Inquiry', color: '#f59e0b' },
                { id: 'engaged', label: 'Engaged', color: '#8b5cf6' },
                { id: 'matched', label: 'Matched', color: '#3b82f6' },
                { id: 'booked', label: 'Booked', color: '#14b8a6' },
                { id: 'active', label: 'Active', color: '#10b981' },
                { id: 'followup', label: 'Follow-up', color: '#f97316' },
                { id: 'ongoing', label: 'Ongoing', color: '#eab308' }
            ];

            // ROLE DETECTION
            function getRole() {
                return typeof currentUserRole !== 'undefined' ? currentUserRole : 'admin';
            }

            function isAdmin() {
                return getRole() === 'admin';
            }

            // Get icon SVG by name
            function getIconSvg(iconName) {
                const icons = {
                    'user': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
                    'calendar': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
                    'file': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',
                    'dollar': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
                    'mail': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>',
                    'edit': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
                    'switch': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>',
                    'user-plus': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>',
                    'archive': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>',
                    'check': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="20 6 9 17 4 12"/></svg>',
                    'x': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>'
                };
                return icons[iconName] || icons['user'];
            }

            // Open detail view
            function open(entityType, entity, fromContext) {
                if (!container) return;

                // Push current state to navigation stack
                if (currentEntity) {
                    navigationStack.push({
                        entityType: currentEntityType,
                        entity: currentEntity,
                        tab: currentTab
                    });
                }

                currentEntity = entity;
                currentEntityType = entityType;
                currentTab = tabConfigs[entityType]?.[0]?.id || 'overview';

                // Update header
                title.textContent = entity.name || entity.title || 'Details';
                subtitle.textContent = entity.id || entity.ucid || '';
                dropdownName.textContent = entity.name || entity.title || 'Details';

                // Update back button text
                if (fromContext) {
                    backText.textContent = 'Back to ' + fromContext;
                } else if (navigationStack.length > 0) {
                    const prev = navigationStack[navigationStack.length - 1];
                    backText.textContent = 'Back';
                } else {
                    backText.textContent = 'Back';
                }

                // Show/hide steward anchor (Admin only, when viewing client from associate context)
                if (isAdmin() && entityType === 'client' && entity.associateName) {
                    stewardAnchor.style.display = 'flex';
                    stewardAvatar.src = entity.associateAvatar || '/default-avatar.png';
                    stewardAvatar.alt = entity.associateName;
                } else {
                    stewardAnchor.style.display = 'none';
                }

                // Show/hide pipeline for clients
                if (entityType === 'client') {
                    renderPipeline(entity);
                    pipelineContainer.style.display = 'flex';
                } else {
                    pipelineContainer.style.display = 'none';
                }

                // Render tabs
                renderTabs(entityType);

                // Render menu
                renderMenu(entityType);

                // Render initial tab content
                renderTabContent(currentTab);

                // Show panel
                container.classList.add('open');
                container.setAttribute('aria-hidden', 'false');

                // Lock body scroll on mobile
                if (window.innerWidth <= 768) {
                    document.body.style.overflow = 'hidden';
                }
            }

            // Close detail view
            function close() {
                if (!container) return;

                container.classList.remove('open');
                container.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                dropdown.classList.remove('open');

                // Clear state after animation
                setTimeout(function() {
                    currentEntity = null;
                    currentEntityType = null;
                    currentTab = null;
                    navigationStack = [];
                }, 300);
            }

            // Go back
            function goBack() {
                if (navigationStack.length > 0) {
                    const previous = navigationStack.pop();
                    currentEntity = null; // Prevent pushing to stack
                    currentTab = previous.tab;
                    open(previous.entityType, previous.entity);
                } else {
                    close();
                }
            }

            // Render pipeline
            function renderPipeline(entity) {
                const currentStage = entity.stage || entity.pipelineStage || 'inquiry';
                let foundCurrent = false;

                pipelineContainer.innerHTML = clientPipelineStages.map(function(stage) {
                    const isActive = stage.id === currentStage;
                    const isCompleted = !foundCurrent && !isActive;
                    if (isActive) foundCurrent = true;

                    const dotClass = isActive ? 'active' : (isCompleted ? 'completed' : '');
                    const labelClass = isActive ? 'active' : '';

                    return '<div class="unified-pipeline-step">' +
                        '<div class="unified-pipeline-dot ' + dotClass + '" style="' + (isActive ? 'background-color:' + stage.color : '') + '"></div>' +
                        '<span class="unified-pipeline-label ' + labelClass + '">' + stage.label + '</span>' +
                        '</div>';
                }).join('');
            }

            // Render tabs
            function renderTabs(entityType) {
                const tabs = tabConfigs[entityType] || [];
                tabsContainer.innerHTML = tabs.map(function(tab, index) {
                    const isActive = tab.id === currentTab || (index === 0 && !currentTab);
                    return '<button class="unified-detail-tab' + (isActive ? ' active' : '') + '" ' +
                        'data-tab="' + tab.id + '" role="tab" ' +
                        'aria-selected="' + isActive + '">' +
                        tab.label + '</button>';
                }).join('');
            }

            // Render menu
            function renderMenu(entityType) {
                const role = getRole();
                const menuItems = menuConfigs[entityType]?.[role] || [];

                const menuHtml = menuItems.map(function(item) {
                    return '<button class="unified-detail-dropdown-item" data-action="' + item.id + '">' +
                        '<div class="unified-detail-dropdown-icon">' + getIconSvg(item.icon) + '</div>' +
                        '<div class="unified-detail-dropdown-text">' +
                        '<div class="unified-detail-dropdown-title">' + item.label + '</div>' +
                        '<div class="unified-detail-dropdown-subtitle">' + item.subtitle + '</div>' +
                        '</div>' +
                        '</button>';
                }).join('');

                // Find the dropdown menu content area (after the header)
                const dropdownHeader = dropdown.querySelector('.unified-detail-dropdown-header');
                if (dropdownHeader) {
                    // Remove any existing menu items
                    const existingMenu = dropdown.querySelector('.unified-detail-dropdown-menu');
                    if (existingMenu) existingMenu.remove();

                    // Add new menu items container
                    const menuContainer = document.createElement('div');
                    menuContainer.className = 'unified-detail-dropdown-menu';
                    menuContainer.innerHTML = menuHtml;
                    dropdown.appendChild(menuContainer);
                }
            }

            // Render tab content
            function renderTabContent(tabId) {
                currentTab = tabId;
                if (!currentEntity || !currentEntityType) return;

                let html = '';

                switch(currentEntityType) {
                    case 'associate':
                        html = renderAssociateTabContent(tabId);
                        break;
                    case 'client':
                        html = renderClientTabContent(tabId);
                        break;
                    case 'referral':
                        html = renderReferralTabContent(tabId);
                        break;
                    default:
                        html = '<div class="unified-detail-section"><p>No content available</p></div>';
                }

                content.innerHTML = html;
            }

            // Render associate tab content
            function renderAssociateTabContent(tabId) {
                const entity = currentEntity;

                switch(tabId) {
                    case 'profile':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Personal Details</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Name</span><span class="unified-detail-value">' + (entity.name || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Email</span><span class="unified-detail-value">' + (entity.email || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Phone</span><span class="unified-detail-value">' + (entity.phone || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Location</span><span class="unified-detail-value">' + (entity.address || 'N/A') + '</span></div>' +
                            '</div>' +
                            '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Practice Details</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Specialisation</span><span class="unified-detail-value">' + (entity.specialisation || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Support Mode</span><span class="unified-detail-value">' + (entity.supportMode || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Joined</span><span class="unified-detail-value">' + (entity.joinDate || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Capacity</span><span class="unified-detail-value">' + (entity.clients || 0) + ' / ' + (entity.maxCapacity || 0) + ' clients</span></div>' +
                            '</div>' +
                            '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Emergency Contact</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Name</span><span class="unified-detail-value">' + (entity.emergencyName || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Relation</span><span class="unified-detail-value">' + (entity.emergencyRelation || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Phone</span><span class="unified-detail-value">' + (entity.emergencyPhone || 'N/A') + '</span></div>' +
                            '</div>';

                    case 'sessions':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Recent Sessions</div>' +
                            '<p style="color: #6b7280; font-size: 14px;">Session history will be displayed here.</p>' +
                            '</div>';

                    case 'finance':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Earnings Overview</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Total Earnings</span><span class="unified-detail-value">' + (entity.totalEarnings || '0') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Pending Payout</span><span class="unified-detail-value">' + (entity.pendingPayout || '0') + '</span></div>' +
                            '</div>';

                    case 'inbox':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Messages</div>' +
                            '<p style="color: #6b7280; font-size: 14px;">No messages yet.</p>' +
                            '</div>';

                    default:
                        return '<div class="unified-detail-section"><p>Content not available</p></div>';
                }
            }

            // Render client tab content
            function renderClientTabContent(tabId) {
                const entity = currentEntity;
                const associate = typeof associates !== 'undefined' ? associates.find(a => a.id === entity.associateId) : null;

                switch(tabId) {
                    case 'overview':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Contact Details</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Email</span><span class="unified-detail-value">' + (entity.email || 'Not provided') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Phone</span><span class="unified-detail-value">' + (entity.phone || 'Not provided') + '</span></div>' +
                            '</div>' +
                            '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Therapy Details</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Type</span><span class="unified-detail-value">' + (entity.type || 'Individual') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Therapist</span><span class="unified-detail-value">' + (associate ? associate.name : 'Unassigned') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Started</span><span class="unified-detail-value">' + (entity.firstSessionDate || 'Not started') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Presenting Issue</span><span class="unified-detail-value">' + (entity.presentingIssue || 'Not specified') + '</span></div>' +
                            '</div>';

                    case 'sessions':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Session History</div>' +
                            '<p style="color: #6b7280; font-size: 14px;">Session history will be displayed here.</p>' +
                            '</div>';

                    case 'finance':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Payment History</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Last Payment</span><span class="unified-detail-value">100 - 3 days ago</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Payment Method</span><span class="unified-detail-value">Stripe (Visa ****4242)</span></div>' +
                            '</div>';

                    case 'notes':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Client Notes</div>' +
                            '<p style="color: #6b7280; font-size: 14px;">No notes yet.</p>' +
                            '</div>';

                    default:
                        return '<div class="unified-detail-section"><p>Content not available</p></div>';
                }
            }

            // Render referral tab content
            function renderReferralTabContent(tabId) {
                const entity = currentEntity;

                switch(tabId) {
                    case 'details':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Referral Information</div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Name</span><span class="unified-detail-value">' + (entity.name || entity.clientName || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Type</span><span class="unified-detail-value">' + (entity.type || entity.therapyType || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Source</span><span class="unified-detail-value">' + (entity.source || 'N/A') + '</span></div>' +
                            '<div class="unified-detail-row"><span class="unified-detail-label">Received</span><span class="unified-detail-value">' + (entity.dateReceived || 'N/A') + '</span></div>' +
                            '</div>';

                    case 'history':
                        return '<div class="unified-detail-section">' +
                            '<div class="unified-detail-section-title">Activity History</div>' +
                            '<p style="color: #6b7280; font-size: 14px;">No activity recorded yet.</p>' +
                            '</div>';

                    default:
                        return '<div class="unified-detail-section"><p>Content not available</p></div>';
                }
            }

            // Handle menu actions
            function handleMenuAction(action) {
                console.log('Menu action:', action, 'Entity:', currentEntity);
                dropdown.classList.remove('open');

                switch(action) {
                    case 'view-profile':
                        switchTab('profile');
                        break;
                    case 'view-sessions':
                        switchTab('sessions');
                        break;
                    case 'view-contracts':
                        // Could open contracts subpage
                        break;
                    case 'view-finance':
                        switchTab('finance');
                        break;
                    case 'send-message':
                        switchTab('inbox');
                        break;
                    case 'view-associate':
                        if (currentEntity && currentEntity.associateId && typeof associates !== 'undefined') {
                            const assoc = associates.find(a => a.id === currentEntity.associateId);
                            if (assoc) {
                                open('associate', assoc, 'Client');
                            }
                        }
                        break;
                    case 'update-stage':
                        // Could open stage selector
                        break;
                    case 'reassign':
                        // Could open reassign modal
                        break;
                    // Add more cases as needed
                }
            }

            // Switch tab
            function switchTab(tabId) {
                currentTab = tabId;

                // Update active state
                tabsContainer.querySelectorAll('.unified-detail-tab').forEach(function(tab) {
                    tab.classList.remove('active');
                    tab.setAttribute('aria-selected', 'false');
                    if (tab.dataset.tab === tabId) {
                        tab.classList.add('active');
                        tab.setAttribute('aria-selected', 'true');
                    }
                });

                // Render content
                renderTabContent(tabId);
            }

            // Event listeners
            function init() {
                if (!container) return;

                // Back button
                if (backBtn) {
                    backBtn.addEventListener('click', goBack);
                }

                // Backdrop click closes panel (desktop)
                if (backdrop) {
                    backdrop.addEventListener('click', close);
                }

                // Menu toggle
                if (menuBtn) {
                    menuBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        dropdown.classList.toggle('open');
                    });
                }

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (dropdown && !dropdown.contains(e.target) && !menuBtn.contains(e.target)) {
                        dropdown.classList.remove('open');
                    }
                });

                // Tab clicks
                if (tabsContainer) {
                    tabsContainer.addEventListener('click', function(e) {
                        if (e.target.classList.contains('unified-detail-tab')) {
                            switchTab(e.target.dataset.tab);
                        }
                    });
                }

                // Menu item clicks
                if (dropdown) {
                    dropdown.addEventListener('click', function(e) {
                        const item = e.target.closest('.unified-detail-dropdown-item');
                        if (item) {
                            handleMenuAction(item.dataset.action);
                        }
                    });
                }

                // Escape key closes panel
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && container.classList.contains('open')) {
                        close();
                    }
                });
            }

            // Initialize
            init();

            // Public API
            return {
                open: open,
                close: close,
                goBack: goBack,
                switchTab: switchTab,
                getCurrentEntity: function() { return currentEntity; },
                getCurrentEntityType: function() { return currentEntityType; }
            };
        })();

        // Filter navigation based on current role
        function updateNavigationForRole() {
            const permissions = roleNavPermissions[currentUserRole];
            if (!permissions) return;

            document.querySelectorAll('.nav-item').forEach(item => {
                const viewName = item.dataset.view;
                if (permissions.allowedViews.includes(viewName)) {
                    item.style.display = 'flex';
                    // Update label if role-specific label exists
                    if (permissions.navLabels[viewName]) {
                        const labelSpan = item.querySelector('span');
                        if (labelSpan) {
                            labelSpan.textContent = permissions.navLabels[viewName];
                        }
                    }
                } else {
                    item.style.display = 'none';
                }
            });

            // Hide admin-only nav sections for associates
            if (currentUserRole === 'associate') {
                // Hide "Directory" section label if all items hidden
                const directorySections = document.querySelectorAll('.nav-section');
                directorySections.forEach(section => {
                    const visibleItems = section.querySelectorAll('.nav-item[style*="flex"], .nav-item:not([style*="none"])');
                    const label = section.querySelector('.nav-label');
                    if (label && visibleItems.length === 0) {
                        label.style.display = 'none';
                    } else if (label) {
                        label.style.display = 'block';
                    }
                });
            }

            // Update user profile display
            updateUserProfileDisplay();
        }

        // Update the user profile section in sidebar
        function updateUserProfileDisplay() {
            const profileSection = document.getElementById('userProfileSection');
            if (!profileSection) return;

            const roleLabel = currentUserRole === 'admin' ? 'Administrator' : 'Associate';
            const roleBadgeClass = currentUserRole === 'admin' ? 'role-badge-admin' : 'role-badge-associate';

            profileSection.innerHTML = `
                <div class="user-profile-content">
                    <div class="user-avatar">${currentUserName.charAt(0).toUpperCase()}</div>
                    <div class="user-info">
                        <div class="user-name">${currentUserName}</div>
                        <div class="user-role ${roleBadgeClass}">${roleLabel}</div>
                    </div>
                </div>
                <button class="role-toggle-btn" onclick="toggleRole()" title="Toggle role (for testing)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    </svg>
                </button>
            `;
        }

        // Toggle between admin and associate roles (for testing)
        function toggleRole() {
            if (currentUserRole === 'admin') {
                currentUserRole = 'associate';
                currentUserId = 'ASSOC-2401';
                currentUserName = 'Sarah Johnson';
            } else {
                currentUserRole = 'admin';
                currentUserId = null;
                currentUserName = 'Mike';
            }
            updateNavigationForRole();

            // If current view is not allowed for new role, redirect to dashboard
            const permissions = roleNavPermissions[currentUserRole];
            if (!permissions.allowedViews.includes(currentView)) {
                showView('dashboard');
            }

            // Reset home navigation and update home screen
            homeNavStack = ['home'];
            updateHomeScreenForRole();

            // Update referrals view for new role
            renderReferrals();

            // Update mobile bottom nav for role change
            if (typeof updateBottomNavForRole === 'function') {
                updateBottomNavForRole();
            }
        }

        // Check if current user can access a view
        function canAccessView(viewName) {
            const permissions = roleNavPermissions[currentUserRole];
            return permissions && permissions.allowedViews.includes(viewName);
        }

        // ============================================
        // VIEW NAVIGATION
        // ============================================

        function showView(viewName) {
            // Role-based access control check
            if (!canAccessView(viewName)) {
                console.warn(`Access denied: ${currentUserRole} cannot access ${viewName}`);
                // Show brief access denied notification
                showAccessDeniedNotification(viewName);
                return;
            }

            // Close any open detail views when navigating
            if (typeof DetailView !== 'undefined' && DetailView.close) {
                DetailView.close();
            }

            currentView = viewName;

            // Update view containers
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById(viewName + 'View');
            if (targetView) {
                targetView.classList.add('active');
            }

            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.view === viewName) {
                    item.classList.add('active');
                }
            });

            // Close sidebar on mobile
            if (isMobile) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
            }

            // Re-render referrals when switching to referrals view
            if (viewName === 'referrals') {
                renderReferrals();
            }

            // Update Action Centre summary counts when showing action-centre
            if (viewName === 'action-centre') {
                renderFrictionFeed();
            }

            // Sync mobile bottom nav active state
            if (typeof syncBottomNavState === 'function') {
                syncBottomNavState(viewName);
            }
        }

        // Show access denied notification
        function showAccessDeniedNotification(viewName) {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('accessDeniedNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'accessDeniedNotification';
                notification.className = 'access-denied-notification';
                document.body.appendChild(notification);
            }

            notification.textContent = `Access to ${viewName.replace('-', ' ')} is restricted`;
            notification.classList.add('show');

            // Hide after 2 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // Analytics period toggle
        function setAnalyticsPeriod(period) {
            // Update toggle buttons
            document.querySelectorAll('.analytics-period-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase() === period) {
                    btn.classList.add('active');
                }
            });

            // Update metrics based on period (mock data)
            const metricsData = {
                week: { sessions: 47, revenue: '6,820', attendance: '92%', rating: '4.8', comparison: 'vs last week' },
                month: { sessions: 186, revenue: '24,680', attendance: '91%', rating: '4.7', comparison: 'vs last month' },
                quarter: { sessions: 542, revenue: '72,450', attendance: '90%', rating: '4.7', comparison: 'vs last quarter' }
            };

            const data = metricsData[period];
            const cards = document.querySelectorAll('.analytics-metric-card');

            if (cards.length >= 4) {
                cards[0].querySelector('.analytics-metric-value').textContent = data.sessions;
                cards[0].querySelector('.analytics-metric-change').innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"/>
                    </svg>
                    +12% ${data.comparison}
                `;
                cards[1].querySelector('.analytics-metric-value').textContent = data.revenue;
                cards[1].querySelector('.analytics-metric-change').innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"/>
                    </svg>
                    +8% ${data.comparison}
                `;
                cards[2].querySelector('.analytics-metric-value').textContent = data.attendance;
                cards[3].querySelector('.analytics-metric-value').textContent = data.rating;
            }

            showToast(`Showing ${period} analytics`);
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        let associatesFilter = 'all';

        function renderCards(filter = 'all') {
            const grid = document.getElementById('cardGrid');
            if (!grid) return;

            associatesFilter = filter;

            // Update filter pills
            document.querySelectorAll('#associatesFilter .filter-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });

            // Filter associates
            let filteredAssociates = associates;
            if (filter === 'independent') {
                filteredAssociates = associates.filter(a => a.supportMode === 'independent');
            } else if (filter === 'supported') {
                filteredAssociates = associates.filter(a => a.supportMode === 'supported');
            } else if (filter === 'highCapacity') {
                filteredAssociates = associates.filter(a => (a.clients / a.maxCapacity) >= 0.8);
            }

            // Update stats
            updateAssociateStats();

            if (filteredAssociates.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--eden-text-secondary)" stroke-width="1.5" style="margin-bottom: 16px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <p style="color: var(--eden-text-secondary);">No associates match this filter</p>
                    </div>
                `;
                return;
            }

            // Use animated card list with StatusCard component
            grid.className = 'animated-card-list';
            grid.innerHTML = filteredAssociates.map((associate, index) => {
                const capacityPercent = Math.round((associate.clients / associate.maxCapacity) * 100);
                const status = associate.supportMode;
                const statusLabel = associate.supportMode === 'independent' ? 'Independent' : 'Supported';
                const pulseColour = capacityPercent > 80 ? 'amber' : 'green';

                return renderStatusCard({
                    reference: associate.id,
                    status: status,
                    statusLabel: statusLabel,
                    title: associate.name,
                    preview: `${associate.specialisation}  ${associate.clients}/${associate.maxCapacity} clients`,
                    meta: [associate.specialisation, associate.pendingPayout],
                    pulseColour: pulseColour,
                    onClick: `openAssociateDetailPanel('${associate.id}')`,
                    dataId: associate.id,
                    showKebabMenu: false
                });
            }).join('');

            // Apply staggered animation
            applyCardAnimation(grid);
        }

        function updateAssociateStats() {
            const total = associates.length;
            const independent = associates.filter(a => a.supportMode === 'independent').length;
            const supported = associates.filter(a => a.supportMode === 'supported').length;
            const highCapacity = associates.filter(a => (a.clients / a.maxCapacity) >= 0.8).length;

            const totalEl = document.getElementById('totalAssociatesCount');
            const independentEl = document.getElementById('activeAssociatesCount');
            const supportedEl = document.getElementById('supportedAssociatesCount');
            const highCapacityEl = document.getElementById('highCapacityCount');

            if (totalEl) totalEl.textContent = total;
            if (independentEl) independentEl.textContent = independent;
            if (supportedEl) supportedEl.textContent = supported;
            if (highCapacityEl) {
                highCapacityEl.textContent = highCapacity;
                // Add warning color if high capacity count > 0
                highCapacityEl.className = 'summary-stat-value' + (highCapacity > 0 ? ' warning' : '');
            }

            // Update subtitle
            const subtitle = document.getElementById('associatesSubtitle');
            if (subtitle) {
                subtitle.textContent = `${total} associates across the practice`;
            }
        }

        function filterAssociates(filter) {
            renderCards(filter);
        }

        function getAssociateClients(associateId) {
            return clients.filter(c => c.associateId === associateId);
        }

        function renderClientMiniCards(associateId, filter = 'all') {
            const associateClients = getAssociateClients(associateId);
            const filteredClients = filter === 'all'
                ? associateClients
                : associateClients.filter(c => c.stage === filter);

            const grid = document.getElementById('clientMiniGrid');
            if (!grid) return;

            if (filteredClients.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-title">No clients in this stage</div>
                        <div class="empty-state-text">Select a different filter to see clients</div>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredClients.map(client => `
                <div class="client-mini-card" onclick="openClientPanel('${client.id}')">
                    <div class="client-mini-header">
                        <div class="client-mini-avatar">${client.initials}</div>
                        <div>
                            <div class="client-mini-name">${client.name}</div>
                            <div class="client-mini-id">${client.id}</div>
                        </div>
                    </div>
                    <span class="client-mini-stage ${client.stage}">${client.stage.charAt(0).toUpperCase() + client.stage.slice(1)}</span>
                </div>
            `).join('');
        }

        function updatePipelineCounts(associateId) {
            const associateClients = getAssociateClients(associateId);

            const counts = {
                all: associateClients.length,
                awaiting: associateClients.filter(c => c.stage === 'awaiting').length,
                pending: associateClients.filter(c => c.stage === 'pending').length,
                active: associateClients.filter(c => c.stage === 'active').length,
                ending: associateClients.filter(c => c.stage === 'ending').length
            };

            // Update count badges
            const countAll = document.getElementById('countAll');
            const countAwaiting = document.getElementById('countAwaiting');
            const countPending = document.getElementById('countPending');
            const countActive = document.getElementById('countActive');
            const countEnding = document.getElementById('countEnding');

            if (countAll) countAll.textContent = counts.all;
            if (countAwaiting) countAwaiting.textContent = counts.awaiting;
            if (countPending) countPending.textContent = counts.pending;
            if (countActive) countActive.textContent = counts.active;
            if (countEnding) countEnding.textContent = counts.ending;
        }

        function filterClients(stage) {
            currentPipelineFilter = stage;

            // Update active state on pipeline buttons
            document.querySelectorAll('.pipeline-stage').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.stage === stage) {
                    btn.classList.add('active');
                }
            });

            // Re-render client cards with filter
            if (selectedAssociate) {
                renderClientMiniCards(selectedAssociate.id, stage);
            }
        }

        // ============================================
        // CLIENT PANEL FUNCTIONS
        // ============================================

        function openClientPanel(clientId) {
            // Use full page navigation instead of panel
            showClientDetail(clientId, 'associateDetail');
        }

        function closeClientPanel() {
            // Redirect to new full-page navigation close function
            selectedClient = null;
            closeClientDetail();
        }

        function updateClientPanelContent(client, associate) {
            // DEPRECATED: Client panels have been replaced with full-page clientDetailView
            // This function is kept for backwards compatibility but does nothing
            console.log('updateClientPanelContent deprecated - using full-page clientDetailView');
        }

        function updateClientSessionsTab(client, associate) {
            // DEPRECATED: Client panels have been replaced with full-page clientDetailView
            // This function is kept for backwards compatibility but does nothing
            console.log('updateClientSessionsTab deprecated - using full-page clientDetailView');
        }

        // ============================================
        // INBOX MESSAGE FUNCTIONS
        // ============================================

        const messages = [
            {
                id: 'MSG-001',
                subject: 'Insurance Renewal Reminder',
                preview: 'Your professional indemnity insurance certificate is due for renewal...',
                from: 'Eden Practice Admin',
                date: '2 days ago',
                unread: true,
                body: `<p>Dear Associate,</p>
                       <p>This is a friendly reminder that your professional indemnity insurance certificate is due for renewal in the next 14 days.</p>
                       <p>Please ensure you upload your renewed certificate to the system before the expiry date to maintain your active status.</p>
                       <p>If you have any questions about insurance requirements, please don't hesitate to reach out.</p>
                       <p>Best regards,<br>Eden Practice Team</p>`
            },
            {
                id: 'MSG-002',
                subject: 'Payout Processed - December 2025',
                preview: 'Your December payout of 7,850 has been processed and will arrive...',
                from: 'Eden Finance',
                date: '1 week ago',
                unread: false,
                body: `<p>Dear Associate,</p>
                       <p>Your December 2025 payout has been processed:</p>
                       <p><strong>Total Amount: 7,850.00</strong></p>
                       <p>This payment covers 47 sessions at your agreed fee split. The funds will arrive in your account within 2-3 business days.</p>
                       <p>You can view the full breakdown in your Earnings dashboard.</p>
                       <p>Best regards,<br>Eden Finance Team</p>`
            },
            {
                id: 'MSG-003',
                subject: 'CPD Workshop Invitation: Trauma-Informed Practice',
                preview: "You're invited to our upcoming workshop on trauma-informed approaches...",
                from: 'Eden CPD',
                date: '2 weeks ago',
                unread: false,
                body: `<p>Dear Associate,</p>
                       <p>We're pleased to invite you to our upcoming CPD workshop:</p>
                       <p><strong>Trauma-Informed Practice in Therapeutic Settings</strong></p>
                       <p>Date: Saturday, 25th January 2026<br>Time: 10:00 AM - 4:00 PM<br>Location: Eden Practice HQ, London</p>
                       <p>This workshop counts towards 6 CPD hours and is free for all associates.</p>
                       <p>Best regards,<br>Eden CPD Team</p>`
            },
            {
                id: 'MSG-004',
                subject: 'New Client Referral',
                preview: 'A new client has been referred to you. Please review their intake form...',
                from: 'Eden Referrals',
                date: '3 days ago',
                unread: true,
                body: `<p>Dear Associate,</p>
                       <p>A new client has been referred to your caseload:</p>
                       <p><strong>Client Reference: CLIENT-2521</strong></p>
                       <p>The client is seeking couples therapy and has indicated availability on Tuesday and Thursday evenings.</p>
                       <p>Please review their intake form and reach out within 48 hours to arrange an initial consultation.</p>
                       <p>Best regards,<br>Eden Referrals Team</p>`
            }
        ];

        let currentMessage = null;

        function renderInboxMessages() {
            const container = document.getElementById('inboxMessages');
            if (!container) return;

            container.innerHTML = messages.map(msg => `
                <div class="message-item ${msg.unread ? 'unread' : ''}" onclick="openMessage('${msg.id}')" style="position: relative;">
                    <div class="message-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <div class="message-subject">${msg.subject}</div>
                        <div class="message-preview">${msg.preview}</div>
                    </div>
                    <div class="message-date">${msg.date}</div>
                </div>
            `).join('');
        }

        function openMessage(messageId) {
            const message = messages.find(m => m.id === messageId);
            if (!message) return;

            currentMessage = message;

            // Mark as read
            message.unread = false;
            renderInboxMessages();

            // Populate viewer
            document.getElementById('messageViewerSubject').textContent = message.subject;
            document.getElementById('messageViewerFrom').textContent = `From: ${message.from}`;
            document.getElementById('messageViewerDate').textContent = message.date;
            document.getElementById('messageViewerBody').innerHTML = message.body;

            // Open viewer
            document.getElementById('messageViewer').classList.add('open');
        }

        function closeMessageViewer() {
            document.getElementById('messageViewer').classList.remove('open');
            currentMessage = null;
        }

        function archiveMessage() {
            if (!currentMessage) return;

            // Remove from messages array
            const index = messages.findIndex(m => m.id === currentMessage.id);
            if (index > -1) {
                messages.splice(index, 1);
            }

            closeMessageViewer();
            renderInboxMessages();
            showToast('Message archived');
        }

        function replyToMessage() {
            if (!currentMessage) return;
            showToast(`Replying to: ${currentMessage.subject}`);
            closeMessageViewer();
        }

        function composeMessage() {
            showToast('Compose message coming soon');
        }

        // ============================================
        // PANEL NAVIGATION STACK FUNCTIONS
        // ============================================

        // Get view title for navigation header
        function getPanelViewTitle(viewName) {
            const titles = {
                'overview': 'Overview',
                'inbox': 'Inbox',
                'capacity': 'Capacity',
                'payout-cockpit': 'Payout Cockpit',
                'sessions': 'Sessions',
                'contracts': 'Contracts',
                'finance': 'Finance'
            };
            if (viewName.startsWith('email-')) return 'Email';
            return titles[viewName] || viewName;
        }

        // Update panel UI based on navigation state
        function updatePanelNavigationUI() {
            console.log('=== updatePanelNavigationUI called ===');
            console.log('panelNavigationStack:', panelNavigationStack);

            const currentView = panelNavigationStack[panelNavigationStack.length - 1];
            const isAtRoot = panelNavigationStack.length === 1 && currentView === 'overview';
            const isInSubView = ['inbox', 'capacity', 'payout-cockpit'].includes(currentView) || currentView.startsWith('email-');

            console.log('currentView:', currentView);
            console.log('isInSubView:', isInSubView);

            // Toggle headers
            const desktopStandardHeader = document.getElementById('desktopStandardHeader');
            const desktopNavHeader = document.getElementById('desktopNavHeader');
            const mobileStandardHeader = document.getElementById('mobileStandardHeader');
            const mobileNavHeader = document.getElementById('mobileNavHeader');

            if (isInSubView) {
                // Show navigation header with back button
                if (desktopStandardHeader) desktopStandardHeader.style.display = 'none';
                if (desktopNavHeader) desktopNavHeader.style.display = 'flex';
                if (mobileStandardHeader) mobileStandardHeader.style.display = 'none';
                if (mobileNavHeader) mobileNavHeader.style.display = 'flex';

                // Update title
                const title = getPanelViewTitle(currentView);
                const subtitle = selectedAssociate ? selectedAssociate.name.split(' ')[0] + ' ' + selectedAssociate.name.split(' ')[1]?.charAt(0) + '.' : '';

                if (document.getElementById('desktopNavTitle')) document.getElementById('desktopNavTitle').textContent = title;
                if (document.getElementById('desktopNavSubtitle')) document.getElementById('desktopNavSubtitle').textContent = subtitle;
                if (document.getElementById('mobileNavTitle')) document.getElementById('mobileNavTitle').textContent = title;
                if (document.getElementById('mobileNavSubtitle')) document.getElementById('mobileNavSubtitle').textContent = subtitle;
            } else {
                // Show standard header
                if (desktopStandardHeader) desktopStandardHeader.style.display = 'flex';
                if (desktopNavHeader) desktopNavHeader.style.display = 'none';
                if (mobileStandardHeader) mobileStandardHeader.style.display = 'flex';
                if (mobileNavHeader) mobileNavHeader.style.display = 'none';
            }

            // Toggle tab navigation visibility
            const desktopTabNav = document.getElementById('desktopTabNav');
            const mobileTabNav = document.getElementById('mobileTabNav');

            if (isInSubView) {
                if (desktopTabNav) desktopTabNav.style.display = 'none';
                if (mobileTabNav) mobileTabNav.style.display = 'none';
            } else {
                if (desktopTabNav) desktopTabNav.style.display = 'flex';
                if (mobileTabNav) mobileTabNav.style.display = 'flex';
            }

            // Show/hide views and tabs - handle both desktop and mobile
            const container = isMobile
                ? document.getElementById('mobileTabContent')
                : document.getElementById('tabContent');

            if (!container) {
                console.error('Tab content container not found');
                return;
            }

            const allViews = container.querySelectorAll('.panel-view');
            const overviewPanel = container.querySelector('[data-panel="overview"]');
            const allTabPanels = container.querySelectorAll('.tab-panel');

            console.log('Container:', isMobile ? 'mobile' : 'desktop');
            console.log('Found views:', allViews.length);

            // Hide all views first
            allViews.forEach(view => view.style.display = 'none');

            if (isInSubView) {
                // Hide overview and tab content, show the pushed view
                if (overviewPanel) overviewPanel.classList.remove('active');
                allTabPanels.forEach(panel => panel.classList.remove('active'));

                // Find and show the current view within the correct container
                let viewToShow = null;
                console.log('Looking for view:', currentView);

                if (currentView === 'inbox') {
                    viewToShow = container.querySelector('[data-view="inbox"]');
                    console.log('Found inboxView:', viewToShow);
                    if (viewToShow) populateInboxView(container);
                } else if (currentView === 'capacity') {
                    viewToShow = container.querySelector('[data-view="capacity"]');
                    console.log('Found capacityView:', viewToShow);
                    if (viewToShow) populateCapacityView(container);
                } else if (currentView === 'payout-cockpit') {
                    viewToShow = container.querySelector('[data-view="payout-cockpit"]');
                    console.log('Found payoutCockpitView:', viewToShow);
                    if (viewToShow) populatePayoutCockpitView(container);
                } else if (currentView.startsWith('email-')) {
                    viewToShow = container.querySelector('[data-view="email-detail"]');
                    console.log('Found emailDetailView:', viewToShow);
                    if (viewToShow) populateEmailDetail(currentView, container);
                }

                if (viewToShow) {
                    viewToShow.style.display = 'block';
                    console.log('View displayed, innerHTML length:', viewToShow.innerHTML.length);
                } else {
                    console.error('VIEW NOT FOUND:', currentView);
                }
            } else {
                // Show overview and restore active tab
                if (overviewPanel) overviewPanel.classList.add('active');

                // Also show the active tab panel
                allTabPanels.forEach(panel => {
                    if (panel.dataset.panel === activePanelTab) {
                        panel.classList.add('active');
                    }
                });
            }
        }

        // Navigate to a view (push onto stack)
        function navigatePanelTo(viewName) {
            panelNavigationStack.push(viewName);
            updatePanelNavigationUI();
        }

        // Navigate back (pop from stack)
        function navigatePanelBack() {
            console.log('=== navigatePanelBack called ===');
            console.log('Stack before pop:', [...panelNavigationStack]);
            if (panelNavigationStack.length > 1) {
                panelNavigationStack.pop();
                console.log('Stack after pop:', [...panelNavigationStack]);
                updatePanelNavigationUI();
            } else {
                console.log('Cannot go back - already at root');
            }
        }

        // Switch tab (replaces navigation to overview + tab)
        function switchPanelTab(tabName) {
            // Reset stack to overview
            panelNavigationStack = ['overview'];
            activePanelTab = tabName;

            // Update tab buttons
            const tabButtons = document.querySelectorAll('.side-panel .tab-btn, .bottom-sheet .tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) btn.classList.add('active');
            });

            // Update tab panels
            const tabPanels = document.querySelectorAll('.side-panel .tab-panel, .bottom-sheet .tab-panel');
            tabPanels.forEach(panel => {
                panel.classList.remove('active');
                if (panel.dataset.panel === tabName) panel.classList.add('active');
            });

            // Also ensure overview is visible (since tabs appear below overview content)
            const overviewPanel = document.getElementById('overviewPanel');
            if (overviewPanel) overviewPanel.classList.add('active');

            updatePanelNavigationUI();
        }

        // Reset navigation when panel closes
        function resetPanelNavigation() {
            panelNavigationStack = ['overview'];
            activePanelTab = 'profile';
            updatePanelNavigationUI();
        }

        // Populate email detail (mock data)
        function populateEmailDetail(emailId, parentContainer) {
            const mockEmails = {
                'email-1': {
                    subject: 'Session confirmation for Friday',
                    from: 'sarah.j@email.com',
                    date: 'January 11, 2026 at 10:30 AM',
                    body: 'Hi Marcus,\n\nJust confirming our session this Friday at 3pm.\n\nLooking forward to it.\n\nBest regards,\nSarah'
                },
                'email-2': {
                    subject: 'Need to reschedule next week',
                    from: 'david.m@email.com',
                    date: 'January 10, 2026 at 2:15 PM',
                    body: 'Hi Marcus,\n\nI have a conflict next Tuesday. Can we move to Wednesday same time?\n\nThanks,\nDavid'
                },
                'email-3': {
                    subject: 'Payment confirmation',
                    from: 'notifications@stripe.com',
                    date: 'January 8, 2026 at 9:00 AM',
                    body: 'Your payment of 85.00 has been processed successfully.\n\nTransaction ID: txn_1234567890\n\nThank you for using Stripe.'
                }
            };

            const email = mockEmails[emailId] || mockEmails['email-1'];

            // Find elements within the correct container
            const view = parentContainer
                ? parentContainer.querySelector('[data-view="email-detail"]')
                : document.getElementById('emailDetailView');

            if (!view) {
                console.error('Email detail view not found');
                return;
            }

            const subjectEl = view.querySelector('.email-detail-subject');
            const fromEl = view.querySelector('.email-detail-meta span:first-child');
            const dateEl = view.querySelector('.email-detail-meta span:last-child');
            const bodyEl = view.querySelector('.email-detail-body');

            if (subjectEl) subjectEl.textContent = email.subject;
            if (fromEl) fromEl.textContent = 'From: ' + email.from;
            if (dateEl) dateEl.textContent = email.date;
            if (bodyEl) bodyEl.textContent = email.body;

            console.log('Email detail populated');
        }

        // Populate Inbox view with mock data
        function populateInboxView(parentContainer) {
            console.log('=== populateInboxView called ===');
            const mockEmails = [
                { id: 'email-1', subject: 'Session confirmation for Friday', from: 'Sarah Johnson', unread: true, date: '2 hours ago' },
                { id: 'email-2', subject: 'Need to reschedule next week', from: 'David Mitchell', unread: true, date: 'Yesterday' },
                { id: 'email-3', subject: 'Payment confirmation', from: 'Stripe', unread: false, date: '3 days ago' }
            ];

            const container = parentContainer
                ? parentContainer.querySelector('.inbox-messages-list')
                : document.getElementById('inboxMessagesList');

            console.log('inboxMessagesList container:', container);
            if (!container) {
                console.error('inboxMessagesList container NOT FOUND');
                return;
            }

            container.innerHTML = mockEmails.map(email => `
                <div class="inbox-message-item ${email.unread ? 'unread' : ''}" onclick="navigatePanelTo('${email.id}')">
                    ${email.unread ? '<div class="inbox-message-unread-dot"></div>' : ''}
                    <div class="inbox-message-content" ${!email.unread ? 'style="margin-left: 20px;"' : ''}>
                        <div class="inbox-message-subject">${email.subject}</div>
                        <div class="inbox-message-from">${email.from}</div>
                    </div>
                    <div class="inbox-message-date">${email.date}</div>
                </div>
            `).join('');
            console.log('Inbox populated, container innerHTML length:', container.innerHTML.length);
        }

        // Populate Capacity view with mock/associate data
        function populateCapacityView(parentContainer) {
            console.log('=== populateCapacityView called ===');
            console.log('selectedAssociate:', selectedAssociate);
            if (!selectedAssociate) {
                console.error('No selectedAssociate - cannot populate capacity view');
                return;
            }

            const capacityPercent = selectedAssociate.maxCapacity
                ? Math.round((selectedAssociate.clients / selectedAssociate.maxCapacity) * 100)
                : 75;
            const hoursBooked = Math.round(capacityPercent * 0.4); // Mock calculation
            const hoursAvailable = 40;

            // Find elements within the correct container
            const view = parentContainer
                ? parentContainer.querySelector('[data-view="capacity"]')
                : document.getElementById('capacityView');

            if (!view) {
                console.error('Capacity view not found');
                return;
            }

            const gaugeValue = view.querySelector('.capacity-gauge-value');
            const progressFill = view.querySelector('.capacity-progress-fill');
            const hoursBookedEl = view.querySelector('#hoursBooked') || view.querySelectorAll('.capacity-stat-value')[0];
            const hoursAvailableEl = view.querySelector('#hoursAvailable') || view.querySelectorAll('.capacity-stat-value')[1];
            const nextSlotEl = view.querySelector('.capacity-next-slot-value');

            if (gaugeValue) gaugeValue.textContent = capacityPercent + '%';
            if (progressFill) progressFill.style.width = capacityPercent + '%';
            if (hoursBookedEl) hoursBookedEl.textContent = hoursBooked;
            if (hoursAvailableEl) hoursAvailableEl.textContent = hoursAvailable;
            if (nextSlotEl) nextSlotEl.textContent = 'Tomorrow 2:00 PM';

            console.log('Capacity view populated');
        }

        // Populate Payout Cockpit view with mock/associate data
        function populatePayoutCockpitView(parentContainer) {
            console.log('=== populatePayoutCockpitView called ===');
            console.log('selectedAssociate:', selectedAssociate);
            if (!selectedAssociate) {
                console.error('No selectedAssociate - cannot populate payout view');
                return;
            }

            // Find view within the correct container
            const view = parentContainer
                ? parentContainer.querySelector('[data-view="payout-cockpit"]')
                : document.getElementById('payoutCockpitView');

            if (!view) {
                console.error('Payout cockpit view not found');
                return;
            }

            // Get real data from sessions using helper functions
            const earnings = calculateAssociateEarnings(selectedAssociate.id);
            const associatePayouts = getPayoutsForAssociate(selectedAssociate.id);
            const readySessions = getSessionsByPayoutStatus('Ready for Payout', selectedAssociate.id);
            const awaitingSessions = getSessionsByPaymentStatus('Awaiting Payment', selectedAssociate.id);

            // Calculate progress percentage (paid out vs total earned)
            const totalEarned = earnings.paidOutTotal + earnings.readyForPayoutTotal;
            const progressPercent = totalEarned > 0 ? (earnings.paidOutTotal / totalEarned) * 100 : 0;

            // Update Earnings Hero
            const heroValue = view.querySelector('#earningsHeroValue');
            const heroSubtitle = view.querySelector('#earningsHeroSubtitle');
            const progressFill = view.querySelector('#earningsProgressFill');
            const progressPaid = view.querySelector('#earningsProgressPaid');
            const progressPending = view.querySelector('#earningsProgressPending');

            if (heroValue) heroValue.textContent = '' + earnings.associateShare.toFixed(2);
            if (heroSubtitle) heroSubtitle.textContent = `Your 69% share from ${earnings.completedSessions} sessions`;
            if (progressFill) progressFill.style.width = progressPercent.toFixed(0) + '%';
            if (progressPaid) progressPaid.textContent = '' + earnings.paidOutTotal.toFixed(2) + ' paid out';
            if (progressPending) progressPending.textContent = '' + earnings.readyForPayoutTotal.toFixed(2) + ' ready';

            // Update Earnings Breakdown Cards
            const awaitingValue = view.querySelector('#awaitingPaymentValue');
            const awaitingCount = view.querySelector('#awaitingPaymentCount');
            const readyValue = view.querySelector('#readyForPayoutValue');
            const readyCount = view.querySelector('#readyForPayoutCount');
            const paidValue = view.querySelector('#paidOutValue');
            const paidCount = view.querySelector('#paidOutCount');

            if (awaitingValue) awaitingValue.textContent = '' + (earnings.awaitingPaymentTotal * 0.69).toFixed(2);
            if (awaitingCount) awaitingCount.textContent = earnings.awaitingPaymentCount + ' sessions';
            if (readyValue) readyValue.textContent = '' + earnings.readyForPayoutTotal.toFixed(2);
            if (readyCount) readyCount.textContent = earnings.readyForPayoutCount + ' sessions';
            if (paidValue) paidValue.textContent = '' + earnings.paidOutTotal.toFixed(2);
            if (paidCount) paidCount.textContent = earnings.paidOutCount + ' sessions';

            // Render Sessions Ready for Payout
            const readySessionsList = view.querySelector('#readySessionsList');
            if (readySessionsList) {
                if (readySessions.length === 0) {
                    readySessionsList.innerHTML = '<p style="color: var(--eden-text-secondary); font-size: 13px; padding: 8px 0;">No sessions ready for payout</p>';
                } else {
                    readySessionsList.innerHTML = readySessions.map(session => `
                        <div class="session-item">
                            <div class="session-status-dot ready"></div>
                            <div class="session-item-info">
                                <div class="session-item-date">${formatSessionDate(session.sessionDate)} at ${session.sessionTime}</div>
                                <div class="session-item-client">${session.clientName}  ${session.sessionType}</div>
                            </div>
                            <div class="session-item-amounts">
                                <div class="session-item-rate">${session.rate}</div>
                                <div class="session-item-share">${(session.rate * 0.69).toFixed(2)} to you</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            // Render Sessions Awaiting Payment
            const awaitingSessionsList = view.querySelector('#awaitingSessionsList');
            if (awaitingSessionsList) {
                if (awaitingSessions.length === 0) {
                    awaitingSessionsList.innerHTML = '<p style="color: var(--eden-text-secondary); font-size: 13px; padding: 8px 0;">No sessions awaiting payment</p>';
                } else {
                    awaitingSessionsList.innerHTML = awaitingSessions.map(session => `
                        <div class="session-item">
                            <div class="session-status-dot awaiting"></div>
                            <div class="session-item-info">
                                <div class="session-item-date">${formatSessionDate(session.sessionDate)} at ${session.sessionTime}</div>
                                <div class="session-item-client">${session.clientName}  ${session.sessionType}</div>
                            </div>
                            <div class="session-item-amounts">
                                <div class="session-item-rate">${session.rate}</div>
                                <div class="session-item-share">Pending payment</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            // Render Payout History
            const historyContainer = view.querySelector('.payout-history-list');
            if (historyContainer) {
                if (associatePayouts.length === 0) {
                    historyContainer.innerHTML = '<p style="color: var(--eden-text-secondary); font-size: 13px;">No payout history yet</p>';
                } else {
                    historyContainer.innerHTML = associatePayouts.map(payout => `
                        <div class="payout-history-card">
                            <div class="payout-history-header">
                                <span class="payout-history-period">${formatPayoutPeriod(payout.periodStart, payout.periodEnd)}</span>
                                <span class="payout-history-status ${payout.status.toLowerCase()}">${payout.status}</span>
                            </div>
                            <div class="payout-history-row">
                                <span class="payout-history-sessions">${payout.sessionCount} sessions</span>
                                <span class="payout-history-amount">${payout.associateAmount.toFixed(2)}</span>
                            </div>
                            ${payout.paidDate ? `<div class="payout-history-paid-date">Paid ${formatPayoutDate(payout.paidDate)}</div>` : ''}
                        </div>
                    `).join('');
                }
            }

            console.log('Payout cockpit populated with real session data');
        }

        // Helper function to format session date
        function formatSessionDate(dateStr) {
            const date = new Date(dateStr);
            const options = { weekday: 'short', day: 'numeric', month: 'short' };
            return date.toLocaleDateString('en-GB', options);
        }

        // Helper function to format payout period
        function formatPayoutPeriod(start, end) {
            const startDate = new Date(start);
            const endDate = new Date(end);
            const startDay = startDate.getDate();
            const endDay = endDate.getDate();
            const month = startDate.toLocaleDateString('en-GB', { month: 'long' });
            const year = startDate.getFullYear();
            return `${startDay}-${endDay} ${month} ${year}`;
        }

        // Helper function to format payout date
        function formatPayoutDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        }

        // Toggle collapsible section
        function toggleCollapsible(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.toggle('open');
            }
        }

        // Legacy function - kept for backwards compatibility
        function switchToTab(tabName) {
            switchPanelTab(tabName);
        }

        function viewAssociateClients() {
            // Deprecated - clients tab removed
            showToast('View clients from the main Clients page');
        }

        function openAssociatePayouts() {
            // Close associate panel and open Payout Cockpit
            if (!selectedAssociate) return;

            closePanel();
            showView('earnings');

            setTimeout(() => {
                openWealthModule('payouts');
                // Store reference to associate for back navigation
                window.payoutSourceAssociate = selectedAssociate;
                showToast(`Viewing payouts for ${selectedAssociate.name}`);
            }, 300);
        }

        function updateNeedsAttention(associate) {
            const section = document.getElementById('needsAttentionSection');
            const container = document.getElementById('needsAttentionItems');

            if (!section || !container) return;

            // Mock alerts based on associate data
            const alerts = [];

            // Check for pending payout
            if (associate.pendingPayout && associate.pendingPayout !== '0') {
                alerts.push({
                    type: 'warning',
                    message: `${associate.pendingPayout} payout pending approval`,
                    tab: 'finance'
                });
            }

            // Random chance of contract expiring alert (mock)
            if (Math.random() > 0.6) {
                alerts.push({
                    type: 'warning',
                    message: 'Contract expires in 23 days',
                    tab: 'contracts'
                });
            }

            if (alerts.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = alerts.map(alert => `
                <div class="attention-item" onclick="switchToTab('${alert.tab}')">
                    <div class="attention-icon ${alert.type}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                    </div>
                    <span class="attention-text">${alert.message}</span>
                    <svg class="attention-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="m9 18 6-6-6-6"/>
                    </svg>
                </div>
            `).join('');
        }

        function viewClientAssociate(associateId) {
            // Close client panel and show associate detail page
            closeClientPanelDirect();
            showAssociateDetail(associateId);
        }

        function openAssociatePanelFromClient(associateId) {
            // Navigate to associate detail page
            // Used when clicking therapist name in Clients Grid
            showAssociateDetail(associateId);
        }

        function openAssociateFromPayout(associateId) {
            // Close payout cockpit and show associate detail page
            // Used when clicking associate name in Payout Cockpit
            closeWealthModule();
            showAssociateDetail(associateId);
        }

        function updateClientPipelineUI(currentStage) {
            // DEPRECATED: Client panels have been replaced with full-page clientDetailView
            // This function is kept for backwards compatibility but does nothing
        }

        function updateClientStage(newStage) {
            // DEPRECATED: Now handled by updateClientDetailStage in clientDetailView
            if (!selectedClient) return;

            // Update the client's stage in mock data
            const clientIndex = clients.findIndex(c => c.id === selectedClient.id);
            if (clientIndex !== -1) {
                clients[clientIndex].stage = newStage;
                selectedClient.stage = newStage;
            }

            // Re-render the client mini cards in associate panel to reflect change
            if (selectedAssociate) {
                updatePipelineCounts(selectedAssociate.id);
                renderClientMiniCards(selectedAssociate.id, currentPipelineFilter);
            }
        }

        function initClientPanelTabs() {
            // DEPRECATED: Client panels have been replaced with full-page clientDetailView
            // This function is kept for backwards compatibility but does nothing
        }

        function updatePanelContent(associate) {
            // Desktop panel
            document.getElementById('panelAvatar').textContent = associate.initials;
            document.getElementById('panelName').textContent = associate.name;
            document.getElementById('panelUcid').textContent = associate.id;

            // Mobile panel
            document.getElementById('mobileAvatar').textContent = associate.initials;
            document.getElementById('mobilePanelName').textContent = associate.name;
            document.getElementById('mobilePanelUcid').textContent = associate.id;

            // Overview tab - Profile section
            document.getElementById('contactEmail').textContent = associate.email;
            document.getElementById('contactPhone').textContent = associate.phone;
            document.getElementById('joinDate').textContent = associate.joinDate;
            document.getElementById('specialisation').textContent = associate.specialisation;

            // Overview tab - Support Mode and Fee Split
            const supportModeEl = document.getElementById('supportModeValue');
            if (supportModeEl) {
                supportModeEl.textContent = associate.supportMode === 'independent' ? 'Independent' : 'Supported';
            }
            const feeSplitEl = document.getElementById('feeSplitValue');
            if (feeSplitEl) {
                feeSplitEl.textContent = associate.supportMode === 'independent' ? '70/30' : '60/40';
            }

            // Overview tab - This Month stats (new: Inbox, Capacity, Earnings)
            const unreadCount = Math.floor(Math.random() * 5); // Mock unread inbox count
            const capacityPercent = associate.maxCapacity ? Math.round((associate.clients / associate.maxCapacity) * 100) : 75;
            const earningsAmount = associate.totalEarnings || '0';

            const overviewInboxEl = document.getElementById('overviewInbox');
            const overviewCapacityEl = document.getElementById('overviewCapacity');
            const overviewEarningsEl = document.getElementById('overviewEarnings');

            if (overviewInboxEl) overviewInboxEl.textContent = unreadCount;
            if (overviewCapacityEl) overviewCapacityEl.textContent = capacityPercent + '%';
            if (overviewEarningsEl) overviewEarningsEl.textContent = earningsAmount;

            // Update Capacity View values
            const capacityGaugeValue = document.getElementById('capacityGaugeValue');
            const capacityProgressFill = document.getElementById('capacityProgressFill');
            if (capacityGaugeValue) capacityGaugeValue.textContent = capacityPercent + '%';
            if (capacityProgressFill) capacityProgressFill.style.width = capacityPercent + '%';

            // Overview tab - Status badge
            const statusBadgeEl = document.getElementById('associateStatusBadge');
            if (statusBadgeEl) {
                statusBadgeEl.textContent = 'Active';
                statusBadgeEl.className = 'status-badge-inline active';
            }

            // Overview tab - Needs Attention section (mock alerts)
            updateNeedsAttention(associate);

            // Finance
            document.getElementById('totalEarnings').textContent = associate.totalEarnings;
            document.getElementById('pendingPayout').textContent = associate.pendingPayout;

            // Render client mini cards and update pipeline counts
            currentPipelineFilter = 'all'; // Reset filter when switching associates
            updatePipelineCounts(associate.id);
            renderClientMiniCards(associate.id, 'all');

            // Reset pipeline buttons to 'all'
            document.querySelectorAll('.pipeline-stage').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.stage === 'all') btn.classList.add('active');
            });

            // Clone content to mobile
            const desktopContent = document.getElementById('tabContent').innerHTML;
            document.getElementById('mobileTabContent').innerHTML = desktopContent;

            // Re-attach mobile tab functionality
            attachMobileTabListeners();
        }

        // ============================================
        // PANEL FUNCTIONS
        // ============================================

        // Saved scroll position for panel scroll lock
        let savedPanelScrollPosition = 0;

        function openPanel(associateId) {
            selectedAssociate = associates.find(a => a.id === associateId);
            if (!selectedAssociate) return;

            // Reset navigation stack and update content
            resetPanelNavigation();
            updatePanelContent(selectedAssociate);

            if (isMobile) {
                // Save scroll position and lock body scroll (Bug Fix 1)
                savedPanelScrollPosition = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${savedPanelScrollPosition}px`;
                document.body.style.left = '0';
                document.body.style.right = '0';
                document.body.style.overflow = 'hidden';

                const bottomSheet = document.getElementById('bottomSheet');
                bottomSheet.style.transition = 'transform var(--transition-smooth)';
                bottomSheet.style.transform = 'translateY(0)';
                bottomSheet.classList.add('open');
                document.getElementById('bottomSheetOverlay').classList.add('open');
            } else {
                document.getElementById('sidePanel').classList.add('open');
                document.getElementById('mainContent').classList.add('panel-open');
            }
        }

        function closePanel() {
            if (isMobile) {
                const bottomSheet = document.getElementById('bottomSheet');
                bottomSheet.style.transition = 'transform var(--transition-smooth)';
                bottomSheet.style.transform = 'translateY(100%)';
                bottomSheet.classList.remove('open');
                document.getElementById('bottomSheetOverlay').classList.remove('open');

                // Restore scroll position (Bug Fix 1)
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.left = '';
                document.body.style.right = '';
                document.body.style.overflow = '';
                window.scrollTo(0, savedPanelScrollPosition);
            } else {
                document.getElementById('sidePanel').classList.remove('open');
                document.getElementById('mainContent').classList.remove('panel-open');
            }

            // Reset navigation stack
            resetPanelNavigation();

            // Reset overview section to expanded state
            resetOverviewSection();

            // Reset tabs to Profile (default) and show overview
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === 'profile') btn.classList.add('active');
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
                if (panel.dataset.panel === 'overview' || panel.dataset.panel === 'profile') panel.classList.add('active');
            });
        }

        // Toggle the Overview section (Needs Attention + This Month stats)
        // Works for both desktop and mobile panels (handles cloned content)
        function toggleOverviewSection() {
            // Get all overview headers (desktop and mobile have cloned content)
            const headers = document.querySelectorAll('.overview-header');
            const collapsibles = document.querySelectorAll('.overview-collapsible');
            const dividers = document.querySelectorAll('.overview-divider');

            if (headers.length === 0 || collapsibles.length === 0) return;

            // Check the first header's state to determine toggle direction
            const isExpanded = !headers[0].classList.contains('collapsed');

            headers.forEach(header => {
                if (isExpanded) {
                    header.classList.add('collapsed');
                    header.setAttribute('aria-expanded', 'false');
                } else {
                    header.classList.remove('collapsed');
                    header.setAttribute('aria-expanded', 'true');
                }
            });

            collapsibles.forEach(collapsible => {
                if (isExpanded) {
                    collapsible.classList.add('collapsed');
                } else {
                    collapsible.classList.remove('collapsed');
                }
            });

            dividers.forEach(divider => {
                if (isExpanded) {
                    divider.style.display = 'none';
                } else {
                    divider.style.display = '';
                }
            });
        }

        // Reset overview section to expanded state (called on panel close)
        function resetOverviewSection() {
            const headers = document.querySelectorAll('.overview-header');
            const collapsibles = document.querySelectorAll('.overview-collapsible');
            const dividers = document.querySelectorAll('.overview-divider');

            headers.forEach(header => {
                header.classList.remove('collapsed');
                header.setAttribute('aria-expanded', 'true');
            });

            collapsibles.forEach(collapsible => {
                collapsible.classList.remove('collapsed');
            });

            dividers.forEach(divider => {
                divider.style.display = '';
            });
        }

        // ============================================
        // SIDEBAR FUNCTIONS
        // ============================================

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        // ============================================
        // TAB FUNCTIONS
        // ============================================

        function initTabs() {
            document.querySelectorAll('.side-panel .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    // Use switchPanelTab to handle navigation reset and tab switching
                    switchPanelTab(tabName);
                });
            });
        }

        function attachMobileTabListeners() {
            document.querySelectorAll('#bottomSheet .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    // Use switchPanelTab to handle navigation reset and tab switching
                    switchPanelTab(tabName);
                });
            });
        }

        // ============================================
        // NAVIGATION FUNCTIONS
        // ============================================

        function initNavigation() {
            // Prevent default on all nav links
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            });
        }

        // ============================================
        // RESPONSIVE HANDLING
        // ============================================

        function handleResize() {
            const wasOnMobile = isMobile;
            isMobile = window.innerWidth <= 768;

            // Close any open panels when switching between mobile/desktop
            if (wasOnMobile !== isMobile) {
                closePanel();
            }
        }

        // ============================================
        // BOTTOM SHEET SWIPE HANDLING (Bug Fix 2)
        // ============================================

        let touchStartY = 0;
        let touchCurrentY = 0;
        let isDragging = false;
        const SWIPE_THRESHOLD = 100;

        function initBottomSheetSwipe() {
            const handleArea = document.getElementById('bottomSheetHandleArea');
            const standardHeader = document.getElementById('mobileStandardHeader');
            const navHeader = document.getElementById('mobileNavHeader');
            const bottomSheet = document.getElementById('bottomSheet');

            if (!bottomSheet) return;

            // Attach swipe events to handle area, standard header, and nav header
            const swipeTargets = [handleArea, standardHeader, navHeader].filter(el => el);

            swipeTargets.forEach(target => {
                // Touch events
                target.addEventListener('touchstart', handleTouchStart, { passive: true });
                target.addEventListener('touchmove', handleTouchMove, { passive: false });
                target.addEventListener('touchend', handleTouchEnd, { passive: true });

                // Mouse events (for desktop testing)
                target.addEventListener('mousedown', handleMouseDown);
            });

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        function handleTouchStart(e) {
            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet || !bottomSheet.classList.contains('open')) return;

            touchStartY = e.touches[0].clientY;
            touchCurrentY = touchStartY;
            isDragging = true;
            bottomSheet.style.transition = 'none';
        }

        function handleTouchMove(e) {
            if (!isDragging) return;

            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet) return;

            touchCurrentY = e.touches[0].clientY;
            const deltaY = touchCurrentY - touchStartY;

            // Only allow dragging down (positive deltaY)
            if (deltaY > 0) {
                e.preventDefault();
                bottomSheet.style.transform = `translateY(${deltaY}px)`;
            }
        }

        function handleTouchEnd() {
            if (!isDragging) return;
            isDragging = false;

            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet) return;

            bottomSheet.style.transition = 'transform var(--transition-smooth)';

            const deltaY = touchCurrentY - touchStartY;

            // If dragged more than threshold, close the panel
            if (deltaY > SWIPE_THRESHOLD) {
                closePanel();
            } else {
                // Snap back to open position
                bottomSheet.style.transform = 'translateY(0)';
            }

            touchStartY = 0;
            touchCurrentY = 0;
        }

        // Mouse event handlers (for desktop testing)
        function handleMouseDown(e) {
            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet || !bottomSheet.classList.contains('open')) return;

            // Don't trigger drag on buttons
            if (e.target.closest('button')) return;

            touchStartY = e.clientY;
            touchCurrentY = touchStartY;
            isDragging = true;
            bottomSheet.style.transition = 'none';
            e.preventDefault();
        }

        function handleMouseMove(e) {
            if (!isDragging) return;

            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet) return;

            touchCurrentY = e.clientY;
            const deltaY = touchCurrentY - touchStartY;

            if (deltaY > 0) {
                bottomSheet.style.transform = `translateY(${deltaY}px)`;
            }
        }

        function handleMouseUp() {
            if (!isDragging) return;
            isDragging = false;

            const bottomSheet = document.getElementById('bottomSheet');
            if (!bottomSheet) return;

            bottomSheet.style.transition = 'transform var(--transition-smooth)';

            const deltaY = touchCurrentY - touchStartY;

            if (deltaY > SWIPE_THRESHOLD) {
                closePanel();
            } else {
                bottomSheet.style.transform = 'translateY(0)';
            }

            touchStartY = 0;
            touchCurrentY = 0;
        }

        // ============================================
        // FRICTION FEED DATA & FUNCTIONS
        // ============================================

        const frictionItems = [
            {
                id: 'FRI-001',
                type: 'amber',
                category: 'associates',
                icon: 'file-text',
                title: 'Insurance renewal required',
                description: 'Fatima Okafor\'s professional indemnity insurance expires in 14 days',
                associate: 'Fatima Okafor',
                dueDate: '22 Jan 2026',
                action: 'Send Reminder'
            },
            {
                id: 'FRI-002',
                type: 'amber',
                category: 'contracts',
                icon: 'file-signature',
                title: 'Contract pending signature',
                description: 'Amara Mensah has not signed the updated associate agreement',
                associate: 'Amara Mensah',
                dueDate: '15 Jan 2026',
                action: 'Resend Contract'
            },
            {
                id: 'FRI-003',
                type: 'rose',
                category: 'finance',
                icon: 'alert-circle',
                title: 'Overdue invoice #1042',
                description: 'Client payment is 12 days overdue - Emma Stone (CLIENT-2516)',
                client: 'Emma Stone',
                amount: '85',
                action: 'View Invoice'
            },
            {
                id: 'FRI-004',
                type: 'blue',
                category: 'clients',
                icon: 'calendar',
                title: 'Session unconfirmed',
                description: 'Tomorrow\'s 2pm session with Mark & Lisa Harris awaiting confirmation',
                client: 'Mark & Lisa Harris',
                associate: 'Sarah Johnson',
                action: 'Send Reminder'
            }
        ];

        // Action Centre state
        let activeActionFilter = null;

        // Category labels mapping
        const ACTION_CATEGORY_LABELS = {
            associates: 'Associates',
            clients: 'Clients',
            contracts: 'Contracts',
            finance: 'Finance'
        };

        // Count friction items by category
        function countFrictionByCategory() {
            const counts = {
                associates: 0,
                clients: 0,
                contracts: 0,
                finance: 0
            };
            frictionItems.forEach(item => {
                if (counts.hasOwnProperty(item.category)) {
                    counts[item.category]++;
                }
            });
            return counts;
        }

        // Update Action Centre summary cards
        function updateActionSummaryCounts() {
            const counts = countFrictionByCategory();

            // Update each category count and pulse indicator
            Object.keys(counts).forEach(category => {
                const countEl = document.getElementById(
                    category === 'clients' ? 'clientsActionCount' : `${category}Count`
                );
                const pulseEl = document.getElementById(`${category}Pulse`);

                if (countEl) {
                    countEl.textContent = counts[category];
                    countEl.classList.toggle('zero', counts[category] === 0);
                }
                if (pulseEl) {
                    pulseEl.style.display = counts[category] > 0 ? 'block' : 'none';
                }
            });

            // Update mobile bottom nav actions badge
            const totalCount = Object.values(counts).reduce((sum, count) => sum + count, 0);
            if (typeof updateActionsBadge === 'function') {
                updateActionsBadge(totalCount);
            }
        }

        // Filter actions by category
        function filterActionsByCategory(category) {
            const cards = document.querySelectorAll('.action-summary-card');
            const filterIndicator = document.getElementById('actionFilterIndicator');
            const filterLabel = document.getElementById('activeFilterLabel');

            // Toggle filter if same category clicked
            if (activeActionFilter === category) {
                clearActionFilter();
                return;
            }

            activeActionFilter = category;

            // Update card active states
            cards.forEach(card => {
                card.classList.toggle('active', card.dataset.category === category);
            });

            // Show filter indicator
            if (filterIndicator) {
                filterIndicator.style.display = 'flex';
                filterLabel.textContent = ACTION_CATEGORY_LABELS[category] || category;
            }

            // Re-render feed with filter
            renderFrictionFeed(category);
        }

        // Clear action filter
        function clearActionFilter() {
            activeActionFilter = null;

            const cards = document.querySelectorAll('.action-summary-card');
            const filterIndicator = document.getElementById('actionFilterIndicator');

            cards.forEach(card => card.classList.remove('active'));
            if (filterIndicator) filterIndicator.style.display = 'none';

            renderFrictionFeed();
        }

        function renderFrictionFeed(filterCategory = null) {
            const feed = document.getElementById('frictionFeed');
            const allClear = document.getElementById('allClearState');

            if (!feed) return;

            // Apply category filter if provided
            const itemsToRender = filterCategory
                ? frictionItems.filter(item => item.category === filterCategory)
                : frictionItems;

            if (itemsToRender.length === 0) {
                feed.style.display = 'none';
                allClear.style.display = 'block';
                return;
            }

            feed.style.display = 'flex';
            allClear.style.display = 'none';

            feed.innerHTML = itemsToRender.map(item => `
                <div class="friction-item ${item.type}" onclick="openResolutionDrawer('${item.id}')">
                    <div class="friction-icon ${item.type}">
                        ${getFrictionIcon(item.icon)}
                    </div>
                    <div class="friction-content">
                        <div class="friction-title">${item.title}</div>
                        <div class="friction-description">${item.description}</div>
                        <div class="friction-meta">
                            ${item.associate ? `<span>Associate: ${item.associate}</span>` : ''}
                            ${item.client ? `<span>Client: ${item.client}</span>` : ''}
                            ${item.dueDate ? `<span>Due: ${item.dueDate}</span>` : ''}
                            ${item.amount ? `<span>Amount: ${item.amount}</span>` : ''}
                        </div>
                    </div>
                    <button class="friction-action" onclick="event.stopPropagation(); openResolutionDrawer('${item.id}')">${item.action}</button>
                </div>
            `).join('');

            // Update summary counts
            updateActionSummaryCounts();
        }

        function getFrictionIcon(iconName) {
            const icons = {
                'file-text': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',
                'file-signature': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/></svg>',
                'alert-circle': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>',
                'calendar': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>'
            };
            return icons[iconName] || icons['alert-circle'];
        }

        // Resolution Drawer State
        let currentResolutionItem = null;

        function openResolutionDrawer(itemId) {
            const item = frictionItems.find(i => i.id === itemId);
            if (!item) return;

            currentResolutionItem = item;

            const drawer = document.getElementById('resolutionDrawer');
            const header = document.getElementById('resolutionHeader');
            const badge = document.getElementById('resolutionBadge');
            const badgeText = document.getElementById('resolutionBadgeText');
            const title = document.getElementById('resolutionTitle');
            const description = document.getElementById('resolutionDescription');
            const details = document.getElementById('resolutionDetails');
            const actions = document.getElementById('resolutionActions');

            // Set header color
            header.className = `resolution-drawer-header ${item.type}`;
            badge.className = `resolution-type-badge ${item.type}`;

            // Set badge text based on type
            const typeLabels = {
                'amber': 'Attention Needed',
                'rose': 'Urgent',
                'blue': 'Info'
            };
            badgeText.textContent = typeLabels[item.type] || 'Action Required';

            // Set title and description
            title.textContent = item.title;
            description.textContent = item.description;

            // Build details card
            let detailsHtml = '';
            if (item.associate) {
                detailsHtml += `
                    <div class="resolution-info-row">
                        <span class="resolution-info-label">Associate</span>
                        <span class="resolution-info-value">${item.associate}</span>
                    </div>`;
            }
            if (item.client) {
                detailsHtml += `
                    <div class="resolution-info-row">
                        <span class="resolution-info-label">Client</span>
                        <span class="resolution-info-value">${item.client}</span>
                    </div>`;
            }
            if (item.dueDate) {
                detailsHtml += `
                    <div class="resolution-info-row">
                        <span class="resolution-info-label">Due Date</span>
                        <span class="resolution-info-value">${item.dueDate}</span>
                    </div>`;
            }
            if (item.amount) {
                detailsHtml += `
                    <div class="resolution-info-row">
                        <span class="resolution-info-label">Amount</span>
                        <span class="resolution-info-value">${item.amount}</span>
                    </div>`;
            }
            detailsHtml += `
                <div class="resolution-info-row">
                    <span class="resolution-info-label">Reference</span>
                    <span class="resolution-info-value">${item.id}</span>
                </div>`;
            details.innerHTML = detailsHtml;

            // Build action buttons based on item type
            actions.innerHTML = getResolutionActions(item);

            // Open drawer
            drawer.classList.add('open');
        }

        function getResolutionActions(item) {
            const actionConfigs = {
                'Send Reminder': {
                    primary: { icon: 'send', title: 'Send Email Reminder', desc: 'Send an automated reminder email' },
                    secondary: [
                        { icon: 'phone', title: 'Call Associate', desc: 'Log a phone call reminder' },
                        { icon: 'message', title: 'Send SMS', desc: 'Send a text message reminder' }
                    ]
                },
                'Resend Contract': {
                    primary: { icon: 'file-text', title: 'Resend Contract', desc: 'Email the contract for e-signature' },
                    secondary: [
                        { icon: 'download', title: 'Download PDF', desc: 'Download contract for manual signing' },
                        { icon: 'phone', title: 'Call Associate', desc: 'Discuss contract over the phone' }
                    ]
                },
                'View Invoice': {
                    primary: { icon: 'credit-card', title: 'Send Payment Reminder', desc: 'Email invoice with payment link' },
                    secondary: [
                        { icon: 'file-text', title: 'View Invoice', desc: 'Open invoice in detail view' },
                        { icon: 'phone', title: 'Call Client', desc: 'Follow up on payment by phone' }
                    ]
                }
            };

            const config = actionConfigs[item.action] || {
                primary: { icon: 'check', title: item.action, desc: 'Complete this action' },
                secondary: []
            };

            let html = `
                <button class="resolution-action-btn primary" onclick="performAction('${item.action}')">
                    <div class="resolution-action-icon">
                        ${getActionIcon(config.primary.icon)}
                    </div>
                    <div class="resolution-action-text">
                        <div class="resolution-action-title">${config.primary.title}</div>
                        <div class="resolution-action-desc">${config.primary.desc}</div>
                    </div>
                </button>`;

            config.secondary.forEach(action => {
                html += `
                    <button class="resolution-action-btn" onclick="performAction('${action.title}')">
                        <div class="resolution-action-icon">
                            ${getActionIcon(action.icon)}
                        </div>
                        <div class="resolution-action-text">
                            <div class="resolution-action-title">${action.title}</div>
                            <div class="resolution-action-desc">${action.desc}</div>
                        </div>
                    </button>`;
            });

            return html;
        }

        function getActionIcon(iconName) {
            const icons = {
                'send': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>',
                'phone': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>',
                'message': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',
                'file-text': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',
                'download': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
                'credit-card': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>',
                'check': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>'
            };
            return icons[iconName] || icons['check'];
        }

        function performAction(actionName) {
            if (!currentResolutionItem) return;

            // Show feedback
            alert(`Action "${actionName}" triggered for ${currentResolutionItem.id}`);

            // In a real app, this would trigger an API call
            // For now, we just close the drawer and mark as resolved
        }

        function closeResolutionDrawer() {
            const drawer = document.getElementById('resolutionDrawer');
            drawer.classList.remove('open');
            currentResolutionItem = null;
        }

        function snoozeItem() {
            if (!currentResolutionItem) return;

            // Remove item from array
            const index = frictionItems.findIndex(i => i.id === currentResolutionItem.id);
            if (index > -1) {
                frictionItems.splice(index, 1);
            }

            // Close drawer
            closeResolutionDrawer();

            // Re-render the feed
            renderFrictionFeed();

            // Show feedback
            showToast('Snoozed for 7 days');
        }

        function markAsResolved() {
            if (!currentResolutionItem) return;

            // Remove item from array
            const index = frictionItems.findIndex(i => i.id === currentResolutionItem.id);
            if (index > -1) {
                frictionItems.splice(index, 1);
            }

            // Close drawer
            closeResolutionDrawer();

            // Re-render the feed
            renderFrictionFeed();

            // Show feedback
            showToast('Marked as resolved');
        }

        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%);
                background-color: var(--eden-green);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                animation: slideUp 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            // Remove after 2 seconds
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Add toast animations to head
        const toastStyle = document.createElement('style');
        toastStyle.textContent = `
            @keyframes slideUp {
                from { transform: translate(-50%, 20px); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(toastStyle);

        // ============================================
        // CONTRACTS VIEW FUNCTIONS
        // ============================================

        const contracts = [
            {
                id: 'CON-001',
                associateId: 'ASSOC-2401',
                associateName: 'Sarah Johnson',
                role: 'Counsellor',
                status: 'active',
                type: 'Associate Agreement',
                startDate: '1 Jan 2024',
                endDate: '31 Dec 2025',
                feeSplit: '70/30',
                lastUpdated: '1 Jan 2024',
                daysUntilRenewal: 358
            },
            {
                id: 'CON-002',
                associateId: 'ASSOC-2402',
                associateName: 'David Okonkwo',
                role: 'Psychotherapist',
                status: 'active',
                type: 'Associate Agreement',
                startDate: '15 Mar 2024',
                endDate: '14 Mar 2026',
                feeSplit: '65/35',
                lastUpdated: '15 Mar 2024',
                daysUntilRenewal: 431
            },
            {
                id: 'CON-003',
                associateId: 'ASSOC-2403',
                associateName: 'Fatima Okafor',
                role: 'Counsellor',
                status: 'expired',
                type: 'Associate Agreement',
                startDate: '1 Feb 2024',
                endDate: '31 Jan 2026',
                feeSplit: '70/30',
                lastUpdated: '1 Feb 2024',
                daysUntilRenewal: 23
            },
            {
                id: 'CON-004',
                associateId: 'ASSOC-2404',
                associateName: 'Amara Mensah',
                role: 'Clinical Psychologist',
                status: 'pending',
                type: 'Associate Agreement',
                startDate: '1 Feb 2026',
                endDate: '31 Jan 2028',
                feeSplit: '60/40',
                lastUpdated: '5 Jan 2026',
                daysUntilRenewal: null
            },
            {
                id: 'CON-005',
                associateId: 'ASSOC-2405',
                associateName: 'James Chen',
                role: 'Counsellor',
                status: 'active',
                type: 'Associate Agreement',
                startDate: '1 Jun 2024',
                endDate: '31 May 2026',
                feeSplit: '70/30',
                lastUpdated: '1 Jun 2024',
                daysUntilRenewal: 143
            },
            {
                id: 'CON-006',
                associateId: 'ASSOC-2406',
                associateName: 'Emma Williams',
                role: 'Psychotherapist',
                status: 'active',
                type: 'Associate Agreement',
                startDate: '1 Sep 2024',
                endDate: '31 Aug 2026',
                feeSplit: '65/35',
                lastUpdated: '1 Sep 2024',
                daysUntilRenewal: 235
            }
        ];

        let contractsFilter = 'all';

        function renderContractsGrid(filter = 'all') {
            const grid = document.getElementById('contractsGrid');
            if (!grid) return;

            contractsFilter = filter;

            // Update filter buttons
            document.querySelectorAll('.contracts-filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });

            // Filter contracts
            let filteredContracts = contracts;
            if (filter !== 'all') {
                filteredContracts = contracts.filter(c => c.status === filter);
            }

            // Update stats
            updateContractStats();

            if (filteredContracts.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--eden-text-secondary)" stroke-width="1.5" style="margin-bottom: 16px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <p style="color: var(--eden-text-secondary);">No contracts match this filter</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredContracts.map(contract => {
                const initials = contract.associateName.split(' ').map(n => n[0]).join('');
                const renewalClass = getRenewalClass(contract);
                const renewalText = getRenewalText(contract);

                return `
                    <div class="contract-card" onclick="openContractDetail('${contract.id}')">
                        <div class="contract-card-header">
                            <div class="contract-associate-info">
                                <div class="contract-avatar">${initials}</div>
                                <div>
                                    <div class="contract-associate-name">${contract.associateName}</div>
                                    <div class="contract-associate-role">${contract.role}</div>
                                </div>
                            </div>
                            <span class="contract-status-badge ${contract.status}">${getStatusLabel(contract.status)}</span>
                        </div>
                        <div class="contract-card-details">
                            <div class="contract-detail-item">
                                <span class="contract-detail-label">Contract Type</span>
                                <span class="contract-detail-value">${contract.type}</span>
                            </div>
                            <div class="contract-detail-item">
                                <span class="contract-detail-label">Fee Split</span>
                                <span class="contract-detail-value">${contract.feeSplit}</span>
                            </div>
                            <div class="contract-detail-item">
                                <span class="contract-detail-label">Start Date</span>
                                <span class="contract-detail-value">${contract.startDate}</span>
                            </div>
                            <div class="contract-detail-item">
                                <span class="contract-detail-label">End Date</span>
                                <span class="contract-detail-value">${contract.endDate}</span>
                            </div>
                        </div>
                        <div class="contract-card-footer">
                            <span class="contract-renewal-info ${renewalClass}">${renewalText}</span>
                            <button class="contract-action-btn" onclick="event.stopPropagation(); viewContractPDF('${contract.id}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                                View PDF
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateContractStats() {
            const total = contracts.length;
            const active = contracts.filter(c => c.status === 'active').length;
            const pending = contracts.filter(c => c.status === 'pending').length;
            const expiring = contracts.filter(c => c.status === 'expired' || (c.daysUntilRenewal !== null && c.daysUntilRenewal <= 30)).length;

            document.getElementById('totalContractsCount').textContent = total;
            document.getElementById('activeContractsCount').textContent = active;
            document.getElementById('pendingContractsCount').textContent = pending;
            document.getElementById('expiredContractsCount').textContent = expiring;
        }

        function getStatusLabel(status) {
            const labels = {
                'active': 'Active',
                'pending': 'Pending',
                'expired': 'Expiring'
            };
            return labels[status] || status;
        }

        function getRenewalClass(contract) {
            if (contract.status === 'pending') return '';
            if (contract.daysUntilRenewal === null) return '';
            if (contract.daysUntilRenewal <= 14) return 'urgent';
            if (contract.daysUntilRenewal <= 30) return 'warning';
            return '';
        }

        function getRenewalText(contract) {
            if (contract.status === 'pending') return 'Awaiting signature';
            if (contract.daysUntilRenewal === null) return '';
            if (contract.daysUntilRenewal <= 0) return 'Expired';
            if (contract.daysUntilRenewal === 1) return 'Renews tomorrow';
            if (contract.daysUntilRenewal <= 30) return `Renews in ${contract.daysUntilRenewal} days`;
            return `Renews ${contract.endDate}`;
        }

        function filterContracts(filter) {
            renderContractsGrid(filter);
        }

        let currentContract = null;

        function openContractDetail(contractId) {
            const contract = contracts.find(c => c.id === contractId);
            if (!contract) return;

            currentContract = contract;

            // Populate header
            const initials = contract.associateName.split(' ').map(n => n[0]).join('');
            document.getElementById('contractDetailAvatar').textContent = initials;
            document.getElementById('contractDetailName').textContent = contract.associateName;
            document.getElementById('contractDetailRole').textContent = contract.role;

            const statusBadge = document.getElementById('contractDetailStatus');
            statusBadge.className = `contract-status-badge ${contract.status}`;
            statusBadge.textContent = getStatusLabel(contract.status);

            // Populate contract info grid
            document.getElementById('contractInfoGrid').innerHTML = `
                <div class="contract-info-item">
                    <div class="contract-info-label">Contract ID</div>
                    <div class="contract-info-value">${contract.id}</div>
                </div>
                <div class="contract-info-item">
                    <div class="contract-info-label">Associate ID</div>
                    <div class="contract-info-value">${contract.associateId}</div>
                </div>
                <div class="contract-info-item">
                    <div class="contract-info-label">Contract Type</div>
                    <div class="contract-info-value">${contract.type}</div>
                </div>
                <div class="contract-info-item">
                    <div class="contract-info-label">Fee Split</div>
                    <div class="contract-info-value">${contract.feeSplit}</div>
                </div>
                <div class="contract-info-item">
                    <div class="contract-info-label">Start Date</div>
                    <div class="contract-info-value">${contract.startDate}</div>
                </div>
                <div class="contract-info-item">
                    <div class="contract-info-label">End Date</div>
                    <div class="contract-info-value">${contract.endDate}</div>
                </div>
                <div class="contract-info-item full-width">
                    <div class="contract-info-label">Renewal Status</div>
                    <div class="contract-info-value">${getRenewalText(contract)}</div>
                </div>
            `;

            // Populate timeline
            document.getElementById('contractTimeline').innerHTML = `
                <div class="contract-timeline-item">
                    <div class="contract-timeline-date">${contract.lastUpdated}</div>
                    <div class="contract-timeline-event">Contract ${contract.status === 'pending' ? 'sent for signature' : 'signed and activated'}</div>
                </div>
                <div class="contract-timeline-item">
                    <div class="contract-timeline-date">${contract.startDate}</div>
                    <div class="contract-timeline-event">Contract period begins</div>
                </div>
                <div class="contract-timeline-item">
                    <div class="contract-timeline-date">${contract.endDate}</div>
                    <div class="contract-timeline-event">Contract expires</div>
                </div>
            `;

            // Populate documents
            document.getElementById('contractDocuments').innerHTML = `
                <div class="contract-document-item" onclick="viewContractPDF('${contract.id}')">
                    <div class="contract-document-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                    </div>
                    <div class="contract-document-info">
                        <div class="contract-document-name">Associate Agreement</div>
                        <div class="contract-document-meta">PDF - Signed ${contract.lastUpdated}</div>
                    </div>
                </div>
                <div class="contract-document-item" onclick="showToast('Opening insurance document')">
                    <div class="contract-document-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                    </div>
                    <div class="contract-document-info">
                        <div class="contract-document-name">Insurance Certificate</div>
                        <div class="contract-document-meta">PDF - Valid until ${contract.endDate}</div>
                    </div>
                </div>
                <div class="contract-document-item" onclick="showToast('Opening DBS certificate')">
                    <div class="contract-document-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <polyline points="17 11 19 13 23 9"/>
                        </svg>
                    </div>
                    <div class="contract-document-info">
                        <div class="contract-document-name">DBS Certificate</div>
                        <div class="contract-document-meta">PDF - Enhanced check</div>
                    </div>
                </div>
            `;

            // Open panel
            document.getElementById('contractDetailPanel').classList.add('open');
        }

        function closeContractDetail() {
            document.getElementById('contractDetailPanel').classList.remove('open');
            currentContract = null;
        }

        function downloadContract() {
            if (currentContract) {
                showToast(`Downloading ${currentContract.associateName}'s contract`);
            }
        }

        function renewContract() {
            if (currentContract) {
                showToast(`Initiating renewal for ${currentContract.associateName}`);
                closeContractDetail();
            }
        }

        function viewContractPDF(contractId) {
            const contract = contracts.find(c => c.id === contractId);
            if (contract) {
                showToast(`Opening PDF for ${contract.associateName}'s contract`);
            }
        }

        // ============================================
        // ALL CLIENTS VIEW FUNCTIONS
        // ============================================

        let allClientsFilter = 'all';

        function renderAllClientsGrid(filter = 'all') {
            const grid = document.getElementById('allClientsGrid');
            if (!grid) return;

            allClientsFilter = filter;

            // Update filter pills
            document.querySelectorAll('#clientsFilter .filter-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.stage === filter);
            });

            const filteredClients = filter === 'all'
                ? clients
                : clients.filter(c => c.stage === filter);

            // Update counts and stats
            updateAllClientsCounts();

            if (filteredClients.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--eden-text-secondary)" stroke-width="1.5" style="margin-bottom: 16px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                        </svg>
                        <p style="color: var(--eden-text-secondary);">No clients match this filter</p>
                    </div>
                `;
                return;
            }

            // Use animated card list with StatusCard component
            grid.className = 'animated-card-list';
            grid.innerHTML = filteredClients.map((client, index) => {
                const associate = associates.find(a => a.id === client.associateId);
                const statusLabel = client.stage.charAt(0).toUpperCase() + client.stage.slice(1);
                const pulseColour = client.stage === 'awaiting' ? 'amber' :
                                   client.stage === 'pending' ? 'blue' :
                                   client.stage === 'active' ? 'green' : 'purple';

                return renderStatusCard({
                    reference: client.id,
                    status: client.stage,
                    statusLabel: statusLabel,
                    title: client.name,
                    preview: associate ? `Assigned to ${associate.name}` : 'Awaiting therapist match',
                    meta: associate ? [associate.specialisation || 'Therapy'] : ['Pending'],
                    pulseColour: pulseColour,
                    onClick: `openClientDetailPanel('${client.id}')`,
                    dataId: client.id
                });
            }).join('');

            // Apply staggered animation
            applyCardAnimation(grid);
        }

        function updateAllClientsCounts() {
            const counts = {
                all: clients.length,
                awaiting: clients.filter(c => c.stage === 'awaiting').length,
                pending: clients.filter(c => c.stage === 'pending').length,
                active: clients.filter(c => c.stage === 'active').length,
                ending: clients.filter(c => c.stage === 'ending').length
            };

            // Update summary stats grid
            const totalStat = document.getElementById('totalClientsStatCount');
            const activeStat = document.getElementById('activeClientsStatCount');
            const awaitingStat = document.getElementById('awaitingClientsStatCount');
            const endingStat = document.getElementById('endingClientsStatCount');

            if (totalStat) totalStat.textContent = counts.all;
            if (activeStat) activeStat.textContent = counts.active;
            if (awaitingStat) {
                awaitingStat.textContent = counts.awaiting;
                awaitingStat.className = 'summary-stat-value' + (counts.awaiting > 0 ? ' warning' : '');
            }
            if (endingStat) {
                endingStat.textContent = counts.ending;
                endingStat.className = 'summary-stat-value' + (counts.ending > 0 ? ' danger' : '');
            }

            // Update subtitle
            const subtitle = document.getElementById('clientsSubtitle');
            if (subtitle) {
                subtitle.textContent = `${clients.length} clients across the practice`;
            }
        }

        function filterAllClients(stage) {
            renderAllClientsGrid(stage);
        }

        function openClientFromGrid(clientId) {
            // Use full page navigation instead of panel
            showClientDetail(clientId, 'clients');
        }

        function openClientPanelDirect(clientId) {
            // Use full page navigation instead of panel
            showClientDetail(clientId, 'clients');
        }

        function closeClientPanelDirect() {
            // Redirect to closeClientDetail
            closeClientDetail();
        }

        // ============================================
        // SCHEDULE / CALENDAR FUNCTIONS
        // ============================================

        let currentCalendarDate = new Date(2026, 0, 8); // January 8, 2026

        const sessions = [
            { time: '09:00', client: 'James Wilson', associate: 'Sarah Johnson', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 8) },
            { time: '10:30', client: 'Sophie Taylor', associate: 'Sarah Johnson', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 8) },
            { time: '11:00', client: 'Michael Chen', associate: 'David Okonkwo', type: 'Couples', status: 'pending', date: new Date(2026, 0, 8) },
            { time: '14:00', client: 'Mark & Lisa Harris', associate: 'Sarah Johnson', type: 'Couples', status: 'confirmed', date: new Date(2026, 0, 8) },
            { time: '15:30', client: 'Rachel Green', associate: 'Fatima Okafor', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 8) },
            { time: '09:30', client: 'Emma Stone', associate: 'Amara Mensah', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 9) },
            { time: '11:00', client: 'Robert Lee', associate: 'Kwame Asante', type: 'Individual', status: 'pending', date: new Date(2026, 0, 9) },
            { time: '14:00', client: 'Julia Roberts', associate: 'Chioma Eze', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 10) },
            { time: '16:00', client: 'Diana Prince', associate: 'Yemi Adebayo', type: 'Individual', status: 'cancelled', date: new Date(2026, 0, 12) },
            { time: '10:00', client: 'Peter Parker', associate: 'Sarah Johnson', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 13) },
            { time: '14:30', client: 'Mary Jane', associate: 'David Okonkwo', type: 'Individual', status: 'pending', date: new Date(2026, 0, 13) },
            { time: '09:00', client: 'Bruce Wayne', associate: 'Fatima Okafor', type: 'Individual', status: 'confirmed', date: new Date(2026, 0, 15) }
        ];

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('calendarMonth');

            if (!grid || !monthLabel) return;

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                'July', 'August', 'September', 'October', 'November', 'December'];
            monthLabel.textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();

            // Get the day of week for the first day (0 = Sunday, we want Monday = 0)
            let startDay = firstDay.getDay() - 1;
            if (startDay < 0) startDay = 6;

            // Get days from previous month
            const prevMonth = new Date(year, month, 0);
            const daysInPrevMonth = prevMonth.getDate();

            const today = new Date(2026, 0, 8); // Mock "today"

            let html = '';
            let dayCounter = 1;
            let nextMonthDay = 1;

            for (let row = 0; row < 6; row++) {
                for (let col = 0; col < 7; col++) {
                    const cellIndex = row * 7 + col;

                    if (cellIndex < startDay) {
                        // Previous month
                        const day = daysInPrevMonth - startDay + cellIndex + 1;
                        html += `<div class="calendar-day other-month">${day}</div>`;
                    } else if (dayCounter <= daysInMonth) {
                        // Current month
                        const isToday = year === today.getFullYear() &&
                                        month === today.getMonth() &&
                                        dayCounter === today.getDate();

                        const currentDate = new Date(year, month, dayCounter);
                        const hasSessions = sessions.some(s =>
                            s.date.getFullYear() === currentDate.getFullYear() &&
                            s.date.getMonth() === currentDate.getMonth() &&
                            s.date.getDate() === currentDate.getDate()
                        );

                        const classes = ['calendar-day', 'clickable'];
                        if (isToday) classes.push('today');
                        if (hasSessions) classes.push('has-sessions');

                        html += `<div class="${classes.join(' ')}" onclick="openSessionDetail(${year}, ${month}, ${dayCounter})">${dayCounter}</div>`;
                        dayCounter++;
                    } else {
                        // Next month
                        html += `<div class="calendar-day other-month">${nextMonthDay}</div>`;
                        nextMonthDay++;
                    }
                }
            }

            grid.innerHTML = html;
            renderTodaysSessions();
        }

        function renderTodaysSessions() {
            const list = document.getElementById('todaySessionsList');
            if (!list) return;

            const today = new Date(2026, 0, 8);
            const todaysSessions = sessions.filter(s =>
                s.date.getFullYear() === today.getFullYear() &&
                s.date.getMonth() === today.getMonth() &&
                s.date.getDate() === today.getDate()
            );

            if (todaysSessions.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-title">No sessions today</div>
                        <div class="empty-state-text">Enjoy your day off!</div>
                    </div>
                `;
                return;
            }

            list.innerHTML = todaysSessions.map(session => `
                <div class="session-item">
                    <div class="session-time">${session.time}</div>
                    <div class="session-info">
                        <div class="session-client">${session.client}</div>
                        <div class="session-associate">with ${session.associate}</div>
                    </div>
                    <div class="session-type">${session.type}</div>
                </div>
            `).join('');
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function openSessionDetail(year, month, day) {
            const selectedDate = new Date(year, month, day);
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                'July', 'August', 'September', 'October', 'November', 'December'];

            // Update header
            const dateLabel = document.getElementById('sessionDetailDate');
            dateLabel.textContent = `${dayNames[selectedDate.getDay()]}, ${day} ${monthNames[month]}`;

            // Get sessions for this day
            const daySessions = sessions.filter(s =>
                s.date.getFullYear() === year &&
                s.date.getMonth() === month &&
                s.date.getDate() === day
            ).sort((a, b) => a.time.localeCompare(b.time));

            // Render session cards
            const content = document.getElementById('sessionDetailContent');

            if (daySessions.length === 0) {
                content.innerHTML = `
                    <div class="session-detail-empty">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <div style="font-size: 16px; font-weight: 500; margin-bottom: 4px;">No sessions scheduled</div>
                        <div style="font-size: 14px;">This day is free</div>
                    </div>
                `;
            } else {
                content.innerHTML = daySessions.map(session => `
                    <div class="session-detail-card ${session.status}">
                        <div class="session-card-header">
                            <div class="session-card-time">${session.time}</div>
                            <span class="session-card-status ${session.status}">${session.status}</span>
                        </div>
                        <div class="session-card-client">${session.client}</div>
                        <div class="session-card-meta">
                            <span>${session.associate}</span>
                            <span class="session-card-meta-dot"></span>
                            <span>${session.type}</span>
                        </div>
                        <div class="session-card-actions">
                            ${session.status !== 'cancelled' ? `
                                <button class="session-action-btn secondary" onclick="rescheduleSession('${session.client}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"/>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                    </svg>
                                    Reschedule
                                </button>
                                <button class="session-action-btn secondary" onclick="cancelSession('${session.client}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                    Cancel
                                </button>
                            ` : `
                                <button class="session-action-btn primary" onclick="rebookSession('${session.client}')">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"/>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                    </svg>
                                    Rebook
                                </button>
                            `}
                            <button class="session-action-btn primary" onclick="viewSessionNotes('${session.client}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                </svg>
                                Notes
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // Open panel
            document.getElementById('sessionDetailPanel').classList.add('open');
        }

        function closeSessionDetail() {
            document.getElementById('sessionDetailPanel').classList.remove('open');
        }

        function rescheduleSession(client) {
            alert(`Reschedule session for ${client} - Coming soon!`);
        }

        function cancelSession(client) {
            if (confirm(`Cancel session for ${client}?`)) {
                alert('Session cancelled (Demo only)');
                closeSessionDetail();
            }
        }

        function rebookSession(client) {
            alert(`Rebook session for ${client} - Coming soon!`);
        }

        function viewSessionNotes(client) {
            alert(`Session notes for ${client} - Coming soon!`);
        }

        // Add Session Modal Functions
        function openAddSessionModal() {
            // Set default date to today
            const today = new Date(2026, 0, 8); // Mock today
            const dateInput = document.getElementById('sessionDate');
            dateInput.value = today.toISOString().split('T')[0];

            // Reset form
            document.getElementById('sessionClient').value = '';
            document.getElementById('sessionAssociate').value = '';
            document.getElementById('sessionTime').value = '';
            document.getElementById('sessionNotes').value = '';
            document.querySelector('input[name="sessionType"][value="Individual"]').checked = true;
            document.getElementById('sessionConflictWarning').style.display = 'none';

            // Open modal
            document.getElementById('addSessionModal').classList.add('open');
        }

        function closeAddSessionModal() {
            document.getElementById('addSessionModal').classList.remove('open');
        }

        function checkSessionConflict() {
            const associate = document.getElementById('sessionAssociate').value;
            const dateValue = document.getElementById('sessionDate').value;
            const time = document.getElementById('sessionTime').value;

            if (!associate || !dateValue || !time) {
                document.getElementById('sessionConflictWarning').style.display = 'none';
                return false;
            }

            const dateParts = dateValue.split('-');
            const year = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]) - 1;
            const day = parseInt(dateParts[2]);

            // Check for conflicts
            const conflict = sessions.find(s =>
                s.associate === associate &&
                s.date.getFullYear() === year &&
                s.date.getMonth() === month &&
                s.date.getDate() === day &&
                s.time === time &&
                s.status !== 'cancelled'
            );

            if (conflict) {
                document.getElementById('conflictMessage').textContent =
                    `${associate} already has a session at ${time} with ${conflict.client}`;
                document.getElementById('sessionConflictWarning').style.display = 'flex';
                return true;
            }

            document.getElementById('sessionConflictWarning').style.display = 'none';
            return false;
        }

        function saveNewSession() {
            const client = document.getElementById('sessionClient').value;
            const associate = document.getElementById('sessionAssociate').value;
            const dateValue = document.getElementById('sessionDate').value;
            const time = document.getElementById('sessionTime').value;
            const type = document.querySelector('input[name="sessionType"]:checked').value;

            // Validate required fields
            if (!client || !associate || !dateValue || !time) {
                alert('Please fill in all required fields');
                return;
            }

            // Check for conflicts
            if (checkSessionConflict()) {
                if (!confirm('There is a scheduling conflict. Add session anyway?')) {
                    return;
                }
            }

            // Parse date
            const dateParts = dateValue.split('-');
            const newDate = new Date(
                parseInt(dateParts[0]),
                parseInt(dateParts[1]) - 1,
                parseInt(dateParts[2])
            );

            // Add new session to array
            sessions.push({
                time: time,
                client: client,
                associate: associate,
                type: type,
                status: 'pending',
                date: newDate
            });

            // Refresh calendar and close modal
            renderCalendar();
            closeAddSessionModal();

            // Show confirmation
            alert(`Session added for ${client} on ${newDate.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' })} at ${time}`);
        }

        // ============================================
        // CPD FUNCTIONS
        // ============================================

        const cpdActivities = [
            { date: '3 Jan 2026', title: 'Trauma-Informed Practice Workshop', category: 'Clinical Skills', hours: 4 },
            { date: '18 Dec 2025', title: 'BACP Ethics Update', category: 'Ethics & Law', hours: 2 },
            { date: '5 Dec 2025', title: 'Group Supervision Session', category: 'Supervision', hours: 2 },
            { date: '28 Nov 2025', title: 'Mindfulness for Therapists', category: 'Self-Care', hours: 3 },
            { date: '15 Nov 2025', title: 'Couples Therapy Techniques', category: 'Clinical Skills', hours: 4 }
        ];

        function renderCpdActivities() {
            const list = document.getElementById('cpdActivityList');
            if (!list) return;

            list.innerHTML = cpdActivities.map(activity => `
                <div class="cpd-activity-item">
                    <div class="cpd-activity-date">${activity.date}</div>
                    <div class="cpd-activity-info">
                        <div class="cpd-activity-title">${activity.title}</div>
                        <div class="cpd-activity-category">${activity.category}</div>
                    </div>
                    <div class="cpd-activity-hours">${activity.hours} hrs</div>
                </div>
            `).join('');
        }

        // ============================================
        // WEALTH MODULE FUNCTIONS
        // ============================================

        let currentWealthModule = null;

        const wealthModuleTitles = {
            'cash-density': 'Cash Density',
            'tax-intel': 'Tax Intelligence',
            'payment-tracker': 'Payment Tracker',
            'payouts': 'Payout Pipeline',
            'simulator': 'Wealth Lab'
        };

        const wealthModuleViews = {
            'cash-density': 'cashDensityView',
            'tax-intel': 'taxIntelView',
            'payment-tracker': 'paymentTrackerView',
            'payouts': 'payoutsView',
            'simulator': 'simulatorView'
        };

        function openWealthModule(moduleName) {
            currentWealthModule = moduleName;

            // Update panel title
            const titleEl = document.getElementById('wealthPanelTitle');
            titleEl.textContent = wealthModuleTitles[moduleName] || 'Module';

            // Hide all views, show selected
            document.querySelectorAll('.wealth-view').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById(wealthModuleViews[moduleName]);
            if (targetView) {
                targetView.classList.add('active');
            }

            // Initialize module-specific data
            if (moduleName === 'payment-tracker') {
                initPaymentTracker();
            } else if (moduleName === 'payouts') {
                initPayoutPipeline();
            }

            // Open the panel
            document.getElementById('wealthPanel').classList.add('open');
        }

        function closeWealthModule() {
            document.getElementById('wealthPanel').classList.remove('open');
            currentWealthModule = null;
        }

        // ============================================
        // PAYMENT TRACKER FUNCTIONS
        // ============================================

        let currentPaymentFilter = 'all';

        // Initialize Payment Tracker on load
        function initPaymentTracker() {
            updatePaymentOverview();
            renderPaymentTable();
            updatePaymentTrackerAlerts();
        }

        // Update Payment Overview Cards
        function updatePaymentOverview() {
            const overview = getPaymentOverview();

            // Update Awaiting Payment
            const awaitingValue = document.getElementById('awaitingPaymentOverviewValue');
            const awaitingCount = document.getElementById('awaitingPaymentOverviewCount');
            if (awaitingValue) awaitingValue.textContent = '' + overview.awaitingPaymentTotal.toFixed(0);
            if (awaitingCount) awaitingCount.textContent = overview.awaitingPaymentCount + ' sessions';

            // Update Paid
            const paidValue = document.getElementById('paidOverviewValue');
            const paidCount = document.getElementById('paidOverviewCount');
            if (paidValue) paidValue.textContent = '' + overview.paidTotal.toFixed(0);
            if (paidCount) paidCount.textContent = overview.paidCount + ' sessions';

            // Update Overdue
            const overdueValue = document.getElementById('overdueOverviewValue');
            const overdueCount = document.getElementById('overdueOverviewCount');
            if (overdueValue) overdueValue.textContent = '' + overview.overdueTotal.toFixed(0);
            if (overdueCount) overdueCount.textContent = overview.overdueCount + ' sessions';

            // Update module alert badge
            const alertBadge = document.getElementById('paymentTrackerAlert');
            if (alertBadge) {
                alertBadge.textContent = overview.awaitingPaymentCount + ' awaiting';
            }
        }

        // Render Payment Table
        function renderPaymentTable(filter = 'all') {
            const tableBody = document.getElementById('paymentTableBody');
            if (!tableBody) return;

            let sessionData = sessions.filter(s => s.sessionStatus === 'Completed' || s.sessionStatus === 'Scheduled');

            // Apply filter
            if (filter === 'awaiting') {
                sessionData = sessionData.filter(s => s.paymentStatus === 'Awaiting Payment');
            } else if (filter === 'paid') {
                sessionData = sessionData.filter(s => s.paymentStatus === 'Paid');
            } else if (filter === 'overdue') {
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                sessionData = sessionData.filter(s =>
                    s.paymentStatus === 'Awaiting Payment' &&
                    new Date(s.sessionDate) < sevenDaysAgo
                );
            }

            // Sort by date descending
            sessionData.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate));

            if (sessionData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--eden-text-secondary);">
                            No sessions found for this filter
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = sessionData.map(session => {
                const isOverdue = isSessionOverdue(session);
                let statusClass = 'awaiting';
                let statusText = 'Awaiting';

                if (session.paymentStatus === 'Paid') {
                    statusClass = 'paid';
                    statusText = 'Paid';
                } else if (isOverdue) {
                    statusClass = 'overdue';
                    statusText = 'Overdue';
                }

                return `
                    <tr data-session-id="${session.id}">
                        <td>${formatSessionDate(session.sessionDate)}</td>
                        <td>${session.clientName}</td>
                        <td class="payment-table-associate" onclick="openAssociateFromPaymentTable('${session.associateId}')">${session.associateName}</td>
                        <td class="payment-table-amount">${session.rate}</td>
                        <td>
                            <span class="payment-table-status ${statusClass}">
                                <span class="payment-table-status-dot"></span>
                                ${statusText}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Check if session is overdue (more than 7 days awaiting payment)
        function isSessionOverdue(session) {
            if (session.paymentStatus !== 'Awaiting Payment') return false;
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            return new Date(session.sessionDate) < sevenDaysAgo;
        }

        // Filter Payment Table
        function filterPaymentTable(filter) {
            currentPaymentFilter = filter;

            // Update active button
            document.querySelectorAll('.payment-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });

            renderPaymentTable(filter);
        }

        // Update Payment Tracker Alerts
        function updatePaymentTrackerAlerts() {
            const alert = document.getElementById('unmatchedAlert');
            const alertTitle = document.getElementById('unmatchedAlertTitle');
            const alertDesc = document.getElementById('unmatchedAlertDesc');

            if (unmatchedPayments.length > 0) {
                alert.style.display = 'flex';
                alertTitle.textContent = `${unmatchedPayments.length} Unmatched Payment${unmatchedPayments.length > 1 ? 's' : ''} Need${unmatchedPayments.length === 1 ? 's' : ''} Review`;
                alertDesc.textContent = `Stripe payment${unmatchedPayments.length > 1 ? 's' : ''} couldn't be matched to session${unmatchedPayments.length > 1 ? 's' : ''}`;
            } else {
                alert.style.display = 'none';
            }
        }

        // Show unmatched payments details
        function showUnmatchedPayments() {
            // In a full implementation, this would show a modal or drawer with unmatched payment details
            const payment = unmatchedPayments[0];
            if (payment) {
                showToast(`Unmatched: ${payment.amount} from ${payment.customerEmail} on ${formatPayoutDate(payment.paymentDate)}`);
            }
        }

        // Open associate from payment table
        function openAssociateFromPaymentTable(associateId) {
            closeWealthModule();
            showAssociateDetail(associateId);
        }

        // ============================================
        // TAX INTELLIGENCE FUNCTIONS
        // ============================================

        let isPostVat = false;

        function toggleVatMode() {
            isPostVat = !isPostVat;

            const toggle = document.getElementById('vatToggle');
            const preLabel = document.getElementById('preVatLabel');
            const postLabel = document.getElementById('postVatLabel');
            const description = document.getElementById('taxModeDescription');
            const preContent = document.getElementById('preVatContent');
            const postContent = document.getElementById('postVatContent');

            if (isPostVat) {
                toggle.classList.add('active');
                preLabel.classList.remove('active');
                postLabel.classList.add('active');
                description.textContent = 'Showing tax obligations including VAT';
                preContent.style.display = 'none';
                postContent.style.display = 'block';
            } else {
                toggle.classList.remove('active');
                postLabel.classList.remove('active');
                preLabel.classList.add('active');
                description.textContent = 'Showing tax obligations before VAT registration threshold';
                postContent.style.display = 'none';
                preContent.style.display = 'block';
            }
        }

        // ============================================
        // PAYOUT PIPELINE FUNCTIONS
        // ============================================

        let selectedPipelineAssociate = null;

        // Initialize Payout Pipeline
        function initPayoutPipeline() {
            updatePipelineSummary();
            renderPayoutPipelineGrid();
            renderRecentPayouts();
            updatePayoutPipelineAlert();
        }

        // Update Pipeline Summary Hero
        function updatePipelineSummary() {
            const pipeline = getPayoutPipeline();
            const totalAmount = pipeline.reduce((sum, a) => sum + a.totalAssociateShare, 0);
            const totalSessions = pipeline.reduce((sum, a) => sum + a.sessions.length, 0);
            const edenShare = pipeline.reduce((sum, a) => sum + (a.totalGross - a.totalAssociateShare), 0);

            // Calculate paid this month from payouts data
            const paidThisMonth = payouts
                .filter(p => p.status === 'Paid' && p.paidDate && p.paidDate.startsWith('2026-01'))
                .reduce((sum, p) => sum + p.associateAmount, 0);

            document.getElementById('pipelineReadyCount').textContent = pipeline.length + ' associates';
            document.getElementById('pipelineTotalAmount').textContent = '' + totalAmount.toFixed(2);
            document.getElementById('pipelineSessionCount').textContent = totalSessions;
            document.getElementById('pipelineEdenShare').textContent = '' + edenShare.toFixed(2);
            document.getElementById('pipelinePaidThisMonth').textContent = '' + paidThisMonth.toFixed(2);
        }

        // Render Payout Pipeline Grid
        function renderPayoutPipelineGrid() {
            const grid = document.getElementById('payoutPipelineGrid');
            if (!grid) return;

            const pipeline = getPayoutPipeline();

            if (pipeline.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <svg class="empty-state-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        <p class="empty-state-text">No sessions ready for payout. All caught up!</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = pipeline.map(associate => {
                const initials = associate.associateName.split(' ').map(n => n[0]).join('');
                const edenShare = associate.totalGross - associate.totalAssociateShare;

                return `
                    <div class="payout-pipeline-card" data-associate-id="${associate.associateId}">
                        <div class="payout-pipeline-header">
                            <div class="payout-pipeline-avatar">${initials}</div>
                            <div class="payout-pipeline-info">
                                <div class="payout-pipeline-name">${associate.associateName}</div>
                                <div class="payout-pipeline-sessions">${associate.sessions.length} sessions ready</div>
                            </div>
                        </div>
                        <div class="payout-pipeline-amounts">
                            <div class="payout-pipeline-amount">
                                <div class="payout-pipeline-amount-value">${associate.totalGross.toFixed(0)}</div>
                                <div class="payout-pipeline-amount-label">Gross</div>
                            </div>
                            <div class="payout-pipeline-amount">
                                <div class="payout-pipeline-amount-value">${associate.totalAssociateShare.toFixed(2)}</div>
                                <div class="payout-pipeline-amount-label">Associate (69%)</div>
                            </div>
                            <div class="payout-pipeline-amount">
                                <div class="payout-pipeline-amount-value">${edenShare.toFixed(2)}</div>
                                <div class="payout-pipeline-amount-label">Eden (31%)</div>
                            </div>
                        </div>
                        <div class="payout-pipeline-action">
                            <button class="payout-pipeline-btn" onclick="openPayoutDetail('${associate.associateId}')">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                Review & Create Payout
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render Recent Payouts List
        function renderRecentPayouts() {
            const container = document.getElementById('recentPayoutsList');
            if (!container) return;

            const recentPayouts = payouts
                .filter(p => p.status === 'Paid')
                .sort((a, b) => new Date(b.paidDate) - new Date(a.paidDate))
                .slice(0, 5);

            if (recentPayouts.length === 0) {
                container.innerHTML = '<p style="color: var(--eden-text-secondary); font-size: 13px;">No recent payouts</p>';
                return;
            }

            container.innerHTML = recentPayouts.map(payout => `
                <div class="payout-history-card">
                    <div class="payout-history-header">
                        <span class="payout-history-period">${payout.associateName}</span>
                        <span class="payout-history-status paid">Paid</span>
                    </div>
                    <div class="payout-history-row">
                        <span class="payout-history-sessions">${payout.sessionCount} sessions  ${formatPayoutPeriod(payout.periodStart, payout.periodEnd)}</span>
                        <span class="payout-history-amount">${payout.associateAmount.toFixed(2)}</span>
                    </div>
                    <div class="payout-history-paid-date">Paid ${formatPayoutDate(payout.paidDate)}  Ref: ${payout.paymentReference}</div>
                </div>
            `).join('');
        }

        // Update Payout Pipeline Alert Badge
        function updatePayoutPipelineAlert() {
            const alertBadge = document.getElementById('payoutPipelineAlert');
            if (alertBadge) {
                const pipeline = getPayoutPipeline();
                const totalSessions = pipeline.reduce((sum, a) => sum + a.sessions.length, 0);
                alertBadge.textContent = totalSessions + ' ready';
            }
        }

        // Open Payout Detail for an Associate
        function openPayoutDetail(associateId) {
            selectedPipelineAssociate = associateId;

            // Get pipeline data for this associate
            const pipeline = getPayoutPipeline();
            const associatePipeline = pipeline.find(p => p.associateId === associateId);

            if (!associatePipeline) {
                showToast('No sessions ready for payout');
                return;
            }

            // Update detail view
            const initials = associatePipeline.associateName.split(' ').map(n => n[0]).join('');
            document.getElementById('detailAvatar').textContent = initials;
            document.getElementById('detailName').textContent = associatePipeline.associateName;
            document.getElementById('detailId').textContent = associateId;
            document.getElementById('detailAmount').textContent = '' + associatePipeline.totalAssociateShare.toFixed(2);

            // Update breakdown
            const edenShare = associatePipeline.totalGross - associatePipeline.totalAssociateShare;
            document.getElementById('detailBreakdown').innerHTML = `
                <div class="section-title" style="margin-top: 20px;">Breakdown</div>
                <div class="info-row">
                    <span class="info-label">Gross Session Fees (${associatePipeline.sessions.length} sessions)</span>
                    <span class="info-value">${associatePipeline.totalGross.toFixed(2)}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Associate Share (69%)</span>
                    <span class="info-value positive">${associatePipeline.totalAssociateShare.toFixed(2)}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Eden Share (31%)</span>
                    <span class="info-value">${edenShare.toFixed(2)}</span>
                </div>
            `;

            // Update sessions list
            document.getElementById('detailSessionsList').innerHTML = associatePipeline.sessions.map(session => `
                <div class="session-item">
                    <div class="session-status-dot ready"></div>
                    <div class="session-item-info">
                        <div class="session-item-date">${formatSessionDate(session.sessionDate)}</div>
                        <div class="session-item-client">${session.clientName}  ${session.sessionType}</div>
                    </div>
                    <div class="session-item-amounts">
                        <div class="session-item-rate">${session.rate}</div>
                    </div>
                </div>
            `).join('');

            // Show detail view
            document.getElementById('payoutOverviewContent').style.display = 'none';
            document.getElementById('payoutDetailContent').style.display = 'block';
        }

        // Close Payout Detail
        function closePayoutDetail() {
            selectedPipelineAssociate = null;
            document.getElementById('payoutDetailContent').style.display = 'none';
            document.getElementById('payoutOverviewContent').style.display = 'block';
        }

        // Navigate to Associate from Payout Detail
        function navigateToAssociateFromPayoutDetail() {
            const associateId = selectedPipelineAssociate || document.getElementById('detailId').textContent;
            if (associateId) {
                closeWealthModule();
                showAssociateDetail(associateId);
            }
        }

        // Create Payout Batch
        function createPayoutBatch() {
            if (!selectedPipelineAssociate) return;

            const pipeline = getPayoutPipeline();
            const associatePipeline = pipeline.find(p => p.associateId === selectedPipelineAssociate);

            if (!associatePipeline) return;

            // In a real app, this would create a payout record in Airtable
            // and potentially send to QuickBooks
            showToast(`Payout batch created for ${associatePipeline.associateName}: ${associatePipeline.totalAssociateShare.toFixed(2)}`);

            // Close detail and refresh
            closePayoutDetail();
            initPayoutPipeline();
        }

        // Open Associate from Payout card (duplicate kept for backwards compatibility)
        // Note: Primary function is defined earlier in the file
        function openAssociateFromPayoutCard(associateId) {
            closeWealthModule();
            showAssociateDetail(associateId);
        }

        function markAsPaid() {
            // In a real app, this would make an API call
            showToast('Payment marked as paid!');
            closePayoutDetail();
        }

        // ============================================
        // TRUE CASH FUNCTIONS
        // ============================================

        // Initialize True Cash display with real data
        function initTrueCash() {
            const cashData = calculateTrueCash();

            // Update values
            const trueCashValue = document.getElementById('trueCashValue');
            const bankBalanceValue = document.getElementById('bankBalanceValue');
            const outstandingPayoutsValue = document.getElementById('outstandingPayoutsValue');
            const taxReserveValue = document.getElementById('taxReserveValue');
            const trueCashPulse = document.getElementById('trueCashPulse');
            const trueCashStatus = document.getElementById('trueCashStatus');
            const trueCashRunway = document.getElementById('trueCashRunway');

            if (trueCashValue) trueCashValue.textContent = '' + cashData.trueCash.toFixed(0).toLocaleString();
            if (bankBalanceValue) bankBalanceValue.textContent = '' + cashData.bankBalance.toFixed(0).toLocaleString();
            if (outstandingPayoutsValue) outstandingPayoutsValue.textContent = '' + cashData.outstandingPayouts.toFixed(0).toLocaleString();
            if (taxReserveValue) taxReserveValue.textContent = '' + cashData.taxReserve.toFixed(0).toLocaleString();

            // Determine health status based on runway
            let healthStatus = 'healthy';
            let statusText = 'Healthy';
            if (cashData.runway < 1) {
                healthStatus = 'critical';
                statusText = 'Critical';
            } else if (cashData.runway < 3) {
                healthStatus = 'caution';
                statusText = 'Caution';
            }

            // Update pulse indicator
            if (trueCashPulse) {
                trueCashPulse.className = 'pulse-dot ' + healthStatus;
            }
            if (trueCashStatus) trueCashStatus.textContent = statusText;
            if (trueCashRunway) trueCashRunway.textContent = '~' + cashData.runway.toFixed(1) + ' months runway';
        }

        // ============================================
        // WEALTH LAB SIMULATOR FUNCTIONS
        // ============================================

        const simulatorDefaults = {
            sessions: 25,
            rate: 75,
            split: 40,
            overheads: 800,
            taxRate: 25
        };

        function formatCurrency(value) {
            return '' + value.toLocaleString('en-GB', { maximumFractionDigits: 0 });
        }

        function updateSimulator() {
            // Get input values
            const sessions = parseInt(document.getElementById('sessionsSlider').value);
            const rate = parseInt(document.getElementById('rateSlider').value);
            const split = parseInt(document.getElementById('splitSlider').value);
            const overheads = parseInt(document.getElementById('overheadsSlider').value);
            const taxRate = parseInt(document.getElementById('taxRateSlider').value);

            // Update displayed values
            document.getElementById('sessionsValue').textContent = sessions;
            document.getElementById('rateValue').textContent = formatCurrency(rate);
            document.getElementById('splitValue').textContent = split + '%';
            document.getElementById('overheadsValue').textContent = formatCurrency(overheads);
            document.getElementById('taxRateValue').textContent = taxRate + '%';

            // Calculate monthly values (4.33 weeks per month)
            const weeksPerMonth = 4.33;
            const grossRevenue = sessions * rate * weeksPerMonth;
            const practiceShareAmount = grossRevenue * (split / 100);
            const netToPractice = grossRevenue - practiceShareAmount;
            const taxReserveAmount = netToPractice * (taxRate / 100);
            const trueCash = netToPractice - overheads - taxReserveAmount;

            // Update results display
            document.getElementById('grossRevenue').textContent = formatCurrency(grossRevenue);
            document.getElementById('practiceShare').textContent = '' + formatCurrency(practiceShareAmount);
            document.getElementById('netToPractice').textContent = formatCurrency(netToPractice);
            document.getElementById('overheadsResult').textContent = '' + formatCurrency(overheads);
            document.getElementById('taxReserveResult').textContent = '' + formatCurrency(taxReserveAmount);
            document.getElementById('trueCashResult').textContent = formatCurrency(trueCash);

            // Update hero value
            document.getElementById('projectedIncome').textContent = formatCurrency(trueCash);

            // Update projections
            document.getElementById('projection3m').textContent = formatCurrency(trueCash * 3);
            document.getElementById('projection6m').textContent = formatCurrency(trueCash * 6);
            document.getElementById('projection12m').textContent = formatCurrency(trueCash * 12);

            // Update dynamic label for practice share
            const practiceShareLabel = document.querySelector('#practiceShare').closest('.results-row').querySelector('.results-label');
            if (practiceShareLabel) {
                practiceShareLabel.textContent = `Practice Share (${split}%)`;
            }

            // Update dynamic label for tax reserve
            const taxReserveLabel = document.querySelector('#taxReserveResult').closest('.results-row').querySelector('.results-label');
            if (taxReserveLabel) {
                taxReserveLabel.textContent = `Tax Reserve (${taxRate}%)`;
            }
        }

        function resetSimulator() {
            // Reset sliders to defaults
            document.getElementById('sessionsSlider').value = simulatorDefaults.sessions;
            document.getElementById('rateSlider').value = simulatorDefaults.rate;
            document.getElementById('splitSlider').value = simulatorDefaults.split;
            document.getElementById('overheadsSlider').value = simulatorDefaults.overheads;
            document.getElementById('taxRateSlider').value = simulatorDefaults.taxRate;

            // Recalculate
            updateSimulator();
        }

        function initSimulator() {
            // Initialize with default values
            updateSimulator();
        }

        // ============================================
        // IVY WALLET-INSPIRED HOME SCREEN FUNCTIONS
        // ============================================

        // Home navigation stack
        let homeNavStack = ['home'];
        let currentHomePeriod = 'week';

        // Mock session data for associate view
        const associateSessions = [
            { id: 'SES-001', client: 'James Wilson', initials: 'JW', date: 'Monday', time: '10:00 AM', fee: 85, status: 'paid' },
            { id: 'SES-002', client: 'Emma Stone', initials: 'ES', date: 'Monday', time: '2:00 PM', fee: 85, status: 'pending' },
            { id: 'SES-003', client: 'David Miller', initials: 'DM', date: 'Tuesday', time: '11:00 AM', fee: 85, status: 'paid' },
            { id: 'SES-004', client: 'Sophie Taylor', initials: 'ST', date: 'Wednesday', time: '9:00 AM', fee: 85, status: 'paid' },
            { id: 'SES-005', client: 'Mark Harris', initials: 'MH', date: 'Wednesday', time: '3:00 PM', fee: 85, status: 'pending' },
            { id: 'SES-006', client: 'Rachel Green', initials: 'RG', date: 'Thursday', time: '10:00 AM', fee: 85, status: 'paid' },
            { id: 'SES-007', client: 'Tom Bennett', initials: 'TB', date: 'Friday', time: '11:00 AM', fee: 85, status: 'paid' },
            { id: 'SES-008', client: 'Nina Patel', initials: 'NP', date: 'Friday', time: '2:00 PM', fee: 85, status: 'paid' }
        ];

        // Update home screen based on role
        function updateHomeScreenForRole() {
            const associateHome = document.getElementById('associateHome');
            const adminHome = document.getElementById('adminHome');

            if (!associateHome || !adminHome) return;

            if (currentUserRole === 'associate') {
                associateHome.classList.add('active');
                adminHome.classList.remove('active');
                updateAssociateHomeData();
            } else {
                associateHome.classList.remove('active');
                adminHome.classList.add('active');
                updateAdminHomeData();
                animateCashDensityRing();
            }

            // Hide all nav views
            document.querySelectorAll('.nav-view').forEach(v => v.classList.remove('active'));
        }

        // Update associate home with current user data
        function updateAssociateHomeData() {
            // Get greeting based on time of day
            const hour = new Date().getHours();
            let greeting = 'Good morning';
            if (hour >= 12 && hour < 17) greeting = 'Good afternoon';
            else if (hour >= 17) greeting = 'Good evening';

            // Get associate name (first name only)
            const firstName = currentUserName.split(' ')[0];
            const greetingEl = document.getElementById('associateGreeting');
            if (greetingEl) greetingEl.textContent = `${greeting}, ${firstName}`;

            // Update stats based on period
            updateAssociateStats();
        }

        function updateAssociateStats() {
            const periodData = {
                week: { sessions: 8, pending: 2, earnings: '680', label: 'This week' },
                month: { sessions: 32, pending: 5, earnings: '2,720', label: 'This month' },
                quarter: { sessions: 96, pending: 8, earnings: '8,160', label: 'This quarter' }
            };

            const data = periodData[currentHomePeriod];

            const statSessions = document.getElementById('statSessions');
            const statPending = document.getElementById('statPending');
            const statEarnings = document.getElementById('statEarnings');
            const statSessionsSubtext = document.getElementById('statSessionsSubtext');
            const statEarningsSubtext = document.getElementById('statEarningsSubtext');

            if (statSessions) statSessions.textContent = data.sessions;
            if (statPending) statPending.textContent = data.pending;
            if (statEarnings) statEarnings.textContent = data.earnings;
            if (statSessionsSubtext) statSessionsSubtext.textContent = data.label;
            if (statEarningsSubtext) statEarningsSubtext.textContent = data.label;

            // Show/hide pending pulse dot based on count
            const pendingCard = document.getElementById('pendingStatCard');
            const pulseDot = document.getElementById('pendingPulseDot');
            if (data.pending > 0) {
                if (pendingCard) pendingCard.classList.add('warning');
                if (pulseDot) pulseDot.style.display = 'block';
            } else {
                if (pendingCard) pendingCard.classList.remove('warning');
                if (pulseDot) pulseDot.style.display = 'none';
            }
        }

        // Update admin home data
        function updateAdminHomeData() {
            // Calculate total pending from all associates
            let totalPending = 0;
            associates.forEach(a => {
                const amount = parseInt(a.pendingPayout.replace('', '').replace(',', '')) || 0;
                totalPending += amount;
            });

            const adminPendingCount = document.getElementById('adminPendingCount');
            if (adminPendingCount) adminPendingCount.textContent = '' + totalPending.toLocaleString();

            const adminAssociatesCount = document.getElementById('adminAssociatesCount');
            if (adminAssociatesCount) adminAssociatesCount.textContent = associates.length;

            const adminClientsCount = document.getElementById('adminClientsCount');
            if (adminClientsCount) adminClientsCount.textContent = clients.length;

            // Show pulse dot if pending > 0
            const adminPendingPulse = document.getElementById('adminPendingPulse');
            if (adminPendingPulse) {
                adminPendingPulse.style.display = totalPending > 0 ? 'block' : 'none';
            }
        }

        // Animate Cash Density Ring
        function animateCashDensityRing() {
            const ring = document.getElementById('cashRingProgress');
            if (!ring) return;

            // Reset animation
            ring.style.strokeDashoffset = 377;

            // Calculate target (example: 75% of projected)
            const trueCash = 18450;
            const projected = 24680;
            const percentage = trueCash / projected;
            const circumference = 2 * Math.PI * 60; // r=60
            const targetOffset = circumference * (1 - percentage);

            // Animate after a short delay
            setTimeout(() => {
                ring.style.transition = 'stroke-dashoffset 1.5s ease-out';
                ring.style.strokeDashoffset = targetOffset;
            }, 100);
        }

        // Set home period (This Week / This Month / Quarter)
        function setHomePeriod(period) {
            currentHomePeriod = period;

            // Update period selector buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update stats
            updateAssociateStats();
        }

        // Navigate to associate view (sessions, pending, earnings, clients, inbox)
        function navigateToAssociateView(viewName) {
            homeNavStack.push(viewName);

            // Hide home screens
            document.getElementById('associateHome').classList.remove('active');
            document.getElementById('adminHome').classList.remove('active');

            // Hide all nav views first
            document.querySelectorAll('.nav-view').forEach(v => v.classList.remove('active'));

            // Show the target view
            const viewMap = {
                'sessions': 'sessionsNavView',
                'pending': 'pendingNavView',
                'earnings': 'earningsNavView',
                'clients': 'clientsNavView',
                'inbox': 'inboxNavView',
                'pipeline': 'clientsNavView'
            };

            const targetViewId = viewMap[viewName];
            const targetView = document.getElementById(targetViewId);
            if (targetView) {
                targetView.classList.add('active');
                populateAssociateView(viewName);
            }
        }

        // Navigate to admin view
        function navigateToAdminView(viewName) {
            homeNavStack.push(viewName);

            // Hide home screens
            document.getElementById('associateHome').classList.remove('active');
            document.getElementById('adminHome').classList.remove('active');

            // Hide all nav views first
            document.querySelectorAll('.nav-view').forEach(v => v.classList.remove('active'));

            // Show the target view
            const viewMap = {
                'pending-payments': 'adminPendingView',
                'finance': 'adminFinanceView',
                'health': 'adminHealthView'
            };

            const targetViewId = viewMap[viewName];
            const targetView = document.getElementById(targetViewId);
            if (targetView) {
                targetView.classList.add('active');
                populateAdminView(viewName);
            }
        }

        // Navigate back to home
        function navigateHomeBack() {
            if (homeNavStack.length > 1) {
                homeNavStack.pop();
            }

            const currentView = homeNavStack[homeNavStack.length - 1];

            if (currentView === 'home') {
                // Hide all nav views
                document.querySelectorAll('.nav-view').forEach(v => v.classList.remove('active'));
                // Show appropriate home screen
                updateHomeScreenForRole();
            } else {
                // Navigate to the view on the stack
                if (currentUserRole === 'associate') {
                    navigateToAssociateView(currentView);
                } else {
                    navigateToAdminView(currentView);
                }
            }
        }

        // Populate associate views with content
        function populateAssociateView(viewName) {
            switch (viewName) {
                case 'sessions':
                    populateSessionsView();
                    break;
                case 'pending':
                    populatePendingView();
                    break;
                case 'earnings':
                    populateEarningsView();
                    break;
                case 'clients':
                case 'pipeline':
                    populateClientsView();
                    break;
                case 'inbox':
                    populateAssociateInboxView();
                    break;
            }
        }

        // Populate sessions view
        function populateSessionsView() {
            const container = document.getElementById('sessionsContent');
            if (!container) return;

            // Group sessions by day
            const sessionsByDay = {};
            associateSessions.forEach(s => {
                if (!sessionsByDay[s.date]) sessionsByDay[s.date] = [];
                sessionsByDay[s.date].push(s);
            });

            let html = '';
            Object.entries(sessionsByDay).forEach(([day, sessions]) => {
                html += `<div class="day-group">
                    <div class="day-label">${day}</div>`;

                sessions.forEach(session => {
                    html += `
                        <div class="session-item" onclick="openSessionDetail('${session.id}')">
                            <div class="session-avatar">${session.initials}</div>
                            <div class="session-info">
                                <div class="session-client">${session.client}</div>
                                <div class="session-time">${session.time}</div>
                            </div>
                            <div class="session-amount">
                                <div class="session-fee">${session.fee}</div>
                                <div class="session-status ${session.status}">${session.status === 'paid' ? ' Paid' : 'Pending'}</div>
                            </div>
                        </div>`;
                });

                html += '</div>';
            });

            container.innerHTML = html;
        }

        // Populate pending payments view
        function populatePendingView() {
            const container = document.getElementById('pendingContent');
            if (!container) return;

            const pendingSessions = associateSessions.filter(s => s.status === 'pending');
            const totalPending = pendingSessions.reduce((sum, s) => sum + s.fee, 0);

            let html = `
                <div class="pending-summary-card">
                    <div class="pending-summary-value">${totalPending}</div>
                    <div class="pending-summary-label">${pendingSessions.length} sessions awaiting payment</div>
                </div>`;

            pendingSessions.forEach(session => {
                html += `
                    <div class="session-item" onclick="openSessionDetail('${session.id}')">
                        <div class="session-avatar">${session.initials}</div>
                        <div class="session-info">
                            <div class="session-client">${session.client}</div>
                            <div class="session-time">${session.date}, ${session.time}</div>
                        </div>
                        <div class="session-amount">
                            <div class="session-fee">${session.fee}</div>
                            <div class="session-status pending">Pending</div>
                        </div>
                    </div>`;
            });

            container.innerHTML = html;
        }

        // Populate earnings view
        function populateEarningsView() {
            const container = document.getElementById('earningsContent');
            if (!container) return;

            const paidSessions = associateSessions.filter(s => s.status === 'paid');
            const upcomingPayout = paidSessions.reduce((sum, s) => sum + s.fee, 0);

            container.innerHTML = `
                <div class="payout-preview-card">
                    <div class="payout-preview-header">
                        <span class="payout-preview-label">Upcoming Payout</span>
                        <span class="payout-preview-date">15th January</span>
                    </div>
                    <div class="payout-preview-amount">${upcomingPayout}</div>
                    <div class="payout-preview-sessions">${paidSessions.length} sessions confirmed</div>
                </div>

                <div class="section-title">Payout History</div>
                <div class="payout-history-list">
                    <div class="payout-history-item">
                        <div class="payout-history-header">
                            <span class="payout-month">December 2025</span>
                            <span class="payout-status completed">Paid</span>
                        </div>
                        <div class="payout-history-details">
                            <span class="payout-amount">2,180</span>
                            <span class="payout-date">Paid 15 Dec</span>
                        </div>
                    </div>
                    <div class="payout-history-item">
                        <div class="payout-history-header">
                            <span class="payout-month">November 2025</span>
                            <span class="payout-status completed">Paid</span>
                        </div>
                        <div class="payout-history-details">
                            <span class="payout-amount">1,890</span>
                            <span class="payout-date">Paid 15 Nov</span>
                        </div>
                    </div>
                </div>`;
        }

        // Populate clients view
        function populateClientsView() {
            const container = document.getElementById('clientsNavContent');
            if (!container) return;

            // Get clients for current associate
            const myClients = currentUserId
                ? clients.filter(c => c.associateId === currentUserId)
                : clients.slice(0, 12); // Mock for testing

            // Count by stage
            const stageCounts = {
                awaiting: myClients.filter(c => c.stage === 'awaiting').length,
                pending: myClients.filter(c => c.stage === 'pending').length,
                active: myClients.filter(c => c.stage === 'active').length,
                ending: myClients.filter(c => c.stage === 'ending').length
            };

            let html = `
                <div class="pipeline-visual" style="margin-bottom: 24px; padding: 16px; background: var(--eden-mint); border-radius: var(--radius-card);">
                    <div class="pipeline-stage-dot">
                        <div class="stage-dot" style="background: #9b59b6;"></div>
                        <span class="stage-count">${stageCounts.awaiting}</span>
                        <span class="stage-label">Awaiting</span>
                    </div>
                    <div class="pipeline-connector"></div>
                    <div class="pipeline-stage-dot">
                        <div class="stage-dot" style="background: #f39c12;"></div>
                        <span class="stage-count">${stageCounts.pending}</span>
                        <span class="stage-label">Pending</span>
                    </div>
                    <div class="pipeline-connector"></div>
                    <div class="pipeline-stage-dot">
                        <div class="stage-dot active"></div>
                        <span class="stage-count">${stageCounts.active}</span>
                        <span class="stage-label">Active</span>
                    </div>
                    <div class="pipeline-connector"></div>
                    <div class="pipeline-stage-dot">
                        <div class="stage-dot" style="background: #7f8c8d;"></div>
                        <span class="stage-count">${stageCounts.ending}</span>
                        <span class="stage-label">Ending</span>
                    </div>
                </div>

                <div class="section-title">In Pipeline</div>`;

            const inPipeline = myClients.filter(c => c.stage !== 'active');
            inPipeline.forEach(client => {
                html += `
                    <div class="session-item" onclick="openClientPanel('${client.id}')">
                        <div class="session-avatar">${client.initials}</div>
                        <div class="session-info">
                            <div class="session-client">${client.name}</div>
                            <div class="session-time">${client.id}</div>
                        </div>
                        <span class="badge badge-${client.stage === 'pending' ? 'warning' : 'info'}">${client.stage}</span>
                    </div>`;
            });

            html += '<div class="section-title" style="margin-top: 24px;">Active Clients</div>';

            const activeClients = myClients.filter(c => c.stage === 'active');
            activeClients.forEach(client => {
                html += `
                    <div class="session-item" onclick="openClientPanel('${client.id}')">
                        <div class="session-avatar">${client.initials}</div>
                        <div class="session-info">
                            <div class="session-client">${client.name}</div>
                            <div class="session-time">${client.id}</div>
                        </div>
                        <span class="badge badge-success">Active</span>
                    </div>`;
            });

            container.innerHTML = html;
        }

        // Populate associate inbox view
        function populateAssociateInboxView() {
            const container = document.getElementById('inboxNavContent');
            if (!container) return;

            container.innerHTML = messages.map(msg => `
                <div class="session-item ${msg.unread ? 'unread' : ''}" onclick="openMessage('${msg.id}')" style="position: relative;">
                    <div class="session-avatar" style="background: ${msg.unread ? 'var(--eden-green)' : 'var(--eden-green-light)'}; color: ${msg.unread ? 'white' : 'var(--eden-green)'};">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                    </div>
                    <div class="session-info" style="flex: 1;">
                        <div class="session-client" style="font-weight: ${msg.unread ? '600' : '500'};">${msg.subject}</div>
                        <div class="session-time">${msg.from}</div>
                    </div>
                    <div style="font-size: 12px; color: var(--eden-text-muted);">${msg.date}</div>
                </div>
            `).join('');
        }

        // Open session detail
        function openSessionDetail(sessionId) {
            const session = associateSessions.find(s => s.id === sessionId);
            if (!session) return;

            homeNavStack.push('session-detail');

            // Hide all nav views
            document.querySelectorAll('.nav-view').forEach(v => v.classList.remove('active'));

            // Show session detail view
            const view = document.getElementById('sessionDetailView');
            if (view) {
                view.classList.add('active');
                populateSessionDetail(session);
            }
        }

        // Populate session detail
        function populateSessionDetail(session) {
            const container = document.getElementById('sessionDetailContent');
            if (!container) return;

            const isPaid = session.status === 'paid';

            container.innerHTML = `
                <div class="session-detail-card">
                    <div class="session-detail-header">
                        <div class="session-detail-avatar">${session.initials}</div>
                        <div class="session-detail-info">
                            <h3>${session.client}</h3>
                            <p>${session.date}, ${session.time}</p>
                        </div>
                    </div>

                    <div class="session-detail-row">
                        <span class="session-detail-label">Session Fee</span>
                        <span class="session-detail-value">${session.fee}</span>
                    </div>
                    <div class="session-detail-row">
                        <span class="session-detail-label">Session ID</span>
                        <span class="session-detail-value" style="font-family: monospace;">${session.id}</span>
                    </div>
                </div>

                <div class="stripe-status-section">
                    <div class="stripe-status-header">
                        <span class="stripe-logo">stripe</span>
                        <span>Payment Status</span>
                    </div>
                    <div class="stripe-status-badge ${isPaid ? 'paid' : 'pending'}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            ${isPaid
                                ? '<path d="M20 6L9 17l-5-5"/>'
                                : '<circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>'
                            }
                        </svg>
                        ${isPaid ? 'Payment Confirmed' : 'Payment Pending'}
                    </div>
                </div>

                <div class="action-btn-group">
                    ${isPaid
                        ? '<button class="action-btn action-btn-primary" onclick="navigateHomeBack()">Confirmed</button>'
                        : `<button class="action-btn action-btn-warning" onclick="showPaymentReminder('${session.id}')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                                Send Payment Reminder
                           </button>
                           <button class="action-btn action-btn-secondary" onclick="markSessionPaid('${session.id}')">
                                Mark as Paid (Manual)
                           </button>`
                    }
                </div>`;
        }

        // Show payment reminder email preview
        function showPaymentReminder(sessionId) {
            const session = associateSessions.find(s => s.id === sessionId);
            if (!session) return;

            const container = document.getElementById('sessionDetailContent');
            if (!container) return;

            container.innerHTML = `
                <div class="email-preview">
                    <div class="email-preview-header">Email Preview</div>
                    <div class="email-preview-to"><strong>To:</strong> ${session.client.toLowerCase().replace(' ', '.')}@email.com</div>
                    <div class="email-preview-subject"><strong>Subject:</strong> Payment Reminder - Session on ${session.date}</div>
                    <div class="email-preview-body">
Dear ${session.client.split(' ')[0]},

This is a friendly reminder that payment for your session on ${session.date} at ${session.time} is still pending.

Session Fee: ${session.fee}

Please complete your payment at your earliest convenience using the secure payment link below.

Best regards,
Eden Relationships
                    </div>
                </div>

                <div class="action-btn-group">
                    <button class="action-btn action-btn-primary" onclick="sendPaymentReminder('${session.id}')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                        Send Email
                    </button>
                    <button class="action-btn action-btn-secondary" onclick="openSessionDetail('${session.id}')">
                        Cancel
                    </button>
                </div>`;
        }

        // Send payment reminder
        function sendPaymentReminder(sessionId) {
            showToast('Payment reminder sent');
            navigateHomeBack();
        }

        // Mark session as paid manually
        function markSessionPaid(sessionId) {
            const session = associateSessions.find(s => s.id === sessionId);
            if (session) {
                session.status = 'paid';
                showToast('Session marked as paid');
                navigateHomeBack();
            }
        }

        // Populate admin views
        function populateAdminView(viewName) {
            switch (viewName) {
                case 'pending-payments':
                    populateAdminPendingView();
                    break;
                case 'finance':
                    populateAdminFinanceView();
                    break;
                case 'health':
                    populateAdminHealthView();
                    break;
            }
        }

        // Admin: Populate pending payments view
        function populateAdminPendingView() {
            const container = document.getElementById('adminPendingContent');
            if (!container) return;

            // Calculate total pending
            let totalPending = 0;
            associates.forEach(a => {
                const amount = parseInt(a.pendingPayout.replace('', '').replace(',', '')) || 0;
                totalPending += amount;
            });

            let html = `
                <div class="pending-summary-card">
                    <div class="pending-summary-value">${totalPending.toLocaleString()}</div>
                    <div class="pending-summary-label">Total pending across all associates</div>
                </div>

                <div class="section-title">By Associate</div>`;

            associates.forEach(associate => {
                if (associate.pendingPayout && associate.pendingPayout !== '0') {
                    html += `
                        <div class="session-item" onclick="showAssociateDetail('${associate.id}')" style="cursor: pointer;">
                            <div class="session-avatar">${associate.initials}</div>
                            <div class="session-info">
                                <div class="session-client">${associate.name}</div>
                                <div class="session-time">${associate.id}</div>
                            </div>
                            <div class="session-amount">
                                <div class="session-fee">${associate.pendingPayout}</div>
                                <div class="session-status pending">Pending</div>
                            </div>
                        </div>`;
                }
            });

            container.innerHTML = html;
        }

        // Admin: Populate finance view
        function populateAdminFinanceView() {
            const container = document.getElementById('adminFinanceContent');
            if (!container) return;

            // Mock financial data
            const bankBalance = 32450;
            const taxReserve = 8200;
            const trueCash = bankBalance - taxReserve;

            let totalPayouts = 0;
            associates.forEach(a => {
                const amount = parseInt(a.pendingPayout.replace('', '').replace(',', '')) || 0;
                totalPayouts += amount;
            });

            container.innerHTML = `
                <div class="session-detail-card">
                    <div class="section-title">True Cash Calculation</div>

                    <div class="session-detail-row">
                        <span class="session-detail-label">Bank Balance</span>
                        <span class="session-detail-value">${bankBalance.toLocaleString()}</span>
                    </div>
                    <div class="session-detail-row">
                        <span class="session-detail-label">Tax Reserve (25%)</span>
                        <span class="session-detail-value" style="color: #B45309;">- ${taxReserve.toLocaleString()}</span>
                    </div>
                    <div class="session-detail-row" style="border-top: 2px solid var(--eden-green); padding-top: 16px; margin-top: 8px;">
                        <span class="session-detail-label" style="font-weight: 600;">True Cash</span>
                        <span class="session-detail-value" style="font-size: 20px; color: var(--eden-green);">${trueCash.toLocaleString()}</span>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 24px;">Upcoming Obligations</div>

                <div class="session-item">
                    <div class="session-avatar" style="background: #FEF3C7; color: #92400E;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div class="session-info">
                        <div class="session-client">Associate Payouts</div>
                        <div class="session-time">Due 15th January</div>
                    </div>
                    <div class="session-fee">${totalPayouts.toLocaleString()}</div>
                </div>

                <div class="session-item">
                    <div class="session-avatar" style="background: #EFF6FF; color: #1E40AF;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                            <line x1="1" y1="10" x2="23" y2="10"/>
                        </svg>
                    </div>
                    <div class="session-info">
                        <div class="session-client">VAT Return</div>
                        <div class="session-time">Due 7th February</div>
                    </div>
                    <div class="session-fee">4,120</div>
                </div>`;
        }

        // Admin: Populate health view
        function populateAdminHealthView() {
            const container = document.getElementById('adminHealthContent');
            if (!container) return;

            // Calculate capacity metrics
            let totalClients = 0;
            let totalCapacity = 0;
            associates.forEach(a => {
                totalClients += a.clients;
                totalCapacity += a.maxCapacity;
            });
            const avgCapacity = Math.round((totalClients / totalCapacity) * 100);

            container.innerHTML = `
                <div class="session-detail-card" style="text-align: center;">
                    <div class="progress-ring-container" style="margin-bottom: 16px;">
                        <svg class="progress-ring" width="120" height="120">
                            <circle class="progress-ring-bg" cx="60" cy="60" r="50" stroke-width="10" fill="none" stroke="var(--eden-border)"/>
                            <circle class="progress-ring-progress" cx="60" cy="60" r="50" stroke-width="10" fill="none" stroke="var(--eden-green)"
                                stroke-dasharray="314" stroke-dashoffset="${314 * (1 - avgCapacity / 100)}" style="transform: rotate(-90deg); transform-origin: center;"/>
                        </svg>
                        <div class="progress-ring-content" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div class="progress-ring-value" style="font-size: 28px; color: var(--eden-green);">${avgCapacity}%</div>
                            <div class="progress-ring-label" style="font-size: 12px; color: var(--eden-text-secondary);">Utilisation</div>
                        </div>
                    </div>
                    <p style="color: var(--eden-text-secondary); font-size: 14px;">Average capacity across ${associates.length} associates</p>
                </div>

                <div class="section-title" style="margin-top: 24px;">Associate Capacity</div>`;

            let html = container.innerHTML;

            associates.forEach(associate => {
                const capacity = Math.round((associate.clients / associate.maxCapacity) * 100);
                const isHigh = capacity >= 80;

                html += `
                    <div class="session-item" onclick="showAssociateDetail('${associate.id}')" style="cursor: pointer;">
                        <div class="session-avatar">${associate.initials}</div>
                        <div class="session-info" style="flex: 1;">
                            <div class="session-client">${associate.name}</div>
                            <div style="height: 4px; background: var(--eden-border); border-radius: 2px; margin-top: 6px;">
                                <div style="height: 100%; width: ${capacity}%; background: ${isHigh ? '#B45309' : 'var(--eden-green)'}; border-radius: 2px;"></div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="session-fee" style="color: ${isHigh ? '#B45309' : 'var(--eden-text)'};">${capacity}%</div>
                            <div style="font-size: 11px; color: var(--eden-text-muted);">${associate.clients}/${associate.maxCapacity}</div>
                        </div>
                    </div>`;
            });

            container.innerHTML = html;
        }

        // ============================================
        // REFERRAL SYSTEM FUNCTIONS
        // ============================================

        let currentReferralFilter = 'all';

        // Render referrals based on role
        function renderReferrals() {
            if (currentUserRole === 'admin') {
                renderAdminReferrals();
                document.getElementById('referralsAdminView').style.display = 'block';
                document.getElementById('referralsAssociateView').style.display = 'none';
            } else {
                renderAssociateReferrals();
                document.getElementById('referralsAdminView').style.display = 'none';
                document.getElementById('referralsAssociateView').style.display = 'block';
            }
            updateReferralAlertDot();
        }

        // Admin: Render referral command centre
        function renderAdminReferrals() {
            // Update stats
            const newCount = referrals.filter(r => r.status === 'New').length;
            const broadcastingCount = referrals.filter(r => r.status === 'Broadcasting').length;
            const pendingCount = referrals.filter(r => r.status === 'Pending Allocation').length;
            const acceptedCount = referrals.filter(r => r.status === 'Accepted').length;

            document.getElementById('refStatNew').textContent = newCount;
            document.getElementById('refStatBroadcasting').textContent = broadcastingCount;
            document.getElementById('refStatPending').textContent = pendingCount;
            document.getElementById('refStatAccepted').textContent = acceptedCount;

            // Filter referrals
            let filteredReferrals = referrals;
            if (currentReferralFilter !== 'all') {
                filteredReferrals = referrals.filter(r => r.status === currentReferralFilter);
            }

            // Sort by createdAt descending
            filteredReferrals.sort((a, b) => b.createdAt - a.createdAt);

            const container = document.getElementById('referralListAdmin');

            if (filteredReferrals.length === 0) {
                container.innerHTML = `
                    <div class="referral-empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <line x1="19" y1="8" x2="19" y2="14"/>
                            <line x1="22" y1="11" x2="16" y2="11"/>
                        </svg>
                        <h3>No referrals</h3>
                        <p>No referrals match the current filter.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredReferrals.map(ref => {
                const hoursAgo = Math.floor((Date.now() - ref.createdAt) / (1000 * 60 * 60));
                const timeLabel = hoursAgo < 24 ? `${hoursAgo}h ago` : `${Math.floor(hoursAgo/24)}d ago`;

                const statusClass = ref.status.toLowerCase().replace(' ', '-').replace(' allocation', '');
                const actionMode = ref.status === 'New' ? 'triage' :
                                  ref.status === 'Pending Allocation' ? 'allocate' : 'view';

                // Get expression counts for broadcasting referrals
                let footerHtml = '';
                if (ref.status === 'Broadcasting' && ref.broadcastExpiresAt) {
                    const hoursRemaining = Math.max(0, Math.floor((ref.broadcastExpiresAt - Date.now()) / (1000 * 60 * 60)));
                    const interestedCount = referralExpressions.filter(e => e.referralId === ref.id && e.status === 'Interested').length;
                    footerHtml = `
                        <div class="referral-card-footer">
                            <span class="referral-time-remaining">${hoursRemaining}h remaining</span>
                            <span class="referral-interest-count">${interestedCount} interested</span>
                        </div>
                    `;
                } else if (ref.status === 'Pending Allocation') {
                    const interestedCount = referralExpressions.filter(e => e.referralId === ref.id && e.status === 'Interested').length;
                    footerHtml = `
                        <div class="referral-card-footer">
                            <span class="referral-interest-count" style="color: var(--referral-pending);">${interestedCount} interested - ready to allocate</span>
                        </div>
                    `;
                }

                return `
                    <div class="referral-card" onclick="openReferralPanel('${ref.id}', '${actionMode}')">
                        <div class="referral-card-header">
                            <div>
                                <span class="referral-card-id">${ref.id}</span>
                                <span class="referral-status-badge ${statusClass}">${ref.status}</span>
                            </div>
                            <span class="referral-card-time">${timeLabel}</span>
                        </div>
                        ${ref.clientPseudonym ? `<div class="referral-card-pseudonym">${ref.clientPseudonym}</div>` : ''}
                        <div class="referral-card-enquiry">"${ref.enquiryText}"</div>
                        <div class="referral-card-meta">
                            <span class="referral-card-meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                ${ref.preferredTimes.join(', ')}
                            </span>
                            ${ref.presentingIssue ? `<span class="referral-card-meta-item">${ref.presentingIssue}</span>` : ''}
                        </div>
                        ${footerHtml}
                    </div>
                `;
            }).join('');
        }

        // Associate: Render referral inbox
        function renderAssociateReferrals() {
            const settings = associateReferralSettings[currentUserId] || { acceptingReferrals: true, capacitySlots: 2, availableTimes: [] };

            // Update capacity display
            const toggle = document.getElementById('acceptingToggle');
            if (toggle) {
                toggle.classList.toggle('active', settings.acceptingReferrals);
            }
            const slotsText = document.getElementById('capacitySlotsText');
            if (slotsText) {
                slotsText.textContent = `${settings.capacitySlots} slots available`;
            }

            // Get available referrals (Broadcasting status, matching times)
            const availableReferrals = referrals.filter(ref => {
                if (ref.status !== 'Broadcasting') return false;

                // Check if associate already has an expression for this referral
                const existingExpression = referralExpressions.find(e =>
                    e.referralId === ref.id && e.associateId === currentUserId
                );

                // Only show if expression is pending or doesn't exist
                if (existingExpression && existingExpression.status !== 'Pending') return false;

                return true;
            });

            // Update badge
            const badge = document.getElementById('availableReferralsBadge');
            if (badge) {
                badge.textContent = `${availableReferrals.length} available`;
            }

            const container = document.getElementById('referralListAssociate');

            if (availableReferrals.length === 0) {
                container.innerHTML = `
                    <div class="referral-empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <h3>All caught up!</h3>
                        <p>No referrals matching your availability right now.</p>
                    </div>
                `;
            } else {
                container.innerHTML = availableReferrals.map(ref => {
                    const hoursRemaining = Math.max(0, Math.floor((ref.broadcastExpiresAt - Date.now()) / (1000 * 60 * 60)));

                    return `
                        <div class="referral-card">
                            <div class="referral-card-header">
                                <span class="referral-card-id">${ref.id}</span>
                                <span class="referral-status-badge broadcasting">${hoursRemaining}h left</span>
                            </div>
                            ${ref.presentingIssue ? `
                                <div class="specialisation-tags">
                                    <span class="specialisation-tag">${ref.presentingIssue}</span>
                                </div>
                            ` : ''}
                            <div class="referral-card-enquiry">"${ref.enquiryText}"</div>
                            <div class="referral-card-meta">
                                <span class="referral-card-meta-item">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    Preferred: ${ref.preferredTimes.join(', ')}
                                </span>
                            </div>
                            <div class="referral-card-actions">
                                <button class="referral-action-btn primary" onclick="event.stopPropagation(); openReferralPanel('${ref.id}', 'interest')">
                                    I'm Interested
                                </button>
                                <button class="referral-action-btn secondary" onclick="event.stopPropagation(); declineReferral('${ref.id}')">
                                    Not For Me
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Render awaiting allocation section
            const myExpressions = referralExpressions.filter(e =>
                e.associateId === currentUserId && e.status === 'Interested'
            );

            const expressionsContainer = document.getElementById('myExpressionsLis');
            if (myExpressions.length === 0) {
                expressionsContainer.innerHTML = `
                    <p style="font-size: 14px; color: var(--eden-text-secondary); padding: 16px 0;">No pending expressions.</p>
                `;
            } else {
                expressionsContainer.innerHTML = myExpressions.map(exp => {
                    const ref = referrals.find(r => r.id === exp.referralId);
                    if (!ref) return '';

                    return `
                        <div class="referral-card" style="cursor: default;">
                            <div class="referral-card-header">
                                <span class="referral-card-id">${ref.id}</span>
                                <span class="referral-status-badge pending">Awaiting decision</span>
                            </div>
                            ${ref.clientPseudonym ? `<div class="referral-card-pseudonym">${ref.clientPseudonym}</div>` : ''}
                            <p style="font-size: 13px; color: var(--eden-text-secondary); margin-top: 8px;">
                                You expressed interest. Waiting for admin to make allocation decision.
                            </p>
                        </div>
                    `;
                }).join('');
            }
        }

        // Filter referrals by status
        function filterReferrals(status) {
            currentReferralFilter = status;

            // Update active state on stat cards
            document.querySelectorAll('.referral-stat-card').forEach(card => {
                card.classList.remove('active');
                const cardStatus = card.dataset.status;
                if ((status === 'all' && cardStatus === 'accepted') ||
                    (status === 'New' && cardStatus === 'new') ||
                    (status === 'Broadcasting' && cardStatus === 'broadcasting') ||
                    (status === 'Pending Allocation' && cardStatus === 'pending')) {
                    card.classList.add('active');
                }
            });

            renderAdminReferrals();
        }

        // Open referral panel
        function openReferralPanel(referralId, mode) {
            // Use unified detail view
            const referral = referrals.find(r => r.id === referralId);
            if (referral) {
                DetailView.open('referral', referral, 'Referrals');
            }
        }

        // Close referral panel - redirect to new closeReferralDetail
        function closeReferralPanel() {
            closeReferralDetail();
        }

        // Render triage panel content
        function renderTriageContent(ref) {
            const eligibleAssociates = getEligibleAssociates(ref);

            return `
                <div class="panel-section">
                    <div class="panel-section-title">Enquiry</div>
                    <div class="enquiry-preview">
                        <p class="enquiry-text">"${ref.enquiryText}"</p>
                        <div class="enquiry-meta">
                            ${ref.contactEmail}<br>
                            <div style="margin-top: 4px; display: flex; gap: 8px;">
                                ${ref.preferredTimes.map(t => `<span style="background: var(--pure-white); padding: 2px 8px; border-radius: 4px; font-size: 11px;">${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-section-title">Triage Fields</div>

                    <div class="form-group">
                        <label class="form-label">Client Reference</label>
                        <input type="text" class="form-input" id="triageClientRef" placeholder="e.g. Emma R" value="${ref.clientPseudonym || ''}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Presenting Issue</label>
                        <select class="form-select" id="triagePresentingIssue">
                            <option value="">Select...</option>
                            ${SPECIALISATIONS.map(s => `<option value="${s}" ${ref.presentingIssue === s ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Urgency</label>
                        <div class="urgency-selector">
                            <button class="urgency-btn ${ref.urgency === 'Standard' || !ref.urgency ? 'active' : ''}" onclick="setUrgency('Standard')">Standard</button>
                            <button class="urgency-btn ${ref.urgency === 'Priority' ? 'active' : ''}" onclick="setUrgency('Priority')">Priority</button>
                            <button class="urgency-btn ${ref.urgency === 'Urgent' ? 'active' : ''}" onclick="setUrgency('Urgent')">Urgent</button>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-section-title">Eligible Associates (${eligibleAssociates.filter(a => a.eligible).length})</div>
                    <div class="associate-checkbox-list" id="associateCheckboxList">
                        ${eligibleAssociates.map(a => `
                            <div class="associate-checkbox-item ${a.eligible ? 'selected' : 'disabled'}"
                                 onclick="${a.eligible ? `toggleAssociateSelection('${a.id}')` : ''}"
                                 data-associate-id="${a.id}">
                                <div class="associate-checkbox">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                </div>
                                <div class="associate-checkbox-info">
                                    <div class="associate-checkbox-name">${a.name}</div>
                                    <div class="associate-checkbox-slots">${a.eligible ? `${a.slots} slots` : 'At capacity'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <button class="broadcast-btn" onclick="broadcastReferral()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                    </svg>
                    Broadcast to ${eligibleAssociates.filter(a => a.eligible).length} Associates
                </button>
                <p class="broadcast-note">Window closes in 24 hours</p>
            `;
        }

        // Render allocation panel content
        function renderAllocationContent(ref) {
            const expressions = referralExpressions.filter(e => e.referralId === ref.id);
            const interested = expressions.filter(e => e.status === 'Interested');
            const declined = expressions.filter(e => e.status === 'Declined');

            return `
                <div class="panel-section">
                    <div class="referral-card-header" style="margin-bottom: 16px;">
                        <div>
                            <span class="referral-card-id">${ref.id}</span>
                            <span class="referral-status-badge pending">Pending Allocation</span>
                        </div>
                    </div>
                    ${ref.clientPseudonym ? `<div class="referral-card-pseudonym">${ref.clientPseudonym}</div>` : ''}
                    ${ref.presentingIssue ? `<p style="font-size: 14px; color: var(--eden-text-secondary);">${ref.presentingIssue}</p>` : ''}
                </div>

                ${interested.length > 0 ? `
                    <div class="expression-group">
                        <div class="expression-group-title interested">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            INTERESTED (${interested.length})
                        </div>
                        ${interested.map(exp => {
                            const associate = associates.find(a => a.id === exp.associateId);
                            return `
                                <div class="expression-card">
                                    <div class="expression-card-header">
                                        <span class="expression-associate-name">${associate ? associate.name : 'Unknown'}</span>
                                    </div>
                                    ${exp.note ? `<p class="expression-note">"${exp.note}"</p>` : ''}
                                    <button class="allocate-btn" onclick="allocateReferral('${ref.id}', '${exp.associateId}')">
                                        Allocate to ${associate ? associate.name.split(' ')[0] : 'Associate'}
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : ''}

                ${declined.length > 0 ? `
                    <div class="expression-group">
                        <div class="expression-group-title declined">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            DECLINED (${declined.length})
                        </div>
                        ${declined.map(exp => {
                            const associate = associates.find(a => a.id === exp.associateId);
                            return `
                                <div class="expression-card" style="background: var(--eden-mint);">
                                    <div class="expression-associate-name">${associate ? associate.name : 'Unknown'}</div>
                                    ${exp.note ? `<p class="expression-note">"${exp.note}"</p>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : ''}

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button class="referral-action-btn secondary" style="flex: 1;" onclick="rebroadcastReferral('${ref.id}')">Re-broadcast</button>
                    <button class="referral-action-btn secondary" style="flex: 1;" onclick="closeReferralPanel()">Close</button>
                </div>
            `;
        }

        // Render interest panel content (Associate)
        function renderInterestContent(ref) {
            return `
                <div class="panel-section">
                    <div class="referral-card-header" style="margin-bottom: 16px;">
                        <span class="referral-card-id">${ref.id}</span>
                    </div>
                    ${ref.presentingIssue ? `
                        <div class="specialisation-tags" style="margin-bottom: 16px;">
                            <span class="specialisation-tag">${ref.presentingIssue}</span>
                        </div>
                    ` : ''}
                </div>

                <div class="panel-section">
                    <div class="form-group">
                        <label class="form-label">Add a note (optional)</label>
                        <p style="font-size: 12px; color: var(--eden-text-secondary); margin-bottom: 8px;">This helps admin allocate the right person</p>
                        <textarea class="form-textarea" id="interestNote" rows="3" placeholder="e.g. This sounds like a good fit for my experience with..."></textarea>
                    </div>
                </div>

                <div class="interest-info-box">
                    <p>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        This doesn't guarantee allocation. Admin will review all interested associates and make the final decision.
                    </p>
                </div>

                <button class="broadcast-btn" onclick="expressInterest('${ref.id}')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    Confirm Interest
                </button>
            `;
        }

        // Render view-only content
        function renderViewContent(ref) {
            return `
                <div class="panel-section">
                    <div class="panel-section-title">Enquiry Details</div>
                    <div class="enquiry-preview">
                        <p class="enquiry-text">"${ref.enquiryText}"</p>
                        <div class="enquiry-meta" style="margin-top: 12px;">
                            <strong>Contact:</strong> ${ref.contactEmail}<br>
                            <strong>Preferred Times:</strong> ${ref.preferredTimes.join(', ')}<br>
                            ${ref.presentingIssue ? `<strong>Presenting Issue:</strong> ${ref.presentingIssue}<br>` : ''}
                            ${ref.urgency ? `<strong>Urgency:</strong> ${ref.urgency}` : ''}
                        </div>
                    </div>
                </div>

                ${ref.allocatedTo ? `
                    <div class="panel-section">
                        <div class="panel-section-title">Allocation</div>
                        <p style="font-size: 14px;">Allocated to: <strong>${associates.find(a => a.id === ref.allocatedTo)?.name || 'Unknown'}</strong></p>
                    </div>
                ` : ''}

                <button class="referral-action-btn secondary" style="width: 100%;" onclick="closeReferralPanel()">Close</button>
            `;
        }

        // Get eligible associates for a referral
        function getEligibleAssociates(ref) {
            return associates.map(associate => {
                const settings = associateReferralSettings[associate.id] || { acceptingReferrals: false, capacitySlots: 0, availableTimes: [] };

                const timeOverlap = ref.preferredTimes.some(t => settings.availableTimes.includes(t));
                const eligible = settings.acceptingReferrals && settings.capacitySlots > 0 && timeOverlap;

                return {
                    id: associate.id,
                    name: associate.name,
                    slots: settings.capacitySlots,
                    eligible: eligible
                };
            }).sort((a, b) => b.eligible - a.eligible);
        }

        // Toggle associate selection in triage
        function toggleAssociateSelection(associateId) {
            const item = document.querySelector(`.associate-checkbox-item[data-associate-id="${associateId}"]`);
            if (item && !item.classList.contains('disabled')) {
                item.classList.toggle('selected');
                updateBroadcastButton();
            }
        }

        // Update broadcast button count
        function updateBroadcastButton() {
            const selectedCount = document.querySelectorAll('.associate-checkbox-item.selected').length;
            const btn = document.querySelector('.broadcast-btn');
            if (btn) {
                btn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                    </svg>
                    Broadcast to ${selectedCount} Associates
                `;
                btn.disabled = selectedCount === 0;
            }
        }

        // Set urgency in triage
        function setUrgency(level) {
            document.querySelectorAll('.urgency-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === level) {
                    btn.classList.add('active');
                }
            });
        }

        // Broadcast referral
        function broadcastReferral() {
            if (!selectedReferral) return;

            const clientRef = document.getElementById('triageClientRef')?.value;
            const presentingIssue = document.getElementById('triagePresentingIssue')?.value;
            const urgencyBtn = document.querySelector('.urgency-btn.active');
            const urgency = urgencyBtn?.textContent || 'Standard';

            const selectedAssociates = Array.from(document.querySelectorAll('.associate-checkbox-item.selected'))
                .map(item => item.dataset.associateId);

            if (selectedAssociates.length === 0) {
                alert('Please select at least one associate.');
                return;
            }

            // Update referral
            selectedReferral.clientPseudonym = clientRef || null;
            selectedReferral.presentingIssue = presentingIssue || null;
            selectedReferral.urgency = urgency;
            selectedReferral.status = 'Broadcasting';
            selectedReferral.broadcastDate = new Date();
            selectedReferral.broadcastExpiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);

            // Create expressions for selected associates
            selectedAssociates.forEach(assocId => {
                const expId = `EXP-${Date.now()}-${assocId}`;
                referralExpressions.push({
                    id: expId,
                    referralId: selectedReferral.id,
                    associateId: assocId,
                    status: 'Pending',
                    note: '',
                    expressedAt: null
                });
            });

            closeReferralPanel();
            renderReferrals();
        }

        // Express interest (Associate)
        function expressInterest(referralId) {
            const note = document.getElementById('interestNote')?.value || '';

            // Find or create expression
            let expression = referralExpressions.find(e =>
                e.referralId === referralId && e.associateId === currentUserId
            );

            if (expression) {
                expression.status = 'Interested';
                expression.note = note;
                expression.expressedAt = new Date();
            } else {
                referralExpressions.push({
                    id: `EXP-${Date.now()}`,
                    referralId: referralId,
                    associateId: currentUserId,
                    status: 'Interested',
                    note: note,
                    expressedAt: new Date()
                });
            }

            closeReferralPanel();
            renderReferrals();
        }

        // Decline referral (Associate)
        function declineReferral(referralId) {
            let expression = referralExpressions.find(e =>
                e.referralId === referralId && e.associateId === currentUserId
            );

            if (expression) {
                expression.status = 'Declined';
                expression.expressedAt = new Date();
            } else {
                referralExpressions.push({
                    id: `EXP-${Date.now()}`,
                    referralId: referralId,
                    associateId: currentUserId,
                    status: 'Declined',
                    note: '',
                    expressedAt: new Date()
                });
            }

            renderReferrals();
        }

        // Allocate referral (Admin)
        function allocateReferral(referralId, associateId) {
            const referral = referrals.find(r => r.id === referralId);
            if (!referral) return;

            referral.status = 'Accepted';
            referral.allocatedTo = associateId;
            referral.allocatedDate = new Date();

            // Update expressions
            referralExpressions.forEach(exp => {
                if (exp.referralId === referralId) {
                    if (exp.associateId === associateId) {
                        exp.status = 'Allocated';
                    } else if (exp.status === 'Interested') {
                        exp.status = 'Not Selected';
                    }
                }
            });

            // Decrement associate capacity
            const settings = associateReferralSettings[associateId];
            if (settings && settings.capacitySlots > 0) {
                settings.capacitySlots--;
            }

            closeReferralPanel();
            renderReferrals();
        }

        // Re-broadcast referral
        function rebroadcastReferral(referralId) {
            const referral = referrals.find(r => r.id === referralId);
            if (!referral) return;

            referral.status = 'Broadcasting';
            referral.broadcastDate = new Date();
            referral.broadcastExpiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);

            closeReferralPanel();
            renderReferrals();
        }

        // Toggle accepting referrals (Associate)
        function toggleAcceptingReferrals() {
            const settings = associateReferralSettings[currentUserId];
            if (settings) {
                settings.acceptingReferrals = !settings.acceptingReferrals;
                renderReferrals();
            }
        }

        // Update referral alert dot in navigation
        function updateReferralAlertDot() {
            const alertDot = document.getElementById('referralsAlertDot');
            if (!alertDot) return;

            if (currentUserRole === 'admin') {
                const hasNew = referrals.some(r => r.status === 'New');
                const hasPending = referrals.some(r => r.status === 'Pending Allocation');
                alertDot.style.display = (hasNew || hasPending) ? 'block' : 'none';
            } else {
                const availableCount = referrals.filter(ref => {
                    if (ref.status !== 'Broadcasting') return false;
                    const existingExpression = referralExpressions.find(e =>
                        e.referralId === ref.id && e.associateId === currentUserId
                    );
                    if (existingExpression && existingExpression.status !== 'Pending') return false;
                    return true;
                }).length;
                alertDot.style.display = availableCount > 0 ? 'block' : 'none';
            }
        }

        // ============================================
        // ONBOARDING STAGES CONFIGURATION
        // ============================================

        // Client Onboarding Stages (4 stages)
        const clientStages = [
            {
                id: 'enquiry',
                label: 'Enquiry',
                requiredFields: ['name', 'email', 'phone', 'presentingIssue', 'availability'],
                validate: (data) => {
                    return data.name && data.email && data.phone && data.presentingIssue && data.availability;
                }
            },
            {
                id: 'broadcasting',
                label: 'Broadcasting',
                requiredFields: ['associatesNotified'],
                validate: (data) => {
                    return data.associatesNotified && data.associatesNotified.length > 0;
                }
            },
            {
                id: 'matching',
                label: 'Matching',
                requiredFields: ['matchedAssociateId'],
                validate: (data) => {
                    return !!data.matchedAssociateId;
                }
            },
            {
                id: 'onboarded',
                label: 'Onboarded',
                requiredFields: ['firstSessionDate'],
                validate: (data) => {
                    return !!data.firstSessionDate;
                }
            }
        ];

        // Associate Onboarding Stages (4 stages)
        const associateStages = [
            {
                id: 'interest',
                label: 'Interest',
                requiredFields: ['name', 'email', 'phone', 'qualifications'],
                validate: (data) => {
                    return data.name && data.email && data.phone && data.qualifications;
                }
            },
            {
                id: 'documents',
                label: 'Documents',
                requiredFields: ['insuranceDoc', 'dbsDoc', 'certificateDocs', 'allDocsVerified'],
                validate: (data) => {
                    return data.insuranceDoc && data.dbsDoc &&
                           data.certificateDocs && data.certificateDocs.length > 0 &&
                           data.allDocsVerified === true;
                }
            },
            {
                id: 'profile',
                label: 'Profile',
                requiredFields: ['bio', 'photo', 'specialisms', 'availability', 'profileApproved'],
                validate: (data) => {
                    return data.bio && data.photo &&
                           data.specialisms && data.specialisms.length > 0 &&
                           data.availability && data.profileApproved === true;
                }
            },
            {
                id: 'ready',
                label: 'Ready',
                requiredFields: ['bankDetails', 'agreementSigned'],
                validate: (data) => {
                    return data.bankDetails && data.agreementSigned === true;
                }
            }
        ];

        // ============================================
        // HELPER FUNCTIONS
        // ============================================

        function formatTimeAgo(date) {
            if (!date) return 'Unknown';
            const now = new Date();
            const diffMs = now - new Date(date);
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return new Date(date).toLocaleDateString();
        }

        // ============================================
        // PROGRESS STEPPER COMPONENT
        // ============================================

        // Calculate current step index based on validation
        function calculateCurrentStep(steps, data) {
            for (let i = 0; i < steps.length; i++) {
                if (!steps[i].validate(data)) {
                    return i;
                }
            }
            return steps.length; // All complete
        }

        // Render the progress stepper HTML
        function renderProgressStepper(steps, currentData, onStepClick) {
            const currentStepIndex = calculateCurrentStep(steps, currentData);

            let html = '<div class="progress-stepper"><div class="stepper-container">';

            steps.forEach((step, index) => {
                const isComplete = index < currentStepIndex;
                const isActive = index === currentStepIndex;
                const isInactive = index > currentStepIndex;

                let stepClass = '';
                if (isComplete) stepClass = 'complete';
                else if (isActive) stepClass = 'active';
                else stepClass = 'inactive';

                html += `
                    <div class="stepper-step ${stepClass}" data-step-index="${index}" ${isComplete ? `onclick="handleStepClick(${index})"` : ''}>
                        <div class="stepper-circle">
                            <span class="stepper-number">${index + 1}</span>
                            <svg class="stepper-checkmark" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                        </div>
                        <span class="stepper-label">${step.label}</span>
                    </div>
                `;

                // Add connector line (except after last step)
                if (index < steps.length - 1) {
                    const connectorClass = isComplete ? 'complete' : '';
                    html += `<div class="stepper-connector ${connectorClass}"></div>`;
                }
            });

            html += '</div></div>';
            return html;
        }

        // Global step click handler
        let currentStepClickHandler = null;
        function handleStepClick(stepIndex) {
            if (currentStepClickHandler) {
                currentStepClickHandler(stepIndex);
            }
        }

        // ============================================
        // STATUS CARD COMPONENT
        // ============================================

        function renderStatusCard(config) {
            const { reference, status, statusLabel, title, preview, meta, timestamp, pulseColour, onClick, dataId, showKebabMenu, kebabMenuData } = config;

            const statusClass = status.toLowerCase().replace(/\s+/g, '-');
            const metaChips = meta ? meta.map(m => `<span class="status-card-chip">${m}</span>`).join('') : '';

            // Kebab menu HTML for associate cards
            const kebabMenuHtml = showKebabMenu && kebabMenuData ? `
                <div class="kebab-menu-container" onclick="event.stopPropagation();">
                    <button class="kebab-menu-btn" onclick="toggleKebabMenu('${kebabMenuData.id}')" aria-label="Open menu">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="5" r="1"/>
                            <circle cx="12" cy="12" r="1"/>
                            <circle cx="12" cy="19" r="1"/>
                        </svg>
                    </button>
                    <div class="kebab-dropdown" id="kebab-${kebabMenuData.id}">
                        <div class="kebab-dropdown-header">
                            <div class="kebab-dropdown-label">Quick Access</div>
                            <div class="kebab-dropdown-name">${kebabMenuData.name}</div>
                        </div>
                        <div class="kebab-dropdown-options">
                            <button class="kebab-option" onclick="navigateToAssociateView('${kebabMenuData.id}', 'sessions')">
                                <div class="kebab-option-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="16" y1="2" x2="16" y2="6"/>
                                        <line x1="8" y1="2" x2="8" y2="6"/>
                                        <line x1="3" y1="10" x2="21" y2="10"/>
                                    </svg>
                                </div>
                                <div class="kebab-option-text">
                                    <div class="kebab-option-title">Sessions</div>
                                    <div class="kebab-option-desc">View client sessions</div>
                                </div>
                            </button>
                            <button class="kebab-option" onclick="navigateToAssociateView('${kebabMenuData.id}', 'contracts')">
                                <div class="kebab-option-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                    </svg>
                                </div>
                                <div class="kebab-option-text">
                                    <div class="kebab-option-title">Contracts</div>
                                    <div class="kebab-option-desc">Active agreements</div>
                                </div>
                            </button>
                            <button class="kebab-option" onclick="navigateToAssociateView('${kebabMenuData.id}', 'finance')">
                                <div class="kebab-option-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <line x1="12" y1="1" x2="12" y2="23"/>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                </div>
                                <div class="kebab-option-text">
                                    <div class="kebab-option-title">Finance</div>
                                    <div class="kebab-option-desc">Earnings & payouts</div>
                                </div>
                            </button>
                            <button class="kebab-option" onclick="navigateToAssociateView('${kebabMenuData.id}', 'inbox')">
                                <div class="kebab-option-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                </div>
                                <div class="kebab-option-text">
                                    <div class="kebab-option-title">Inbox</div>
                                    <div class="kebab-option-desc">Messages</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            ` : '';

            return `
                <div class="status-card" onclick="${onClick}" data-id="${dataId || ''}">
                    ${showKebabMenu ? kebabMenuHtml : (pulseColour ? `<div class="status-card-pulse ${pulseColour}"></div>` : '')}
                    ${timestamp ? `<span class="status-card-timestamp">${timestamp}</span>` : ''}
                    <div class="status-card-header">
                        <span class="status-card-ref">${reference}</span>
                        <span class="status-card-badge ${statusClass}">${statusLabel}</span>
                    </div>
                    <div class="status-card-title">${title}</div>
                    ${preview ? `<div class="status-card-preview">${preview}</div>` : ''}
                    ${meta && meta.length > 0 ? `<div class="status-card-meta">${metaChips}</div>` : ''}
                </div>
            `;
        }

        // ============================================
        // KEBAB MENU FUNCTIONS
        // ============================================

        let activeKebabMenu = null;

        function toggleKebabMenu(associateId) {
            const dropdown = document.getElementById(`kebab-${associateId}`);
            if (!dropdown) return;

            const isOpen = dropdown.classList.contains('open');

            // Close any open kebab menus first
            closeAllKebabMenus();

            if (!isOpen) {
                dropdown.classList.add('open');
                activeKebabMenu = associateId;

                // Add click-outside listener
                setTimeout(() => {
                    document.addEventListener('click', handleKebabClickOutside);
                }, 0);
            }
        }

        function closeAllKebabMenus() {
            document.querySelectorAll('.kebab-dropdown.open').forEach(menu => {
                menu.classList.remove('open');
            });
            document.removeEventListener('click', handleKebabClickOutside);
            activeKebabMenu = null;
        }

        function handleKebabClickOutside(e) {
            if (!e.target.closest('.kebab-menu-container')) {
                closeAllKebabMenus();
            }
        }

        function navigateToAssociateView(associateId, viewType) {
            // Close the kebab menu
            closeAllKebabMenus();

            // Find the associate
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            // Store selected associate for context
            selectedAssociate = associate;

            // Navigate based on view type
            switch (viewType) {
                case 'sessions':
                    // Open associate panel and show sessions/clients
                    openAssociateDetailPanel(associateId);
                    break;
                case 'contracts':
                    // Navigate to contracts view filtered by associate
                    showView('contracts');
                    // Note: Could add filter functionality here
                    showNotification(`Viewing contracts for ${associate.name}`);
                    break;
                case 'finance':
                    // Open associate panel and navigate to payout cockpit
                    openAssociateDetailPanel(associateId);
                    setTimeout(() => {
                        navigatePanelTo('payout-cockpit');
                    }, 300);
                    break;
                case 'inbox':
                    // Open associate inbox view
                    openAssociateInbox(associateId);
                    break;
                default:
                    openAssociateDetailPanel(associateId);
            }
        }

        // Show a brief notification toast
        function showNotification(message) {
            let toast = document.getElementById('notificationToast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'notificationToast';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    left: 50%;
                    transform: translateX(-50%) translateY(20px);
                    background: var(--eden-text);
                    color: white;
                    padding: 12px 24px;
                    border-radius: 8px;
                    font-size: 14px;
                    opacity: 0;
                    transition: all 300ms ease;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
            }
            toast.textContent = message;
            toast.style.opacity = '1';
            toast.style.transform = 'translateX(-50%) translateY(0)';

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(20px)';
            }, 2500);
        }

        // Open associate inbox (will be enhanced in Chunk 3)
        function openAssociateInbox(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            // Open associate panel and navigate to inbox
            openAssociateDetailPanel(associateId);
            setTimeout(() => {
                navigatePanelTo('inbox');
            }, 300);
        }

        // ============================================
        // ANIMATED CARD LIST
        // ============================================

        function applyCardAnimation(container) {
            const cards = container.children;
            Array.from(cards).forEach((card, index) => {
                card.style.animationDelay = `${index * 75}ms`;
            });
        }

        // ============================================
        // DETAIL PANEL COMPONENT
        // ============================================

        let currentDetailPanelData = null;
        let currentDetailPanelType = null; // 'client' or 'associate'
        let savedDetailPanelScrollPosition = 0;

        function openDetailPanel(type, data) {
            // Use unified detail view for supported entity types
            if (type === 'associate' || type === 'client' || type === 'referral') {
                DetailView.open(type, data);
                return;
            }

            // Fallback to old panel for other types
            currentDetailPanelType = type;
            currentDetailPanelData = { ...data };

            // Save scroll position before locking
            savedDetailPanelScrollPosition = window.scrollY;

            const overlay = document.getElementById('detailPanelOverlay');
            const panel = document.getElementById('detailPanel');

            if (overlay) overlay.classList.add('open');
            if (panel) {
                panel.classList.add('open');
                renderDetailPanelContent();
                // Ensure panel starts scrolled to top
                panel.scrollTop = 0;
            }

            // Lock body scroll
            document.body.classList.add('panel-open');

            // Add keyboard listener for Escape key
            document.addEventListener('keydown', handleDetailPanelKeydown);
        }

        function closeDetailPanel() {
            const overlay = document.getElementById('detailPanelOverlay');
            const panel = document.getElementById('detailPanel');

            if (overlay) overlay.classList.remove('open');
            if (panel) panel.classList.remove('open');

            // Restore body scroll
            document.body.classList.remove('panel-open');

            currentDetailPanelData = null;
            currentDetailPanelType = null;

            // Remove keyboard listener
            document.removeEventListener('keydown', handleDetailPanelKeydown);
        }

        function handleDetailPanelKeydown(e) {
            if (e.key === 'Escape') {
                closeDetailPanel();
            }
        }

        // Three-dots menu toggle function
        function toggleDetailPanelMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('detailPanelDropdown');
            if (dropdown) {
                dropdown.classList.toggle('open');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('detailPanelDropdown');
            const menuButton = event.target.closest('.detail-panel-actions-btn');

            if (!menuButton && dropdown && !dropdown.contains(event.target)) {
                dropdown.classList.remove('open');
            }
        });

        // Navigate to section from dropdown menu
        function navigateToSection(section) {
            // Close the dropdown
            const dropdown = document.getElementById('detailPanelDropdown');
            if (dropdown) dropdown.classList.remove('open');

            // Close detail panel
            closeDetailPanel();

            // Navigate based on section
            switch(section) {
                case 'sessions':
                    showView('schedule');
                    break;
                case 'contracts':
                    showView('contracts');
                    break;
                case 'finance':
                    showView('earnings');
                    break;
                case 'inbox':
                    // Navigate to inbox or message view if available
                    if (currentRole === 'associate') {
                        navigateToAssociateView('inbox');
                    }
                    break;
            }
        }

        function renderDetailPanelContent() {
            const panel = document.getElementById('detailPanel');
            if (!panel) return;

            const stages = currentDetailPanelType === 'client' ? clientStages : associateStages;
            const currentStepIndex = calculateCurrentStep(stages, currentDetailPanelData);

            // Set up step click handler
            currentStepClickHandler = (stepIndex) => {
                scrollToStageSection(stepIndex);
            };

            const entityName = currentDetailPanelData.name || 'Unknown';
            const entityRef = currentDetailPanelData.id || '';

            panel.innerHTML = `
                <div class="detail-panel-drag-handle"></div>
                <div class="detail-panel-header">
                    <button class="detail-panel-back" onclick="closeDetailPanel()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                        Back
                    </button>
                    <div style="text-align: center; flex: 1;">
                        <div class="detail-panel-title">${entityName}</div>
                        <div style="font-size: 12px; color: var(--eden-text-secondary); font-family: monospace;">${entityRef}</div>
                    </div>
                    <div class="detail-panel-actions">
                        <button class="detail-panel-actions-btn" onclick="toggleDetailPanelMenu(event)">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="1"/>
                                <circle cx="12" cy="5" r="1"/>
                                <circle cx="12" cy="19" r="1"/>
                            </svg>
                        </button>
                        <div class="detail-panel-dropdown" id="detailPanelDropdown">
                            <div class="detail-panel-dropdown-header">
                                <div class="detail-panel-dropdown-header-label">Quick Access</div>
                                <div class="detail-panel-dropdown-header-name">${entityName}</div>
                            </div>
                            <div class="detail-panel-dropdown-menu">
                                <button class="detail-panel-dropdown-item" onclick="navigateToSection('sessions')">
                                    <div class="detail-panel-dropdown-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                            <line x1="16" y1="2" x2="16" y2="6"/>
                                            <line x1="8" y1="2" x2="8" y2="6"/>
                                            <line x1="3" y1="10" x2="21" y2="10"/>
                                        </svg>
                                    </div>
                                    <div class="detail-panel-dropdown-text">
                                        <div class="detail-panel-dropdown-title">Sessions</div>
                                        <div class="detail-panel-dropdown-subtitle">View client sessions</div>
                                    </div>
                                </button>
                                <button class="detail-panel-dropdown-item" onclick="navigateToSection('contracts')">
                                    <div class="detail-panel-dropdown-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14 2 14 8 20 8"/>
                                            <line x1="16" y1="13" x2="8" y2="13"/>
                                            <line x1="16" y1="17" x2="8" y2="17"/>
                                        </svg>
                                    </div>
                                    <div class="detail-panel-dropdown-text">
                                        <div class="detail-panel-dropdown-title">Contracts</div>
                                        <div class="detail-panel-dropdown-subtitle">Active agreements</div>
                                    </div>
                                </button>
                                <button class="detail-panel-dropdown-item" onclick="navigateToSection('finance')">
                                    <div class="detail-panel-dropdown-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="8" x2="12" y2="12"/>
                                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                                            <path d="M9 9.5a3 3 0 1 1 6 0c0 1.5-3 2.5-3 4.5"/>
                                        </svg>
                                    </div>
                                    <div class="detail-panel-dropdown-text">
                                        <div class="detail-panel-dropdown-title">Finance</div>
                                        <div class="detail-panel-dropdown-subtitle">Earnings & payouts</div>
                                    </div>
                                </button>
                                <button class="detail-panel-dropdown-item" onclick="navigateToSection('inbox')">
                                    <div class="detail-panel-dropdown-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                            <polyline points="22,6 12,13 2,6"/>
                                        </svg>
                                    </div>
                                    <div class="detail-panel-dropdown-text">
                                        <div class="detail-panel-dropdown-title">Inbox</div>
                                        <div class="detail-panel-dropdown-subtitle">Messages</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="detail-panel-stepper" id="detailPanelStepper">
                    ${renderProgressStepper(stages, currentDetailPanelData)}
                </div>
                <div class="detail-panel-content" id="detailPanelContentArea">
                    ${renderOnboardingForm(currentDetailPanelType, currentDetailPanelData, currentStepIndex)}
                </div>
            `;

            // Initialize swipe to close on mobile
            initDetailPanelSwipe();
        }

        function scrollToStageSection(stepIndex) {
            const section = document.getElementById(`stage-section-${stepIndex}`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function renderOnboardingForm(type, data, currentStepIndex) {
            const stages = type === 'client' ? clientStages : associateStages;

            let html = '<div class="onboarding-form">';

            stages.forEach((stage, index) => {
                const isComplete = index < currentStepIndex;
                const isCurrent = index === currentStepIndex;
                const statusClass = isComplete ? 'complete' : (isCurrent ? 'incomplete' : 'incomplete');
                const statusText = isComplete ? 'Complete' : (isCurrent ? 'In Progress' : 'Pending');

                html += `
                    <div class="form-section" id="stage-section-${index}">
                        <div class="form-section-header">
                            <span class="form-section-title">${stage.label}</span>
                            <span class="form-section-status ${statusClass}">${statusText}</span>
                        </div>
                        ${renderStageFields(type, stage, data, isComplete || isCurrent)}
                    </div>
                `;
            });

            // Add activity timeline
            html += renderActivityTimeline(type, data);

            html += '</div>';
            return html;
        }

        function renderStageFields(type, stage, data, editable) {
            let html = '';

            if (type === 'client') {
                switch (stage.id) {
                    case 'enquiry':
                        html = `
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-input ${data.name ? 'valid' : ''}" value="${data.name || ''}"
                                           onchange="updateDetailPanelField('name', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input ${data.email ? 'valid' : ''}" value="${data.email || ''}"
                                           onchange="updateDetailPanelField('email', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-input ${data.phone ? 'valid' : ''}" value="${data.phone || ''}"
                                           onchange="updateDetailPanelField('phone', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Availability</label>
                                    <select class="form-input form-select ${data.availability ? 'valid' : ''}"
                                            onchange="updateDetailPanelField('availability', this.value)" ${!editable ? 'disabled' : ''}>
                                        <option value="">Select availability...</option>
                                        <option value="Weekdays" ${data.availability === 'Weekdays' ? 'selected' : ''}>Weekdays</option>
                                        <option value="Evenings" ${data.availability === 'Evenings' ? 'selected' : ''}>Evenings</option>
                                        <option value="Weekends" ${data.availability === 'Weekends' ? 'selected' : ''}>Weekends</option>
                                        <option value="Flexible" ${data.availability === 'Flexible' ? 'selected' : ''}>Flexible</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Presenting Issue</label>
                                    <textarea class="form-input form-textarea ${data.presentingIssue ? 'valid' : ''}"
                                              onchange="updateDetailPanelField('presentingIssue', this.value)"
                                              ${!editable ? 'disabled' : ''}>${data.presentingIssue || ''}</textarea>
                                </div>
                            </div>
                        `;
                        break;
                    case 'broadcasting':
                        const notifiedCount = data.associatesNotified ? data.associatesNotified.length : 0;
                        html = `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Associates Notified</label>
                                    <div class="form-input" style="background: var(--eden-mint);">
                                        ${notifiedCount > 0 ? `${notifiedCount} associate(s) notified` : 'No associates notified yet'}
                                    </div>
                                </div>
                            </div>
                            ${notifiedCount > 0 ? `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Broadcast Status</label>
                                    <div class="status-card-badge broadcasting" style="display: inline-flex;">Broadcasting Active</div>
                                </div>
                            </div>
                            ` : ''}
                        `;
                        break;
                    case 'matching':
                        const matchedAssociate = data.matchedAssociateId ?
                            associates.find(a => a.id === data.matchedAssociateId) : null;
                        html = `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Matched Associate</label>
                                    <div class="form-input ${matchedAssociate ? 'valid' : ''}" style="background: var(--eden-mint);">
                                        ${matchedAssociate ? matchedAssociate.name : 'Awaiting match...'}
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 'onboarded':
                        html = `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">First Session Date</label>
                                    <input type="date" class="form-input ${data.firstSessionDate ? 'valid' : ''}"
                                           value="${data.firstSessionDate || ''}"
                                           onchange="updateDetailPanelField('firstSessionDate', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                            </div>
                        `;
                        break;
                }
            } else if (type === 'associate') {
                switch (stage.id) {
                    case 'interest':
                        html = `
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-input ${data.name ? 'valid' : ''}" value="${data.name || ''}"
                                           onchange="updateDetailPanelField('name', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input ${data.email ? 'valid' : ''}" value="${data.email || ''}"
                                           onchange="updateDetailPanelField('email', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-input ${data.phone ? 'valid' : ''}" value="${data.phone || ''}"
                                           onchange="updateDetailPanelField('phone', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Qualifications</label>
                                    <input type="text" class="form-input ${data.qualifications ? 'valid' : ''}"
                                           value="${data.qualifications || ''}" placeholder="e.g., BACP Registered"
                                           onchange="updateDetailPanelField('qualifications', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                            </div>
                        `;
                        break;
                    case 'documents':
                        html = `
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Insurance Certificate</label>
                                    <div class="doc-upload-area ${data.insuranceDoc ? 'has-file' : ''}"
                                         onclick="simulateDocUpload('insuranceDoc')">
                                        <svg class="doc-upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                        <div class="doc-upload-text">${data.insuranceDoc ? 'Document uploaded' : 'Click to upload'}</div>
                                        ${data.insuranceDoc ? `<div class="doc-upload-filename">${data.insuranceDoc}</div>` : ''}
                                    </div>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">DBS Certificate</label>
                                    <div class="doc-upload-area ${data.dbsDoc ? 'has-file' : ''}"
                                         onclick="simulateDocUpload('dbsDoc')">
                                        <svg class="doc-upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                        <div class="doc-upload-text">${data.dbsDoc ? 'Document uploaded' : 'Click to upload'}</div>
                                        ${data.dbsDoc ? `<div class="doc-upload-filename">${data.dbsDoc}</div>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Verification Status</label>
                                    <div class="form-input" style="background: ${data.allDocsVerified ? '#dcfce7' : '#fef3c7'}; color: ${data.allDocsVerified ? '#16a34a' : '#d97706'};">
                                        ${data.allDocsVerified ? ' All documents verified' : 'Awaiting verification'}
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 'profile':
                        html = `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Bio</label>
                                    <textarea class="form-input form-textarea ${data.bio ? 'valid' : ''}"
                                              placeholder="Professional biography..."
                                              onchange="updateDetailPanelField('bio', this.value)"
                                              ${!editable ? 'disabled' : ''}>${data.bio || ''}</textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="form-label">Photo</label>
                                    <div class="doc-upload-area ${data.photo ? 'has-file' : ''}"
                                         onclick="simulateDocUpload('photo')">
                                        <svg class="doc-upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                            <circle cx="8.5" cy="8.5" r="1.5"/>
                                            <polyline points="21 15 16 10 5 21"/>
                                        </svg>
                                        <div class="doc-upload-text">${data.photo ? 'Photo uploaded' : 'Click to upload'}</div>
                                    </div>
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Availability</label>
                                    <select class="form-input form-select ${data.availability ? 'valid' : ''}"
                                            onchange="updateDetailPanelField('availability', this.value)" ${!editable ? 'disabled' : ''}>
                                        <option value="">Select availability...</option>
                                        <option value="Full-time" ${data.availability === 'Full-time' ? 'selected' : ''}>Full-time</option>
                                        <option value="Part-time" ${data.availability === 'Part-time' ? 'selected' : ''}>Part-time</option>
                                        <option value="Weekends Only" ${data.availability === 'Weekends Only' ? 'selected' : ''}>Weekends Only</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Profile Status</label>
                                    <div class="form-input" style="background: ${data.profileApproved ? '#dcfce7' : '#fef3c7'}; color: ${data.profileApproved ? '#16a34a' : '#d97706'};">
                                        ${data.profileApproved ? ' Profile approved' : 'Awaiting approval'}
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 'ready':
                        html = `
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Bank Details</label>
                                    <input type="text" class="form-input ${data.bankDetails ? 'valid' : ''}"
                                           value="${data.bankDetails ? '   ' + data.bankDetails.slice(-4) : ''}"
                                           placeholder="Enter bank account details"
                                           onchange="updateDetailPanelField('bankDetails', this.value)" ${!editable ? 'disabled' : ''}>
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-field">
                                    <label class="form-label">Agreement Status</label>
                                    <div class="form-input" style="background: ${data.agreementSigned ? '#dcfce7' : '#fef3c7'}; color: ${data.agreementSigned ? '#16a34a' : '#d97706'};">
                                        ${data.agreementSigned ? ' Agreement signed' : 'Awaiting signature'}
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                }
            }

            return html;
        }

        function renderActivityTimeline(type, data) {
            // Generate mock activity based on current stage
            const activities = [];

            if (data.createdAt) {
                activities.push({ text: `${type === 'client' ? 'Enquiry' : 'Application'} received`, time: formatTimeAgo(data.createdAt) });
            }

            if (type === 'client') {
                if (data.associatesNotified && data.associatesNotified.length > 0) {
                    activities.push({ text: `Broadcast sent to ${data.associatesNotified.length} associates`, time: '1d ago' });
                }
                if (data.matchedAssociateId) {
                    const associate = associates.find(a => a.id === data.matchedAssociateId);
                    activities.push({ text: `Matched with ${associate ? associate.name : 'associate'}`, time: '12h ago' });
                }
            } else {
                if (data.allDocsVerified) {
                    activities.push({ text: 'Documents verified', time: '3d ago' });
                }
                if (data.profileApproved) {
                    activities.push({ text: 'Profile approved', time: '2d ago' });
                }
            }

            if (activities.length === 0) {
                activities.push({ text: 'Record created', time: 'Just now' });
            }

            let html = `
                <div class="activity-timeline">
                    <div class="activity-timeline-title">Activity</div>
            `;

            activities.forEach(activity => {
                html += `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <div class="activity-text">${activity.text}</div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            return html;
        }

        function updateDetailPanelField(field, value) {
            if (!currentDetailPanelData) return;

            currentDetailPanelData[field] = value;

            // Re-render stepper to reflect any stage changes
            const stepperContainer = document.getElementById('detailPanelStepper');
            if (stepperContainer) {
                const stages = currentDetailPanelType === 'client' ? clientStages : associateStages;
                stepperContainer.innerHTML = renderProgressStepper(stages, currentDetailPanelData);
            }

            // Update form field validation state
            const input = event.target;
            if (value && value.trim() !== '') {
                input.classList.add('valid');
                input.classList.remove('invalid');
            } else {
                input.classList.remove('valid');
            }
        }

        function simulateDocUpload(field) {
            // Simulate document upload
            const fileName = `document_${Date.now()}.pdf`;
            updateDetailPanelField(field, fileName);
            renderDetailPanelContent(); // Re-render to show uploaded state
        }

        function initDetailPanelSwipe() {
            const panel = document.getElementById('detailPanel');
            if (!panel || !isMobile) return;

            let startY = 0;
            let currentY = 0;

            const dragHandle = panel.querySelector('.detail-panel-drag-handle');
            if (!dragHandle) return;

            dragHandle.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });

            dragHandle.addEventListener('touchmove', (e) => {
                currentY = e.touches[0].clientY;
                const diff = currentY - startY;
                if (diff > 0) {
                    panel.style.transform = `translateY(${diff}px)`;
                }
            });

            dragHandle.addEventListener('touchend', () => {
                const diff = currentY - startY;
                if (diff > 100) {
                    closeDetailPanel();
                }
                panel.style.transform = '';
            });
        }

        // ============================================
        // CLIENT/ASSOCIATE CARD RENDERING WITH STEPPER
        // ============================================

        // Enhanced client data with onboarding fields
        function getEnhancedClientData(client) {
            // Add onboarding fields based on stage
            const enhanced = { ...client };

            // Simulate different onboarding stages based on client stage
            switch (client.stage) {
                case 'awaiting':
                    enhanced.name = client.name;
                    enhanced.email = `${client.initials.toLowerCase()}@email.com`;
                    enhanced.phone = '07700 900' + Math.floor(Math.random() * 900 + 100);
                    enhanced.presentingIssue = 'Seeking therapy support';
                    enhanced.availability = 'Weekdays';
                    enhanced.createdAt = new Date(Date.now() - 2 * 24 * 60 * 60 * 1000);
                    break;
                case 'pending':
                    enhanced.name = client.name;
                    enhanced.email = `${client.initials.toLowerCase()}@email.com`;
                    enhanced.phone = '07700 900' + Math.floor(Math.random() * 900 + 100);
                    enhanced.presentingIssue = 'Seeking therapy support';
                    enhanced.availability = 'Evenings';
                    enhanced.associatesNotified = ['ASSOC-2401', 'ASSOC-2402'];
                    enhanced.createdAt = new Date(Date.now() - 5 * 24 * 60 * 60 * 1000);
                    break;
                case 'active':
                    enhanced.name = client.name;
                    enhanced.email = `${client.initials.toLowerCase()}@email.com`;
                    enhanced.phone = '07700 900' + Math.floor(Math.random() * 900 + 100);
                    enhanced.presentingIssue = 'Ongoing therapy';
                    enhanced.availability = 'Flexible';
                    enhanced.associatesNotified = ['ASSOC-2401'];
                    enhanced.matchedAssociateId = client.associateId;
                    enhanced.firstSessionDate = '2025-01-15';
                    enhanced.createdAt = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case 'ending':
                    enhanced.name = client.name;
                    enhanced.email = `${client.initials.toLowerCase()}@email.com`;
                    enhanced.phone = '07700 900' + Math.floor(Math.random() * 900 + 100);
                    enhanced.presentingIssue = 'Completing therapy journey';
                    enhanced.availability = 'Weekdays';
                    enhanced.associatesNotified = ['ASSOC-2401'];
                    enhanced.matchedAssociateId = client.associateId;
                    enhanced.firstSessionDate = '2024-06-01';
                    enhanced.createdAt = new Date(Date.now() - 180 * 24 * 60 * 60 * 1000);
                    break;
            }

            return enhanced;
        }

        // Enhanced associate data with onboarding fields
        function getEnhancedAssociateData(associate) {
            const enhanced = { ...associate };

            // All existing associates are considered fully onboarded
            enhanced.qualifications = 'BACP Registered';
            enhanced.insuranceDoc = 'insurance_2025.pdf';
            enhanced.dbsDoc = 'dbs_enhanced.pdf';
            enhanced.certificateDocs = ['bacp_cert.pdf'];
            enhanced.allDocsVerified = true;
            enhanced.bio = `${associate.name} is an experienced therapist specialising in ${associate.specialisation}.`;
            enhanced.photo = 'profile_photo.jpg';
            enhanced.specialisms = [associate.specialisation];
            enhanced.profileApproved = true;
            enhanced.bankDetails = '12345678';
            enhanced.agreementSigned = true;
            enhanced.createdAt = new Date(associate.joinDate);

            return enhanced;
        }

        // Render client cards using StatusCard component
        function renderClientStatusCards() {
            const grid = document.getElementById('allClientsGrid');
            if (!grid) return;

            grid.className = 'animated-card-list';
            grid.innerHTML = '';

            clients.forEach((client, index) => {
                const statusLabel = client.stage.charAt(0).toUpperCase() + client.stage.slice(1);
                const pulseColour = client.stage === 'awaiting' ? 'amber' :
                                   client.stage === 'pending' ? 'blue' :
                                   client.stage === 'active' ? 'green' : 'purple';

                const associate = associates.find(a => a.id === client.associateId);
                const meta = associate ? [associate.name] : [];

                grid.innerHTML += renderStatusCard({
                    reference: client.id,
                    status: client.stage,
                    statusLabel: statusLabel,
                    title: client.name,
                    preview: `Assigned to ${associate ? associate.name : 'Unassigned'}`,
                    meta: meta,
                    pulseColour: pulseColour,
                    onClick: `openClientDetailPanel('${client.id}')`,
                    dataId: client.id
                });
            });

            applyCardAnimation(grid);
        }

        // Render associate cards using StatusCard component
        function renderAssociateStatusCards() {
            const grid = document.getElementById('cardGrid');
            if (!grid) return;

            grid.className = 'animated-card-list';
            grid.innerHTML = '';

            associates.forEach((associate, index) => {
                const capacityPercent = Math.round((associate.clients / associate.maxCapacity) * 100);
                const status = associate.supportMode;
                const statusLabel = associate.supportMode === 'independent' ? 'Independent' : 'Supported';
                const pulseColour = capacityPercent > 80 ? 'amber' : 'green';

                grid.innerHTML += renderStatusCard({
                    reference: associate.id,
                    status: status,
                    statusLabel: statusLabel,
                    title: associate.name,
                    preview: `${associate.specialisation}  ${associate.clients}/${associate.maxCapacity} clients`,
                    meta: [associate.specialisation],
                    pulseColour: pulseColour,
                    onClick: `openAssociateDetailPanel('${associate.id}')`,
                    dataId: associate.id
                });
            });

            applyCardAnimation(grid);
        }

        // ============================================
        // CLIENT DETAIL VIEW (Full Page Navigation)
        // ============================================

        let currentClientDetailData = null;
        let clientDetailReturnView = 'clients'; // Track where to return to
        let currentClientSection = 'overview';

        function openClientDetailPanel(clientId) {
            // Use unified detail view
            const client = clients.find(c => c.id === clientId);
            if (client) {
                // Add associated therapist info for steward anchor
                const associate = associates.find(a => a.id === client.associateId);
                const enhancedClient = {
                    ...client,
                    associateName: associate ? associate.name : null,
                    associateAvatar: null // Could add avatar URL here
                };
                DetailView.open('client', enhancedClient, 'Clients');
            }
        }

        function showClientDetail(clientId, returnTo = 'clients') {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            const enhancedData = getEnhancedClientData(client);
            currentClientDetailData = enhancedData;
            clientDetailReturnView = returnTo;
            currentClientSection = 'overview';

            // Get associated therapist
            const associate = associates.find(a => a.id === client.associateId);

            // Update header info
            const nameEl = document.getElementById('clientDetailName');
            const ucidEl = document.getElementById('clientDetailUcid');
            const dropdownNameEl = document.getElementById('clientDetailDropdownName');
            const associateLinkEl = document.getElementById('clientAssociateLink');
            const backTextEl = document.getElementById('clientDetailBackText');

            if (nameEl) nameEl.textContent = enhancedData.name || 'Unknown';
            if (ucidEl) ucidEl.textContent = enhancedData.id || '';
            if (dropdownNameEl) dropdownNameEl.textContent = enhancedData.name || 'Unknown';
            if (associateLinkEl) associateLinkEl.textContent = associate ? associate.name : 'Unassigned';
            if (backTextEl) {
                if (returnTo === 'associateDetail') {
                    backTextEl.textContent = 'Back to Associate';
                } else {
                    backTextEl.textContent = 'Back to Clients';
                }
            }

            // Render pipeline stages
            const pipelineEl = document.getElementById('clientDetailPipeline');
            if (pipelineEl) {
                pipelineEl.innerHTML = renderClientPipeline(enhancedData.stage || client.stage);
            }

            // Reset tabs to overview
            document.querySelectorAll('.client-detail-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.section === 'overview') tab.classList.add('active');
            });

            // Render content
            renderClientDetailContent('overview');

            // Show the view
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById('clientDetailView');
            if (targetView) {
                targetView.classList.add('active');
            }

            // Update nav items (deselect all)
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function renderClientPipeline(currentStage) {
            const stages = ['awaiting', 'pending', 'active', 'ending'];
            const labels = { awaiting: 'Awaiting', pending: 'Pending', active: 'Active', ending: 'Ending' };

            return `
                <div class="client-pipeline-horizontal">
                    ${stages.map(stage => `
                        <div class="client-pipeline-stage ${stage} ${stage === currentStage ? 'current' : ''}"
                             onclick="updateClientDetailStage('${stage}')">
                            <div class="client-pipeline-dot"></div>
                            <span class="client-pipeline-label">${labels[stage]}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateClientDetailStage(newStage) {
            if (!currentClientDetailData) return;

            // Update the client's stage
            const clientIndex = clients.findIndex(c => c.id === currentClientDetailData.id);
            if (clientIndex !== -1) {
                clients[clientIndex].stage = newStage;
                currentClientDetailData.stage = newStage;
            }

            // Re-render pipeline
            const pipelineEl = document.getElementById('clientDetailPipeline');
            if (pipelineEl) {
                pipelineEl.innerHTML = renderClientPipeline(newStage);
            }

            showToast(`Stage updated to ${newStage.charAt(0).toUpperCase() + newStage.slice(1)}`);
        }

        function switchClientSection(section) {
            currentClientSection = section;

            // Update tab active state
            document.querySelectorAll('.client-detail-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.section === section) tab.classList.add('active');
            });

            // Render appropriate content
            renderClientDetailContent(section);
        }

        function renderClientDetailContent(section) {
            const contentEl = document.getElementById('clientDetailContent');
            if (!contentEl || !currentClientDetailData) return;

            const client = currentClientDetailData;
            const associate = associates.find(a => a.id === client.associateId);

            switch (section) {
                case 'overview':
                    contentEl.innerHTML = `
                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Contact Details</div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Email</span>
                                <span class="client-detail-value">${client.email || 'Not provided'}</span>
                            </div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Phone</span>
                                <span class="client-detail-value">${client.phone || 'Not provided'}</span>
                            </div>
                        </div>

                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Therapy Details</div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Type</span>
                                <span class="client-detail-value">${client.type || 'Individual'}</span>
                            </div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Therapist</span>
                                <span class="client-detail-value">${associate ? associate.name : 'Unassigned'}</span>
                            </div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Started</span>
                                <span class="client-detail-value">${client.firstSessionDate || 'Not started'}</span>
                            </div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Presenting Issue</span>
                                <span class="client-detail-value">${client.presentingIssue || 'Not specified'}</span>
                            </div>
                        </div>
                    `;
                    break;

                case 'sessions':
                    contentEl.innerHTML = `
                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Upcoming Sessions</div>
                            <div style="padding: 16px; color: var(--eden-text-secondary); font-size: 14px;">
                                No upcoming sessions scheduled
                            </div>
                        </div>

                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Session History</div>
                            <div class="timeline" style="padding: 16px;">
                                <div class="timeline-item">
                                    <div class="timeline-dot past"></div>
                                    <div class="timeline-date">Last Tuesday, 10:00 AM</div>
                                    <div class="timeline-content">Session #12 - Completed</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-dot past"></div>
                                    <div class="timeline-date">2 weeks ago</div>
                                    <div class="timeline-content">Session #11 - Completed</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'finance':
                    contentEl.innerHTML = `
                        <div class="finance-stat-grid" style="padding: 16px;">
                            <div class="finance-stat">
                                <div class="finance-stat-value">${Math.floor(Math.random() * 3000 + 500)}</div>
                                <div class="finance-stat-label">Total Spent</div>
                            </div>
                            <div class="finance-stat">
                                <div class="finance-stat-value">${Math.floor(Math.random() * 5)}</div>
                                <div class="finance-stat-label">Session Credits</div>
                            </div>
                        </div>

                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Payment History</div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Last Payment</span>
                                <span class="client-detail-value">100 - 3 days ago</span>
                            </div>
                            <div class="client-detail-row">
                                <span class="client-detail-label">Payment Method</span>
                                <span class="client-detail-value">Stripe (Visa ****4242)</span>
                            </div>
                        </div>
                    `;
                    break;

                case 'notes':
                    contentEl.innerHTML = `
                        <div class="client-detail-section">
                            <div class="client-detail-section-title">Client Notes</div>
                            <div style="padding: 16px;">
                                <p style="color: var(--eden-text-secondary); font-size: 14px; margin-bottom: 16px;">
                                    Clinical notes are stored securely and can only be accessed by the assigned therapist.
                                </p>
                                <button class="btn-primary" style="width: 100%; padding: 12px; border-radius: 8px; background: var(--eden-green); color: white; border: none; font-weight: 500; cursor: pointer;"
                                    onclick="showToast('Opening secure notes portal...')">
                                    Open Notes Portal
                                </button>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        function closeClientDetail() {
            // Close dropdown if open
            const dropdown = document.getElementById('clientDetailDropdown');
            if (dropdown) dropdown.classList.remove('open');

            // Navigate back based on where we came from
            if (clientDetailReturnView === 'associateDetail' && currentAssociateDetailData) {
                showAssociateDetail(currentAssociateDetailData.id);
            } else {
                showView('clients');
            }
            currentClientDetailData = null;
        }

        function toggleClientDetailMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('clientDetailDropdown');
            if (dropdown) {
                dropdown.classList.toggle('open');
            }
        }

        function navigateFromClientDetail(section) {
            // Close dropdown
            const dropdown = document.getElementById('clientDetailDropdown');
            if (dropdown) dropdown.classList.remove('open');

            switch (section) {
                case 'associate':
                    if (currentClientDetailData && currentClientDetailData.associateId) {
                        showAssociateDetail(currentClientDetailData.associateId);
                    }
                    break;
                case 'sessions':
                    showView('schedule');
                    break;
            }
            currentClientDetailData = null;
        }

        // Close client dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('clientDetailDropdown');
            const menuButton = event.target.closest('.client-detail-menu-btn');

            if (!menuButton && dropdown && !dropdown.contains(event.target)) {
                dropdown.classList.remove('open');
            }
        });

        // ============================================
        // ASSOCIATE DETAIL VIEW (Full Page Navigation)
        // ============================================

        let currentAssociateDetailData = null;

        function showAssociateDetail(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update header info
            const nameEl = document.getElementById('associateDetailName');
            const ucidEl = document.getElementById('associateDetailUcid');
            const dropdownNameEl = document.getElementById('associateDetailDropdownName');

            if (nameEl) nameEl.textContent = enhancedData.name || 'Unknown';
            if (ucidEl) ucidEl.textContent = enhancedData.id || '';
            if (dropdownNameEl) dropdownNameEl.textContent = enhancedData.name || 'Unknown';

            // Render progress stepper
            const stepperEl = document.getElementById('associateDetailStepper');
            if (stepperEl) {
                stepperEl.innerHTML = renderProgressStepper(associateStages, enhancedData);
            }

            // Render content
            const contentEl = document.getElementById('associateDetailContent');
            if (contentEl) {
                const currentStepIndex = calculateCurrentStep(associateStages, enhancedData);
                contentEl.innerHTML = renderOnboardingForm('associate', enhancedData, currentStepIndex);
            }

            // Show the view
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById('associateDetailView');
            if (targetView) {
                targetView.classList.add('active');
            }

            // Update nav items (deselect all, will look like we're on a detail page)
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Scroll to top of the view
            window.scrollTo(0, 0);
        }

        function closeAssociateDetail() {
            // Close dropdown if open
            const dropdown = document.getElementById('associateDetailDropdown');
            if (dropdown) dropdown.classList.remove('open');

            // Navigate back to associates view
            showView('associates');
            currentAssociateDetailData = null;
        }

        function toggleAssociateDetailMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('associateDetailDropdown');
            if (dropdown) {
                dropdown.classList.toggle('open');
            }
        }

        function navigateFromAssociateDetail(section) {
            // Close dropdown
            const dropdown = document.getElementById('associateDetailDropdown');
            if (dropdown) dropdown.classList.remove('open');

            // Navigate to associate-specific view
            if (!currentAssociateDetailData) return;

            switch(section) {
                case 'profile':
                    showAssociateProfilePage(currentAssociateDetailData.id);
                    break;
                case 'sessions':
                    showAssociateSessionsPage(currentAssociateDetailData.id);
                    break;
                case 'contracts':
                    showAssociateContractsPage(currentAssociateDetailData.id);
                    break;
                case 'finance':
                    showAssociateFinancePage(currentAssociateDetailData.id);
                    break;
                case 'inbox':
                    showAssociateInboxPage(currentAssociateDetailData.id);
                    break;
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('associateDetailDropdown');
            const menuButton = event.target.closest('.associate-detail-menu-btn');

            if (!menuButton && dropdown && !dropdown.contains(event.target)) {
                dropdown.classList.remove('open');
            }
        });

        function openAssociateDetailPanel(associateId) {
            // Use unified detail view
            const associate = associates.find(a => a.id === associateId);
            if (associate) {
                DetailView.open('associate', associate, 'Associates');
            }
        }

        // ============================================
        // ASSOCIATE SUB-PAGES (Profile, Sessions, Contracts, Finance, Inbox)
        // ============================================

        // Mock data for associate sessions
        function getAssociateSessions(associateId) {
            return [
                { id: 1, dateTime: 'Mon 20 Jan, 10:00', clientName: 'James & Emma Wilson', sessionType: 'Couples Therapy', status: 'scheduled' },
                { id: 2, dateTime: 'Wed 22 Jan, 14:00', clientName: 'Michael Thompson', sessionType: 'Individual', status: 'scheduled' },
                { id: 3, dateTime: 'Thu 16 Jan, 11:00', clientName: 'Sarah Mitchell', sessionType: 'Individual', status: 'completed' },
                { id: 4, dateTime: 'Tue 14 Jan, 15:00', clientName: 'David & Lisa Chen', sessionType: 'Couples Therapy', status: 'completed' },
                { id: 5, dateTime: 'Fri 10 Jan, 09:30', clientName: 'Rebecca Adams', sessionType: 'Individual', status: 'cancelled' }
            ];
        }

        // Mock data for associate contracts
        function getAssociateContracts(associateId) {
            return [
                { id: 1, name: 'Associate Agreement 2026', dateLabel: 'Signed 1 Jan 2026', status: 'signed' },
                { id: 2, name: 'Data Processing Agreement', dateLabel: 'Signed 1 Jan 2026', status: 'signed' },
                { id: 3, name: 'Insurance Certificate 2026', dateLabel: 'Due 22 Jan 2026', status: 'pending' },
                { id: 4, name: 'Associate Agreement 2025', dateLabel: 'Expired 31 Dec 2025', status: 'expired' }
            ];
        }

        // Mock data for associate finance
        function getAssociateFinance(associateId) {
            return {
                totalEarnings: 431.25,
                sharePercent: 69,
                sessionCount: 9,
                awaitingPayment: 248.40,
                awaitingCount: 4,
                readyForPayout: 182.85,
                readyCount: 3,
                paidOut: 248.40,
                paidCount: 4,
                readySessions: [
                    { id: 1, dateTime: 'Thu 8 Jan at 10:00', clientName: 'James & Emma Wilson', sessionType: 'Couples Therapy', totalAmount: 95, associateAmount: 65.55 },
                    { id: 2, dateTime: 'Tue 6 Jan at 14:00', clientName: 'Michael Thompson', sessionType: 'Individual', totalAmount: 75, associateAmount: 51.75 },
                    { id: 3, dateTime: 'Mon 4 Jan at 11:00', clientName: 'Sarah Mitchell', sessionType: 'Individual', totalAmount: 75, associateAmount: 51.75 }
                ]
            };
        }

        // Mock data for associate messages
        function getAssociateMessages(associateId) {
            return [
                { id: 1, subject: 'Session confirmation for Friday', senderName: 'Eden Admin', timeAgo: '2 hours ago', readAt: null },
                { id: 2, subject: 'Need to reschedule next week', senderName: 'David Mitchell', timeAgo: 'Yesterday', readAt: null },
                { id: 3, subject: 'Payment confirmation', senderName: 'Stripe', timeAgo: '3 days ago', readAt: '2026-01-14T10:00:00Z' },
                { id: 4, subject: 'Monthly summary available', senderName: 'Eden System', timeAgo: '1 week ago', readAt: '2026-01-10T09:00:00Z' }
            ];
        }

        // Close associate subpage and return to main detail
        function closeAssociateSubpage() {
            if (currentAssociateDetailData) {
                showAssociateDetail(currentAssociateDetailData.id);
            } else {
                showView('associates');
            }
        }

        // Helper to show an associate subpage view
        function showAssociateSubpageView(viewId) {
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.add('active');
            }
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            window.scrollTo(0, 0);
        }

        // ============================================
        // PROFILE PAGE
        // ============================================

        function showAssociateProfilePage(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update initials
            const initialsEl = document.getElementById('profileInitials');
            if (initialsEl) initialsEl.textContent = enhancedData.initials || '';

            // Render content
            const contentEl = document.getElementById('associateProfileContent');
            if (contentEl) {
                contentEl.innerHTML = renderAssociateProfilePage(enhancedData);
            }

            showAssociateSubpageView('associateProfileView');
        }

        function renderAssociateProfilePage(data) {
            // Calculate stats
            const capacity = data.maxCapacity ? Math.round((data.clients / data.maxCapacity) * 100) : 0;
            const earningsNum = data.totalEarnings ? parseFloat(data.totalEarnings.replace(/[^0-9.]/g, '')) : 0;
            const inboxCount = 4; // Mock inbox count

            return `
                <div class="profile-page">
                    <!-- This Month Stats -->
                    <section class="profile-section">
                        <h2 class="profile-section-label">This Month</h2>
                        <div class="profile-stats-row">
                            <button class="profile-stat-card" onclick="navigateFromAssociateDetail('inbox')">
                                <p class="profile-stat-value">${inboxCount}</p>
                                <div class="profile-stat-label">
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                    <span>Inbox</span>
                                </div>
                            </button>
                            <div class="profile-stat-card">
                                <p class="profile-stat-value">${capacity}%</p>
                                <p class="profile-stat-label-text">Capacity</p>
                            </div>
                            <button class="profile-stat-card" onclick="navigateFromAssociateDetail('finance')">
                                <p class="profile-stat-value profile-stat-value-green">${earningsNum.toLocaleString()}</p>
                                <div class="profile-stat-label">
                                    <span>Earnings</span>
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <polyline points="9 18 15 12 9 6"/>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </section>

                    <!-- Profile Info -->
                    <section class="profile-section">
                        <h2 class="profile-section-label">Profile</h2>
                        <div class="profile-info-card">
                            <a href="mailto:${data.email || ''}" class="profile-info-row profile-info-row-link">
                                <span class="profile-info-label">Email</span>
                                <div class="profile-info-value-wrap">
                                    <span class="profile-info-value">${data.email || ''}</span>
                                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <polyline points="9 18 15 12 9 6"/>
                                    </svg>
                                </div>
                            </a>
                            <a href="tel:${data.phone || ''}" class="profile-info-row profile-info-row-link">
                                <span class="profile-info-label">Phone</span>
                                <div class="profile-info-value-wrap">
                                    <span class="profile-info-value">${data.phone || ''}</span>
                                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <polyline points="9 18 15 12 9 6"/>
                                    </svg>
                                </div>
                            </a>
                            <div class="profile-info-row">
                                <span class="profile-info-label">Specialisms</span>
                                <span class="profile-info-value">${data.specialisation || ''}</span>
                            </div>
                            <div class="profile-info-row">
                                <span class="profile-info-label">Support Mode</span>
                                <span class="profile-info-value">${data.supportMode ? data.supportMode.charAt(0).toUpperCase() + data.supportMode.slice(1) : ''}</span>
                            </div>
                        </div>
                    </section>

                    <!-- Practice Info -->
                    <section class="profile-section">
                        <h2 class="profile-section-label">Practice Info</h2>
                        <div class="profile-info-card">
                            <div class="profile-info-row">
                                <span class="profile-info-label">Joined</span>
                                <span class="profile-info-value">${data.joinDate || ''}</span>
                            </div>
                            <div class="profile-info-row">
                                <span class="profile-info-label">Fee Split</span>
                                <span class="profile-info-value">69/31</span>
                            </div>
                        </div>
                    </section>
                </div>
            `;
        }

        // ============================================
        // SESSIONS PAGE
        // ============================================

        function showAssociateSessionsPage(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update initials
            const initialsEl = document.getElementById('sessionsInitials');
            if (initialsEl) initialsEl.textContent = enhancedData.initials || '';

            // Get sessions
            const sessions = getAssociateSessions(associateId);

            // Render content
            const contentEl = document.getElementById('associateSessionsContent');
            if (contentEl) {
                contentEl.innerHTML = renderAssociateSessionsPage(sessions);
            }

            showAssociateSubpageView('associateSessionsView');
        }

        function renderAssociateSessionsPage(sessions) {
            const upcoming = sessions.filter(s => s.status === 'scheduled');
            const completed = sessions.filter(s => s.status === 'completed');
            const cancelled = sessions.filter(s => s.status === 'cancelled');

            const renderSessionCard = (session) => {
                const statusStyles = {
                    scheduled: 'session-status-scheduled',
                    completed: 'session-status-completed',
                    cancelled: 'session-status-cancelled'
                };
                const statusLabels = {
                    scheduled: 'Scheduled',
                    completed: 'Completed',
                    cancelled: 'Cancelled'
                };

                return `
                    <div class="session-card">
                        <div class="session-card-header">
                            <p class="session-card-date">${session.dateTime}</p>
                            <span class="session-status ${statusStyles[session.status]}">${statusLabels[session.status]}</span>
                        </div>
                        <p class="session-card-client">${session.clientName}</p>
                        <p class="session-card-type">${session.sessionType}</p>
                    </div>
                `;
            };

            let html = '<div class="sessions-page">';

            if (upcoming.length > 0) {
                html += `
                    <section class="sessions-section">
                        <h2 class="sessions-section-label">Upcoming</h2>
                        <div class="sessions-list">
                            ${upcoming.map(renderSessionCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (completed.length > 0) {
                html += `
                    <section class="sessions-section">
                        <h2 class="sessions-section-label">Completed</h2>
                        <div class="sessions-list">
                            ${completed.map(renderSessionCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (cancelled.length > 0) {
                html += `
                    <section class="sessions-section">
                        <h2 class="sessions-section-label">Cancelled</h2>
                        <div class="sessions-list">
                            ${cancelled.map(renderSessionCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (sessions.length === 0) {
                html += `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <p>No sessions found</p>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        // ============================================
        // CONTRACTS PAGE
        // ============================================

        function showAssociateContractsPage(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update initials
            const initialsEl = document.getElementById('contractsInitials');
            if (initialsEl) initialsEl.textContent = enhancedData.initials || '';

            // Get contracts
            const contracts = getAssociateContracts(associateId);

            // Render content
            const contentEl = document.getElementById('associateContractsContent');
            if (contentEl) {
                contentEl.innerHTML = renderAssociateContractsPage(contracts);
            }

            showAssociateSubpageView('associateContractsView');
        }

        function renderAssociateContractsPage(contracts) {
            const signed = contracts.filter(c => c.status === 'signed');
            const pending = contracts.filter(c => c.status === 'pending');
            const expired = contracts.filter(c => c.status === 'expired');

            const renderContractCard = (contract) => {
                const statusStyles = {
                    signed: 'contract-status-signed',
                    pending: 'contract-status-pending',
                    expired: 'contract-status-expired'
                };
                const statusLabels = {
                    signed: 'Signed',
                    pending: 'Pending',
                    expired: 'Expired'
                };

                return `
                    <div class="contract-card">
                        <div class="contract-card-content">
                            <p class="contract-card-name">${contract.name}</p>
                            <p class="contract-card-date">${contract.dateLabel}</p>
                        </div>
                        <span class="contract-status ${statusStyles[contract.status]}">${statusLabels[contract.status]}</span>
                    </div>
                `;
            };

            let html = '<div class="contracts-page">';

            if (signed.length > 0) {
                html += `
                    <section class="contracts-section">
                        <h2 class="contracts-section-label">Active</h2>
                        <div class="contracts-list">
                            ${signed.map(renderContractCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (pending.length > 0) {
                html += `
                    <section class="contracts-section">
                        <h2 class="contracts-section-label">Pending</h2>
                        <div class="contracts-list">
                            ${pending.map(renderContractCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (expired.length > 0) {
                html += `
                    <section class="contracts-section">
                        <h2 class="contracts-section-label">Expired</h2>
                        <div class="contracts-list">
                            ${expired.map(renderContractCard).join('')}
                        </div>
                    </section>
                `;
            }

            if (contracts.length === 0) {
                html += `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <p>No contracts found</p>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        // ============================================
        // FINANCE PAGE (Payout Cockpit)
        // ============================================

        let financeExpandedSection = 'ready';

        function showAssociateFinancePage(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update initials
            const initialsEl = document.getElementById('financeInitials');
            if (initialsEl) initialsEl.textContent = enhancedData.initials || '';

            // Get finance data
            const financeData = getAssociateFinance(associateId);

            // Render content
            const contentEl = document.getElementById('associateFinanceContent');
            if (contentEl) {
                contentEl.innerHTML = renderAssociateFinancePage(financeData);
            }

            showAssociateSubpageView('associateFinanceView');
        }

        function toggleFinanceSection(section) {
            financeExpandedSection = financeExpandedSection === section ? null : section;
            // Re-render the finance page
            if (currentAssociateDetailData) {
                const financeData = getAssociateFinance(currentAssociateDetailData.id);
                const contentEl = document.getElementById('associateFinanceContent');
                if (contentEl) {
                    contentEl.innerHTML = renderAssociateFinancePage(financeData);
                }
            }
        }

        function renderAssociateFinancePage(data) {
            const totalPipeline = data.awaitingPayment + data.readyForPayout + data.paidOut;
            const paidPercent = totalPipeline > 0 ? ((data.paidOut + data.readyForPayout) / totalPipeline) * 100 : 0;

            const renderSessionRow = (session) => `
                <div class="finance-session-row">
                    <span class="finance-session-dot"></span>
                    <div class="finance-session-info">
                        <p class="finance-session-date">${session.dateTime}</p>
                        <p class="finance-session-client">${session.clientName}</p>
                        <p class="finance-session-type">${session.sessionType}</p>
                    </div>
                    <div class="finance-session-amounts">
                        <p class="finance-session-total">${session.totalAmount}</p>
                        <p class="finance-session-share">${session.associateAmount.toFixed(2)} to you</p>
                    </div>
                </div>
            `;

            const chevronDown = `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="6 9 12 15 18 9"/></svg>`;
            const chevronUp = `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="18 15 12 9 6 15"/></svg>`;

            return `
                <div class="finance-page">
                    <!-- Hero Earnings Card -->
                    <div class="finance-hero-card">
                        <p class="finance-hero-label">Your Earnings This Month</p>
                        <p class="finance-hero-amount">${data.totalEarnings.toLocaleString('en-GB', { minimumFractionDigits: 2 })}</p>
                        <p class="finance-hero-subtitle">Your ${data.sharePercent}% share from ${data.sessionCount} sessions</p>

                        <div class="finance-progress-bar">
                            <div class="finance-progress-fill" style="width: ${paidPercent}%"></div>
                        </div>
                        <div class="finance-progress-labels">
                            <span>${data.paidOut.toLocaleString('en-GB', { minimumFractionDigits: 2 })} paid out</span>
                            <span>${data.readyForPayout.toLocaleString('en-GB', { minimumFractionDigits: 2 })} ready</span>
                        </div>
                    </div>

                    <!-- Status Cards Row -->
                    <div class="finance-status-row">
                        <div class="finance-status-card">
                            <p class="finance-status-amount finance-status-amber">${data.awaitingPayment.toLocaleString('en-GB', { minimumFractionDigits: 2 })}</p>
                            <p class="finance-status-label">Awaiting</p>
                            <p class="finance-status-label">Payment</p>
                            <p class="finance-status-count">${data.awaitingCount} sessions</p>
                        </div>
                        <div class="finance-status-card">
                            <p class="finance-status-amount finance-status-green">${data.readyForPayout.toLocaleString('en-GB', { minimumFractionDigits: 2 })}</p>
                            <p class="finance-status-label">Ready for</p>
                            <p class="finance-status-label">Payout</p>
                            <p class="finance-status-count">${data.readyCount} sessions</p>
                        </div>
                        <div class="finance-status-card">
                            <p class="finance-status-amount finance-status-blue">${data.paidOut.toLocaleString('en-GB', { minimumFractionDigits: 2 })}</p>
                            <p class="finance-status-label">Paid to</p>
                            <p class="finance-status-label">You</p>
                            <p class="finance-status-count">${data.paidCount} sessions</p>
                        </div>
                    </div>

                    <!-- Sessions Ready for Payout - Expandable -->
                    <div class="finance-expandable-section">
                        <button class="finance-expandable-header" onclick="toggleFinanceSection('ready')">
                            <span>Sessions Ready for Payout</span>
                            ${financeExpandedSection === 'ready' ? chevronUp : chevronDown}
                        </button>
                        ${financeExpandedSection === 'ready' ? `
                            <div class="finance-expandable-content">
                                ${data.readySessions && data.readySessions.length > 0
                                    ? data.readySessions.map(renderSessionRow).join('')
                                    : '<p class="finance-empty-message">No sessions ready for payout</p>'
                                }
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ============================================
        // INBOX PAGE
        // ============================================

        function showAssociateInboxPage(associateId) {
            const associate = associates.find(a => a.id === associateId);
            if (!associate) return;

            const enhancedData = getEnhancedAssociateData(associate);
            currentAssociateDetailData = enhancedData;

            // Update initials
            const initialsEl = document.getElementById('inboxInitials');
            if (initialsEl) initialsEl.textContent = enhancedData.initials || '';

            // Get messages
            const messages = getAssociateMessages(associateId);

            // Render content
            const contentEl = document.getElementById('associateInboxContent');
            if (contentEl) {
                contentEl.innerHTML = renderAssociateInboxPage(messages);
            }

            showAssociateSubpageView('associateInboxView');
        }

        function renderAssociateInboxPage(messages) {
            const renderMessageRow = (message) => {
                const isUnread = !message.readAt;
                return `
                    <button class="inbox-message-row" onclick="handleMessageClick('${message.id}')">
                        <div class="inbox-message-indicator">
                            ${isUnread ? '<span class="inbox-unread-dot"></span>' : ''}
                        </div>
                        <div class="inbox-message-content">
                            <div class="inbox-message-header">
                                <h3 class="inbox-message-subject ${isUnread ? 'inbox-message-unread' : ''}">${message.subject}</h3>
                                <span class="inbox-message-time">${message.timeAgo}</span>
                            </div>
                            <p class="inbox-message-sender">${message.senderName}</p>
                        </div>
                    </button>
                `;
            };

            return `
                <div class="inbox-page">
                    <!-- Messages Header -->
                    <div class="inbox-header">
                        <h2 class="inbox-header-label">Messages</h2>
                        <button class="inbox-compose-btn" onclick="handleComposeClick()">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.5">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>Compose</span>
                        </button>
                    </div>

                    <!-- Messages List -->
                    <div class="inbox-messages-list">
                        ${messages.length === 0
                            ? `
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                    <p>No messages yet</p>
                                </div>
                            `
                            : messages.map(renderMessageRow).join('')
                        }
                    </div>
                </div>
            `;
        }

        function handleMessageClick(messageId) {
            // TODO: Open message detail view
            console.log('Open message:', messageId);
        }

        function handleComposeClick() {
            // TODO: Open compose message view
            console.log('Open compose');
        }

        // ============================================
        // REFERRAL DETAIL VIEW (Full Page Navigation)
        // ============================================

        let currentReferralDetailData = null;

        function showReferralDetail(referralId, mode = 'view') {
            const referral = referrals.find(r => r.id === referralId);
            if (!referral) return;

            currentReferralDetailData = { ...referral, mode: mode };
            selectedReferral = referral;

            // Update header and banner
            const bannerEl = document.getElementById('referralDetailBanner');
            const badgeEl = document.getElementById('referralDetailBadge');
            const titleEl = document.getElementById('referralDetailTitle');
            const subtitleEl = document.getElementById('referralDetailSubtitle');

            if (titleEl) titleEl.textContent = referral.id;
            if (subtitleEl) subtitleEl.textContent = referral.enquiry || 'Client enquiry details';

            // Set banner color based on status
            const statusClass = referral.status.toLowerCase().replace(' ', '-').replace('allocation', '');
            if (bannerEl) {
                bannerEl.className = 'referral-detail-banner ' + statusClass;
            }
            if (badgeEl) {
                badgeEl.textContent = referral.status;
            }

            // Render content based on mode
            renderReferralDetailContent(mode);

            // Render bottom actions based on status
            renderReferralDetailActions();

            // Show the view
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const targetView = document.getElementById('referralDetailView');
            if (targetView) {
                targetView.classList.add('active');
            }

            // Update nav items (deselect all)
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function renderReferralDetailContent(mode) {
            const contentEl = document.getElementById('referralDetailContent');
            if (!contentEl || !currentReferralDetailData) return;

            const ref = currentReferralDetailData;
            const eligibleAssociates = getEligibleAssociates ? getEligibleAssociates(ref) : [];

            let html = `
                <div class="referral-detail-section">
                    <div class="referral-detail-section-title">Enquiry Details</div>
                    <div class="referral-detail-card">
                        <div class="referral-detail-row">
                            <span class="referral-detail-label">Type</span>
                            <span class="referral-detail-value">${ref.type || 'Individual'}</span>
                        </div>
                        <div class="referral-detail-row">
                            <span class="referral-detail-label">Received</span>
                            <span class="referral-detail-value">${ref.receivedDate || 'Today'}</span>
                        </div>
                        <div class="referral-detail-row">
                            <span class="referral-detail-label">Source</span>
                            <span class="referral-detail-value">${ref.source || 'Website'}</span>
                        </div>
                    </div>
                </div>

                <div class="referral-detail-section">
                    <div class="referral-detail-section-title">Client Message</div>
                    <div class="referral-detail-card">
                        <div style="padding: 16px; font-size: 14px; line-height: 1.6; color: var(--eden-text);">
                            ${ref.enquiry || 'No additional details provided.'}
                        </div>
                    </div>
                </div>
            `;

            // Show eligible associates for triage/allocate modes
            if ((mode === 'triage' || mode === 'allocate') && eligibleAssociates.length > 0) {
                html += `
                    <div class="referral-detail-section">
                        <div class="referral-detail-section-title">Eligible Associates (${eligibleAssociates.length})</div>
                        <div class="referral-detail-card">
                            ${eligibleAssociates.map(a => `
                                <div class="referral-detail-row" style="cursor: pointer;" onclick="showToast('Selected ${a.name}')">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--eden-green-light); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; color: var(--eden-green);">
                                            ${a.initials}
                                        </div>
                                        <div>
                                            <div style="font-weight: 500; color: var(--eden-text);">${a.name}</div>
                                            <div style="font-size: 12px; color: var(--eden-text-secondary);">${a.specialisation}</div>
                                        </div>
                                    </div>
                                    <span style="color: var(--eden-text-secondary); font-size: 13px;">${a.clients}/${a.maxCapacity}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Show interest expressions for pending status
            if (ref.status === 'Pending Allocation' && ref.interests && ref.interests.length > 0) {
                html += `
                    <div class="referral-detail-section">
                        <div class="referral-detail-section-title">Interest Received (${ref.interests.length})</div>
                        <div class="referral-detail-card">
                            ${ref.interests.map(interest => {
                                const assoc = associates.find(a => a.id === interest.associateId);
                                return assoc ? `
                                    <div class="referral-detail-row" style="cursor: pointer;" onclick="allocateReferralTo('${assoc.id}')">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--eden-green-light); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; color: var(--eden-green);">
                                                ${assoc.initials}
                                            </div>
                                            <div>
                                                <div style="font-weight: 500; color: var(--eden-text);">${assoc.name}</div>
                                                <div style="font-size: 12px; color: var(--eden-text-secondary);">${assoc.specialisation}</div>
                                            </div>
                                        </div>
                                        <button style="padding: 6px 12px; background: var(--eden-green); color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;">
                                            Allocate
                                        </button>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            contentEl.innerHTML = html;
        }

        function renderReferralDetailActions() {
            const actionsEl = document.getElementById('referralDetailActions');
            if (!actionsEl || !currentReferralDetailData) return;

            const ref = currentReferralDetailData;
            let html = '';

            switch (ref.status) {
                case 'New':
                    html = `
                        <button class="referral-action-btn secondary" onclick="closeReferralDetail()">Cancel</button>
                        <button class="referral-action-btn primary" onclick="broadcastReferral()">Broadcast to Associates</button>
                    `;
                    break;
                case 'Broadcasting':
                    html = `
                        <button class="referral-action-btn secondary" onclick="closeReferralDetail()">Close</button>
                        <button class="referral-action-btn primary" onclick="showToast('Viewing responses...')">View Responses</button>
                    `;
                    break;
                case 'Pending Allocation':
                    html = `
                        <button class="referral-action-btn secondary" onclick="closeReferralDetail()">Close</button>
                        <button class="referral-action-btn primary" onclick="showToast('Select an associate above')">Allocate</button>
                    `;
                    break;
                case 'Accepted':
                    html = `
                        <button class="referral-action-btn primary" onclick="closeReferralDetail()" style="flex: 1;">Done</button>
                    `;
                    break;
                default:
                    html = `
                        <button class="referral-action-btn primary" onclick="closeReferralDetail()" style="flex: 1;">Close</button>
                    `;
            }

            actionsEl.innerHTML = html;
        }

        function closeReferralDetail() {
            currentReferralDetailData = null;
            selectedReferral = null;
            showView('referrals');
        }

        function broadcastReferral() {
            if (!currentReferralDetailData) return;

            const refIndex = referrals.findIndex(r => r.id === currentReferralDetailData.id);
            if (refIndex !== -1) {
                referrals[refIndex].status = 'Broadcasting';
                referrals[refIndex].broadcastTime = new Date();
            }

            showToast('Referral broadcast to eligible associates');
            closeReferralDetail();
            renderReferrals();
        }

        function allocateReferralTo(associateId) {
            if (!currentReferralDetailData) return;

            const assoc = associates.find(a => a.id === associateId);
            const refIndex = referrals.findIndex(r => r.id === currentReferralDetailData.id);

            if (refIndex !== -1 && assoc) {
                referrals[refIndex].status = 'Accepted';
                referrals[refIndex].allocatedTo = associateId;
                showToast(`Allocated to ${assoc.name}`);
                closeReferralDetail();
                renderReferrals();
            }
        }

        // Update openReferralPanel to use full page navigation
        // (Keep original function for backwards compatibility, but redirect to new view)

        // ============================================
        // INITIALIZATION
        // ============================================

        function init() {
            renderCards();
            initTabs();
            initNavigation();
            initBottomSheetSwipe();

            // Initialize new views
            renderFrictionFeed();
            renderAllClientsGrid();
            renderContractsGrid();
            renderCalendar();
            renderCpdActivities();
            renderInboxMessages();

            // Initialize Phase 2 modules
            initSimulator();

            // Initialize Finance Integration (True Cash)
            initTrueCash();

            // Initialize Role-Based Navigation (Phase 4)
            updateNavigationForRole();

            // Initialize Ivy Wallet-inspired Home Screens
            updateHomeScreenForRole();

            // Initialize Referral System
            renderReferrals();

            // Handle window resize
            window.addEventListener('resize', handleResize);

            // Set initial mobile state
            isMobile = window.innerWidth <= 768;
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);

        // ============================================
        // MOBILE BOTTOM NAV LOGIC
        // ============================================

        (function() {
            // Wait for DOM to be ready
            document.addEventListener('DOMContentLoaded', function() {
                const bottomNav = document.getElementById('mobile-bottom-nav');
                if (!bottomNav) return;

                const navItems = bottomNav.querySelectorAll('.bottom-nav-item');
                const peopleNavItem = document.getElementById('people-nav-item');
                const peopleNavLabel = document.getElementById('people-nav-label');

                // Update "People" nav item based on role
                function updatePeopleNavForRole() {
                    const isAdmin = currentUserRole === 'admin';
                    if (isAdmin) {
                        peopleNavLabel.textContent = 'Associates';
                        peopleNavItem.setAttribute('data-destination', 'associates');
                    } else {
                        peopleNavLabel.textContent = 'My Clients';
                        peopleNavItem.setAttribute('data-destination', 'my-clients');
                    }
                }

                // Initialize role-specific label
                updatePeopleNavForRole();

                // Handle nav item clicks
                navItems.forEach(function(item) {
                    item.addEventListener('click', function() {
                        const navTarget = this.getAttribute('data-nav');

                        // Close any open detail view first
                        if (typeof DetailView !== 'undefined' && DetailView.close) {
                            DetailView.close();
                        }

                        // Remove active class from all items
                        navItems.forEach(function(nav) {
                            nav.classList.remove('active');
                            nav.removeAttribute('aria-current');
                        });

                        // Add active class to clicked item
                        this.classList.add('active');
                        this.setAttribute('aria-current', 'page');

                        // Navigate to the appropriate view
                        switch(navTarget) {
                            case 'home':
                                showView('dashboard');
                                break;
                            case 'actions':
                                showView('action-centre');
                                break;
                            case 'people':
                                // Navigate based on role
                                if (currentUserRole === 'admin') {
                                    showView('associates');
                                } else {
                                    showView('clients');
                                }
                                break;
                            case 'earnings':
                                showView('earnings');
                                break;
                        }
                    });
                });

                // Update badge count for Actions
                window.updateActionsBadge = function(count) {
                    const badge = document.getElementById('actions-badge');
                    if (badge) {
                        if (count > 0) {
                            badge.textContent = count > 99 ? '99+' : count;
                            badge.style.display = 'flex';
                        } else {
                            badge.style.display = 'none';
                        }
                    }
                };

                // Sync active state with current view
                window.syncBottomNavState = function(viewName) {
                    navItems.forEach(function(item) {
                        item.classList.remove('active');
                        item.removeAttribute('aria-current');
                    });

                    let targetNav = null;
                    switch(viewName) {
                        case 'dashboard':
                        case 'home':
                            targetNav = 'home';
                            break;
                        case 'action-centre':
                        case 'actions':
                            targetNav = 'actions';
                            break;
                        case 'associates':
                        case 'clients':
                        case 'my-clients':
                            targetNav = 'people';
                            break;
                        case 'earnings':
                        case 'payout':
                        case 'financial-vitality':
                            targetNav = 'earnings';
                            break;
                    }

                    if (targetNav) {
                        const activeItem = bottomNav.querySelector('[data-nav="' + targetNav + '"]');
                        if (activeItem) {
                            activeItem.classList.add('active');
                            activeItem.setAttribute('aria-current', 'page');
                        }
                    }
                };

                // Update bottom nav when role changes
                window.updateBottomNavForRole = function() {
                    updatePeopleNavForRole();
                };

                // Initialize action badge with current friction count
                function initActionsBadge() {
                    if (typeof frictionItems !== 'undefined') {
                        window.updateActionsBadge(frictionItems.length);
                    }
                }
                initActionsBadge();
            });
        })();
    </script>

    <!-- Mobile Bottom Nav - Only visible on mobile (768px and below) -->
    <nav id="mobile-bottom-nav" class="mobile-bottom-nav" aria-label="Mobile navigation">
        <button class="bottom-nav-item active" data-nav="home" aria-current="page">
            <svg class="bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="bottom-nav-label">Home</span>
        </button>

        <button class="bottom-nav-item" data-nav="actions">
            <svg class="bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
            <span class="bottom-nav-label">Actions</span>
            <span id="actions-badge" class="bottom-nav-badge" style="display: none;">0</span>
        </button>

        <button class="bottom-nav-item" data-nav="people" id="people-nav-item">
            <svg class="bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span class="bottom-nav-label" id="people-nav-label">Associates</span>
        </button>

        <button class="bottom-nav-item" data-nav="earnings">
            <svg class="bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            <span class="bottom-nav-label">Earnings</span>
        </button>
    </nav>
</body>
</html>
